import{v as M,bO as Q,z,A as r,B as g,Y as F,C as O,D as E,y as u,bp as I,ay as Y,b7 as D,c4 as H,cm as L,cc as U,bY as V}from"./index-Bl2lQPd7.js";import{T as j}from"./TouchPan-jBhMORlX.js";import{b as A}from"./format-IcNrutKL.js";const b=40,m=20,K=M({name:"QPullToRefresh",props:{color:String,bgColor:String,icon:String,noMouse:Boolean,disable:Boolean,scrollTarget:Q},emits:["refresh"],setup(l,{slots:w,emit:x}){const{proxy:s}=z(),{$q:y}=s,t=r("pull"),i=r(0),o=r(!1),c=r(-40),f=r(!1),h=r({}),C=g(()=>({opacity:i.value,transform:`translateY(${c.value}px) rotate(${i.value*360}deg)`})),_=g(()=>"q-pull-to-refresh__puller row flex-center"+(f.value===!0?" q-pull-to-refresh__puller--animating":"")+(l.bgColor!==void 0?` bg-${l.bgColor}`:""));function P(e){if(e.isFinal===!0){o.value===!0&&(o.value=!1,t.value==="pulled"?(t.value="refreshing",v({pos:m}),T()):t.value==="pull"&&v({pos:-40,ratio:0}));return}if(f.value===!0||t.value==="refreshing")return!1;if(e.isFirst===!0){if(L(S)!==0||e.direction!=="down")return o.value===!0&&(o.value=!1,t.value="pull",v({pos:-40,ratio:0})),!1;o.value=!0;const{top:R,left:B}=s.$el.getBoundingClientRect();h.value={top:R+"px",left:B+"px",width:window.getComputedStyle(s.$el).getPropertyValue("width")}}U(e.evt);const n=Math.min(140,Math.max(0,e.distance.y));c.value=n-b,i.value=A(n/(m+b),0,1);const p=c.value>m?"pulled":"pull";t.value!==p&&(t.value=p)}const $=g(()=>{const e={down:!0};return l.noMouse!==!0&&(e.mouse=!0),[[j,P,void 0,e]]}),q=g(()=>`q-pull-to-refresh__content${o.value===!0?" no-pointer-events":""}`);function T(){x("refresh",()=>{v({pos:-40,ratio:0},()=>{t.value="pull"})})}let S,a=null;function v({pos:e,ratio:n},p){f.value=!0,c.value=e,n!==void 0&&(i.value=n),a!==null&&clearTimeout(a),a=setTimeout(()=>{a=null,f.value=!1,p?.()},300)}function d(){S=V(s.$el,l.scrollTarget)}return F(()=>l.scrollTarget,d),O(d),E(()=>{a!==null&&clearTimeout(a)}),Object.assign(s,{trigger:T,updateScrollTarget:d}),()=>{const e=[u("div",{class:q.value},I(w.default)),u("div",{class:"q-pull-to-refresh__puller-container fixed row flex-center no-pointer-events z-top",style:h.value},[u("div",{class:_.value,style:C.value},[t.value!=="refreshing"?u(Y,{name:l.icon||y.iconSet.pullToRefresh.icon,color:l.color,size:"32px"}):u(D,{size:"24px",color:l.color})])])];return H("div",{class:"q-pull-to-refresh"},e,"main",l.disable===!1,()=>$.value)}}});export{K as Q};
