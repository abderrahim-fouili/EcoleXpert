import{_ as T,ar as U,aq as H,as as W,at as G,ag as x,a4 as g,S as o,Q as i,R as f,a5 as t,a6 as e,ad as c,ab as n,a3 as p,a7 as w,a8 as u,a9 as _,aa as C,av as y,aw as Q,ax as O,ay as A,af as M,az as J,aA as j,aD as K,h as X,aN as D,aJ as Y,aB as z}from"./index-Bl2lQPd7.js";import{Q as b,a as m}from"./QItem-De3v03wU.js";import{Q as k}from"./QList-CMzNTEGD.js";import{Q as N}from"./QMenu-BNr9Tzvf.js";import{Q as V}from"./QToolbarTitle-C8APieXG.js";import{Q as B}from"./QBadge-Bjfo5tRO.js";import{Q as q}from"./QItemLabel-BkJiB6aE.js";import{Q as Z}from"./QExpansionItem-EMhshZ_3.js";import{Q as $}from"./QScrollArea-DbARZhEV.js";import{_ as ee,Q as te}from"./SchoolSwitcher-D06IRcd0.js";import{Q as le}from"./QToolbar-DR-_wX4W.js";import{Q as se}from"./QFooter-BqOQs2Wv.js";import{C as E}from"./ClosePopup-BY_YGFBZ.js";import{E as ae}from"./Header-iKAj_IF4.js";import{N as re}from"./Notifications-DUxCRqy9.js";import{s as F}from"./notif-Ca_8-ZkB.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./QSlideTransition-CrdUnXBf.js";import"./TouchPan-jBhMORlX.js";import"./touch-BjYP5sR0.js";import"./format-IcNrutKL.js";import"./composables-CAkrP3jA.js";import"./QBanner-xBGiroIy.js";import"./QPageSticky-adQ0nSeI.js";import"./QHeader-B4MlZ-LM.js";import"./QSpace-CKKoNTi_.js";import"./groupBy-BgHPVcz-.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./_curry1-CPMemvwC.js";import"./_xfBase-ZXVHuZFu.js";import"./_reduce-BZMr9wpn.js";import"./_isArrayLike-B3kKjEvQ.js";import"./index-Dx01H97j.js";import"./index-CbPSoDvq.js";const oe={name:"MyLayout",data(){return{isFullscreen:!1,settingeDialog:!1,showNotifs:!1,drawerOpen:this.$q.platform.is.desktop}},components:{EpHeader:ae,Notifications:re,SchoolSwitcher:ee},computed:{...G({user:"user/user",config:"user/config",links:"user/nav",notificationCounter:"notification/counter",current:"user/current",darkMode:"darkMode",title:"title",footer:"footer"}),eleve(){if(this.current&&this.current.hasOwnProperty("eleve"))return this.current.eleve},annee(){if(this.current&&this.current.hasOwnProperty("annee"))return this.current.annee},dark:{get(){return this.darkMode},set(r){this.toggleDarkMode()}}},methods:{...W({logout:"user/logout",nav:"user/nav",setDefaults:"user/setDefaults",toggleEleve:"user/setEleve",togglAnnee:"user/setAnnee",getEmploi:"emploi/getData",getDevoirs:"devoirs/getDevoirs",setCounter:"notification/setCounter",toggleDarkMode:"toggleDarkMode"}),isDev:H,openURL:U,clearNotifCounter(){this.setCounter(0)},subscribeAll(r){if(this.$q.platform.is.cordova){let a="ecoleplus_"+r;F(a+"_eleve"),F(a+"_"+this.user.idpers)}},setEleve(r){this.toggleEleve(r),this.go("/eleve")},setAnnee(r){this.togglAnnee(r),this.go("/eleve")},avatar(){return z(this.user)},personAvatar(r){return z(r)},deconnexion(){this.logout(),this.$router.push("/login")},minimize(){},maximize(){},fullscreen(){this.$q.electron.remote.BrowserWindow.getFocusedWindow().setFullScreen(this.isFullscreen=!this.isFullscreen)},close(){}},watch:{annee(){this.getEmploi(this.annee),this.getDevoirs({page:1,filter:{annee:this.annee.idannee,classe:this.annee.pivot.idclasse}})}},created(){Y("eleve")},mounted(){this.canAccess(this.config),this.nav(),this.setDefaults(this.config),this.subscribeAll(X),D.length&&(D[0].includes("message")||this.$router.push("/eleve"+D[0]),D.splice(0,D.length))}},ne=["src"],ie=["src"],ue={class:"col-xs-10",style:{position:"relative"}},de={class:"absolute-top text-white bg1",style:{height:"150px",overflow:"hidden"}},fe={class:"absolute-bottom text-center"},ce=["src"],me={class:"text-weight-bold text-white text-shadow q-mb-xl"},pe={class:"absolute-bottom text-left q-pa-sm"},ve=["src"],ge={class:"q-ml-sm"},_e=["src"],he={class:"col-xs-2 bg-white text-dark q-pt-lg q-pb-lg q-pr-xs",style:{position:"relative"}};function be(r,a,ke,we,d,s){const P=x("ep-header"),S=x("school-switcher"),I=x("router-view"),L=x("notifications");return o(),g(_,null,[r.user?(o(),i(j,{key:0,view:"hhr lpR fFr",class:M({page:!0})},{default:e(()=>[t(P,null,{toolbar:e(()=>[s.eleve?(o(),i(p,{key:0,flat:""},{default:e(()=>[t(w,{size:"45px"},{default:e(()=>[u("img",{src:s.personAvatar(s.eleve)},null,8,ne)]),_:1}),t(N,null,{default:e(()=>[t(k,{flat:""},{default:e(()=>[(o(!0),g(_,null,C(r.config.meta.eleves,(l,h)=>y((o(),i(b,{clickable:"",key:h,onClick:v=>s.setEleve(l),active:s.eleve.idpers===l.idpers},{default:e(()=>[t(m,{avatar:""},{default:e(()=>[t(w,null,{default:e(()=>[u("img",{src:s.personAvatar(l)},null,8,ie)]),_:2},1024)]),_:2},1024),t(m,null,{default:e(()=>[c(n(l.nom)+" "+n(l.prenom),1)]),_:2},1024)]),_:2},1032,["onClick","active"])),[[E],[Q]])),128))]),_:1})]),_:1})]),_:1})):f("",!0),s.annee?(o(),i(p,{key:1,flat:"",icon:"pending_actions",dark:""},{default:e(()=>[c(n(s.annee.description)+" ",1),t(N,null,{default:e(()=>[t(k,{link:""},{default:e(()=>[(o(!0),g(_,null,C(s.eleve.annees,(l,h)=>y((o(),i(b,{clickable:"",key:h,onClick:v=>s.setAnnee(l),active:s.annee.idannee===l.idannee},{default:e(()=>[t(m,null,{default:e(()=>[c(n(l.description)+" - "+n(l.pivot.classes.classe_fr),1)]),_:2},1024)]),_:2},1032,["onClick","active"])),[[E],[Q]])),128))]),_:1})]),_:1})]),_:1})):f("",!0),t(V),t(p,{onClick:a[0]||(a[0]=l=>r.go("/eleve")),flat:"",round:"",dense:"",icon:"icon_home",class:"q-mr-xs"}),t(p,{flat:"",round:"",dense:"",icon:"icon_menu_burger",onClick:a[1]||(a[1]=l=>d.drawerOpen=!d.drawerOpen),"aria-label":"Menu"},{default:e(()=>[r.notificationCounter>0?(o(),i(B,{key:0,color:"warning",floating:""},{default:e(()=>[c(n(r.notificationCounter),1)]),_:1})):f("",!0)]),_:1})]),title:e(()=>[c(n(r.title),1)]),_:1}),t(te,{modelValue:d.drawerOpen,"onUpdate:modelValue":a[4]||(a[4]=l=>d.drawerOpen=l),side:"right",dark:"",elevated:"",class:"bg-secondary row"},{default:e(()=>[u("div",ue,[t($,{style:{height:"calc(100% - 150px)","margin-top":"150px"}},{default:e(()=>[t(k,{bordered:""},{default:e(()=>[(o(!0),g(_,null,C(r.links,(l,h)=>(o(),g(_,null,[l.haschildren&&l.items.length?(o(),i(Z,{key:0,label:l.label},{default:e(()=>[t(k,null,{default:e(()=>[(o(!0),g(_,null,C(l.items,(v,R)=>(o(),g(_,null,[s.isDev()||!v.disable?y((o(),i(b,{clickable:"",to:v.to,key:R,disable:s.isDev()?!1:v.disable,exact:!v.hasOwnProperty("haschildren")},{default:e(()=>[t(m,null,{default:e(()=>[t(q,null,{default:e(()=>[c(n(v.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to","disable","exact"])),[[Q]]):f("",!0)],64))),256))]),_:2},1024)]),_:2},1032,["label"])):s.isDev()||!l.disable?y((o(),i(b,{clickable:"",to:l.to,key:h,disable:s.isDev()?!1:l.disable,exact:!l.hasOwnProperty("haschildren")},{default:e(()=>[t(m,null,{default:e(()=>[t(q,null,{default:e(()=>[c(n(l.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["to","disable","exact"])),[[Q]]):f("",!0),l.disable?f("",!0):(o(),i(O,{key:2}))],64))),256))]),_:1})]),_:1}),u("div",de,[u("div",fe,[t(w,{size:"56px",class:"q-mb-sm"},{default:e(()=>[u("img",{src:s.avatar(r.user)},null,8,ce),t(N,null,{default:e(()=>[t(k,{link:""},{default:e(()=>[t(b,{to:"/personnel",clickable:""},{default:e(()=>[t(m,{side:""},{default:e(()=>[t(A,{name:"account_circle"})]),_:1}),t(m,null,{default:e(()=>[t(q,null,{default:e(()=>a[8]||(a[8]=[c(" Profil ")])),_:1})]),_:1})]),_:1}),t(O),t(b,{onClick:s.deconnexion,clickable:""},{default:e(()=>[t(m,{side:""},{default:e(()=>[t(A,{name:"power_settings_new"})]),_:1}),t(m,null,{default:e(()=>[t(q,null,{default:e(()=>a[9]||(a[9]=[c(" DÃ©connexion ")])),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),u("div",me,n(r.user.nom)+" "+n(r.user.prenom),1),u("div",pe,[s.eleve?(o(),i(p,{key:0,flat:"",class:""},{default:e(()=>[t(w,{size:"xs"},{default:e(()=>[u("img",{src:s.personAvatar(s.eleve)},null,8,ve)]),_:1}),u("span",ge,n(s.eleve.nom)+" "+n(s.eleve.prenom),1),t(N,null,{default:e(()=>[t(k,{flat:""},{default:e(()=>[(o(!0),g(_,null,C(r.config.meta.eleves,(l,h)=>y((o(),i(b,{clickable:"",key:h,onClick:v=>s.setEleve(l),active:s.eleve.idpers===l.idpers},{default:e(()=>[t(m,{avatar:""},{default:e(()=>[t(w,null,{default:e(()=>[u("img",{src:s.personAvatar(l)},null,8,_e)]),_:2},1024)]),_:2},1024),t(m,null,{default:e(()=>[c(n(l.nom)+" "+n(l.prenom),1)]),_:2},1024)]),_:2},1032,["onClick","active"])),[[E],[Q]])),128))]),_:1})]),_:1})]),_:1})):f("",!0)])])])]),u("div",he,[t(p,{class:"full-width",flat:"",onClick:a[2]||(a[2]=l=>d.drawerOpen=!d.drawerOpen),"aria-label":"Menu"},{default:e(()=>[t(A,{name:"icon_menu_burger"})]),_:1}),t(p,{class:M({"full-width":!0,"q-mt-sm":!0,greyscale:r.notificationCounter==0}),size:"lg",flat:"",dense:"",onClick:a[3]||(a[3]=l=>d.showNotifs=!d.showNotifs),"aria-label":"Menu"},{default:e(()=>[r.notificationCounter>0?(o(),i(B,{key:0,color:"warning",floating:""},{default:e(()=>[c(n(r.notificationCounter),1)]),_:1})):f("",!0),a[10]||(a[10]=u("img",{src:"leaf.svg",class:"full-width"},null,-1))]),_:1},8,["class"]),t(S),t(p,{onClick:s.deconnexion,color:"red",flat:"",size:"lg",class:"full-width absolute-bottom"},{default:e(()=>[t(A,{name:"power_settings_new"})]),_:1},8,["onClick"])])]),_:1},8,["modelValue"]),t(J,null,{default:e(()=>[s.annee?(o(),i(I,{key:0})):f("",!0)]),_:1}),r.footer?(o(),i(se,{key:0,class:"bg-secondary"},{default:e(()=>[t(le,null,{default:e(()=>[t(V,null,{default:e(()=>[t(p,{icon:"icon_retour_mobile",flat:"",onClick:a[5]||(a[5]=l=>r.$router.go(-1))})]),_:1}),a[11]||(a[11]=u("div",{id:"footer-portal"},null,-1))]),_:1})]),_:1})):f("",!0)]),_:1})):f("",!0),t(K,{modelValue:d.showNotifs,"onUpdate:modelValue":a[7]||(a[7]=l=>d.showNotifs=l),position:"right",maximized:"",onHide:s.clearNotifCounter},{default:e(()=>[t(L,{"onNotif:close":a[6]||(a[6]=l=>{d.showNotifs=!1,d.drawerOpen=!1})})]),_:1},8,["modelValue","onHide"])],64)}const st=T(oe,[["render",be]]);export{st as default};
