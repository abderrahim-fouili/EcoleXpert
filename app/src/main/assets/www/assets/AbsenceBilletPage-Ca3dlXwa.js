const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BilletExcuseReport-4hs9PLcc.js","./index-Bl2lQPd7.js","./index-B-uS9A6y.css","./BilletExcuseReport-VNo_KMHQ.css"])))=>i.map(i=>d[i]);
import{aP as me,aO as pe,A as g,B as V,Y as ve,Q as k,S as b,a6 as i,a5 as t,aE as T,aF as P,a8 as s,av as fe,ab as f,a3 as y,ah as be,ad as x,a2 as L,ay as Q,aG as _e,aD as W,R as E,aS as ge,_ as Ee,C as Pe,ag as Ye,a4 as I,a9 as re,aa as de,af as Ne,a$ as ze,aC as Ue,aM as Me,aR as Re,aW as Te,b0 as Le}from"./index-Bl2lQPd7.js";import{Q as Oe}from"./QBanner-xBGiroIy.js";import{Q as Z}from"./QSelect-DchnWyXK.js";import{Q as J}from"./QDate-C_jC-zMt.js";import{Q as O}from"./QPopupProxy-CQ30ymZI.js";import{Q as K,a as M}from"./QItem-De3v03wU.js";import{Q as je}from"./QSpinnerDots-BW9ZsFNG.js";import{Q as He}from"./QInnerLoading-WxvcYHvS.js";import{Q as U}from"./QTd-CpEgdqvP.js";import{Q as F}from"./QTooltip-r7WoEuzy.js";import{Q as ue}from"./QChip-C9OfA2gn.js";import{Q as Ge}from"./QTable-D-OlObRI.js";import{Q as We}from"./QList-CMzNTEGD.js";import{C as ye}from"./ClosePopup-BY_YGFBZ.js";import{Q as Ze}from"./QSpace-CKKoNTi_.js";import{Q as Je}from"./QTime-DY-qDies.js";import{Q as Ke}from"./QForm-Dk45GsL9.js";import{q as ce}from"./date-C1Mon-Jj.js";import{_ as Xe}from"./StudentScan-BWckmCLy.js";import{u as et}from"./composables-CAkrP3jA.js";import{E as tt}from"./ExportControls-UOL0zNKZ.js";import"./QItemLabel-BkJiB6aE.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-datetime-hbLWgGn4.js";import"./QVirtualScroll-CENgsPEr.js";import"./QLinearProgress-DW1NPbfx.js";import"./TouchPan-jBhMORlX.js";import"./touch-BjYP5sR0.js";import"./QToolbarTitle-C8APieXG.js";import"./QToolbar-DR-_wX4W.js";import"./QBtnGroup-CdugIB7Z.js";import"./_commonjsHelpers-D6-XlEtG.js";const lt={class:"text-h6"},at={class:"q-gutter-md"},it={class:"flex items-center gap-4"},st={class:"grow"},ot={class:"flex items-center justify-center q-field--with-bottom"},nt={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},rt={class:"col-12 col-sm-6"},dt={class:"col-12 col-sm-6"},ut={__name:"AbsenceBilletForm",props:{show:Boolean,billetId:[Number,String,null],idanneeCourante:Number},emits:["close","submitted"],setup(j,{emit:H}){const u=j,_=H,C=me(),w=pe(),p=g(!1),D=V(()=>!!u.billetId),Y=V(()=>C.getters["absence/billets/isSubmitting"]),r=V(()=>C.getters["absence/billets/studentSearchResults"]);V(()=>C.getters["absence/billets/currentBillet"]);const B=()=>({idpers:null,date_billet_date:ce.formatDate(Date.now(),"YYYY-MM-DD"),date_billet_time:ce.formatDate(Date.now(),"HH:mm"),observation:"Billet d'entrée",idannee:u.idanneeCourante||null,idsurveillant:0,active:2}),n=g(B()),$=g(null),S=g([]),q=()=>{p.value=!0},A=c=>{console.log("Person scanned:",c),n.value.idpers=c.idpers,S.value=[c],p.value=!1};ve(()=>u.show,async c=>{if(c)if($.value=null,D.value&&u.billetId)try{const o=await C.dispatch("absence/billets/fetchBilletById",u.billetId);o?(n.value={idpers:o.idpers,date_billet_date:o.date_billet_date,date_billet_time:o.date_billet_time,observation:o.observation,idannee:o.idannee,idsurveillant:o.idsurveillant||0,active:o.active},o.personne&&(S.value=[o.personne])):(n.value=B(),u.idanneeCourante&&(n.value.idannee=u.idanneeCourante))}catch{w.notify({type:"negative",message:"Erreur de chargement du billet."}),n.value=B(),u.idanneeCourante&&(n.value.idannee=u.idanneeCourante)}else n.value=B(),u.idanneeCourante&&(n.value.idannee=u.idanneeCourante)});const N=async(c,o,d)=>{if(c.length<2){d();return}try{await C.dispatch("absence/billets/searchStudents",c),o(()=>{S.value=[...r.value]})}catch(G){console.error(G),w.notify({type:"negative",message:"Erreur de chargement des étudiants."}),d()}},v=async()=>{if(!n.value.idpers||!n.value.date_billet_date||!n.value.date_billet_time||!n.value.observation){w.notify({type:"negative",message:"Veuillez remplir tous les champs obligatoires."});return}const c=new FormData;c.append("idpers",n.value.idpers),c.append("date_billet_date",n.value.date_billet_date),c.append("date_billet_time",n.value.date_billet_time),c.append("observation",n.value.observation),c.append("active",n.value.active),n.value.idannee&&c.append("idannee",n.value.idannee),n.value.idsurveillant&&c.append("idsurveillant",n.value.idsurveillant),$.value&&c.append("scanned_billet_file",$.value);try{D.value?await C.dispatch("absence/billets/updateBillet",{idbillet:u.billetId,billetData:c}):await C.dispatch("absence/billets/storeBillet",c),_("submitted"),_("close")}catch{}};return(c,o)=>(b(),k(W,{"model-value":j.show,onHide:o[8]||(o[8]=d=>c.$emit("close")),persistent:""},{default:i(()=>[t(T,null,{default:i(()=>[t(P,{class:"row items-center q-pb-none"},{default:i(()=>[s("div",lt,f(D.value?"Modifier le Billet d'Excuse":"Nouveau Billet d'Excuse"),1),t(Ze),fe(t(y,{icon:"close",flat:"",round:"",dense:""},null,512),[[ye]])]),_:1}),t(Ke,{onSubmit:be(v,["prevent"])},{default:i(()=>[t(P,{class:"q-pt-md"},{default:i(()=>[s("div",at,[s("div",it,[s("div",st,[t(Z,{filled:"",modelValue:n.value.idpers,"onUpdate:modelValue":o[0]||(o[0]=d=>n.value.idpers=d),"use-input":"","hide-selected":"","fill-input":"","input-debounce":"500",label:"Élève",options:S.value,onFilter:N,"option-value":"idpers","option-label":d=>`${d.nom} ${d.prenom} (${d.classe_name||d.eleve_classes[0]?.classe_fr||"N/A"})`,"emit-value":"","map-options":"",rules:[d=>!!d||"Veuillez sélectionner un élève."],clearable:""},{"no-option":i(()=>[t(K,null,{default:i(()=>[t(M,{class:"text-grey"},{default:i(()=>o[9]||(o[9]=[x(" Aucun élève trouvé. Tapez pour rechercher. ")])),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","rules"])]),s("div",ot,[t(y,{flat:"",icon:"qr_code",round:"",onClick:q})])]),s("div",nt,[s("div",rt,[t(L,{filled:"",modelValue:n.value.date_billet_date,"onUpdate:modelValue":o[2]||(o[2]=d=>n.value.date_billet_date=d),label:"Date du Billet",mask:"####-##-##",clearable:""},{append:i(()=>[t(Q,{name:"event",class:"cursor-pointer"},{default:i(()=>[t(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[t(J,{modelValue:n.value.date_billet_date,"onUpdate:modelValue":o[1]||(o[1]=d=>n.value.date_billet_date=d),mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",dt,[t(L,{filled:"",modelValue:n.value.date_billet_time,"onUpdate:modelValue":o[4]||(o[4]=d=>n.value.date_billet_time=d),label:"Heure du Billet",mask:"##:##",rules:[d=>d===null||d===""||/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(d)||"Format HH:MM requis"],clearable:""},{append:i(()=>[t(Q,{name:"access_time",class:"cursor-pointer"},{default:i(()=>[t(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[t(Je,{modelValue:n.value.date_billet_time,"onUpdate:modelValue":o[3]||(o[3]=d=>n.value.date_billet_time=d),format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])])])]),_:1}),t(_e,{align:"right",class:"q-pa-md"},{default:i(()=>[t(y,{label:"Annuler",color:"grey-7",flat:"",onClick:o[5]||(o[5]=d=>c.$emit("close")),disable:Y.value},null,8,["disable"]),t(y,{label:D.value?"Mettre à jour":"Créer",type:"submit",color:"primary",loading:Y.value},null,8,["label","loading"])]),_:1})]),_:1})]),_:1}),t(W,{modelValue:p.value,"onUpdate:modelValue":o[7]||(o[7]=d=>p.value=d),maximized:"",position:"right"},{default:i(()=>[ge(w).platform.is.cordova&&p.value?(b(),k(Xe,{key:0,onStudentSelected:o[6]||(o[6]=d=>A(d,!0))})):E("",!0)]),_:1},8,["modelValue"])]),_:1},8,["model-value"]))}},ct={class:"row q-col-gutter-md items-end"},mt={class:"col-12 col-md-3"},pt={class:"col-12 col-md-3"},vt={class:"col-12 col-md-3"},ft={class:"col-12 col-md-3"},bt={class:"col-12 text-right"},_t={key:0,class:"student-info"},gt={class:"text-weight-medium"},yt={class:"text-caption text-grey-7"},ht={key:1,class:"text-grey"},wt={class:"status-container"},xt={class:"chip-label-text"},Ct={key:0,class:"attachments-container"},Dt={key:1,class:"text-grey"},kt={class:"row justify-end q-gutter-xs"},Vt={class:"full-width row flex-center q-pa-lg empty-state"},Bt={class:"row q-col-gutter-md"},$t={class:"col-12 col-md-6"},Qt={class:"detail-item"},St={class:"detail-value"},It={class:"detail-item"},qt={class:"detail-value"},At={class:"detail-item"},Ft={class:"detail-value"},Et={class:"col-12 col-md-6"},Pt={class:"detail-item"},Yt={class:"detail-value"},Nt={class:"detail-item"},zt={class:"detail-value"},Ut={class:"col-12"},Mt={class:"detail-item"},Rt={class:"detail-value observation-text"},Tt={key:0,class:"col-12"},Lt={class:"detail-item"},Ot={class:"detail-value"},jt={__name:"AbsenceBilletPage",setup(j){const H=ze(()=>Le(()=>import("./BilletExcuseReport-4hs9PLcc.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)),u=me(),_=pe(),{setTitle:C}=et(),w=V(()=>u.getters["user/currentAnnee"]),p=g([]),D=g(!1),Y=()=>({idannee:w.value?.idannee||null,idpers:null,date_from:null,date_to:null}),r=g(Y()),B=g([]),n=V(()=>u.getters["absence/billets/billetsList"]),$=g(u.getters["absence/billets/pagination"]),S=V(()=>u.getters["absence/billets/isLoading"]),q=g(!1),A=g(null),N=g(!1),v=g(null),c=g(null),o=g({billet:{},schoolInfo:{},currentDate:new Date().toISOString()}),d=V(()=>u.getters["ecole/info"]),G=[{name:"personne",label:"Élève",align:"left",field:a=>a.personne,format:a=>a?`${a.nom} ${a.prenom}`:"N/A",sortable:!1},{name:"date_billet",label:"Date Billet",align:"center",field:"date_billet",sortable:!0},{name:"active",label:"Statut",align:"center",field:"active",sortable:!0},{name:"admin",label:"Créé par",field:a=>a.admin,format:a=>a?`${a.nom} ${a.prenom}`:"Système",align:"left",sortable:!1},{name:"actions",label:"Actions",align:"right",field:"actions"}],he=async()=>{D.value=!0;try{const a=await u.dispatch("timetable/fetchAcademicYears");p.value=u.getters["timetable/academicYears"],!r.value.idannee&&w.value?.idannee&&p.value.some(e=>e.idannee===w.value.idannee)?r.value.idannee=w.value.idannee:!r.value.idannee&&p.value.length>0&&(r.value.idannee=p.value.find(e=>e.courant===1)?.idannee||p.value[0].idannee)}catch(a){console.error("Error fetching academic years for billets:",a),_.notify({type:"negative",message:"Impossible de charger les années scolaires."})}finally{D.value=!1}},X=V(()=>!r.value.idannee||!p.value.length?null:p.value.find(a=>a.idannee===r.value.idannee)),we=a=>{r.value.idannee=a,R()},R=()=>{$.value.page=1,z()},xe=()=>{r.value=Y(),w.value?.idannee?r.value.idannee=w.value.idannee:p.value.length>0&&(r.value.idannee=p.value.find(a=>a.courant===1)?.idannee||p.value[0].idannee),B.value=[],R()},z=()=>{if(!r.value.idannee){u.commit("absence/billets/SET_BILLETS",{data:[],total:0,current_page:1,per_page:$.value.rowsPerPage});return}const a={...r.value};a.date_from&&(a.date_from=a.date_from.replace(/\//g,"-")),a.date_to&&(a.date_to=a.date_to.replace(/\//g,"-")),u.dispatch("absence/billets/fetchBillets",a)},Ce=a=>{const{page:e,rowsPerPage:h,sortBy:l,descending:m}=a.pagination;u.commit("absence/billets/SET_PAGINATION",{page:e,rowsPerPage:h,sortBy:l,descending:m}),z()},De=(a,e,h)=>{if(a.length<2){h();return}u.dispatch("absence/billets/searchStudents",a).then(l=>{e(()=>{B.value=l})}).catch(()=>h())},ke=()=>{A.value=null,q.value=!0},Ve=a=>{A.value=a,q.value=!0},Be=async a=>{_.loading.show({message:"Chargement des détails..."});try{const e=await u.dispatch("absence/billets/fetchBilletById",a);v.value=e,N.value=!0}catch{_.notify({type:"negative",message:"Impossible de charger les détails du billet."})}finally{_.loading.hide()}},$e=a=>{_.dialog({title:"Confirmer la Désactivation",message:"Êtes-vous sûr de vouloir désactiver ce billet d'excuse ? Cette action est généralement réversible.",cancel:!0,persistent:!0,ok:{label:"Désactiver",color:"negative"}}).onOk(async()=>{await u.dispatch("absence/billets/destroyBillet",a)})},Qe=async a=>{try{(await u.dispatch("absence/billets/validateBillet",a)).status==="success"&&(z(),_.notify({type:"positive",message:"Billet validé avec succès."}))}catch(e){console.error("Error validating billet:",e)}},Se=()=>{z()},ee=(a,e=!1)=>{if(!a)return"N/A";try{const h=new Date(a),l={year:"numeric",month:"2-digit",day:"2-digit"};if(e){const m=a.split("T")[1];m&&m!=="00:00:00.000Z"&&m!=="00:00:00.000000Z"&&m!=="00:00:00"&&(l.hour="2-digit",l.minute="2-digit")}return h.toLocaleDateString("fr-FR",l)}catch{const l=String(a);if(l.length>=8){const m=l.substring(0,4),ie=l.substring(4,6);let se=`${l.substring(6,8)}/${ie}/${m}`;if(e&&l.length>=12){const oe=l.substring(8,10),ne=l.substring(10,12);(oe!=="00"||ne!=="00")&&(se+=` ${oe}:${ne}`)}return se}return a}},te=a=>a===1?"Validé":a===0?"Expiré":a===2?"En attente":"Inconnu",Ie=a=>a===1?"positive":a===0?"negative":a===2?"warning":"grey",le=a=>a?a.substring(a.lastIndexOf("/")+1):"",ae=a=>{const e=Te();window.open(`${e}/storage/${a}`,"_blank")},qe=a=>a===2?"warning":a===1?"positive":"negative",Ae=a=>"white",Fe=async a=>{if(!c.value){_.notify({type:"negative",message:"Composant d'impression non prêt."});return}_.loading.show({message:"Préparation du billet pour impression..."});let e;try{e=await u.dispatch("absence/billets/fetchBilletById",a.idbillet)}catch{_.loading.hide(),_.notify({type:"negative",message:"Impossible de charger les détails complets du billet pour l'impression."});return}const h=d.value||{},l=e.personne||{};console.log(l),o.value={billet:{studentName:`${l.nom||""} ${l.prenom||""}`,studentClass:l.classes[0]?.bref||l.classes[0]?.classe_fr||"Non spécifiée",date_billet:e.date_billet,observation:e.observation||"Aucune observation.",studentId:l.idpers||"N/A"},schoolInfo:{name:h.description||"Nom de l'Établissement",logoUrl:h.logo?Me(h.logo):null},currentDate:new Date().toISOString()},await Re(),_.loading.hide();try{await c.value.printReport()}catch(m){console.error("Error during printReport call:",m),_.notify({type:"negative",message:"Erreur lors du lancement de l'impression."})}};return Pe(async()=>{C("Billets d'Excuse"),await he(),r.value.idannee&&z()}),ve(w,a=>{a&&a.idannee&&a.idannee!==r.value.idannee?(r.value.idannee=a.idannee,R()):!a&&r.value.idannee}),(a,e)=>{const h=Ye("ep-footer");return b(),k(Ue,{padding:"",class:"page-content"},{default:i(()=>[X.value?E("",!0):(b(),k(Oe,{key:0,class:"bg-warning text-white q-mb-md rounded-borders shadow-1"},{default:i(()=>[t(Q,{name:"warning",class:"q-mr-sm"}),e[9]||(e[9]=x(" Veuillez sélectionner une année scolaire active pour gérer les billets d'excuse. "))]),_:1})),t(T,{flat:"",bordered:"",class:"filter-card shadow-2 rounded-borders"},{default:i(()=>[t(P,null,{default:i(()=>[e[11]||(e[11]=s("h5",{class:"text-h5 q-mt-none q-mb-md text-primary"},"Filtres",-1)),s("div",ct,[s("div",mt,[t(Z,{outlined:"",modelValue:r.value.idannee,"onUpdate:modelValue":[e[0]||(e[0]=l=>r.value.idannee=l),we],options:p.value,label:"Année Scolaire","option-value":"idannee","option-label":"description","emit-value":"","map-options":"",disable:D.value,loading:D.value,class:"filter-select"},null,8,["modelValue","options","disable","loading"])]),s("div",pt,[t(L,{outlined:"",modelValue:r.value.date_from,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value.date_from=l),label:"Date Du",mask:"####-##-##",clearable:""},{append:i(()=>[t(Q,{name:"event",class:"cursor-pointer text-primary"},{default:i(()=>[t(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[t(J,{modelValue:r.value.date_from,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.date_from=l),mask:"YYYY-MM-DD",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",vt,[t(L,{outlined:"",modelValue:r.value.date_to,"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.date_to=l),label:"Date Au",mask:"####-##-##",clearable:""},{append:i(()=>[t(Q,{name:"event",class:"cursor-pointer text-primary"},{default:i(()=>[t(O,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[t(J,{modelValue:r.value.date_to,"onUpdate:modelValue":e[3]||(e[3]=l=>r.value.date_to=l),mask:"YYYY-MM-DD",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",ft,[t(Z,{outlined:"",modelValue:r.value.idpers,"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.idpers=l),"use-input":"","hide-selected":"","fill-input":"","input-debounce":"500",label:"Rechercher Élève",options:B.value,onFilter:De,"option-value":"idpers","option-label":l=>`${l.nom} ${l.prenom} (${l.classe_name||"N/A"})`,"emit-value":"","map-options":"",clearable:""},{"no-option":i(()=>[t(K,null,{default:i(()=>[t(M,{class:"text-grey"},{default:i(()=>e[10]||(e[10]=[x("Aucun élève.")])),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),s("div",bt,[t(y,{label:"Filtrer",color:"primary","icon-right":"search",onClick:R,loading:S.value,class:"q-px-md",rounded:""},null,8,["loading"]),t(y,{label:"Réinitialiser",color:"grey-7",flat:"","icon-right":"refresh",onClick:xe,class:"q-ml-sm q-px-md",rounded:""})])])]),_:1})]),_:1}),t(T,{flat:"",bordered:"",class:"q-mt-md shadow-2 rounded-borders"},{default:i(()=>[t(P,{class:"bg-primary text-white q-pb-xs"},{default:i(()=>e[12]||(e[12]=[s("div",{class:"text-h6"},"Liste des Billets d'Excuse",-1),s("div",{class:"text-caption"},"Gérez vos billets d'excuse en toute simplicité",-1)])),_:1}),t(Ge,{flat:"",rows:n.value,columns:G,"row-key":"idbillet",pagination:$.value,"onUpdate:pagination":e[6]||(e[6]=l=>$.value=l),loading:S.value,onRequest:Ce,"binary-state-sort":"",class:"modern-table","rows-per-page-options":[10,20,50,100]},{loading:i(()=>[t(He,{showing:"",color:"primary"},{default:i(()=>[t(je,{size:"50px",color:"primary"})]),_:1})]),"body-cell-date_billet":i(l=>[t(U,{props:l,class:"text-weight-medium"},{default:i(()=>[x(f(ee(l.row.date_billet)),1)]),_:2},1032,["props"])]),"body-cell-personne":i(l=>[t(U,{props:l},{default:i(()=>[l.row.personne?(b(),I("div",_t,[s("div",gt,f(l.row.personne.nom)+" "+f(l.row.personne.prenom),1),s("div",yt,f(l.row.personne.classes[0]?.classe_fr),1)])):(b(),I("span",ht,"N/A"))]),_:2},1032,["props"])]),"body-cell-active":i(l=>[t(U,{props:l},{default:i(()=>[s("div",wt,[t(ue,{color:qe(l.row.active),"text-color":Ae(l.row.active),size:"sm",class:Ne(["status-chip-with-action",{"has-button":l.row.active===2}])},{default:i(()=>[l.row.active===2?(b(),k(y,{key:0,round:"",icon:"check",size:"sm",color:"positive","text-color":"white",dense:"",unelevated:"",onClick:be(m=>Qe(l.row.idbillet),["stop"]),class:"q-mr-xs embedded-btn"},{default:i(()=>[t(F,null,{default:i(()=>e[13]||(e[13]=[x("Valider ce billet")])),_:1})]),_:2},1032,["onClick"])):E("",!0),s("span",xt,f(te(l.row.active)),1)]),_:2},1032,["color","text-color","class"])])]),_:2},1032,["props"])]),"body-cell-pieces_jointes":i(l=>[t(U,{props:l},{default:i(()=>[l.row.pieces_jointes&&l.row.pieces_jointes.length?(b(),I("div",Ct,[(b(!0),I(re,null,de(l.row.pieces_jointes,m=>(b(),k(y,{key:m.id_pj,round:"",icon:"attachment",size:"sm",color:"info",onClick:ie=>ae(m.fichier),class:"q-mr-xs"},{default:i(()=>[t(F,null,{default:i(()=>[x(f(le(m.fichier)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):(b(),I("span",Dt,"-"))]),_:2},1032,["props"])]),"body-cell-actions":i(l=>[t(U,{props:l,class:"text-right"},{default:i(()=>[s("div",kt,[t(y,{round:"",icon:"print",color:"info",size:"sm",onClick:m=>Fe(l.row)},{default:i(()=>[t(F,null,{default:i(()=>e[14]||(e[14]=[x("Imprimer Billet")])),_:1})]),_:2},1032,["onClick"]),t(y,{round:"",icon:"visibility",color:"secondary",size:"sm",onClick:m=>Be(l.row.idbillet)},{default:i(()=>[t(F,null,{default:i(()=>e[15]||(e[15]=[x("Voir Détails")])),_:1})]),_:2},1032,["onClick"]),t(y,{round:"",icon:"edit",color:"primary",size:"sm",onClick:m=>Ve(l.row.idbillet)},{default:i(()=>[t(F,null,{default:i(()=>e[16]||(e[16]=[x("Modifier")])),_:1})]),_:2},1032,["onClick"]),t(y,{round:"",icon:"delete",color:"negative",size:"sm",onClick:m=>$e(l.row.idbillet)},{default:i(()=>[t(F,null,{default:i(()=>e[17]||(e[17]=[x("Désactiver")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":i(()=>[s("div",Vt,[t(Q,{name:"folder_off",size:"4rem",color:"grey-5"}),e[18]||(e[18]=s("div",{class:"text-h6 text-grey-7 q-mt-sm"},"Aucun billet d'excuse trouvé",-1)),e[19]||(e[19]=s("div",{class:"text-body2 text-grey q-mt-xs"},"Ajustez vos filtres ou créez un nouveau billet",-1))])]),_:1},8,["rows","pagination","loading"])]),_:1}),t(h,{to:"#footer-portal"},{default:i(()=>[X.value?(b(),k(y,{key:0,color:"primary",icon:"add",label:"Nouveau Billet",onClick:ke,class:"q-px-md",rounded:""})):E("",!0)]),_:1}),t(ut,{show:q.value,"billet-id":A.value,"idannee-courante":r.value.idannee,onClose:e[7]||(e[7]=l=>{q.value=!1,A.value=null}),onSubmitted:Se,position:"bottom"},null,8,["show","billet-id","idannee-courante"]),t(W,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=l=>N.value=l),position:"standard","transition-show":"slide-up","transition-hide":"slide-down"},{default:i(()=>[v.value?(b(),k(T,{key:0,class:"detail-card",style:{width:"700px","max-width":"90vw"}},{default:i(()=>[t(P,{class:"bg-primary text-white"},{default:i(()=>e[20]||(e[20]=[s("div",{class:"text-h6"},"Détails du Billet",-1),s("div",{class:"text-caption"},"Informations complètes",-1)])),_:1}),t(P,null,{default:i(()=>[s("div",Bt,[s("div",$t,[s("div",Qt,[e[21]||(e[21]=s("div",{class:"detail-label"},"Élève",-1)),s("div",St,f(v.value.personne?.nom)+" "+f(v.value.personne?.prenom),1)]),s("div",It,[e[22]||(e[22]=s("div",{class:"detail-label"},"Date Billet",-1)),s("div",qt,f(ee(v.value.date_billet,!0)),1)]),s("div",At,[e[23]||(e[23]=s("div",{class:"detail-label"},"Statut",-1)),s("div",Ft,[t(ue,{color:Ie(v.value.active),"text-color":"white",size:"sm"},{default:i(()=>[x(f(te(v.value.active)),1)]),_:1},8,["color"])])])]),s("div",Et,[s("div",Pt,[e[24]||(e[24]=s("div",{class:"detail-label"},"Créé par",-1)),s("div",Yt,f(v.value.admin?.nom)+" "+f(v.value.admin?.prenom),1)]),s("div",Nt,[e[25]||(e[25]=s("div",{class:"detail-label"},"Année Scolaire",-1)),s("div",zt,f(v.value.annee_scolaire?.description),1)])]),s("div",Ut,[s("div",Mt,[e[26]||(e[26]=s("div",{class:"detail-label"},"Observation",-1)),s("div",Rt,f(v.value.observation),1)])]),v.value.pieces_jointes&&v.value.pieces_jointes.length?(b(),I("div",Tt,[s("div",Lt,[e[27]||(e[27]=s("div",{class:"detail-label"},"Pièces Jointes",-1)),s("div",Ot,[t(We,{dense:""},{default:i(()=>[(b(!0),I(re,null,de(v.value.pieces_jointes,l=>(b(),k(K,{key:l.id_pj,clickable:"",onClick:m=>ae(l.fichier)},{default:i(()=>[t(M,{avatar:""},{default:i(()=>[t(Q,{name:"attachment",color:"primary"})]),_:1}),t(M,null,{default:i(()=>[x(f(le(l.fichier)),1)]),_:2},1024),t(M,{side:""},{default:i(()=>[t(Q,{name:"open_in_new",color:"grey"})]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})])])])):E("",!0)])]),_:1}),t(_e,{align:"right"},{default:i(()=>[fe(t(y,{flat:"",label:"Fermer",color:"primary"},null,512),[[ye]])]),_:1})]),_:1})):E("",!0)]),_:1},8,["modelValue"]),t(tt,{ref_key:"exportControlsRef",ref:c,"report-component":ge(H),"report-data":o.value,pdfFilenamePrefix:"Billet_Excuse",pdfFormat:[76,"auto"],pdfUnit:"mm",pdfMargin:[4,0,4,0],reportComponentStyles:[{url:"/reports/billet.css?v=1.0.0"}],style:{opacity:"0"}},null,8,["report-component","report-data"])]),_:1})}}},Il=Ee(jt,[["__scopeId","data-v-f7459508"]]);export{Il as default};
