import{Q as q}from"./QImg-BMvxJu3S.js";import{_ as D,aY as S,b8 as M,b9 as V,b2 as U,ba as B,as as I,at as A,ag as k,a4 as d,S as i,Q as c,R as g,a5 as s,a6 as a,ad as u,ab as o,a9 as f,aa as y,av as N,af as v,a7 as $,a8 as P,ah as p,ay as w,a3 as _,aw as j,aE as R,be as T,a as O,aB as z}from"./index-Bl2lQPd7.js";import{Q as E,a as b}from"./QItem-De3v03wU.js";import{Q as L}from"./QBadge-Bjfo5tRO.js";import{Q as m}from"./QItemLabel-BkJiB6aE.js";import{Q as H}from"./QList-CMzNTEGD.js";import{q as F}from"./date-C1Mon-Jj.js";import"./format-IcNrutKL.js";const G={data(){return{unvalid:!1}},computed:{...A({user:"user/user",config:"user/config",links:"user/nav",current:"user/current",messagesList:"message/messages",globalSettings:"user/globalSettings",darkMode:"darkMode"}),messages(){return this.messagesList&&this.messagesList.data?this.messagesList.data:[]},classe(){if(this.current&&this.current.hasOwnProperty("classe"))return this.current.classe},annee(){if(this.current&&this.current.hasOwnProperty("annee"))return this.current.annee},dark:{get(){return this.darkMode},set(t){this.toggleDarkMode()}}},watch:{$route(){this.$route.path.includes("unvalid")?this.unvalid=!0:this.unvalid=!1,this.getData()}},methods:{...I({getConfig:"user/getConfig",getMessages:"message/getMessages"}),LetterAvatar:B,toNow:U,fileIcon:V,openURL:M,pjUrl:S,personAvatar(t){return z(t)},getData(){this.messagesList&&this.messagesList.current_page?this.getMessages({page:this.messagesList.current_page,filter:this.filter()}):this.getMessages({page:1,filter:this.filter()})},valider(t,l){t&&O("post","/messages/validation",{status:l,id:t.id}).then(({data:h})=>{h.success&&this.$q.notify({color:"positive",message:this.$t("stats.success"),position:"bottom",icon:"check",actions:[{label:this.$q.lang.label.close,color:"white"}]}),this.getData()}).catch(h=>{this.$q.notify({color:"negative",message:"Une erreur est survenue",position:"bottom",icon:"error_outline",actions:[{label:this.$q.lang.label.close,color:"yellow"}]})})},filter(){let t=3,l=null;return this.globalSettings&&this.globalSettings.hasOwnProperty("validationStatus")&&(l=this.globalSettings.validationStatus),this.unvalid&&(t=4,l=2),{mode:t,status:l}},sub(t){return T(this.$cleanHtml(t,{allowedTags:[]}))},date(t){return F.formatDate(t*1e3)}},mounted(){this.$route.path.includes("unvalid")?this.unvalid=!0:this.unvalid=!1,this.getData()}},Y=["onClick"],J={key:0,class:"q-pt-sm"},K={key:1,class:"q-pt-sm"};function W(t,l,h,X,Z,r){const C=k("ep-pagination"),Q=k("ep-portal");return i(),d(f,null,[t.messagesList?(i(),c(Q,{key:0,to:"#pagination-portal"},{default:a(()=>[t.messagesList&&t.messagesList.current_page?(i(),c(C,{key:0,modelValue:t.messagesList.current_page,"onUpdate:modelValue":[l[0]||(l[0]=e=>t.messagesList.current_page=e),r.getData],max:t.messagesList.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:a(()=>[u(" Page "+o(t.messagesList.current_page),1)]),_:1},8,["modelValue","max","onUpdate:modelValue"])):g("",!0)]),_:1})):g("",!0),s(R,{style:{margin:"0 -8px"},flat:""},{default:a(()=>[s(H,null,{default:a(()=>[(i(!0),d(f,null,y(r.messages,(e,x)=>N((i(),c(E,{key:x,clickable:"",onClick:n=>t.go("/admin/messages/validation/view/"+e.id),class:v({"bg-grey-1":e.status===1})},{default:a(()=>[s(b,{avatar:""},{default:a(()=>[s($,null,{default:a(()=>[s(q,{src:r.personAvatar(e.sender),"placeholder-src":r.LetterAvatar(e.sender.nom),ratio:"1"},null,8,["src","placeholder-src"])]),_:2},1024)]),_:2},1024),s(b,null,{default:a(()=>[s(m,{lines:"1"},{default:a(()=>[s(L,{transparent:"",color:"secondary"},{default:a(()=>[u(o(e.type_sender),1)]),_:2},1024),P("span",{class:v({"text-weight-bold":!e.etat.length})},"  "+o(e.sender.nom)+" "+o(e.sender.prenom),3)]),_:2},1024),s(m,{lines:"1",class:v({"text-weight-bold":!e.etat.length})},{default:a(()=>[u(o(e.objet),1)]),_:2},1032,["class"]),s(m,{caption:"",lines:"1"},{default:a(()=>[u(o(r.sub(e.message)),1)]),_:2},1024),e.fichiers.length?(i(),c(m,{key:0,lines:"1"},{default:a(()=>[(i(!0),d(f,null,y(e.fichiers,(n,ee)=>(i(),d("div",{outline:"",color:"grey-9",onClick:p(te=>r.openURL(r.pjUrl(n)),["prevent"]),class:"ellipsis rounded-borders q-mr-xs q-pa-xs",style:{"max-width":"40%",display:"inline-block",border:"1px solid var(--q-primary)"}},[s(w,{name:"img:"+r.fileIcon(n.fichier),size:"14px"},null,8,["name"]),u(" "+o(n.fichier),1)],8,Y))),256))]),_:2},1024)):g("",!0)]),_:2},1024),s(b,{side:"",top:""},{default:a(()=>[s(m,{caption:""},{default:a(()=>[u(o(r.toNow(e.created_at*1e3)),1)]),_:2},1024),e.status===0?(i(),d("div",J,[s(_,{flat:"",dense:"",icon:"thumb_up",color:"positive",onClick:p(n=>r.valider(e,1),["stop"])},null,8,["onClick"]),s(_,{flat:"",dense:"",icon:"thumb_down",color:"warning",onClick:p(n=>r.valider(e,2),["stop"])},null,8,["onClick"])])):e.status===2?(i(),d("div",K,[s(_,{flat:"",dense:"",icon:"thumb_up",color:"positive",onClick:p(n=>r.valider(e,1),["stop"])},null,8,["onClick"])])):g("",!0),e.status===1?(i(),c(L,{key:2,color:"positive",class:"q-mt-sm"},{default:a(()=>[s(w,{name:"check"}),l[1]||(l[1]=u(" validé"))]),_:1})):g("",!0)]),_:2},1024)]),_:2},1032,["onClick","class"])),[[j]])),128))]),_:1})]),_:1})],64)}const de=D(G,[["render",W]]);export{de as default};
