import{_ as G,bt as M,Q as V,S as L,a6 as d,a8 as i,a5 as r,aE as B,aF as E,a2 as p,R as U,a3 as C,aC as $,aP as z,aO as N,A as c,B as m,C as P,bv as T}from"./index-Bl2lQPd7.js";import{Q as j}from"./QForm-Dk45GsL9.js";import{L as g}from"./leaflet-src-BmGqNqGH.js";import{u as F}from"./composables-CAkrP3jA.js";import"./_commonjsHelpers-D6-XlEtG.js";const O=M({name:"GeolocationPage",setup(){const t=z(),o=N(),u=c(null),l=c(null),s=c(null),{setTitle:v}=F(),e=c({latitude:"",longitude:"",adresse:"",proximity_threshold:200,ville:"",code_postal:"",pays:"Maroc"}),D=m(()=>t.getters["ecole-geo/loading"]),_=m(()=>t.getters["ecole-geo/error"]),f=m(()=>t.getters["ecole-geo/geoData"]),w=m(()=>t.getters["ecole-geo/hasLocation"]),k=()=>{if(!u.value)return;const a=[31.7917,-7.0926];l.value=g.map(u.value).setView(a,5),g.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(l.value),l.value.on("click",n=>{const{lat:h,lng:b}=n.latlng;y(h,b),e.value.latitude=h,e.value.longitude=b})},y=(a,n)=>{s.value?s.value.setLatLng([a,n]):s.value=g.marker([a,n]).addTo(l.value),l.value.setView([a,n],15)},Q=async()=>{try{await t.dispatch("ecole-geo/fetchGeoData"),f.value&&(e.value={...f.value},e.value.latitude&&e.value.longitude&&y(e.value.latitude,e.value.longitude))}catch(a){console.error("Error loading geo data:",a)}},S=async()=>{try{await t.dispatch("ecole-geo/saveGeoData",e.value),o.notify({type:"positive",message:"Données de géolocalisation enregistrées avec succès"})}catch(a){o.notify({type:"negative",message:a.response?.data?.message||"Erreur lors de la sauvegarde"})}},q=async()=>{try{await o.dialog({title:"Confirmation",message:"Voulez-vous vraiment supprimer les données de géolocalisation?",cancel:!0,persistent:!0}),await t.dispatch("ecole-geo/deleteGeoData"),e.value={latitude:"",longitude:"",adresse:"",ville:"",code_postal:"",pays:"Maroc"},s.value&&(s.value.remove(),s.value=null),o.notify({type:"positive",message:"Données de géolocalisation supprimées avec succès"})}catch(a){a&&o.notify({type:"negative",message:a.response?.data?.message||"Erreur lors de la suppression"})}};return P(()=>{k(),v("Géolocalisation de l'École"),Q()}),T(()=>{l.value&&l.value.remove()}),{mapContainer:u,form:e,loading:D,error:_,hasLocation:w,onSubmit:S,onDelete:q}}}),A={class:"row q-col-gutter-md q-mt-sm"},I={class:"col-12"},R={class:"row q-col-gutter-md"},H={class:"col-12 col-md-4"},J={class:"row q-gutter-sm justify-end"};function K(t,o,u,l,s,v){return L(),V($,{class:"page-content"},{default:d(()=>[i("div",A,[i("div",I,[r(B,{flat:""},{default:d(()=>[r(E,null,{default:d(()=>[i("div",R,[i("div",H,[r(j,{onSubmit:t.onSubmit,class:"q-gutter-md"},{default:d(()=>[r(p,{modelValue:t.form.latitude,"onUpdate:modelValue":o[0]||(o[0]=e=>t.form.latitude=e),type:"number",label:"Latitude",filled:"","lazy-rules":"",rules:[e=>e!==null&&e!==""||"La latitude est requise",e=>e>=-90&&e<=90||"La latitude doit être entre -90 et 90"]},null,8,["modelValue","rules"]),r(p,{modelValue:t.form.longitude,"onUpdate:modelValue":o[1]||(o[1]=e=>t.form.longitude=e),filled:"",type:"number",label:"Longitude","lazy-rules":"",rules:[e=>e!==null&&e!==""||"La longitude est requise",e=>e>=-180&&e<=180||"La longitude doit être entre -180 et 180"]},null,8,["modelValue","rules"]),r(p,{modelValue:t.form.proximity_threshold,"onUpdate:modelValue":o[2]||(o[2]=e=>t.form.proximity_threshold=e),label:"Distance de proximité de l'École (en metres)",type:"number",filled:"",hint:"Utilisé pour les demandes de sortie"},null,8,["modelValue"]),i("div",J,[t.hasLocation?(L(),V(C,{key:0,flat:"",color:"negative",label:"Supprimer",onClick:t.onDelete},null,8,["onClick"])):U("",!0),r(C,{type:"submit",color:"primary",label:t.hasLocation?"Mettre à jour":"Enregistrer",loading:t.loading},null,8,["label","loading"])])]),_:1},8,["onSubmit"])])])]),_:1})]),_:1})])])]),_:1})}const ee=G(O,[["render",K]]);export{ee as default};
