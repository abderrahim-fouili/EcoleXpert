const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Invoice-Co6Np-Hl.js","./index-Bl2lQPd7.js","./index-B-uS9A6y.css","./Invoice-DIXSCx8j.css","./Recouvrement-Warxip9I.js","./Recouvrement-B7uLVnpr.css"])))=>i.map(i=>d[i]);
import{aP as ke,aO as Ke,A,d8 as Xe,B as h,aM as rt,aW as it,Y as J,C as Ee,b3 as ce,Q as N,S as d,a6 as l,a5 as e,av as ye,a3 as oe,ad as S,aF as x,a4 as g,R as te,aE as $,a8 as s,a2 as Ie,ay as Y,ab as v,aZ as nt,a_ as ut,a9 as ve,aa as he,aS as Q,a$ as Ue,ax as $e,b7 as De,af as se,ac as dt,a as Ye,N as ae,b0 as Fe,_ as we,aD as ct,aC as mt}from"./index-Bl2lQPd7.js";import{u as Ae,i as pt,a as Me,b as Te,c as Re,H}from"./index.esm.min-FpMw1SSI.js";import{Q as vt}from"./QToolbarTitle-C8APieXG.js";import{Q as ft}from"./QToolbar-DR-_wX4W.js";import{Q as Be}from"./QDate-C_jC-zMt.js";import{Q as Ge}from"./QPopupProxy-CQ30ymZI.js";import{Q as me}from"./QSelect-DchnWyXK.js";import{Q as O}from"./QItemLabel-BkJiB6aE.js";import{Q as ne,a as W}from"./QItem-De3v03wU.js";import{Q as bt}from"./QExpansionItem-EMhshZ_3.js";import{Q as gt}from"./QChip-C9OfA2gn.js";import{Q as pe}from"./QBadge-Bjfo5tRO.js";import{Q as xe}from"./QTd-CpEgdqvP.js";import{Q as We}from"./QTable-D-OlObRI.js";import{Q as He}from"./QList-CMzNTEGD.js";import{C as Se}from"./ClosePopup-BY_YGFBZ.js";import{E as Je}from"./ExportControls-UOL0zNKZ.js";import{q as Ze}from"./date-C1Mon-Jj.js";import{i as et,a as _t,b as yt}from"./install-Dh964sWS.js";import{f as le}from"./index-C9ZTL5MN.js";import{i as Ve,a as Ce,b as ht}from"./install-qCEEq-uE.js";import{i as Pe}from"./install-C7aL04A7.js";import{Q as xt}from"./QBtnToggle-BRjXr5oj.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-datetime-hbLWgGn4.js";import"./format-IcNrutKL.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./QSlideTransition-CrdUnXBf.js";import"./QVirtualScroll-CENgsPEr.js";import"./QLinearProgress-DW1NPbfx.js";import"./QTooltip-r7WoEuzy.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-BXMW6yyY.js";import"./index-CbPSoDvq.js";import"./QBtnGroup-CdugIB7Z.js";const St={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3"},$t={class:""},kt={class:"row items-center justify-end"},Et={class:""},Dt={class:"row items-center justify-end"},wt={class:""},At={class:""},Mt={class:"col-12 col-md-4"},Tt={class:"col-12 col-md-4"},Rt={key:0},Vt={key:1},Ct={class:"md:col-span-2 lg:col-span-3 text-right q-pt-md"},Pt={key:0,class:""},qt={class:"flex q-gutter-sm wrap"},Lt={key:1,class:"q-mt-md"},zt={key:2,class:"text-center q-pa-xl"},jt={key:3,class:"text-negative text-center q-pa-md"},Ot={key:4},Nt={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-4 w-full min-w-0 q-mt-md"},Qt={class:"text-h6 text-bold text-blue-9"},It={class:"text-h6 text-bold text-indigo-9"},Ut={class:"text-h6 text-bold text-blue-grey-9"},Yt={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 w-full mt-4"},Ft={key:0,class:"mt-4"},Bt={class:"text-subtitle1 q-mb-sm"},Gt={key:1,class:"mt-4"},Wt={class:"text-subtitle1 q-mb-sm"},Ht={key:2,class:"mt-4"},Jt={class:"text-blue-7"},Zt={class:"text-indigo-7"},Kt={key:3,class:"text-center text-grey-6 q-pa-xl"},Xt={key:4,class:"text-center text-grey-6 q-pa-xl"},ea={key:5,class:"text-center text-grey-6 q-pa-xl"},ta={__name:"TotalDetails",setup(fe){Ae([Ve,et,Pe,pt,Me,Te,Re,Ce,_t,ht]);const u=ke(),q=Ke();A(!1);const{getPaletteColor:F}=Xe,I=F("primary"),U=F("secondary"),r=A({group_by:"service",start_date:null,end_date:null,service_ids:[],class_ids:[],student_ids:[],service_types:[]}),R=A([]),L=A([]),D=A([]),p=A({services:!1,classes:!1,students:!1}),c=h(()=>u.getters["dashboard/isDetailsLoading"]),w=h(()=>u.getters["dashboard/getDetailsError"]),i=h(()=>u.getters["dashboard/getDetails"]),b=h(()=>u.getters["user/current"]?.annee),V=h(()=>u.getters["ecole/info"]),m=h(()=>u.getters["ecole/invoiceSettings"]),f=h(()=>!!m.value),k=h(()=>{if(!i.value)return null;if(r.value.group_by!=="none"&&i.value.totals)return{total_paye:i.value.totals.realisation,total_a_payer:Math.max(0,i.value.totals.objectif-i.value.totals.realisation),total_objectif:i.value.totals.objectif,realisation_par_mode:i.value.totals.realisation_par_mode||{}};if(r.value.group_by==="none"&&Array.isArray(i.value)){const o=i.value.reduce((P,T)=>P+(T.objectif||0),0),a=i.value.reduce((P,T)=>P+(T.realisation||0),0),t={};return i.value.forEach(P=>{P.realisation_par_mode&&typeof P.realisation_par_mode=="object"&&Object.entries(P.realisation_par_mode).forEach(([T,X])=>{t[T]=(t[T]||0)+X})}),{total_paye:a,total_a_payer:Math.max(0,o-a),total_objectif:o,realisation_par_mode:t}}return null}),M=h(()=>{if(!k.value||!k.value.total_objectif)return 0;const o=k.value.total_paye,a=k.value.total_objectif;return a>0?Math.round(o/a*100):0}),_=A({}),C=A({}),z=A({}),B=[{label:"Service",value:"service"},{label:"Mois",value:"month"},{label:"Classe",value:"class"},{label:"Élève",value:"student"}],Z=[{label:"Mensuelle",value:"MENSUELLE"},{label:"Annuelle",value:"ANNUELLE"}],ue=h(()=>{if(!r.value.student_ids||!D.value)return[];const o=new Map(D.value.map(a=>[a.idpers,a]));return r.value.student_ids.map(a=>o.get(a)).filter(a=>a!==void 0)}),tt=o=>{const a=r.value.student_ids.findIndex(t=>t===o.idpers);a>-1&&(r.value.student_ids.splice(a,1),ge())},y=o=>o==null||isNaN(o)?"N/A":new Intl.NumberFormat("fr-MA",{style:"currency",currency:"MAD"}).format(o),K=o=>!o||typeof o.objectif!="number"||typeof o.realisation!="number"?0:o.objectif>0?Math.round(o.realisation/o.objectif*100):o.realisation>0?100:0,de=o=>o>=95?"green":o>=75?"orange":"red",qe=async()=>{if(b.value)try{await u.dispatch("ecole/fetchInvoiceSettings")}catch{ae.create({type:"error",message:"Erreur lors de la récupération des paramètres de facturation."})}},Le=async o=>{if(o){p.value.services=!0,console.log("Fetching available services from new endpoint for year:",o);try{const{data:a}=await Ye("get",`/filters/services/${o}`);a&&a.status==="success"&&Array.isArray(a.data)?R.value=a.data.map(t=>({idservice:t.idservice,designation:t.designation||t.service,bref:t.bref})):(R.value=[],ae.create({type:"warning",message:a?.message||"Impossible de charger la liste des services."}))}catch(a){console.error("Error fetching available services:",a),R.value=[],ae.create({type:"negative",message:"Erreur lors du chargement des services."})}finally{p.value.services=!1,console.log("Available services set:",R.value)}}},ze=async o=>{},je=async o=>{if(o){p.value.students=!0,console.log("Fetching available students from new endpoint for year:",o);try{const{data:a}=await Ye("get",`/filters/students/${o}`);a&&a.status==="success"&&Array.isArray(a.data)?D.value=a.data:(D.value=[],ae.create({type:"warning",message:a?.message||"Impossible de charger la liste des élèves."}))}catch(a){console.error("Error fetching available students:",a),D.value=[],ae.create({type:"negative",message:"Erreur lors du chargement des élèves."})}finally{p.value.students=!1,console.log("Available students set:",D.value)}}},be=()=>{b.value?.idannee?(console.log("Dispatching fetchDashboardDetails with filters:",JSON.parse(JSON.stringify(r.value))),u.dispatch("dashboard/fetchDashboardDetails",{...r.value})):(ae.create({type:"warning",message:"Aucune année scolaire sélectionnée pour charger les détails."}),u.commit("dashboard/SET_DETAILS",null))},ge=()=>{console.log("Filter changed, updating data..."),be()},Oe=()=>{const o=b.value?.dateentree?le(ce(b.value.dateentree),"yyyy-MM-dd"):null,a=b.value?.datesortie?le(ce(b.value.datesortie),"yyyy-MM-dd"):null;r.value={group_by:"service",start_date:o,end_date:a,service_ids:[],class_ids:[],student_ids:[],service_types:[]},be()},Ne=h(()=>{if(r.value.student_ids&&r.value.student_ids.length>0&&r.value.group_by==="service"&&i.value&&i.value.filters_applied.student_ids.length&&i.value.groups&&i.value.groups.length>0&&V.value&&b.value){const o=i.value.invoiceItems;if(o.length===0)return null;ue.value?.[0];let a=m.value?.due_date_days??15;return console.log(m.value),{invoiceData:{schoolYear:b.value.description||"Année Inconnue",documentNumber:"F"+Ze.formatDate(Date.now(),"YYMMDDHHmmss"),documentDate:le(new Date,"yyyy-MM-dd"),dueDate:le(Ze.addToDate(new Date,{days:a}),"yyyy-MM-dd"),currency:m.value?.currency??"MAD",items:o},schoolInfo:{name:V.value.description||"",addressLine1:V.value.adresse||"",city:V.value.ville||"",contactEmail:V.value.email||"",paymentEmail:m.value?.payment_email??(V.value.email||""),phone:V.value.telephone?"+"+V.value.telephone:"",logoUrl:m.value?.logo_path??(V.value.logo?rt(V.value.logo):"")},paymentDetails:{qrCodeUrl:it("api")+"/qr",bank:{accountName:m.value?.bank_account_name??"",bankName:m.value?.bank_name??"",iban:m.value?.bank_iban??"",swiftCode:m.value?.bank_swift_code??""}},partnerInfo:{logoUrl:f.value?m.value.partner_logo_path:null}}}return null});J(()=>b.value?.idannee,(o,a)=>{o&&o>0?(console.log(`Year changed to ${o}, fetching details and filters...`),Promise.all([Le(o),ze(),je(o),qe()]).then(()=>{Oe()})):o||(u.commit("dashboard/SET_DETAILS",null),u.commit("dashboard/SET_ERROR_DETAILS","Aucune année scolaire sélectionnée."),R.value=[],L.value=[],D.value=[])},{immediate:!1}),J(k,o=>{if(o&&typeof o.total_paye=="number"&&typeof o.total_a_payer=="number"&&typeof o.total_objectif=="number"){const t=o.total_paye,P=o.total_a_payer,T=o.total_objectif,X=T>0?Math.round(t/T*100):t>0?100:0;_.value={series:[{type:"gauge",startAngle:180,endAngle:0,min:0,max:100,splitNumber:5,axisLine:{lineStyle:{width:10,color:[[.3,"#fd666d"],[.7,U],[1,I]]}},pointer:{icon:"path://M12.8,0.7l-4.4,6.1c-0.4,0.6-0.4,1.4,0,2L12.8,15.3c0.4,0.6,1.2,0.6,1.6,0l4.4-6.1c0.4-0.6,0.4-1.4,0-2L14.4,0.7C14,0.1,13.2,0.1,12.8,0.7z",length:"75%",width:8,offsetCenter:[0,"-60%"],itemStyle:{color:"auto"}},axisTick:{length:12,lineStyle:{color:"auto",width:2}},splitLine:{length:20,lineStyle:{color:"auto",width:5}},axisLabel:{color:"#464646",fontSize:15,distance:-60,formatter:function(n){return n===0||n===50||n===100?n+"%":""}},title:{offsetCenter:[0,"-10%"],fontSize:16,fontWeight:"bold",color:"#333"},detail:{fontSize:30,offsetCenter:[0,"-35%"],valueAnimation:!0,formatter:"{value}%",color:"auto"},data:[{value:X,name:"Taux Global"}]}],tooltip:{formatter:"{a} <br/>{b} : {c}%"}},C.value={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:n=>{let E=`${n[0].axisValue}<br/>`;return n.forEach(j=>{E+=`${j.marker} ${j.seriesName}: ${y(j.value)}<br/>`}),E+='<hr style="border-top: 1px dashed #ccc; margin: 5px 0;">',E+=`<strong>Objectif Total: ${y(T)}</strong>`,E}},legend:{data:["Montant Payé","Reste à Payer"],bottom:5,type:"scroll"},grid:{left:"3%",right:"4%",bottom:"12%",containLabel:!0},xAxis:{type:"category",data:["Comparaison Globale"]},yAxis:{type:"value",axisLabel:{formatter:"{value} MAD"}},series:[{name:"Montant Payé",type:"bar",stack:"global",emphasis:{focus:"series"},data:[t],itemStyle:{color:I}},{name:"Reste à Payer",type:"bar",stack:"global",emphasis:{focus:"series"},data:[P],itemStyle:{color:U},label:{show:!0,position:"top",formatter:()=>y(T),color:"#333",fontSize:10}}]};const ie=o.realisation_par_mode||{},ee=Object.entries(ie).map(([n,E])=>({name:n||"Inconnu",value:E})).filter(n=>n.value>0);ee.length>0?z.value={title:{text:"Répartition par Mode de Paiement",left:"center",top:10,textStyle:{fontSize:16}},tooltip:{trigger:"item",formatter:n=>`${n.marker} ${n.name}:<br/>${y(n.value)} (${n.percent}%)`},legend:{bottom:5,type:"scroll",data:ee.map(n=>n.name)},series:[{name:"Mode Paiement",type:"pie",radius:["45%","70%"],center:["50%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:5,borderColor:"#fff",borderWidth:1},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold",formatter:`{b}
{d}%`}},labelLine:{show:!1},data:ee}]}:z.value={title:{text:"Répartition par Mode de Paiement",left:"center",top:10,textStyle:{fontSize:16}},graphic:{type:"text",left:"center",top:"center",style:{text:"Aucune donnée de paiement par mode disponible.",textAlign:"center",fill:"#999",fontSize:14}}}}else _.value={},C.value={},z.value={}},{deep:!0,immediate:!0});const at=h(()=>{if(!i.value||!i.value.groups||i.value.groups.length===0||r.value.group_by==="none")return{};const o=i.value.groups;o.sort((n,E)=>String(n.group_key).localeCompare(String(E.group_key)));const a=o.map(n=>n.group_key),t=o.map(n=>n.objectif),P=o.map(n=>n.realisation),T=o.map(n=>Math.max(0,n.objectif-n.realisation));B.find(n=>n.value===r.value.group_by)?.label;const X=(r.value.group_by==="student"||r.value.group_by==="service")&&a.length>10,ie=a.length>15;let ee=10;return ie&&(ee+=8),{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:n=>{const E=n[0].axisValueLabel||n[0].name;let j=`${E}<br/>`;n.forEach(G=>{(G.seriesName==="Payé"||G.seriesName==="Reste")&&(j+=`${G.marker} ${G.seriesName}: ${y(G.value)}<br/>`)});const Qe=o.find(G=>G.group_key===E);return Qe&&(j+='<hr style="border-top: 1px dashed #ccc; margin: 5px 0;">',j+=`<strong>Objectif Total: ${y(Qe.objectif)}</strong>`),j}},legend:{data:["Payé","Reste"],bottom:5,type:"scroll"},grid:{left:q.screen.gt.sm?"1%":"3%",right:"4%",bottom:`${ee}%`,containLabel:!0},xAxis:{type:"category",data:a,axisLabel:{rotate:X?45:0,interval:0,formatter:function(n){const E=String(n),j=X?15:20;return E.length>j?E.substring(0,j-3)+"...":E},fontSize:10},axisTick:{alignWithLabel:!0}},yAxis:{type:"value",show:q.screen.gt.sm,axisLabel:{formatter:"{value} MAD"}},series:[{name:"Reste",type:"bar",stack:"total",emphasis:{focus:"series"},data:T,itemStyle:{color:U}},{name:"Payé",type:"bar",stack:"total",emphasis:{focus:"series"},data:P,itemStyle:{color:I},label:{show:!0,position:"top",formatter:n=>{const E=t[n.dataIndex];return E>0?y(E):""},color:"#333",fontSize:10}}],dataZoom:[{type:"slider",show:ie,xAxisIndex:0,start:0,end:ie?15/a.length*100:100,bottom:30,height:20,handleIcon:"path://M306.1,413c0,2.2-1.8,4-4,4h-51.3c-2.2,0-4-1.8-4-4V101c0-2.2,1.8-4,4-4h51.3c2.2,0,4,1.8,4,4V413z",handleSize:"110%",handleStyle:{color:"#ddd",shadowBlur:3,shadowColor:"rgba(0, 0, 0, 0.6)",shadowOffsetX:2,shadowOffsetY:2}}]}}),re=A([]),_e=A(""),lt=(o,a,t)=>{if(_e.value=o,o===""){a(()=>{re.value=D.value});return}a(()=>{const P=o.toLowerCase();re.value=D.value.filter(T=>T.nom_complet.toLowerCase().indexOf(P)>-1)})},ot=Ue(()=>Fe(()=>import("./Invoice-Co6Np-Hl.js"),__vite__mapDeps([0,1,2,3]),import.meta.url)),st=Ue(()=>Fe(()=>import("./Recouvrement-Warxip9I.js"),__vite__mapDeps([4,1,2,5]),import.meta.url));return Ee(()=>{if(b.value?.idannee){console.log(`Initial mount: Fetching for year ${b.value.idannee}`);const o=b.value.idannee;let a=ce(b.value?.dateentree),t=ce(b.value?.datesortie);a&&(r.value.start_date=le(a,"yyyy-MM-dd")),t&&(r.value.end_date=le(t,"yyyy-MM-dd")),Promise.all([Le(o),ze(),je(o),qe()]).then(()=>{re.value=D.value,be()})}else console.log("Initial mount: No year selected yet."),u.commit("dashboard/SET_ERROR_DETAILS","Veuillez sélectionner une année scolaire.")}),J(D,o=>{re.value=o},{deep:!0}),(o,a)=>(d(),N($,{style:{width:"100vw"}},{default:l(()=>[e(ft,{class:"bg-secondary text-white shadow-2"},{default:l(()=>[ye(e(oe,{flat:"",dense:"",icon:"arrow_back"},null,512),[[Se]]),e(vt,null,{default:l(()=>a[8]||(a[8]=[S("Tableau de Bord Financier Détaillé")])),_:1})]),_:1}),e(x,null,{default:l(()=>[e(bt,{icon:"filter_list",label:"Filtres",class:"bg-grey-2 q-mb-md shadow-1 rounded-borders","header-class":"text-primary text-bold"},{default:l(()=>[e($,null,{default:l(()=>[e(x,null,{default:l(()=>[s("div",St,[s("div",$t,[e(Ie,{dense:"",filled:"",modelValue:r.value.start_date,"onUpdate:modelValue":a[1]||(a[1]=t=>r.value.start_date=t),label:"Date de début",mask:"####-##-##",clearable:""},{prepend:l(()=>[e(Y,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(Ge,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Be,{modelValue:r.value.start_date,"onUpdate:modelValue":a[0]||(a[0]=t=>r.value.start_date=t),mask:"YYYY-MM-DD",minimal:""},{default:l(()=>[s("div",kt,[ye(e(oe,{label:"Fermer",color:"primary",flat:""},null,512),[[Se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Et,[e(Ie,{dense:"",filled:"",modelValue:r.value.end_date,"onUpdate:modelValue":a[3]||(a[3]=t=>r.value.end_date=t),label:"Date de fin",mask:"####-##-##",clearable:""},{prepend:l(()=>[e(Y,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(Ge,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Be,{modelValue:r.value.end_date,"onUpdate:modelValue":a[2]||(a[2]=t=>r.value.end_date=t),mask:"YYYY-MM-DD",minimal:""},{default:l(()=>[s("div",Dt,[ye(e(oe,{label:"Fermer",color:"primary",flat:""},null,512),[[Se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",wt,[e(me,{dense:"",filled:"",modelValue:r.value.group_by,"onUpdate:modelValue":a[4]||(a[4]=t=>r.value.group_by=t),options:B,label:"Grouper par","option-label":"label","option-value":"value","emit-value":"","map-options":""},null,8,["modelValue"])]),s("div",At,[e(me,{dense:"",filled:"",modelValue:r.value.service_types,"onUpdate:modelValue":a[5]||(a[5]=t=>r.value.service_types=t),options:Z,label:"Types de service","option-label":"label","option-value":"value","emit-value":"","map-options":"",multiple:"","use-chips":"",clearable:""},null,8,["modelValue"])]),s("div",Mt,[e(me,{dense:"",filled:"",modelValue:r.value.service_ids,"onUpdate:modelValue":a[6]||(a[6]=t=>r.value.service_ids=t),options:R.value,label:"Services Spécifiques","option-label":"designation","option-value":"idservice",multiple:"","use-chips":"","emit-value":"","map-options":"",clearable:"",loading:p.value.services},{option:l(t=>[e(ne,nt(ut(t.itemProps)),{default:l(()=>[e(W,null,{default:l(()=>[e(O,null,{default:l(()=>[S(v(t.opt.designation),1)]),_:2},1024),e(O,{caption:""},{default:l(()=>[S(v(t.opt.bref),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),"no-option":l(()=>[e(ne,null,{default:l(()=>[e(W,{class:"text-grey"},{default:l(()=>[S(" Aucun service trouvé"+v(b.value?.idannee?" pour l'année "+b.value.description:"")+". ",1)]),_:1})]),_:1})]),_:1},8,["modelValue","options","loading"])]),s("div",Tt,[e(me,{dense:"",filled:"",modelValue:r.value.student_ids,"onUpdate:modelValue":[a[7]||(a[7]=t=>r.value.student_ids=t),ge],options:re.value,label:"Élèves Spécifiques","option-label":"nom_complet","option-value":"idpers",multiple:"","use-chips":"","emit-value":"","map-options":"",clearable:"",loading:p.value.students,"use-input":"","hide-selected":"","input-debounce":"300",onFilter:lt},{"no-option":l(()=>[e(ne,null,{default:l(()=>[e(W,{class:"text-grey"},{default:l(()=>[_e.value?(d(),g("span",Rt,'Aucun élève correspondant à "'+v(_e.value)+'"',1)):(d(),g("span",Vt,"Aucun élève trouvé"+v(b.value?.idannee?" pour l'année "+b.value.description:"")+".",1))]),_:1})]),_:1})]),_:1},8,["modelValue","options","loading"])]),s("div",Ct,[e(oe,{label:"Appliquer",color:"primary",onClick:ge,class:"q-mr-sm",icon:"check",disable:c.value},null,8,["disable"]),e(oe,{label:"Réinitialiser",color:"grey",flat:"",onClick:Oe,icon:"refresh",disable:c.value},null,8,["disable"])])])]),_:1})]),_:1})]),_:1}),ue.value&&ue.value.length>0?(d(),g("div",Pt,[a[9]||(a[9]=s("div",{class:"text-caption q-mb-xs text-grey-7"},"Élèves sélectionnés :",-1)),s("div",qt,[(d(!0),g(ve,null,he(ue.value,t=>(d(),N(gt,{key:t.idpers,removable:"",color:"primary","text-color":"white",icon:"person",onRemove:P=>tt(t),title:t.nom_complet,style:{"max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},{default:l(()=>[S(v(t.nom_complet),1)]),_:2},1032,["onRemove","title"]))),128))])])):te("",!0),!c.value&&r.value.student_ids&&r.value.student_ids.length&&r.value.group_by==="service"&&i.value&&i.value.groups&&i.value.groups.length>0?(d(),g("div",Lt,[a[10]||(a[10]=s("span",{class:"text-grey-7"},"Generer une facture:",-1)),e(Je,{"report-component":Q(ot),"pdf-filename-prefix":"facture-","report-data":Ne.value,"report-component-styles":[{url:"/reports/invoice.css?ver=1.0.9"}]},null,8,["report-component","report-data"]),e($e,{class:"my-4"}),a[11]||(a[11]=s("span",{class:"text-grey-7"},"Recouvrement:",-1)),e(Je,{"report-component":Q(st),"pdf-filename-prefix":"recouvrement-","report-data":Ne.value,"report-component-styles":[{url:"/reports/invoice.css?ver=1.0.9"}]},null,8,["report-component","report-data"]),e($e,{class:"my-4"})])):te("",!0),c.value?(d(),g("div",zt,[e(De,{color:"primary",size:"3em"}),a[12]||(a[12]=s("div",{class:"q-mt-sm text-grey-7"},"Chargement des données financières...",-1))])):w.value?(d(),g("div",jt,[e(Y,{name:"error_outline",size:"2em",class:"q-mr-sm"}),S(" Erreur: "+v(w.value),1)])):k.value?(d(),g("div",Ot,[s("div",Nt,[e($,{flat:"",bordered:"",class:"bg-blue-1"},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[a[13]||(a[13]=s("div",{class:"text-caption text-blue-8"},"Montant Payé",-1)),s("div",Qt,v(y(k.value.total_paye)),1)]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:"bg-indigo-1"},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[a[14]||(a[14]=s("div",{class:"text-caption text-indigo-8"},"Montant Restant",-1)),s("div",It,v(y(k.value.total_a_payer)),1)]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:"bg-blue-grey-1"},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[a[15]||(a[15]=s("div",{class:"text-caption text-blue-grey-7"},"Objectif Total",-1)),s("div",Ut,v(y(k.value.total_objectif)),1)]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:se(M.value>=80?"bg-teal-1":M.value>=50?"bg-yellow-1":"bg-red-1")},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[s("div",{class:se(["text-caption",M.value>=80?"text-teal-8":M.value>=50?"text-yellow-9":"text-red-8"])}," Taux de Paiement",2),s("div",{class:se(["text-h6 text-bold",M.value>=80?"text-teal-9":M.value>=50?"text-yellow-9 text-bold":"text-red-9"])},v(M.value)+"% ",3)]),_:1})]),_:1},8,["class"])]),s("div",Yt,[e($,{flat:"",bordered:"",class:"col-span-1"},{default:l(()=>[e(x,null,{default:l(()=>[a[16]||(a[16]=s("div",{class:"text-subtitle1 q-mb-sm text-center"},"Répartition Globale",-1)),e(Q(H),{class:"chart",option:C.value,autoresize:""},null,8,["option"])]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:"col-span-1"},{default:l(()=>[e(x,null,{default:l(()=>[a[17]||(a[17]=s("div",{class:"text-subtitle1 q-mb-sm text-center"},"Jauge Globale",-1)),e(Q(H),{class:"chart",option:_.value,autoresize:""},null,8,["option"])]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:"col-span-1"},{default:l(()=>[e(x,null,{default:l(()=>[a[18]||(a[18]=s("div",{class:"text-subtitle1 q-mb-sm text-center"},"Paiements par Mode",-1)),e(Q(H),{class:"chart",option:z.value,autoresize:""},null,8,["option"])]),_:1})]),_:1})]),r.value.group_by!=="none"&&i.value&&i.value.groups&&i.value.groups.length>0?(d(),g("div",Ft,[e($,{flat:"",bordered:""},{default:l(()=>[e(x,null,{default:l(()=>[s("div",Bt," Détails par "+v(B.find(t=>t.value===r.value.group_by)?.label||"Élément")+" (Objectif vs Payé) ",1),e(Q(H),{class:"chart",option:at.value,autoresize:"",style:dt({height:(r.value.group_by==="student"||r.value.group_by==="service")&&i.value.groups.length>10?"550px":"400px"})},null,8,["option","style"])]),_:1})]),_:1})])):te("",!0),r.value.group_by!=="none"&&i.value&&i.value.groups&&i.value.groups.length>0?(d(),g("div",Gt,[e($,{flat:"",bordered:""},{default:l(()=>[e(x,null,{default:l(()=>[s("div",Wt," Tableau Détaillé par "+v(B.find(t=>t.value===r.value.group_by)?.label||"Élément"),1),Q(q).screen.gt.sm?(d(),N(We,{key:0,rows:i.value.groups,columns:[{name:"group_key",label:B.find(t=>t.value===r.value.group_by)?.label||"Élément",field:"group_key",align:"left",sortable:!0},{name:"objectif",label:"Objectif",field:"objectif",format:t=>y(t),align:"right",sortable:!0},{name:"realisation",label:"Réalisé",field:"realisation",format:t=>y(t),align:"right",sortable:!0},{name:"reste",label:"Reste",field:t=>Math.max(0,t.objectif-t.realisation),format:t=>y(t),align:"right",sortable:!0},{name:"taux",label:"Taux (%)",field:t=>K(t),align:"right",sortable:!0}],"row-key":"group_key",dense:"",pagination:{rowsPerPage:15}},{"body-cell-taux":l(t=>[e(xe,{props:t},{default:l(()=>[e(pe,{color:de(t.value),label:`${t.value}%`},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-group_key":l(t=>[e(xe,{props:t,title:t.value},{default:l(()=>[S(v(String(t.value)?.length>40?String(t.value).substring(0,37)+"...":t.value),1)]),_:2},1032,["props","title"])]),_:1},8,["rows","columns"])):(d(),N(He,{key:1,bordered:"",separator:""},{default:l(()=>[(d(!0),g(ve,null,he(i.value.groups,t=>(d(),N(ne,{key:t.group_key},{default:l(()=>[e(W,null,{default:l(()=>[e(O,{lines:"2",class:"text-weight-medium"},{default:l(()=>[S(v(t.group_key),1)]),_:2},1024),e(O,{caption:""},{default:l(()=>[S(" Objectif: "+v(y(t.objectif)),1)]),_:2},1024),e(O,{caption:""},{default:l(()=>[S(" Réalisé: "+v(y(t.realisation)),1)]),_:2},1024),e(O,{caption:""},{default:l(()=>[S(" Reste: "+v(y(Math.max(0,t.objectif-t.realisation))),1)]),_:2},1024)]),_:2},1024),e(W,{side:"",top:""},{default:l(()=>[e(O,{caption:""},{default:l(()=>a[19]||(a[19]=[S("Taux")])),_:1}),e(pe,{color:de(K(t)),label:`${K(t)}%`},null,8,["color","label"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})])):te("",!0),r.value.group_by==="none"&&i.value&&Array.isArray(i.value)&&i.value.length>0?(d(),g("div",Ht,[e($,{flat:"",bordered:""},{default:l(()=>[e(x,null,{default:l(()=>[a[22]||(a[22]=s("div",{class:"text-subtitle1 q-mb-sm"},"Liste des Échéances (Non groupées)",-1)),Q(q).screen.gt.sm?(d(),N(We,{key:0,rows:i.value,columns:[{name:"eleve_nom",label:"Élève",field:"eleve_nom",align:"left",sortable:!0},{name:"classe_nom",label:"Classe",field:"classe_nom",align:"left",sortable:!0},{name:"service_nom",label:"Service",field:"service_nom",align:"left",sortable:!0},{name:"periode",label:"Période",field:"periode",align:"center",sortable:!0},{name:"objectif",label:"Objectif",field:"objectif",format:t=>y(t),align:"right",sortable:!0},{name:"realisation",label:"Réalisé",field:"realisation",format:t=>y(t),align:"right",sortable:!0},{name:"reste",label:"Reste",field:t=>Math.max(0,t.objectif-t.realisation),format:t=>y(t),align:"right",sortable:!0},{name:"taux",label:"Taux (%)",field:t=>K(t),align:"right",sortable:!0}],"row-key":"row => `${row.eleve_id}-${row.service_id}-${row.periode}`",dense:"",pagination:{rowsPerPage:20}},{"body-cell-taux":l(t=>[e(xe,{props:t},{default:l(()=>[e(pe,{color:de(t.value),label:`${t.value}%`},null,8,["color","label"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])):(d(),N(He,{key:1,bordered:"",separator:""},{default:l(()=>[(d(!0),g(ve,null,he(i.value,t=>(d(),N(ne,{key:`${t.eleve_id}-${t.service_id}-${t.periode}`},{default:l(()=>[e(W,null,{default:l(()=>[e(O,{lines:"1",class:"text-weight-medium"},{default:l(()=>[S(v(t.eleve_nom),1)]),_:2},1024),e(O,{caption:""},{default:l(()=>[S(v(t.classe_nom)+" - "+v(t.service_nom)+" ("+v(t.periode)+") ",1)]),_:2},1024),e(O,{caption:"",class:"q-mt-xs"},{default:l(()=>[S(" Obj: "+v(y(t.objectif))+" | Payé: ",1),s("span",Jt,v(y(t.realisation)),1),a[20]||(a[20]=S(" | Reste: ")),s("span",Zt,v(y(Math.max(0,t.objectif-t.realisation))),1)]),_:2},1024)]),_:2},1024),e(W,{side:"",top:""},{default:l(()=>[e(O,{caption:""},{default:l(()=>a[21]||(a[21]=[S("Taux")])),_:1}),e(pe,{color:de(K(t)),label:`${K(t)}%`},null,8,["color","label"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})])):r.value.group_by!=="none"&&(!i.value||!i.value.groups||i.value.groups.length===0)?(d(),g("div",Kt,[e(Y,{name:"data_usage",size:"3em"}),a[23]||(a[23]=s("div",{class:"q-mt-sm"},"Aucun groupe à afficher pour les filtres sélectionnés.",-1))])):r.value.group_by==="none"&&(!i.value||!Array.isArray(i.value)||i.value.length===0)?(d(),g("div",Xt,[e(Y,{name:"list_alt",size:"3em"}),a[24]||(a[24]=s("div",{class:"q-mt-sm"},"Aucune échéance à afficher pour les filtres sélectionnés.",-1))])):te("",!0)])):!c.value&&!w.value&&!k.value?(d(),g("div",ea,[e(Y,{name:"hourglass_empty",size:"3em"}),a[25]||(a[25]=s("div",{class:"q-mt-sm"},"Aucune donnée financière à afficher pour les filtres sélectionnés.",-1)),a[26]||(a[26]=s("div",{class:"q-mt-xs text-caption"},"Vérifiez l'année scolaire ou ajustez les filtres.",-1))])):te("",!0)]),_:1})]),_:1}))}},aa={key:0,class:"text-center q-pa-xl"},la={key:1,class:"text-negative text-center q-pa-md"},oa={key:2},sa={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-4 w-full min-w-0 q-mb-md"},ra={class:"text-h6 text-bold text-blue-9"},ia={class:"text-h6 text-bold text-indigo-9"},na={class:"text-h6 text-bold text-blue-grey-9"},ua={class:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full mt-4"},da={class:"text-center q-mt-md"},ca={key:3,class:"text-center text-grey-6 q-pa-xl"},ma={__name:"Total",setup(fe){Ae([Ve,et,Pe,Me,Te,Re,Ce]);const u=ke(),q=A(!1),{getPaletteColor:F}=Xe,I=F("primary"),U=F("secondary"),r=h(()=>u.getters["dashboard/isLoading"]),R=h(()=>u.getters["dashboard/getError"]),L=h(()=>u.getters["dashboard/getTotals"]),D=h(()=>u.getters["user/current"]?.annee),p=h(()=>L.value?(L.value.total_paye||0)+(L.value.total_a_payer||0):0),c=h(()=>{if(!L.value||!p.value)return 0;const m=L.value.total_paye||0;return p.value>0?Math.round(m/p.value*100):m>0?100:0}),w=A({}),i=A({}),b=m=>m==null||isNaN(m)?"N/A":new Intl.NumberFormat("fr-MA",{style:"currency",currency:"MAD"}).format(m),V=()=>{u.commit("dashboard/SET_DETAILS",null),q.value=!0};return J(()=>D.value?.idannee,(m,f)=>{m&&m>0?m!==f&&(console.log(`Total.vue: Year changed to ${m}, fetching totals...`),u.dispatch("dashboard/fetchDashboardTotal")):m||(console.log("Total.vue: Year deselected, clearing totals."),u.commit("dashboard/SET_TOTALS",null),u.commit("dashboard/SET_ERROR","Aucune année scolaire sélectionnée."))},{immediate:!1}),J(L,m=>{if(m&&typeof m.total_paye=="number"&&typeof m.total_a_payer=="number"){const f=m.total_paye,k=m.total_a_payer,M=f+k,_=M>0?Math.round(f/M*100):f>0?100:0;w.value={series:[{type:"gauge",startAngle:180,endAngle:0,min:0,max:100,splitNumber:5,axisLine:{lineStyle:{width:10,color:[[.3,"#fd666d"],[.7,U],[1,I]]}},pointer:{icon:"path://M12.8,0.7l-4.4,6.1c-0.4,0.6-0.4,1.4,0,2L12.8,15.3c0.4,0.6,1.2,0.6,1.6,0l4.4-6.1c0.4-0.6,0.4-1.4,0-2L14.4,0.7C14,0.1,13.2,0.1,12.8,0.7z",length:"75%",width:8,offsetCenter:[0,"-60%"],itemStyle:{color:"auto"}},axisTick:{length:12,lineStyle:{color:"auto",width:2}},splitLine:{length:20,lineStyle:{color:"auto",width:5}},axisLabel:{color:"#464646",fontSize:15,distance:-60,formatter:function(C){return C===0||C===50||C===100?C+"%":""}},title:{offsetCenter:[0,"-10%"],fontSize:16,fontWeight:"bold",color:"#333"},detail:{fontSize:30,offsetCenter:[0,"-35%"],valueAnimation:!0,formatter:"{value}%",color:"auto"},data:[{value:_,name:"Taux de Paiement"}]}],tooltip:{formatter:"{a} <br/>{b} : {c}%"}},i.value={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:C=>{let z=`${C[0].axisValue}<br/>`,B=0;return C.forEach(Z=>{z+=`${Z.marker} ${Z.seriesName}: ${b(Z.value)}<br/>`,B+=Z.value}),z+='<hr style="border-top: 1px dashed #ccc; margin: 5px 0;">',z+=`<strong>Objectif Total: ${b(M)}</strong>`,z}},legend:{data:["Montant Payé","Reste à Payer"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:["Synthèse Globale"]},yAxis:{type:"value",axisLabel:{formatter:"{value} MAD"}},series:[{name:"Montant Payé",type:"bar",stack:"global",emphasis:{focus:"series"},data:[f],itemStyle:{color:I}},{name:"Reste à Payer",type:"bar",stack:"global",emphasis:{focus:"series"},data:[k],itemStyle:{color:U},label:{show:!0,position:"top",formatter:()=>b(M),color:"#333",fontSize:10}}]}}else w.value={},i.value={}},{deep:!0,immediate:!0}),Ee(()=>{D.value?.idannee?(console.log(`Total.vue: Initial fetch for year ${D.value.idannee}`),u.dispatch("dashboard/fetchDashboardTotal")):(console.log("Total.vue: Initial mount - No year selected yet."),u.getters["user/current"]?.annee||u.commit("dashboard/SET_ERROR","Veuillez sélectionner une année scolaire."))}),(m,f)=>(d(),g(ve,null,[e(x,null,{default:l(()=>[r.value?(d(),g("div",aa,[e(De,{color:"primary",size:"3em"}),f[1]||(f[1]=s("div",{class:"q-mt-sm text-grey-7"},"Chargement des données globales...",-1))])):R.value?(d(),g("div",la,[e(Y,{name:"error_outline",size:"2em",class:"q-mr-sm"}),S(" Erreur: "+v(R.value),1)])):L.value?(d(),g("div",oa,[s("div",sa,[e($,{flat:"",bordered:"",class:"bg-blue-1"},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[f[2]||(f[2]=s("div",{class:"text-caption text-blue-8"},"Montant Payé",-1)),s("div",ra,v(b(L.value.total_paye)),1)]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:"bg-indigo-1"},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[f[3]||(f[3]=s("div",{class:"text-caption text-indigo-8"},"Montant Restant",-1)),s("div",ia,v(b(L.value.total_a_payer)),1)]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:"bg-blue-grey-1"},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[f[4]||(f[4]=s("div",{class:"text-caption text-blue-grey-7"},"Objectif Total",-1)),s("div",na,v(b(p.value)),1)]),_:1})]),_:1}),e($,{flat:"",bordered:"",class:se(c.value>=80?"bg-teal-1":c.value>=50?"bg-yellow-1":"bg-red-1")},{default:l(()=>[e(x,{class:"text-center"},{default:l(()=>[s("div",{class:se(["text-caption",c.value>=80?"text-teal-8":c.value>=50?"text-yellow-9":"text-red-8"])}," Taux de Paiement ",2),s("div",{class:se(["text-h6 text-bold",c.value>=80?"text-teal-9":c.value>=50?"text-yellow-9 text-bold":"text-red-9"])},v(c.value)+"% ",3)]),_:1})]),_:1},8,["class"])]),s("div",ua,[e($,{flat:"",bordered:""},{default:l(()=>[e(x,null,{default:l(()=>[f[5]||(f[5]=s("div",{class:"text-subtitle1 q-mb-sm"},"Répartition Globale (Payé vs Reste)",-1)),e(Q(H),{class:"chart",option:i.value,autoresize:"",style:{height:"300px"}},null,8,["option"])]),_:1})]),_:1}),e($,{flat:"",bordered:""},{default:l(()=>[e(x,null,{default:l(()=>[f[6]||(f[6]=s("div",{class:"text-subtitle1 q-mb-sm"},"Jauge Globale de Paiement",-1)),e(Q(H),{class:"chart",option:w.value,autoresize:"",style:{height:"300px"}},null,8,["option"])]),_:1})]),_:1})]),s("div",da,[e(oe,{label:"Afficher les Détails",color:"primary",icon:"search",onClick:V})])])):(d(),g("div",ca,[e(Y,{name:"hourglass_empty",size:"3em"}),f[7]||(f[7]=s("div",{class:"q-mt-sm"},"Aucune donnée financière globale à afficher.",-1)),f[8]||(f[8]=s("div",{class:"q-mt-xs text-caption"},"Vérifiez l'année scolaire sélectionnée.",-1))]))]),_:1}),e(ct,{modelValue:q.value,"onUpdate:modelValue":f[0]||(f[0]=k=>q.value=k),maximized:"",position:"right"},{default:l(()=>[e(ta)]),_:1},8,["modelValue"])],64))}},pa=we(ma,[["__scopeId","data-v-8802339d"]]),va={class:"q-mb-md text-right"},fa={key:0,class:"text-center q-pa-md"},ba={key:1,class:"text-negative text-center q-pa-md"},ga={key:2},_a={key:3,class:"text-center text-grey-6 q-pa-md"},ya={__name:"StudentEvolution",setup(fe){Ae([Ve,Pe,yt,Me,Te,Re,Ce]),Ke();const u=ke(),q=h(()=>u.getters["dashboard/isEvolutionLoading"]),F=h(()=>u.getters["dashboard/getEvolutionError"]),I=h(()=>u.getters["dashboard/getEvolutionData"]),U=h(()=>u.getters["user/current"]?.annee),r=A({}),R=A("line"),L=p=>p==null||isNaN(p)?"N/A":p.toLocaleString("fr-FR"),D=(p,c)=>{if(!p||!Array.isArray(p)||p.length===0)return{};const w=[...p].reverse(),i=w.map(_=>_.year_description),b=w.map(_=>_.demandes),V=w.map(_=>_.inscrits),m=w.map(_=>_.reinscrits),f=w.map(_=>_.departs),k={title:{text:"Évolution des Effectifs Élèves",subtext:"Sur les 5 dernières années scolaires",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:c==="bar"?"shadow":"cross"},formatter:_=>{let C=`${_[0].axisValue}<br/>`;return _.forEach(z=>{C+=`${z.marker} ${z.seriesName}: ${L(z.value)}<br/>`}),C}},legend:{data:["Demandes","Inscrits","Réinscrits","Départs"],bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:i,axisTick:{alignWithLabel:c==="bar"}},yAxis:{type:"value"}},M=[{name:"Demandes",type:c,data:b,itemStyle:{color:"#91cc75"},emphasis:{focus:"series"}},{name:"Inscrits",type:c,data:V,itemStyle:{color:"#5470c6"},emphasis:{focus:"series"}},{name:"Réinscrits",type:c,data:m,itemStyle:{color:"#fac858"},emphasis:{focus:"series"}},{name:"Départs",type:c,data:f,itemStyle:{color:"#ee6666"},emphasis:{focus:"series"}}];return c==="line"&&(M.forEach(_=>{_.smooth=!0,_.symbol="circle",_.symbolSize=6,_.lineStyle={width:2}}),k.tooltip.axisPointer.label={backgroundColor:"#6a7985"}),{...k,series:M}};return J(()=>U.value?.idannee,(p,c)=>{p&&p>0?p!==c&&(console.log(`StudentEvolution.vue: Year changed to ${p}, fetching evolution...`),u.dispatch("dashboard/fetchStudentEvolution")):p||(console.log("StudentEvolution.vue: Year deselected, clearing evolution data."),u.commit("dashboard/SET_EVOLUTION_DATA",null),u.commit("dashboard/SET_EVOLUTION_ERROR","Aucune année scolaire sélectionnée."))},{immediate:!1}),J([I,R],([p,c],[w,i])=>{console.log(`StudentEvolution.vue: Updating chart. Data changed: ${p!==w}, Type changed: ${c!==i}`),r.value=D(p,c)},{deep:!0,immediate:!0}),Ee(()=>{U.value?.idannee?(console.log(`StudentEvolution.vue: Initial fetch for year ${U.value.idannee}`),u.dispatch("dashboard/fetchStudentEvolution")):(console.log("StudentEvolution.vue: Initial mount - No year selected yet."),u.getters["user/current"]?.annee||u.commit("dashboard/SET_EVOLUTION_ERROR","Veuillez sélectionner une année scolaire."))}),(p,c)=>(d(),N($,{flat:"",bordered:""},{default:l(()=>[e(x,null,{default:l(()=>[s("div",va,[e(xt,{modelValue:R.value,"onUpdate:modelValue":c[0]||(c[0]=w=>R.value=w),flat:"",dense:"",options:[{label:"Barres",value:"bar",icon:"bar_chart"},{label:"Lignes",value:"line",icon:"show_chart"}],size:"sm",color:"primary","toggle-color":"secondary"},null,8,["modelValue"])]),q.value?(d(),g("div",fa,[e(De,{color:"secondary",size:"2.5em"}),c[1]||(c[1]=s("div",{class:"q-mt-sm text-grey-7"},"Chargement de l'évolution des élèves...",-1))])):F.value?(d(),g("div",ba,[e(Y,{name:"warning_amber",size:"2em",class:"q-mr-sm"}),S(" "+v(F.value),1)])):I.value&&I.value.length>0?(d(),g("div",ga,[(d(),N(Q(H),{class:"chart",option:r.value,autoresize:"",style:{height:"400px"},key:R.value},null,8,["option"]))])):(d(),g("div",_a,[e(Y,{name:"analytics",size:"2.5em"}),c[2]||(c[2]=s("div",{class:"q-mt-sm"},"Aucune donnée d'évolution à afficher.",-1)),c[3]||(c[3]=s("div",{class:"q-mt-xs text-caption"},"Vérifiez l'année scolaire sélectionnée ou les données archivées.",-1))]))]),_:1})]),_:1}))}},ha=we(ya,[["__scopeId","data-v-1e357f7c"]]),xa={class:"mb-6"},Sa={class:""},$a={class:"mt-6"},ka={__name:"Dashboard",setup(fe){return(u,q)=>(d(),N(mt,{padding:"",class:"page-content"},{default:l(()=>[q[0]||(q[0]=s("div",{class:"text-h4 q-mb-md"},null,-1)),s("div",xa,[s("div",Sa,[e(pa)]),e($e),s("div",$a,[e(ha)])])]),_:1}))}},ul=we(ka,[["__scopeId","data-v-e446f7a8"]]);export{ul as default};
