import{v as U,B as L,y as J,bp as K,_ as W,aP as X,aO as Z,A as _,Y as tt,C as et,Q as v,S as u,a6 as e,a8 as t,a5 as l,aE as c,ac as C,aF as m,ab as o,a3 as x,ad as d,au as st,a4 as h,a9 as D,aa as T,af as at,aS as lt,ah as M,ax as H,aD as ot,R as N,av as R,aG as rt,aC as dt,b3 as z}from"./index-Bl2lQPd7.js";import{Q as A}from"./QTooltip-r7WoEuzy.js";import{Q as it}from"./QInnerLoading-WxvcYHvS.js";import{Q as nt,a as ut}from"./QTable-D-OlObRI.js";import{Q as b}from"./QTd-CpEgdqvP.js";import{Q as Y}from"./QItemLabel-BkJiB6aE.js";import{Q as ct,a as $}from"./QItem-De3v03wU.js";import{Q as mt}from"./QList-CMzNTEGD.js";import{Q as ft}from"./QToolbarTitle-C8APieXG.js";import{Q as pt}from"./QSpace-CKKoNTi_.js";import{Q as _t}from"./QToolbar-DR-_wX4W.js";import{a as vt}from"./QVirtualScroll-CENgsPEr.js";import{C as j}from"./ClosePopup-BY_YGFBZ.js";import{q as xt}from"./date-C1Mon-Jj.js";import{u as ht}from"./composables-CAkrP3jA.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./QSelect-DchnWyXK.js";import"./QChip-C9OfA2gn.js";import"./QMenu-BNr9Tzvf.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";import"./QLinearProgress-DW1NPbfx.js";const S=U({name:"QTr",props:{props:Object,noHover:Boolean},setup(p,{slots:w}){const Q=L(()=>"q-tr"+(p.props===void 0||p.props.header===!0?"":" "+p.props.__trClass)+(p.noHover===!0?" q-tr--no-hover":""));return()=>J("tr",{style:p.props?.__trStyle,class:Q.value},K(w.default))}}),bt={class:"content-container"},gt={class:"row q-col-gutter-md q-mb-md"},yt={class:"col-6 col-sm-6 col-md-3"},wt={class:"text-h5 text-weight-bold text-secondary q-mt-sm"},Qt={class:"col-6 col-sm-6 col-md-3"},kt={class:"text-h5 text-weight-bold text-positive q-mt-sm"},qt={class:"col-6 col-sm-6 col-md-3"},Ct={class:"text-h5 text-weight-bold text-primary q-mt-sm"},Dt={class:"col-6 col-sm-6 col-md-3"},Tt={class:"text-h5 text-weight-bold text-primary q-mt-sm"},At={class:"row q-col-gutter-md"},Ot={class:"col-12 col-lg-8"},Bt={class:"row items-center justify-between"},It={class:"row no-wrap items-center q-py-sm"},St={class:"col"},Pt={class:"text-subtitle text-weight-medium"},Vt={class:"text-caption text-grey q-mt-xs"},Ft={class:"col-auto q-ml-md"},Mt={class:"text-subtitle text-weight-medium text-right"},Ht={class:"col-auto q-ml-md"},Nt={class:"col-12 col-lg-4"},Rt={class:"row items-center justify-between"},zt={class:"text-subtitle1 text-weight-medium text-primary"},Yt={class:"row q-col-gutter-lg"},$t={class:"col-12 col-md-4"},jt={class:"column q-gutter-y-md"},Et={class:"text-body1"},Lt={class:"text-body1"},Gt={class:"text-body1"},Ut={class:"text-h6 text-primary"},Jt={class:"col-12 col-md-8"},Kt={class:"desktop-only"},Wt={class:"text-subtitle"},Xt={class:"text-caption text-grey"},Zt={class:"text-center"},te={class:"text-center"},ee={class:"text-right text-weight-medium"},se={class:"text-right text-primary text-weight-bold"},ae={class:"mobile-only"},le={class:"text-subtitle"},oe={class:"text-caption text-grey q-mb-sm"},re={class:"row items-center q-gutter-x-md text-body2"},de={class:"text-weight-medium"},ie="#113e7f",ne="#85b9e8",E="#0B2A52",ue={__name:"Dashboard",setup(p){const w=X(),Q=Z(),P=L(()=>Q.screen),{setTitle:G}=ht(),k=r=>(console.log(z(r),r),r?xt.formatDate(z(r),"DD/MM/YYYY HH:mm"):"-"),n=r=>(r=Number(r),typeof r!="number"?"-":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"MAD"}).format(r).replace("MAD","DH")),g=_({totalOrders:0,todayOrders:0,totalRevenue:0,todayRevenue:0,totalBalance:0}),V=_([]),F=_([]),O=_(!1),i=_(null),y=_(!1),B=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"student",label:"Étudiant",field:"student",align:"left",sortable:!0},{name:"date",label:"Date",field:r=>r.date_achat||r.created_at,format:k,align:"left",sortable:!0},{name:"total",label:"Total",field:"total",format:n,align:"right",sortable:!0},{name:"actions",label:"Actions",field:"actions",align:"center"}],I=async()=>{try{y.value=!0;const r=await w.dispatch("snack/getDashboardData");g.value=r.stats,V.value=r.recentOrders,F.value=r.popularItems,y.value=!1}catch(r){console.error("Error loading dashboard data:",r)}},q=async r=>{try{const s=await w.dispatch("snack/fetchOrderById",r.id);i.value=s,O.value=!0}catch(s){console.error("Error loading order details:",s)}};return tt(P,()=>{P.value.lt.sm?B.pop():B.push({name:"actions",label:"Actions",field:"actions",align:"center"})}),et(()=>{G("Tableau de bord"),I()}),(r,s)=>(u(),v(dt,{class:"page-content bg-grey-1"},{default:e(()=>[t("div",bt,[t("div",gt,[t("div",yt,[l(c,{flat:"",bordered:"",class:"dashboard-card rounded-lg h-full text-white shadow-3",style:C({backgroundColor:ne})},{default:e(()=>[l(m,null,{default:e(()=>[s[1]||(s[1]=t("div",{class:"text-subtitle text-white"},"Total des commandes",-1)),t("div",wt,o(g.value.totalOrders||0),1)]),_:1})]),_:1},8,["style"])]),t("div",Qt,[l(c,{flat:"",bordered:"",class:"dashboard-card rounded-lg h-full text-white shadow-3",style:C({backgroundColor:E})},{default:e(()=>[l(m,null,{default:e(()=>[s[2]||(s[2]=t("div",{class:"text-subtitle text-white"},"Commandes aujourd'hui",-1)),t("div",kt,o(g.value.todayOrders||0),1)]),_:1})]),_:1},8,["style"])]),t("div",qt,[l(c,{flat:"",bordered:"",class:"dashboard-card rounded-lg h-full text-white shadow-3",style:C({backgroundColor:ie})},{default:e(()=>[l(m,null,{default:e(()=>[s[3]||(s[3]=t("div",{class:"text-subtitle text-white"},"Revenu total",-1)),t("div",Ct,o(n(g.value.totalRevenue)),1)]),_:1})]),_:1},8,["style"])]),t("div",Dt,[l(c,{flat:"",bordered:"",class:"dashboard-card rounded-lg h-full text-white shadow-3",style:C({backgroundColor:E})},{default:e(()=>[l(m,null,{default:e(()=>[s[4]||(s[4]=t("div",{class:"text-subtitle text-white"},"Solde total",-1)),t("div",Tt,o(n(g.value.totalBalance)),1)]),_:1})]),_:1},8,["style"])])]),t("div",At,[t("div",Ot,[l(c,{flat:"",bordered:""},{default:e(()=>[l(m,null,{default:e(()=>[t("div",Bt,[s[6]||(s[6]=t("div",{class:"text-h6 text-weight-bold text-primary"},"Commandes récentes",-1)),l(x,{flat:"",color:"primary",icon:"refresh",onClick:I,loading:y.value},{default:e(()=>[l(A,null,{default:e(()=>s[5]||(s[5]=[d("Actualiser")])),_:1})]),_:1},8,["loading"])])]),_:1}),l(nt,{rows:V.value,columns:B,"row-key":"id",pagination:{rowsPerPage:10},"rows-per-page-options":[10,20,50],flat:"",bordered:"",class:"orders-table",loading:y.value},st({loading:e(()=>[l(it,{showing:"",color:"primary"})]),header:e(a=>[l(S,{props:a},{default:e(()=>[(u(!0),h(D,null,T(a.cols,f=>(u(),v(ut,{key:f.name,props:a,class:at(["text-weight-bold",f.align==="right"?"text-right":f.align==="center"?"text-center":""])},{default:e(()=>[d(o(f.label),1)]),_:2},1032,["props","class"]))),128))]),_:2},1032,["props"])]),"no-data":e(()=>[s[8]||(s[8]=t("div",{class:"full-width row flex-center q-pa-md text-grey-8"}," Aucune commande trouvée ",-1))]),bottom:e(()=>[]),_:2},[lt(Q).screen.gt.sm?{name:"body",fn:e(a=>[l(S,{props:a,class:"cursor-pointer",onClick:f=>q(a.row)},{default:e(()=>[l(b,{key:"id",props:a},{default:e(()=>[d(o(a.row.id),1)]),_:2},1032,["props"]),l(b,{key:"student",props:a},{default:e(()=>[d(o(a.row.student),1)]),_:2},1032,["props"]),l(b,{key:"date",props:a},{default:e(()=>[d(o(k(a.row.date||a.row.created_at)),1)]),_:2},1032,["props"]),l(b,{key:"total",props:a,class:"text-right"},{default:e(()=>[d(o(n(a.row.total)),1)]),_:2},1032,["props"]),l(b,{key:"actions",props:a,class:"text-center"},{default:e(()=>[l(x,{flat:"",round:"",size:"sm",color:"primary",icon:"visibility",onClick:M(f=>q(a.row),["stop"])},{default:e(()=>[l(A,null,{default:e(()=>s[7]||(s[7]=[d("Voir les détails")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props","onClick"])]),key:"0"}:{name:"body",fn:e(a=>[l(S,{props:a,onClick:f=>q(a.row),class:"cursor-pointer"},{default:e(()=>[l(b,{colspan:"100%"},{default:e(()=>[t("div",It,[t("div",St,[t("div",Pt,o(a.row.student),1),t("div",Vt," #"+o(a.row.id)+" · "+o(k(a.row.date||a.row.created_at)),1)]),t("div",Ft,[t("div",Mt,o(n(a.row.total)),1)]),t("div",Ht,[l(x,{flat:"",round:"",size:"sm",color:"primary",icon:"visibility",onClick:M(f=>q(a.row),["stop"])},null,8,["onClick"])])])]),_:2},1024)]),_:2},1032,["props","onClick"])]),key:"1"}]),1032,["rows","loading"])]),_:1})]),t("div",Nt,[l(c,{flat:"",bordered:""},{default:e(()=>[l(m,null,{default:e(()=>[t("div",Rt,[s[10]||(s[10]=t("div",{class:"text-h6 text-weight-bold text-primary"},"Articles populaires",-1)),l(x,{flat:"",color:"primary",icon:"refresh",onClick:I,loading:y.value},{default:e(()=>[l(A,null,{default:e(()=>s[9]||(s[9]=[d("Actualiser")])),_:1})]),_:1},8,["loading"])])]),_:1}),l(mt,{separator:"",class:"rounded-borders"},{default:e(()=>[l(H),(u(!0),h(D,null,T(F.value,a=>(u(),v(ct,{key:a.id,class:"q-py-md"},{default:e(()=>[l($,null,{default:e(()=>[l(Y,{class:"text-subtitle1 text-weight-medium"},{default:e(()=>[d(o(a.name),1)]),_:2},1024),l(Y,{caption:""},{default:e(()=>[d(o(a.orders)+" commandes · "+o(a.total_quantity)+" articles ",1)]),_:2},1024)]),_:2},1024),l($,{side:""},{default:e(()=>[t("div",zt,o(n(a.price)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]),l(ot,{modelValue:O.value,"onUpdate:modelValue":s[0]||(s[0]=a=>O.value=a),maximized:""},{default:e(()=>[l(c,{class:"column"},{default:e(()=>[l(_t,{class:"bg-secondary text-white"},{default:e(()=>[l(ft,null,{default:e(()=>[d("Commande #"+o(i.value?.idordre),1)]),_:1}),l(pt),R((u(),v(x,{icon:"close",flat:"",round:"",dense:"",class:"text-white"},{default:e(()=>[l(A,null,{default:e(()=>s[11]||(s[11]=[d("Fermer")])),_:1})]),_:1})),[[j]])]),_:1}),i.value?(u(),v(m,{key:0,class:"col q-pa-md scroll"},{default:e(()=>[t("div",Yt,[t("div",$t,[l(c,{flat:"",bordered:"",class:"q-mb-md"},{default:e(()=>[l(m,null,{default:e(()=>[s[16]||(s[16]=t("div",{class:"text-subtitle1 text-primary q-mb-lg"},"Informations",-1)),t("div",jt,[t("div",null,[s[12]||(s[12]=t("div",{class:"text-caption text-white"},"Étudiant",-1)),t("div",Et,o(i.value.personne.nom)+" "+o(i.value.personne.prenom),1)]),t("div",null,[s[13]||(s[13]=t("div",{class:"text-caption text-white"},"Date",-1)),t("div",Lt,o(k(i.value.date||i.value.created_at)),1)]),t("div",null,[s[14]||(s[14]=t("div",{class:"text-caption text-white"},"Quantité totale",-1)),t("div",Gt,o(i.value.total_quantite)+" articles",1)]),t("div",null,[s[15]||(s[15]=t("div",{class:"text-caption text-white"},"Total",-1)),t("div",Ut,o(n(i.value.total)),1)])])]),_:1})]),_:1})]),t("div",Jt,[l(c,{flat:"",bordered:""},{default:e(()=>[l(m,null,{default:e(()=>[s[23]||(s[23]=t("div",{class:"text-subtitle1 text-primary q-mb-lg"},"Articles commandés",-1)),t("div",Kt,[l(vt,{flat:"",bordered:""},{default:e(()=>[s[19]||(s[19]=t("thead",null,[t("tr",null,[t("th",{class:"text-left"},"Article"),t("th",{class:"text-center",style:{width:"120px"}},"Prix unitaire"),t("th",{class:"text-center",style:{width:"100px"}},"Quantité"),t("th",{class:"text-right",style:{width:"120px"}},"Total")])],-1)),t("tbody",null,[(u(!0),h(D,null,T(i.value.items,a=>(u(),h("tr",{key:a.id},[t("td",null,[t("div",Wt,o(a.menu.designation),1),t("div",Xt,o(a.menu.description||"Aucune description"),1)]),t("td",Zt,o(n(a.prix_unitaire)),1),t("td",te,o(a.quantite),1),t("td",ee,o(n(a.prix_unitaire*a.quantite)),1)]))),128))]),t("tfoot",null,[t("tr",null,[s[17]||(s[17]=t("td",{colspan:"2"},null,-1)),s[18]||(s[18]=t("td",{class:"text-right text-weight-medium"},"Total:",-1)),t("td",se,o(n(i.value.total)),1)])])]),_:1})]),t("div",ae,[(u(!0),h(D,null,T(i.value.items,a=>(u(),h("div",{key:a.id,class:"q-py-md"},[t("div",le,o(a.menu.designation),1),t("div",oe,o(a.menu.description||"Aucune description"),1),t("div",re,[t("div",null,[s[20]||(s[20]=t("span",{class:"text-white"},"Prix:",-1)),d(" "+o(n(a.prix_unitaire)),1)]),t("div",null,[s[21]||(s[21]=t("span",{class:"text-white"},"Qté:",-1)),d(" "+o(a.quantite),1)]),t("div",de,[s[22]||(s[22]=t("span",{class:"text-white"},"Total:",-1)),d(" "+o(n(a.prix_unitaire*a.quantite)),1)])]),i.value.items.indexOf(a)!==i.value.items.length-1?(u(),v(H,{key:0,class:"q-mt-md"})):N("",!0)]))),128))])]),_:1})]),_:1})])])]),_:1})):N("",!0),l(rt,{align:"right",class:"bg-white q-pa-md"},{default:e(()=>[R(l(x,{flat:"",label:"Fermer",color:"primary"},null,512),[[j]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Pe=W(ue,[["__scopeId","data-v-d4c24b5d"]]);export{Pe as default};
