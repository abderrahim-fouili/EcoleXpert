import{Q as se}from"./QBadge-Bjfo5tRO.js";import{_ as ae,bt as le,ag as T,Q as m,S as i,a6 as s,a8 as o,a5 as t,R as g,a3 as p,ad as d,ay as h,ab as n,aE as _,a4 as v,b7 as oe,ax as z,a9 as H,aa as $,aD as j,af as re,av as w,aF as C,a2 as ne,aG as B,a7 as ie,aC as de,aP as ue,aO as ce,c5 as me,A as b,B as x,C as pe,b3 as fe}from"./index-Bl2lQPd7.js";import{Q as y}from"./QItemLabel-BkJiB6aE.js";import{Q as S}from"./QChip-C9OfA2gn.js";import{Q as L,a as k}from"./QItem-De3v03wU.js";import{Q as P}from"./QList-CMzNTEGD.js";import{Q as ge}from"./QToolbarTitle-C8APieXG.js";import{Q as he}from"./QToolbar-DR-_wX4W.js";import{Q as ve}from"./QSelect-DchnWyXK.js";import{C as Q}from"./ClosePopup-BY_YGFBZ.js";import{q as _e}from"./date-C1Mon-Jj.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";const be=le({name:"OrdreList",setup(){const e=ue();ce(),me();const r=b(!1),A=b(!1),q=b(!1),O=b(null),I=x(()=>e.getters["user/current"]?.annee?.idannee),f=b({search:"",status:null,date:null}),D=[{label:"Confirmé",value:1},{label:"Annulé",value:0}],a=[{label:"Aujourd'hui",value:"today"},{label:"Cette semaine",value:"week"},{label:"Ce mois",value:"month"}],F=x(()=>e.state.snack.ordres.data),U=x(()=>e.state.snack.ordres.pagination),N=()=>{const l={};return Object.entries(f.value).forEach(([u,c])=>{c!==null&&c!==""&&(l[u]=c)}),l},M=()=>Object.values(f.value).some(l=>l!==null&&l!==""),R=l=>!l||!l.eleve_classes?.length?"":l.eleve_classes[0].classe_fr,Y=l=>l?`${l.nom.charAt(0)}${l.prenom.charAt(0)}`.toUpperCase():"",E=l=>{if(!l)return"";const u=fe(l);return _e.formatDate(u,"DD/MM/YYYY HH:mm")},G=l=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"MAD"}).format(l||0).replace("MAD","DH"),J=l=>({1:"positive",0:"negative"})[l]||"grey",K=l=>({1:"Confirmé",0:"Annulé"})[l]||l,W=l=>l.items?.length?l.items.reduce((u,c)=>u+parseFloat(c.prix_unitaire)*c.quantite,0):0,V=async()=>{try{r.value=!0,await e.dispatch("snack/fetchOrdres",{filters:{with_eleve_classes:I.value,...N()}})}finally{r.value=!1}},X=()=>{V()},Z=l=>{const u=F.value.find(c=>c.idordre===l);u&&(O.value=u,q.value=!0)},ee=()=>{f.value={search:"",status:null,date:null}},te=()=>{V()};return pe(()=>{V(),e.commit("setTitle","Commandes")}),{loading:r,showFilters:A,showOrderDialog:q,selectedOrder:O,filters:f,statusOptions:D,dateOptions:a,orders:F,pagination:U,getClasse:R,formatDate:E,formatPrice:G,getStatusColor:J,getStatusLabel:K,hasFilter:M,onPagination:X,viewOrder:Z,resetFilters:ee,applyFilters:te,calculateOrderTotal:W,getStudentInitials:Y}}}),ye={class:"q-pa-lg flex flex-center"},we={class:"row q-col-gutter-md"},Ce={class:"col-12"},ke={key:0,class:"row justify-center q-pa-md"},Qe={key:1,class:"text-center q-pa-md text-grey"},qe={class:"text-grey-8 q-mr-xs"},Oe={key:0,class:"text-secondary"},De={class:"text-weight-medium text-primary"},Fe={class:"row items-center full-width q-px-sm"},Ve={class:"col-auto"},xe={class:"row q-col-gutter-md"},Se={class:"col-12"},Ae={class:"col-12"},Ie={class:"row items-center justify-between"},Te={class:"student-info q-mb-lg"},ze={class:"row items-center"},He={class:"q-ml-md"},$e={class:"text-h6 text-weight-bold text-primary"},je={class:"text-subtitle2 text-grey-8"},Be={key:0,class:"text-subtitle1 text-secondary"},Le={class:"order-items-section q-mb-lg"},Pe={class:"row items-center text-body2"},Ue={class:"text-weight-medium text-primary"},Ne={class:"total-section"},Me={class:"row justify-between items-center"},Re={class:"text-h5 text-weight-bold text-primary"};function Ye(e,r,A,q,O,I){const f=T("ep-pagination"),D=T("ep-footer");return i(),m(de,{class:"page-content"},{default:s(()=>[o("div",ye,[e.pagination?.current_page?(i(),m(f,{key:0,modelValue:e.pagination.current_page,"onUpdate:modelValue":[r[1]||(r[1]=a=>e.pagination.current_page=a),e.onPagination],max:e.pagination.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:s(()=>[t(p,{flat:"",onClick:r[0]||(r[0]=a=>e.showFilters=!0)},{default:s(()=>[e.hasFilter()?(i(),m(se,{key:0,color:"warning",rounded:"",align:"top"})):g("",!0),t(h,{name:"filter_list"}),d(" Page "+n(e.pagination.current_page),1)]),_:1})]),_:1},8,["modelValue","max","onUpdate:modelValue"])):g("",!0)]),o("div",we,[o("div",Ce,[t(_,{flat:"",style:{margin:"0 -8px"}},{default:s(()=>[e.loading?(i(),v("div",ke,[t(oe,{color:"primary",size:"2em"})])):e.orders?.length?(i(),m(P,{key:2,separator:""},{default:s(()=>[t(z),(i(!0),v(H,null,$(e.orders,a=>(i(),m(L,{key:a.idordre,clickable:"",onClick:F=>e.viewOrder(a.idordre),class:"q-py-md q-pl-lg"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"text-weight-medium"},{default:s(()=>[o("span",qe,n(a.personne?.nom)+" "+n(a.personne?.prenom),1),e.getClasse(a.personne)?(i(),v("span",Oe,"("+n(e.getClasse(a.personne))+")",1)):g("",!0)]),_:2},1024),t(y,{caption:""},{default:s(()=>[t(h,{name:"event",size:"xs"}),d(" "+n(e.formatDate(a.date_achat)),1)]),_:2},1024),t(y,null,{default:s(()=>[t(S,{color:e.getStatusColor(a.active),"text-color":"white",dense:"",class:"text-weight-medium"},{default:s(()=>[d(n(e.getStatusLabel(a.active)),1)]),_:2},1032,["color"]),t(h,{name:"restaurant_menu",size:"xs",class:"q-ml-sm"}),d(" "+n(a.items[0]?.menu?.designation)+" ",1),a.items.length>1?(i(),m(S,{key:0,size:"sm",class:"q-ml-sm"},{default:s(()=>[d("+"+n(a.items.length-1),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1024),t(k,{side:""},{default:s(()=>[o("div",De,n(e.calculateOrderTotal(a))+" DH ",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),t(z)]),_:1})):(i(),v("div",Qe," Aucune commande trouvée "))]),_:1})])]),t(D,{to:"#footer-portal"},{default:s(()=>[o("div",Fe,[o("div",Ve,[t(p,{icon:"add_shopping_cart",label:"Nouvelle commande",flat:"",to:{name:"snack-order"}})])])]),_:1}),t(j,{modelValue:e.showFilters,"onUpdate:modelValue":r[4]||(r[4]=a=>e.showFilters=a),position:"top"},{default:s(()=>[t(_,null,{default:s(()=>[t(he,{class:re({"bg-secondary":!e.hasFilter(),"bg-positive":e.hasFilter(),"text-white":!0,"shadow-2":!0})},{default:s(()=>[w(t(p,{flat:"",dense:"",icon:"arrow_back"},null,512),[[Q]]),t(ge,null,{default:s(()=>r[6]||(r[6]=[d(" Filtres ")])),_:1})]),_:1},8,["class"]),t(C,null,{default:s(()=>[o("div",xe,[o("div",Se,[t(ne,{modelValue:e.filters.search,"onUpdate:modelValue":r[2]||(r[2]=a=>e.filters.search=a),dense:"",outlined:"",label:"Rechercher",clearable:""},{append:s(()=>[t(h,{name:"search"})]),_:1},8,["modelValue"])]),o("div",Ae,[t(ve,{modelValue:e.filters.date,"onUpdate:modelValue":r[3]||(r[3]=a=>e.filters.date=a),options:e.dateOptions,dense:"",outlined:"",label:"Date",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])])])]),_:1}),t(B,{align:"right",class:"bg-white text-teal"},{default:s(()=>[t(p,{flat:"",label:"Réinitialiser",onClick:e.resetFilters,disable:!e.hasFilter()},null,8,["onClick","disable"]),w(t(p,{flat:"",label:"Appliquer",color:"primary",onClick:e.applyFilters},null,8,["onClick"]),[[Q]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(j,{modelValue:e.showOrderDialog,"onUpdate:modelValue":r[5]||(r[5]=a=>e.showOrderDialog=a),position:"bottom"},{default:s(()=>[t(_,{class:"order-details-dialog"},{default:s(()=>[t(C,{class:"bg-primary text-white"},{default:s(()=>[o("div",Ie,[r[7]||(r[7]=o("div",{class:"text-h6"},"Détails de la commande",-1)),w(t(p,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Q]])])]),_:1}),e.selectedOrder?(i(),m(C,{key:0,class:"q-pa-md"},{default:s(()=>[o("div",Te,[o("div",ze,[t(ie,{size:"64px",color:"primary","text-color":"white",class:"shadow-3"},{default:s(()=>[d(n(e.getStudentInitials(e.selectedOrder.personne)),1)]),_:1}),o("div",He,[o("div",$e,n(e.selectedOrder.personne?.nom)+" "+n(e.selectedOrder.personne?.prenom),1),o("div",je,[t(h,{name:"event",size:"xs",class:"q-mr-xs"}),d(" "+n(e.formatDate(e.selectedOrder.date_achat)),1)]),e.getClasse(e.selectedOrder.personne)?(i(),v("div",Be,[t(h,{name:"school",size:"xs",class:"q-mr-xs"}),d(" "+n(e.getClasse(e.selectedOrder.personne)),1)])):g("",!0)])])]),o("div",Le,[r[8]||(r[8]=o("div",{class:"text-subtitle1 text-weight-medium text-grey-8 q-mb-sm"},"Articles commandés",-1)),t(_,{flat:"",bordered:""},{default:s(()=>[t(P,{separator:""},{default:s(()=>[(i(!0),v(H,null,$(e.selectedOrder.items,a=>(i(),m(L,{key:a.id,class:"q-py-md"},{default:s(()=>[t(k,null,{default:s(()=>[t(y,{class:"text-weight-medium"},{default:s(()=>[d(n(a.menu?.designation),1)]),_:2},1024),t(y,{caption:""},{default:s(()=>[o("div",Pe,[t(S,{dense:"",color:"primary","text-color":"white",class:"q-mr-sm"},{default:s(()=>[d(" × "+n(a.quantite),1)]),_:2},1024),o("span",null,n(a.prix_unitaire)+" DH par unité",1)])]),_:2},1024)]),_:2},1024),t(k,{side:""},{default:s(()=>[o("div",Ue,n(parseFloat(a.prix_unitaire)*a.quantite)+" DH ",1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),o("div",Ne,[t(_,{flat:"",bordered:"",class:"bg-grey-1"},{default:s(()=>[t(C,null,{default:s(()=>[o("div",Me,[r[9]||(r[9]=o("div",{class:"text-subtitle1 text-weight-medium"},"Total de la commande",-1)),o("div",Re,n(e.calculateOrderTotal(e.selectedOrder))+" DH ",1)])]),_:1})]),_:1})])]),_:1})):g("",!0),t(B,{align:"right",class:"bg-grey-2 q-py-sm"},{default:s(()=>[w(t(p,{flat:"",label:"Fermer",color:"primary",class:"q-px-md"},null,512),[[Q]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const dt=ae(be,[["render",Ye],["__scopeId","data-v-ccbe4a6f"]]);export{dt as default};
