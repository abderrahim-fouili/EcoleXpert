import{A as E,Q as _,S as o,a6 as e,a5 as t,aF as I,a8 as m,a4 as S,a9 as N,aa as x,b1 as k,aE as U,Y as T,R as M,d4 as q,ad as y,ab as c,af as $,ax as V,B as P,aG as R,a3 as H,aP as B,aO as Y,C as w,aC as F}from"./index-Bl2lQPd7.js";import{u as O}from"./composables-CAkrP3jA.js";import{Q as D,a as h}from"./QItem-De3v03wU.js";import{Q}from"./QItemLabel-BkJiB6aE.js";import{Q as G}from"./QExpansionItem-EMhshZ_3.js";import{Q as b}from"./QList-CMzNTEGD.js";import{q as z}from"./date-C1Mon-Jj.js";import"./QSlideTransition-CrdUnXBf.js";import"./format-IcNrutKL.js";const j={class:"row q-gutter-sm"},J={__name:"StudentSelection",props:{children:{type:Array,required:!0}},emits:["update:selected"],setup(p,{emit:L}){const r=E(null);return(u,s)=>(o(),_(U,null,{default:e(()=>[t(I,null,{default:e(()=>[s[1]||(s[1]=m("div",{class:"text-h6"},"Sélection de l'élève",-1)),m("div",j,[(o(!0),S(N,null,x(p.children,a=>(o(),_(k,{key:a.id,modelValue:r.value,"onUpdate:modelValue":[s[0]||(s[0]=n=>r.value=n),n=>u.$emit("update:selected",a)],val:a,label:a.prenom},null,8,["modelValue","val","label","onUpdate:modelValue"]))),128))])]),_:1})]),_:1}))}},K={__name:"MonthlyServicesList",props:{monthlyServices:{type:Array,required:!0},studentId:{type:Number,required:!0}},emits:["update:selected"],setup(p,{emit:L}){const r=L,u=E([]);T(u,a=>{r("update:selected",a)});const s=a=>{const n=Math.floor(a/100),l=a%100;return z.formatDate(new Date(n,l-1),"MMMM YYYY")};return(a,n)=>(o(),_(U,null,{default:e(()=>[t(I,null,{default:e(()=>[n[1]||(n[1]=m("div",{class:"text-h6"},"Détails par Mois",-1)),t(b,{separator:""},{default:e(()=>[(o(!0),S(N,null,x(p.monthlyServices,l=>(o(),_(G,{key:l.mois,group:l.montant>0?"unpaid":"paid",icon:l.montant>0?"event":"task_alt",label:s(l.mois),caption:l.montant>0?"À payer: "+l.montant+" DH":"Payé","expand-separator":"","default-opened":l.montant>0},{default:e(()=>[t(U,null,{default:e(()=>[t(I,null,{default:e(()=>[(o(!0),S(N,null,x(l.services,(d,v)=>(o(),S(N,{key:d.id},[t(D,null,{default:e(()=>[d.a_payer>0?(o(),_(h,{key:0,avatar:""},{default:e(()=>[t(q,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=f=>u.value=f),val:`${p.studentId}-${l.mois}-${d.id}`},null,8,["modelValue","val"])]),_:2},1024)):M("",!0),t(h,null,{default:e(()=>[t(Q,null,{default:e(()=>[y(c(d.designation),1)]),_:2},1024),t(Q,{caption:""},{default:e(()=>[y(" Montant: "+c(d.montant)+" DH | Payé: "+c(d.payed)+" DH ",1),d.reduction>0?(o(),S(N,{key:0},[y(" | Réduction: "+c(d.reduction)+" DH ",1)],64)):M("",!0)]),_:2},1024)]),_:2},1024),t(h,{side:""},{default:e(()=>[m("div",{class:$(d.a_payer>0?"text-negative":"text-positive")},c(d.a_payer>0?"Reste: "+d.a_payer+" DH":"Soldé"),3)]),_:2},1024)]),_:2},1024),v<l.services.length-1?(o(),_(V,{key:0,spaced:"",inset:""})):M("",!0)],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["group","icon","label","caption","default-opened"]))),128))]),_:1})]),_:1})]),_:1}))}},W={__name:"PaymentSummary",props:{studentName:{type:String,required:!0},selectedPayments:{type:Array,required:!0},monthlyServices:{type:Array,required:!0},studentId:{type:Number,required:!0}},emits:["proceed"],setup(p,{emit:L}){const r=p,u=P(()=>r.selectedPayments.length),s=P(()=>r.selectedPayments.reduce((a,n)=>{const[l,d,v]=n.split("-").map(Number),f=r.monthlyServices.find(g=>g.mois===d);if(!f)return a;const C=f.services.find(g=>g.id===v);return a+(C?.a_payer||0)},0));return(a,n)=>(o(),_(U,{class:"payment-summary"},{default:e(()=>[t(I,null,{default:e(()=>[n[1]||(n[1]=m("div",{class:"text-h6"},"Résumé du Paiement",-1)),t(b,{dense:""},{default:e(()=>[t(D,null,{default:e(()=>[t(h,null,{default:e(()=>[t(Q,null,{default:e(()=>[y(c(p.studentName),1)]),_:1}),t(Q,{caption:""},{default:e(()=>[y(" Services sélectionnés: "+c(u.value),1)]),_:1})]),_:1}),t(h,{side:""},{default:e(()=>[y(c(s.value)+" DH ",1)]),_:1})]),_:1})]),_:1})]),_:1}),t(R,{align:"right"},{default:e(()=>[t(H,{color:"primary",disable:u.value===0,onClick:n[0]||(n[0]=l=>a.$emit("proceed"))},{default:e(()=>n[2]||(n[2]=[y(" Procéder au Paiement ")])),_:1},8,["disable"])]),_:1})]),_:1}))}},X={class:"row q-col-gutter-md"},Z={class:"col-12"},ee={class:"col-12 col-md-8"},te={class:"col-12 col-md-4"},me={__name:"Index",setup(p){const{setTitle:L}=O(),r=B(),u=Y(),s=E(null),a=E([]),n=E([{ideleve:2e3,montant:6300,service_mensuel:[{mois:202409,services:[{id:2,designation:"MENSUALITE",type_paiement:"MENSUELLE",montant:"2400.00",reduction:"0.00",reduction_mensuelle:0,payed:2400,dispense:!1,a_payer:0},{id:3,designation:"LA CANTINE",type_paiement:"MENSUELLE",montant:"700.00",reduction:"0.00",reduction_mensuelle:0,payed:700,dispense:!1,a_payer:0}],montant:0},{mois:202410,services:[{id:2,designation:"MENSUALITE",type_paiement:"MENSUELLE",montant:"2400.00",reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:2400},{id:3,designation:"LA CANTINE",type_paiement:"MENSUELLE",montant:"700.00",reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:700}],montant:3100},{mois:202411,services:[{id:2,designation:"MENSUALITE",type_paiement:"MENSUELLE",montant:"2400.00",reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:2400},{id:3,designation:"LA CANTINE",type_paiement:"MENSUELLE",montant:"700.00",reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:700}],montant:3100},{mois:202412,services:[{id:2,designation:"MENSUALITE",type_paiement:"MENSUELLE",montant:"2400.00",reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:2400},{id:3,designation:"LA CANTINE",type_paiement:"MENSUELLE",montant:"700.00",reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:700}],montant:3100}],service_annuel:[{id:1,designation:"FRAIS D'INSCRIPTION SCOLAIRE",type_paiement:"ANNUELLE",montant:4500,reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:4500}]},{ideleve:2001,montant:2400,service_mensuel:[{mois:202412,services:[{id:2,designation:"MENSUALITE",type_paiement:"MENSUELLE",montant:"2400.00",reduction:"0.00",reduction_mensuelle:0,payed:0,dispense:!1,a_payer:2400}],montant:2400}],service_annuel:[]}]),l=E([{id:2e3,nom:"Alami",prenom:"Youssef",niveau:"3ème année",photo:null},{id:2001,nom:"Alami",prenom:"Sara",niveau:"1ère année",photo:null}]),d=P(()=>s.value?n.value.filter(i=>i.ideleve===s.value.id):[]),v=P(()=>d.value.length?d.value.flatMap(i=>i.service_mensuel.map(A=>({...A,ideleve:i.ideleve}))).sort((i,A)=>i.mois-A.mois):[]),f=i=>{s.value=i,a.value=[]},C=i=>{a.value=i},g=()=>{u.notify({message:"Paiement en cours de traitement...",color:"primary",position:"top",timeout:2e3})};return w(()=>{L("Paiements en Attente"),r.dispatch("user/getConfig")}),(i,A)=>(o(),_(F,{padding:""},{default:e(()=>[m("div",X,[m("div",Z,[t(J,{children:l.value,"onUpdate:selected":f},null,8,["children"])]),s.value?(o(),S(N,{key:0},[m("div",ee,[t(K,{"student-id":s.value.id,"monthly-services":v.value,"onUpdate:selected":C},null,8,["student-id","monthly-services"])]),m("div",te,[t(W,{"student-name":s.value.prenom,"student-id":s.value.id,"selected-payments":a.value,"monthly-services":v.value,onProceed:g},null,8,["student-name","student-id","selected-payments","monthly-services"])])],64)):M("",!0)])]),_:1}))}};export{me as default};
