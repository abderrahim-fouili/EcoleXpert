import{aP as Ee,A as K,B as Q,Y as Le,d8 as fe,i as ke,N as be,_ as Pe,C as Ye,Q as V,S as n,a6 as l,a8 as i,a5 as t,a4 as f,R as I,aE as Me,aF as he,a2 as Be,aS as e,ay as M,av as ae,a3 as B,ad as v,cW as Ce,d4 as De,ab as d,a9 as $,aa as N,ac as X,af as Ie,aw as Ae,a7 as W,aB as Ne,aD as Re,aG as Ue,aC as Oe}from"./index-Bl2lQPd7.js";import{Q as je}from"./QDate-C_jC-zMt.js";import{Q as Ge}from"./QPopupProxy-CQ30ymZI.js";import{Q as ue}from"./QSelect-DchnWyXK.js";import{Q as Se}from"./QSpace-CKKoNTi_.js";import{Q as le}from"./QTooltip-r7WoEuzy.js";import{Q as We}from"./QBtnGroup-CdugIB7Z.js";import{Q as R,a as C}from"./QItem-De3v03wU.js";import{Q as k}from"./QItemLabel-BkJiB6aE.js";import{Q as He}from"./QSpinnerBars-COgM5MgD.js";import{Q as Je}from"./QBanner-xBGiroIy.js";import{Q as Ke}from"./QToolbar-DR-_wX4W.js";import{Q as Xe}from"./QBadge-Bjfo5tRO.js";import{Q as Ze}from"./QList-CMzNTEGD.js";import{C as we}from"./ClosePopup-BY_YGFBZ.js";import{u as et}from"./composables-CAkrP3jA.js";import{q as tt}from"./date-C1Mon-Jj.js";import{f as me}from"./index-C9ZTL5MN.js";import{p as pe}from"./index-DXqHobUu.js";import{a as st}from"./index-B29DxFTF.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-datetime-hbLWgGn4.js";import"./format-IcNrutKL.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./QChip-C9OfA2gn.js";import"./rtl-DFPa-2ov.js";import"./index-BXMW6yyY.js";import"./index-CbPSoDvq.js";import"./defineProperty-CfK5lsJW.js";import"./index-QVwDN08p.js";const Z=p=>{if(!p||typeof p!="string")return 0;const _=p.split(":");return _.length<2?0:parseInt(_[0],10)*60+parseInt(_[1],10)},Te=(p,_)=>{try{const{r:A,g:u,b:S}=fe.textToRgb(p),h=1-_/100,w=Math.max(0,Math.round(A*h)),c=Math.max(0,Math.round(u*h)),ee=Math.max(0,Math.round(S*h));return`rgb(${w}, ${c}, ${ee})`}catch{return p}};function at(){const p=Ee(),{lighten:_,getPaletteColor:A}=fe,u=K({anneeId:null,date:tt.formatDate(Date.now(),"YYYY-MM-DD"),viewType:"date",displayFocus:"classes",classIds:[],profIds:[]}),S=K(30),h=K("08:00"),w=K("19:00"),c=K({show:!1,session:null}),ee=[{label:"Semaine",value:"week"},{label:"Jour",value:"date"}],_e=[{label:"Par Classe/Matière",value:"classes"},{label:"Par Professeur",value:"professors"}],z=Q(()=>p.getters["timetable/academicYears"]),ve=Q(()=>p.getters["timetable/classes"].map(a=>({...a}))),ye=Q(()=>p.getters["timetable/professors"].map(a=>({...a}))),H=Q(()=>p.getters["timetable/timetableMetadata"]),P=Q(()=>p.getters["timetable/orderedDaysWithData"]),oe=Q(()=>p.getters["timetable/isLoading"]),ie=Q(()=>p.getters["timetable/isLoadingFilters"]),ne=Q(()=>p.getters["timetable/error"]),te=Q(()=>p.getters["user/current"]?.annee),re=a=>a?me(pe(a,"yyyy-MM-dd",new Date),"dd/MM/yyyy"):"",de=a=>a?me(pe(a,"yyyy-MM-dd",new Date),"dd MMM",{locale:ke}):"",ge=a=>a?me(pe(a,"yyyy-MM-dd",new Date),"eeee d MMMM yyyy",{locale:ke}):"";function xe(a){let r=[`${a.debut?.substring(0,5)||"?"} - ${a.fin?.substring(0,5)||"?"} `,`Matière: ${a.matiere?.nom||"N/A"} (${a.matiere?.bref||""})`,`Classe: ${a.classe?.nom||"N/A"} (${a.classe?.bref||""})`,`Prof(s): ${a.professeurs?.map(m=>m.nom_complet||`${m.prenom||""} ${m.nom||""}`.trim()).join(", ")||"N/A"} `,`Salle: ${a.salle?.nom||"N/A"} (${a.salle?.bref||""})`,`Date: ${re(a.date_specific)} `];return a.is_cancelled&&(r.push("---"),r.push(`ANNULÉE par ${a.cancellation_details?.cancelled_by||"?"} `),a.cancellation_details?.reason&&r.push(`Raison: ${a.cancellation_details.reason} `),r.push(`Compensée: ${a.cancellation_details?.is_compensated?"Oui":"Non"} `)),r.join(`
`)}const o=Q(()=>P.value?P.value.flatMap(a=>(a.sessions||[]).map(r=>({...r,key:`${r.emploi_classe_id}_${r.date_specific}_${r.debut} `,tooltipContent:xe(r),professeurs:(r.professeurs||[]).map(m=>({...m,nom_complet:m.nom_complet||`${m.prenom||""} ${m.nom||""} `.trim()}))}))):[]),s=Q(()=>{const a=Z(h.value),r=Z(w.value);if(!o.value.length)return{start:a,end:r};let m=1/0,y=0;o.value.forEach(E=>{const U=Z(E.debut),g=Z(E.fin);U<m&&(m=U),g>y&&(y=g)}),isFinite(m)||(m=a),(y<=0||!isFinite(y))&&(y=r);const T=Math.min(a,Math.floor(m/S.value)*S.value),x=Math.max(r,Math.ceil(y/S.value)*S.value);return{start:T,end:x>T?x:T+S.value}}),b=Q(()=>{const a=[],{start:r,end:m}=s.value;if(m<=r)return[h.value];for(let y=r;y<m;y+=S.value){const T=Math.floor(y/60).toString().padStart(2,"0"),x=(y%60).toString().padStart(2,"0");a.push(`${T}:${x} `)}return a}),F=Q(()=>{const a=K({view:null,columns:[],rows:[],sessions:[],timeSlots:[]});if(!H.value||!P.value)return a.value={view:null,columns:[],rows:[],sessions:[],timeSlots:[]},a;const r=o.value,m=b.value,y=u.value.viewType;if(y==="week"){const T=P.value.map(x=>({id:x.specificDate,label:x.name,subLabel:de(x.specificDate),specificDate:x.specificDate}));a.value={view:"week",columns:T,rows:[],timeSlots:m,sessions:r}}else if(y==="date"){const T=m.map(g=>({id:g,label:g})),x=new Map;u.value.displayFocus==="classes"?r.forEach(g=>{g.classe&&!x.has(g.classe.id)&&x.set(g.classe.id,{id:g.classe.id,label:g.classe.nom,subLabel:g.classe.bref,type:"class",classement:g.classe.classement})}):r.forEach(g=>{(g.professeurs||[]).forEach(D=>{D&&D.id&&!x.has(D.id)&&x.set(D.id,{id:D.id,label:D.nom_complet,subLabel:D.matricule||"Professeur",type:"professor",photo:D.photo})})});let E=Array.from(x.values());u.value.displayFocus==="classes"?E.sort((g,D)=>{const Y=g.classement,O=D.classement,ce=typeof Y=="number"&&isFinite(Y),se=typeof O=="number"&&isFinite(O);return ce&&se?Y-O:ce?-1:se?1:(g.label||"").localeCompare(D.label||"")}):E.sort((g,D)=>(g.label||"").localeCompare(D.label||""));const U=r.filter(g=>g.date_specific===u.value.date);a.value={view:"date",columns:T,rows:E,timeSlots:m,sessions:U}}else a.value={view:null,columns:[],rows:[],sessions:[],timeSlots:[]};return a}),q=a=>{const r=F.value.value;if(!a||!a.debut||!a.fin||!r?.view)return{display:"none"};const m=Z(a.debut),y=Z(a.fin);if(y<=m)return{display:"none"};const T=y-m,x=s.value.start,E=Math.max(0,Math.floor((m-x)/S.value)),U=Math.max(1,Math.ceil(T/S.value)),g=A("grey-7"),D=a.matiere?.discipline_color||g,Y=a.is_cancelled?A("grey-5"):D,O=88,ce=a.is_cancelled?95:Math.max(O,fe.luminosity(Y)>.4?O:O+10),se=a.is_cancelled?A("grey-2"):_(Y,ce),ze=a.is_cancelled?A("grey-6"):fe.luminosity(se)>.6?Te(Y,15):A("grey-1"),L={"--session-color":Y,"background-color":se,color:ze,"z-index":a.is_cancelled?1:5};if(r.view==="week"){const j=r.columns.findIndex(G=>G.specificDate===a.date_specific);if(j===-1)return{display:"none"};L["grid-column-start"]=j+2,L["grid-column-end"]="span 1",L["grid-row-start"]=E+2,L["grid-row-end"]=`span ${U} `}else if(r.view==="date"){let j=-1;if(u.value.displayFocus==="classes"?j=r.rows.findIndex(G=>G.type==="class"&&a.classe?.id===G.id):j=r.rows.findIndex(G=>G.type==="professor"&&(a.professeurs||[]).some(qe=>qe?.id===G.id)),j===-1)return{display:"none"};L["grid-row-start"]=j+2,L["grid-row-end"]="span 1",L["grid-column-start"]=E+2,L["grid-column-end"]=`span ${U} `}else return{display:"none"};return L},J=(a=null)=>{if(!u.value.anneeId||!u.value.date){be.create({type:"warning",message:"Veuillez sélectionner une année scolaire et une date.",position:"top",classes:"modern-notify"});return}c.value.show=!1,c.value.session=null,console.log("Loading timetable...",u.value);let r={...u.value};a&&(a==="week"||a==="day")&&(r.viewType=a),p.dispatch("timetable/fetchTimetable",r)},Qe=a=>{let r;if(a===0)r=new Date;else{const m=H.value?.date_view_starts;if(!m){be.create({type:"info",message:"Chargez d'abord un emploi du temps.",position:"top",classes:"modern-notify"});return}try{const y=pe(m,"yyyy-MM-dd",new Date),T=u.value.viewType==="week"?7:1;r=st(y,a*T)}catch(y){console.error("Error parsing date for navigation:",y),be.create({type:"negative",message:"Erreur de date pour la navigation.",position:"top"});return}}u.value.date=me(r,"yyyy-MM-dd"),J()},Ve=a=>{c.value.session=a,c.value.show=!0},Fe=async()=>{p.commit("timetable/CLEAR_TIMETABLE_DATA"),await p.dispatch("timetable/fetchAcademicYears");const a=te.value?.idannee;a&&z.value.some(r=>r.idannee===a)?u.value.anneeId=a:z.value.length>0?u.value.anneeId=z.value[0].idannee:u.value.anneeId=null,u.value.anneeId&&(await p.dispatch("timetable/fetchClassesForYear",u.value.anneeId),await p.dispatch("timetable/fetchProfessorsForYear",u.value.anneeId),J("week"))},$e=async()=>{p.commit("timetable/CLEAR_TIMETABLE_DATA"),await p.dispatch("timetable/fetchAcademicYears");const a=te.value?.idannee;a&&z.value.some(r=>r.idannee===a)?u.value.anneeId=a:z.value.length>0?u.value.anneeId=z.value[0].idannee:u.value.anneeId=null,u.value.anneeId&&(await p.dispatch("timetable/fetchClassesForYear",u.value.anneeId),await p.dispatch("timetable/fetchProfessorsForYear",u.value.anneeId),J())};return Le(te,(a,r)=>{const m=a?.idannee,y=r?.idannee;m!==y&&m?(u.value.anneeId=m,u.value.classIds=[],u.value.profIds=[],p.dispatch("timetable/fetchClassesForYear",m),p.dispatch("timetable/fetchProfessorsForYear",m),p.commit("timetable/CLEAR_TIMETABLE_DATA")):!m&&y&&(u.value.anneeId=null,u.value.classIds=[],u.value.profIds=[],p.commit("timetable/CLEAR_CLASSES"),p.commit("timetable/CLEAR_PROFESSORS"),p.commit("timetable/CLEAR_TIMETABLE_DATA"))}),{filters:u,isLoading:oe,isLoadingFilters:ie,error:ne,timetableMetadata:H,gridData:F,sessionDetailsDialog:c,academicYears:z,classes:ve,professors:ye,viewTypeOptions:ee,displayFocusOptions:_e,initialize:Fe,initializeForCmp:$e,loadTimetable:J,navigatePeriod:Qe,showSessionDetails:Ve,getSessionStyle:q,formatDateDMY:re,formatDateDM:de,formatDateFull:ge,lighten:_,darken:Te}}const lt={class:"un-flex un-flex-col"},ot={class:"row q-col-gutter-lg items-center"},it={class:"col-12 col-md-auto"},nt={class:"row items-center justify-end q-pt-sm"},rt={class:"col-12 col-md-auto"},dt={class:"col-12 col-md-auto"},ct={class:"col-12 col-md-auto"},ut={class:"row q-col-gutter-lg items-center"},mt={class:"col-12 col-md-6 col-lg"},pt={class:"col-12 col-md-6 col-lg"},ft={class:""},_t={key:0,class:"text-subtitle1 text-grey-8 q-my-sm"},vt={class:"text-weight-medium"},yt={class:"text-weight-medium"},gt={key:0},bt={class:"text-weight-medium"},ht={key:0,class:"text-center q-my-xl"},wt={key:2,class:"text-center text-grey-6 q-my-xl"},xt={key:3,class:"timetable-grid-wrapper grow"},kt={key:0,class:"timetable-grid-container week-view bg-white shadow-2"},Mt={class:"timetable-inner"},Ct={class:"text-weight-medium"},Dt={class:"text-caption text-grey-7"},It=["onClick"],At={class:"tooltip-pre"},St={class:"session-content"},Tt={class:"session-time text-caption"},Qt={class:"session-title text-weight-medium ellipsis"},Vt={key:0,class:"session-detail ellipsis"},Ft={key:1,class:"session-detail ellipsis"},$t={class:"session-detail ellipsis"},zt={key:2,class:"session-detail ellipsis"},qt={key:1,class:"timetable-grid-container date-view bg-white shadow-2"},Et={class:"timetable-inner"},Lt={class:"grid-header resource-header"},Pt=["src"],Yt={class:"ellipsis"},Bt={class:"text-weight-medium"},Nt={key:0,class:"text-grey-7"},Rt=["onClick"],Ut={class:"tooltip-pre"},Ot={class:"session-content"},jt={class:"session-time text-caption"},Gt={class:"session-title text-weight-medium ellipsis"},Wt={class:"session-detail ellipsis"},Ht={key:0},Jt={key:1},Kt={class:"session-detail ellipsis"},Xt={key:0,class:"session-detail ellipsis"},Zt={key:4,class:"text-center text-grey-6 q-my-xl"},es={class:"text-subtitle1 q-mb-md text-grey-8"},ts={class:"text-primary"},ss={class:"text-primary"},as={key:0},ls={__name:"TimetablePage",setup(p){const{filters:_,isLoading:A,isLoadingFilters:u,error:S,timetableMetadata:h,gridData:w,sessionDetailsDialog:c,classes:ee,professors:_e,viewTypeOptions:z,displayFocusOptions:ve,initialize:ye,loadTimetable:H,navigatePeriod:P,showSessionDetails:oe,getSessionStyle:ie,formatDateDMY:ne,formatDateFull:te,lighten:re}=at(),{setTitle:de,showFooter:ge}=et();return Ye(()=>{de("Emploi du Temps"),ge(!1),ye()}),(xe,o)=>(n(),V(Oe,{padding:"",class:"timetable-page bg-grey-1"},{default:l(()=>[i("div",lt,[t(Me,{flat:"",class:"filter-card bg-white q-pa-sm",style:{"border-radius":"12px"}},{default:l(()=>[t(he,null,{default:l(()=>[i("div",ot,[i("div",it,[t(Be,{dense:"",outlined:"",modelValue:e(_).date,"onUpdate:modelValue":o[1]||(o[1]=s=>e(_).date=s),label:"Date Réf.",mask:"####-##-##",clearable:"",filled:"",class:"modern-input",style:{"min-width":"140px"}},{prepend:l(()=>[t(M,{name:"sym_o_event",class:"cursor-pointer text-primary-6"},{default:l(()=>[t(Ge,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[t(je,{modelValue:e(_).date,"onUpdate:modelValue":o[0]||(o[0]=s=>e(_).date=s),mask:"YYYY-MM-DD",minimal:"",color:"primary"},{default:l(()=>[i("div",nt,[ae(t(B,{label:"Fermer",color:"primary",flat:"",dense:""},null,512),[[we]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),i("div",rt,[t(ue,{dense:"",outlined:"",modelValue:e(_).viewType,"onUpdate:modelValue":o[2]||(o[2]=s=>e(_).viewType=s),options:e(z),label:"Vue","emit-value":"","map-options":"",filled:"",class:"modern-select",style:{"min-width":"120px"}},{prepend:l(()=>[t(M,{name:"sym_o_view_week",class:"text-primary-6"})]),_:1},8,["modelValue","options"])]),i("div",dt,[t(ue,{dense:"",outlined:"",modelValue:e(_).displayFocus,"onUpdate:modelValue":o[3]||(o[3]=s=>e(_).displayFocus=s),options:e(ve),label:"Focus","emit-value":"","map-options":"",filled:"",class:"modern-select",style:{"min-width":"160px"}},{prepend:l(()=>[t(M,{name:"sym_o_filter_center_focus",class:"text-primary-6"})]),_:1},8,["modelValue","options"])]),t(Se,{class:"gt-sm"}),i("div",ct,[t(We,{flat:"",rounded:"",class:"nav-btn-group",padding:"xs lg"},{default:l(()=>[t(B,{onClick:o[4]||(o[4]=s=>e(P)(-1)),icon:"sym_o_chevron_left",dense:"",flat:"",disable:!e(h),padding:"xs md"},{default:l(()=>[t(le,{class:"modern-tooltip"},{default:l(()=>o[10]||(o[10]=[v("Précédent")])),_:1})]),_:1},8,["disable"]),t(B,{onClick:o[5]||(o[5]=s=>e(P)(0)),icon:"sym_o_today",dense:"",flat:"",padding:"xs md"},{default:l(()=>[t(le,{class:"modern-tooltip"},{default:l(()=>o[11]||(o[11]=[v("Aujourd'hui")])),_:1})]),_:1}),t(B,{onClick:o[6]||(o[6]=s=>e(P)(1)),icon:"sym_o_chevron_right",dense:"",flat:"",disable:!e(h),padding:"xs md"},{default:l(()=>[t(le,{class:"modern-tooltip"},{default:l(()=>o[12]||(o[12]=[v("Suivant")])),_:1})]),_:1},8,["disable"])]),_:1}),t(B,{label:"Afficher",color:"primary",onClick:e(H),icon:"sym_o_search",loading:e(A),disable:!e(_).anneeId||!e(_).date||e(A),unelevated:"",rounded:"",class:"q-ml-md",padding:"xs lg"},null,8,["onClick","loading","disable"])])])]),_:1}),t(he,{class:"q-pt-none"},{default:l(()=>[i("div",ut,[i("div",mt,[t(ue,{dense:"",outlined:"",multiple:"","use-chips":"",modelValue:e(_).classIds,"onUpdate:modelValue":o[7]||(o[7]=s=>e(_).classIds=s),options:e(ee),label:"Filtrer Classe(s)","option-value":"idclasse","option-label":"classe_fr","emit-value":"","map-options":"",loading:e(u).classes,clearable:"",filled:"",class:"modern-select"},{prepend:l(()=>[t(M,{name:"sym_o_groups",class:"text-primary-6"})]),option:l(({itemProps:s,opt:b,selected:F,toggleOption:q})=>[t(R,Ce(s,{dense:""}),{default:l(()=>[t(C,{side:""},{default:l(()=>[t(De,{"model-value":F,"onUpdate:modelValue":J=>q(b),dense:"",size:"sm"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(C,null,{default:l(()=>[t(k,null,{default:l(()=>[v(d(b.classe_fr),1)]),_:2},1024),t(k,{caption:""},{default:l(()=>[v(d(b.bref),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","loading"])]),i("div",pt,[t(ue,{dense:"",outlined:"",multiple:"","use-chips":"",modelValue:e(_).profIds,"onUpdate:modelValue":o[8]||(o[8]=s=>e(_).profIds=s),options:e(_e),label:"Filtrer Professeur(s)","option-value":"idpers","option-label":"nom_complet","emit-value":"","map-options":"",loading:e(u).professors,clearable:"",filled:"",class:"modern-select"},{prepend:l(()=>[t(M,{name:"sym_o_person_pin",class:"text-primary-6"})]),option:l(({itemProps:s,opt:b,selected:F,toggleOption:q})=>[t(R,Ce(s,{dense:""}),{default:l(()=>[t(C,{side:""},{default:l(()=>[t(De,{"model-value":F,"onUpdate:modelValue":J=>q(b),dense:"",size:"sm"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(C,null,{default:l(()=>[t(k,null,{default:l(()=>[v(d(b.nom_complet),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","loading"])])])]),_:1})]),_:1}),i("div",ft,[e(h)?(n(),f("div",_t,[v(d(e(_).viewType==="week"?"Semaine":"Jour")+" du ",1),i("span",vt,d(e(ne)(e(h).date_view_starts)),1),o[14]||(o[14]=v(" au ")),i("span",yt,d(e(ne)(e(h).date_view_ends)),1),e(h).annee_scolaire?(n(),f("span",gt,[o[13]||(o[13]=v(" / Année: ")),i("span",bt,d(e(h).annee_scolaire.description),1)])):I("",!0)])):I("",!0)]),e(A)?(n(),f("div",ht,[t(He,{color:"primary",size:"4em"}),o[15]||(o[15]=i("div",{class:"q-mt-lg text-primary-8 text-body1"},"Chargement en cours...",-1))])):e(S)?(n(),V(Je,{key:1,dense:"","inline-actions":"",class:"text-white bg-negative q-mb-lg modern-banner"},{avatar:l(()=>[t(M,{name:"sym_o_error_outline"})]),action:l(()=>[t(B,{flat:"",dense:"",color:"white",label:"Réessayer",onClick:e(H),size:"sm",disable:!e(_).anneeId||!e(_).date},null,8,["onClick","disable"])]),default:l(()=>[o[16]||(o[16]=i("span",{class:"text-weight-medium"},"Erreur:",-1)),v(" "+d(e(S))+" ",1)]),_:1})):!e(A)&&!e(S)&&!e(h)?(n(),f("div",wt,[t(M,{name:"sym_o_manage_search",size:"5em",class:"q-mb-md opacity-50"}),o[17]||(o[17]=i("div",{class:"text-h6 text-weight-light"},"Prêt à afficher l'emploi du temps.",-1)),o[18]||(o[18]=i("div",{class:"text-body1"},'Veuillez sélectionner les filtres et cliquer sur "Afficher".',-1))])):e(h)&&e(w).value&&(e(w).value.columns?.length>0||e(w).value.rows?.length>0)?(n(),f("div",xt,[e(_).viewType==="week"&&e(w).value.view==="week"?(n(),f("div",kt,[i("div",Mt,[o[19]||(o[19]=i("div",{class:"grid-header time-header"},"Heure",-1)),(n(!0),f($,null,N(e(w).value.columns,s=>(n(),f("div",{key:s.id,class:"grid-header day-header"},[i("div",Ct,d(s.label),1),i("div",Dt,d(s.subLabel),1)]))),128)),(n(!0),f($,null,N(e(w).value.timeSlots,(s,b)=>(n(),f($,{key:s},[i("div",{class:"grid-cell time-slot-label",style:X({gridRow:b+2,gridColumn:1})},d(s),5),(n(!0),f($,null,N(e(w).value.columns,(F,q)=>(n(),f("div",{key:F.id+"-"+s,class:"grid-cell time-slot-cell",style:X({gridRow:b+2,gridColumn:q+2})},null,4))),128))],64))),128)),(n(!0),f($,null,N(e(w).value.sessions,s=>ae((n(),f("div",{key:s.key,class:Ie(["session-block",{"cancelled-session":s.is_cancelled,"has-details":!0}]),style:X(e(ie)(s)),onClick:b=>e(oe)(s)},[t(le,{anchor:"top middle",self:"bottom middle",offset:[5,5],class:"modern-tooltip","max-width":"300px"},{default:l(()=>[i("pre",At,d(s.tooltipContent),1)]),_:2},1024),i("div",St,[i("div",Tt,[v(d(s.debut?.substring(0,5))+" - "+d(s.fin?.substring(0,5))+" ",1),s.is_cancelled?(n(),V(M,{key:0,name:"sym_o_block",color:"negative",size:"xs",class:"q-ml-xs",title:"Annulée"})):I("",!0)]),i("div",Qt,d(s.matiere?.bref||s.matiere?.nom||"?"),1),e(_).displayFocus==="professors"?(n(),f("div",Vt,d(s.classe?.nom||"?"),1)):(n(),f("div",Ft,d(s.professeurs?.map(b=>b.nom).join(", ")||"?"),1)),i("div",$t,[t(M,{name:"sym_o_meeting_room",size:"xs",class:"q-mr-xs opacity-70"}),v(d(s.salle?.bref||s.salle?.nom||"?"),1)]),s.cahiers&&s.cahiers.length>0?(n(),f("div",zt,[t(M,{name:"sym_o_book_ribbon",size:"xs",class:"opacity-70"})])):I("",!0)])],14,It)),[[Ae,void 0,void 0,{early:!0}]])),128))])])):e(_).viewType==="date"&&e(w).value.view==="date"?(n(),f("div",qt,[i("div",Et,[i("div",Lt,d(e(_).displayFocus==="classes"?"Classe / Matière":"Professeur"),1),(n(!0),f($,null,N(e(w).value.columns,s=>(n(),f("div",{key:s.id,class:"grid-header time-header"},d(s.label),1))),128)),(n(!0),f($,null,N(e(w).value.rows,(s,b)=>(n(),f($,{key:s.id},[i("div",{class:"grid-cell resource-label",style:X({gridRow:b+2,gridColumn:1})},[s.photo?(n(),V(W,{key:0,size:"md",class:"q-mr-sm text-primary-7"},{default:l(()=>[i("img",{src:e(Ne)(s),alt:"Resource Image"},null,8,Pt)]),_:2},1024)):(n(),V(M,{key:1,name:s.type==="class"?"sym_o_groups":"sym_o_person",size:"sm",class:"q-mr-sm text-primary-7"},null,8,["name"])),i("div",Yt,[i("div",Bt,d(s.label),1),s.subLabel?(n(),f("div",Nt,d(s.subLabel),1)):I("",!0)])],4),(n(!0),f($,null,N(e(w).value.columns,(F,q)=>(n(),f("div",{key:s.id+"-"+F.id,class:"grid-cell time-slot-cell",style:X({gridRow:b+2,gridColumn:q+2})},null,4))),128))],64))),128)),(n(!0),f($,null,N(e(w).value.sessions,s=>ae((n(),f("div",{key:s.key,class:Ie(["session-block",{"cancelled-session":s.is_cancelled,"has-details":!0}]),style:X(e(ie)(s)),onClick:b=>e(oe)(s)},[t(le,{anchor:"top middle",self:"bottom middle",offset:[5,5],class:"modern-tooltip","max-width":"300px"},{default:l(()=>[i("pre",Ut,d(s.tooltipContent),1)]),_:2},1024),i("div",Ot,[i("div",jt,[v(d(s.debut?.substring(0,5))+" - "+d(s.fin?.substring(0,5))+" ",1),s.is_cancelled?(n(),V(M,{key:0,name:"sym_o_block",color:"negative",size:"xs",class:"q-ml-xs",title:"Annulée"})):I("",!0)]),i("div",Gt,d(s.matiere?.bref||s.matiere?.nom||"?"),1),i("div",Wt,[e(_).displayFocus==="professors"?(n(),f("span",Ht,d(s.classe?.nom||"?"),1)):(n(),f("span",Jt,d(s.professeurs?.map(b=>b.nom).join(", ")||"?"),1))]),i("div",Kt,[t(M,{name:"sym_o_meeting_room",size:"xs",class:"q-mr-xs opacity-70"}),v(d(s.salle?.bref||s.salle?.nom||"?"),1)]),s.cahiers&&s.cahiers.length>0?(n(),f("div",Xt,[t(M,{name:"sym_o_book_ribbon",size:"xs",class:"opacity-70"})])):I("",!0)])],14,Rt)),[[Ae,void 0,void 0,{early:!0}]])),128))])])):I("",!0)])):!e(A)&&e(h)?(n(),f("div",Zt,[t(M,{name:"sym_o_event_busy",size:"5em",class:"q-mb-md opacity-50"}),o[20]||(o[20]=i("div",{class:"text-h6 text-weight-light"},"Aucune séance trouvée.",-1)),o[21]||(o[21]=i("div",{class:"text-body1"},"Vérifiez vos filtres ou la programmation pour cette période.",-1))])):I("",!0)]),t(Re,{modelValue:e(c).show,"onUpdate:modelValue":o[9]||(o[9]=s=>e(c).show=s)},{default:l(()=>[t(Me,{class:"modern-dialog-card",style:{"min-width":"400px","max-width":"500px"}},{default:l(()=>[t(Ke,{class:"text-primary"},{default:l(()=>[t(M,{name:"sym_o_info",size:"sm",class:"q-mr-sm"}),o[22]||(o[22]=i("div",{class:"text-h6 text-weight-regular"},"Détails de la Séance",-1)),t(Se),ae(t(B,{icon:"close",flat:"",round:"",dense:"",color:"grey-7"},null,512),[[we]])]),_:1}),e(c).session?(n(),V(he,{key:0,class:"q-pt-none q-px-md"},{default:l(()=>[i("div",es,[v(d(e(te)(e(c).session.date_specific))+" ",1),o[23]||(o[23]=i("br",null,null,-1)),o[24]||(o[24]=v("de ")),i("strong",ts,d(e(c).session.debut?.substring(0,5)||"?"),1),o[25]||(o[25]=v(" à ")),i("strong",ss,d(e(c).session.fin?.substring(0,5)||"?"),1)]),t(Ze,{separator:"",padding:"",class:"rounded-borders"},{default:l(()=>[t(R,null,{default:l(()=>[t(C,{avatar:"",top:""},{default:l(()=>[t(W,{rounded:"",color:e(c).session.matiere?.discipline_color?e(re)(e(c).session.matiere.discipline_color,75):"grey-2","text-color":e(c).session.matiere?.discipline_color||"grey-7",icon:"sym_o_book",size:"lg"},null,8,["color","text-color"])]),_:1}),t(C,null,{default:l(()=>[t(k,{class:"text-weight-medium"},{default:l(()=>[v(d(e(c).session.matiere?.nom||"N/A"),1)]),_:1}),t(k,{caption:""},{default:l(()=>[v(d(e(c).session.matiere?.bref||""),1)]),_:1}),t(k,{caption:"",class:"q-mt-xs"},{default:l(()=>[t(Xe,{outline:"",dense:"",color:e(c).session.matiere?.discipline_color||"grey-6",label:e(c).session.matiere?.discipline_nom||"Discipline N/A"},null,8,["color","label"])]),_:1})]),_:1})]),_:1}),t(R,null,{default:l(()=>[t(C,{avatar:"",top:""},{default:l(()=>[t(W,{rounded:"",icon:"sym_o_groups",color:"blue-grey-1","text-color":"blue-grey-8",size:"lg"})]),_:1}),t(C,null,{default:l(()=>[t(k,{class:"text-weight-medium"},{default:l(()=>[v(d(e(c).session.classe?.nom||"N/A"),1)]),_:1}),t(k,{caption:""},{default:l(()=>[v(d(e(c).session.classe?.bref||""),1)]),_:1})]),_:1})]),_:1}),t(R,null,{default:l(()=>[t(C,{avatar:"",top:""},{default:l(()=>[t(W,{rounded:"",icon:"sym_o_person",color:"indigo-1","text-color":"indigo-8",size:"lg"})]),_:1}),t(C,null,{default:l(()=>[e(c).session.professeurs&&e(c).session.professeurs.length>0?(n(),V(k,{key:0,class:"text-weight-medium"},{default:l(()=>[v(d(e(c).session.professeurs.map(s=>s.nom_complet||`${s.prenom||""} ${s.nom||""}`.trim()).join(", ")),1)]),_:1})):(n(),V(k,{key:1,caption:""},{default:l(()=>o[26]||(o[26]=[v("Aucun professeur assigné")])),_:1}))]),_:1})]),_:1}),t(R,null,{default:l(()=>[t(C,{avatar:"",top:""},{default:l(()=>[t(W,{rounded:"",icon:"sym_o_meeting_room",color:"teal-1","text-color":"teal-8",size:"lg"})]),_:1}),t(C,null,{default:l(()=>[t(k,{class:"text-weight-medium"},{default:l(()=>[v(d(e(c).session.salle?.nom||"N/A"),1)]),_:1}),t(k,{caption:""},{default:l(()=>[v(d(e(c).session.salle?.bref||""),1)]),_:1})]),_:1})]),_:1}),e(c).session.cahiers?.length>0?(n(),V(R,{key:0},{default:l(()=>[t(C,{avatar:"",top:""},{default:l(()=>[t(W,{rounded:"",icon:"sym_o_book_ribbon",color:"teal-1","text-color":"teal-8",size:"lg"})]),_:1}),t(C,null,{default:l(()=>[t(k,{class:"text-weight-medium"},{default:l(()=>o[27]||(o[27]=[v("Cahier de textes")])),_:1})]),_:1})]),_:1})):I("",!0),e(c).session.is_cancelled?(n(),V(R,{key:1,class:"bg-red-1 text-negative"},{default:l(()=>[t(C,{avatar:"",top:""},{default:l(()=>[t(W,{rounded:"",icon:"sym_o_cancel",color:"red-2","text-color":"negative",size:"lg"})]),_:1}),t(C,null,{default:l(()=>[t(k,{class:"text-weight-bold"},{default:l(()=>o[28]||(o[28]=[v("Séance Annulée")])),_:1}),e(c).session.cancellation_details?.reason?(n(),V(k,{key:0,caption:"",class:"text-red-9"},{default:l(()=>[v("Raison: "+d(e(c).session.cancellation_details.reason),1)]),_:1})):I("",!0),e(c).session.cancellation_details?.cancelled_by?(n(),V(k,{key:1,caption:"",class:"text-red-9"},{default:l(()=>[v("Par: "+d(e(c).session.cancellation_details.cancelled_by),1)]),_:1})):I("",!0),t(k,{caption:"",class:"text-red-9"},{default:l(()=>[v(" Compensée: "+d(e(c).session.cancellation_details?.is_compensated?"Oui":"Non")+" ",1),e(c).session.cancellation_details?.compensation_notes?(n(),f("span",as," ("+d(e(c).session.cancellation_details.compensation_notes)+")",1)):I("",!0)]),_:1})]),_:1})]),_:1})):I("",!0)]),_:1})]),_:1})):I("",!0),t(Ue,{align:"right",class:"q-pa-md q-pt-none"},{default:l(()=>[ae(t(B,{flat:"",label:"Fermer",color:"primary",rounded:"",dense:"",padding:"xs md"},null,512),[[we]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Es=Pe(ls,[["__scopeId","data-v-bed2f2e7"]]);export{Es as default};
