import{_ as C,as as D,at as q,aB as P,Q as m,S as u,a6 as s,a5 as t,av as S,a3 as p,ad as d,ab as c,aF as B,a7 as F,a2 as I,aG as T,aE as V,b2 as U,ag as v,a4 as b,a8 as w,R as Q,ax as k,a9 as _,aa as A,ac as E,ah as M,ay as z,aD as R,aC as G,b3 as j}from"./index-Bl2lQPd7.js";import{Q as f}from"./QItemLabel-BkJiB6aE.js";import{Q as x,a as g}from"./QItem-De3v03wU.js";import{Q as y}from"./QBadge-Bjfo5tRO.js";import{Q as H}from"./QList-CMzNTEGD.js";import{Q as J}from"./QToolbarTitle-C8APieXG.js";import{Q as K}from"./QToolbar-DR-_wX4W.js";import{Q as W}from"./QImg-BMvxJu3S.js";import{Q as X}from"./QSelect-DchnWyXK.js";import{Q as Y}from"./QForm-Dk45GsL9.js";import{C as Z}from"./ClosePopup-BY_YGFBZ.js";import"./QChip-C9OfA2gn.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";const ee={data(){return{}},props:{title:{default:()=>"Nouvelle demande"}},computed:{...q({user:"user/user",config:"user/config",current:"user/current",form:"document/form",certificats:"document/certificats"}),options(){return this.certificats&&this.certificats.length?this.certificats.map(e=>({label:e.description,value:e.idcertificate})):[]},eleve(){if(this.current&&this.current.hasOwnProperty("eleve"))return this.current.eleve},annee(){if(this.current&&this.current.hasOwnProperty("annee"))return this.current.annee}},methods:{...D({create:"document/create",update:"document/update",getCertificats:"document/getCertificats"}),personAvatar(e){return P(e)},send(){this.$refs.form.validate().then(e=>{if(!e)return this.$q.notify({color:"negative",message:this.$t("stats.fields"),position:"bottom",icon:"error_outline",actions:[{label:this.$q.lang.label.close,color:"yellow"}]}),!1;this.sendMessage()})},sendMessage(e){let o={...this.form};o.idpers=this.eleve.idpers,o.idannee=this.annee.idannee,this.form.id?this.update(o).then(l=>{this.$emit("doc:sent",l)}).catch(l=>{this.$q.notify({color:"negative",message:this.$t("stats.fields"),position:"bottom",icon:"error_outline",actions:[{label:this.$q.lang.label.close,color:"yellow"}]}),this.$emit("doc:error",l)}):this.create(o).then(l=>{this.$emit("doc:sent",l)}).catch(l=>{this.$q.notify({color:"negative",message:this.$t("stats.fields"),position:"bottom",icon:"error_outline",actions:[{label:this.$q.lang.label.close,color:"yellow"}]}),this.$emit("doc:error",l)})},choice(e){this.step=e.value.step,this.$nextTick(()=>{if(this.form.destinataire=this.destinataire.map(o=>o.value.idpers?{type:"personne",id:o.value.idpers,value:"personne_"+o.value.idpers,label:o.label}:o),this.step!=="personnes"&&e.value.value)this.destinataire=null,this.setOptions(),this.$refs.dest.refresh(),this.steps.push(e.value);else if(e.value.value===0)for(var a=0;a<this.steps.length;a++)this.steps[a].step===e.value.step&&delete this.steps[a]})},clear(){this.destinataire=null,this.step=null,this.steps=[],this.setOptions()},hasDiscs(e){return e.value.disciplines&&e.value.disciplines.length},discs(e){return e.value.disciplines[0].description}},mounted(){this.getCertificats()}};function te(e,a,o,l,h,i){return u(),m(V,null,{default:s(()=>[t(K,{class:"bg-secondary text-white shadow-2"},{default:s(()=>[S(t(p,{flat:"",dense:"",icon:"arrow_back"},null,512),[[Z]]),t(J,null,{default:s(()=>[d(c(o.title),1)]),_:1}),t(p,{class:"q-ml-lg",flat:"",icon:"send",onClick:i.send},null,8,["onClick"])]),_:1}),t(B,{style:{"overflow-y":"scroll"}},{default:s(()=>[t(Y,{class:"q-gutter-lg",ref:"form"},{default:s(()=>[t(x,null,{default:s(()=>[t(g,{avatar:""},{default:s(()=>[t(F,null,{default:s(()=>[t(W,{src:i.personAvatar(i.eleve)},null,8,["src"])]),_:1})]),_:1}),t(g,null,{default:s(()=>[d(c(i.eleve.nom)+" "+c(i.eleve.prenom),1)]),_:1})]),_:1}),t(X,{filled:"",modelValue:e.form.idcertificate,"onUpdate:modelValue":a[0]||(a[0]=n=>e.form.idcertificate=n),options:i.options,label:"Document demandÃ©",rules:[n=>!!n||"Champ requis"],"emit-value":"","map-options":""},null,8,["modelValue","options","rules"]),t(I,{filled:"",modelValue:e.form.copie,"onUpdate:modelValue":a[1]||(a[1]=n=>e.form.copie=n),type:"number",label:"Nombre de copie",rules:[n=>!!n||"Champ requis"],"lazy-rules":""},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),t(T,{align:"right",class:""},{default:s(()=>[t(p,{label:"Envoyer",icon:"send",onClick:i.send},null,8,["onClick"])]),_:1})]),_:1})}const se=C(ee,[["render",te]]),ae={data(){return{show:!1,title:"Nouvelle demande"}},components:{DcForm:se},computed:{...q({user:"user/user",config:"user/config",current:"user/current",documentsList:"document/data",certificats:"document/certificats",form:"document/form"}),eleve(){if(this.current&&this.current.hasOwnProperty("eleve"))return this.current.eleve},annee(){if(this.current&&this.current.hasOwnProperty("annee"))return this.current.annee},docs(){return this.documentsList&&this.documentsList.data?this.documentsList.data:[]}},methods:{...D({resetForm:"document/resetForm",getdocs:"document/getData",getCertificats:"document/getCertificats",remove:"document/remove"}),toNow:U,color(e){return["var(--q-warning)","var(--q-positive)","var(--q-info)"][e.status]},getData(){this.getdocs({page:this.documentsList.current_page,filter:{eleve:this.eleve.idpers,annee:this.annee.idannee}})},docEnvoye(){this.getdocs({page:1,filter:{eleve:this.eleve.idpers,annee:this.annee.idannee}}),this.show=!1,this.$q.notify({color:"positive",message:this.$t("stats.success"),position:"bottom",icon:"check",actions:[{label:this.$q.lang.label.close,color:"white"}]})},showDialog(){this.show=!0,this.title="Nouvelle demande",this.resetForm()},edit(e){e.status||(Object.assign(this.form,e),this.title="Modifier",this.show=!0)},showDelete(e){this.$q.dialog({title:"Suppression",message:"Supprimer cette demande?",cancel:!0,ok:{label:"Oui",outline:!0,color:"red"},persistent:!0}).onOk(()=>{this.remove(e).then(a=>{this.getData()})})},toDate(e){return j(e)},personAvatar(e){return userPhotoUrl(e)},sub(e){return this.$cleanHtml(e,{allowedTags:["b","i","em","strong","a"]})}},mounted(){this.setTitle("Documents administratifs"),this.getdocs({page:1,filter:{eleve:this.eleve.idpers,annee:this.annee.idannee}}),this.getCertificats()}},ie={class:"q-pa-lg flex flex-center"};function oe(e,a,o,l,h,i){const n=v("ep-pagination"),$=v("dc-form"),L=v("ep-footer");return u(),b(_,null,[t(G,{padding:"",class:"page-content"},{default:s(()=>[w("div",ie,[e.documentsList?(u(),m(n,{key:0,modelValue:e.documentsList.current_page,"onUpdate:modelValue":[a[0]||(a[0]=r=>e.documentsList.current_page=r),i.getData],max:e.documentsList.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:s(()=>[d(" Page "+c(e.documentsList.current_page),1)]),_:1},8,["modelValue","max","onUpdate:modelValue"])):Q("",!0)]),t(V,{style:{margin:"0 -8px"},flat:""},{default:s(()=>[t(H,null,{default:s(()=>[t(k),(u(!0),b(_,null,A(i.docs,(r,N)=>(u(),b(_,{key:N},[t(x,{clickable:"",style:E("border-left: 5px solid "+i.color(r)),onClick:O=>i.edit(r)},{default:s(()=>[t(g,null,{default:s(()=>[t(f,{style:{"font-weight":"500"}},{default:s(()=>[d(c(r.certificate.description),1)]),_:2},1024),t(f,null,{default:s(()=>[a[2]||(a[2]=w("span",null,"Nombre de copie:",-1)),d(" "+c(r.copie),1)]),_:2},1024)]),_:2},1024),t(g,{side:"",top:"",style:{position:"relative"}},{default:s(()=>[t(f,{caption:"",line:"1"},{default:s(()=>[d(c(i.toNow(i.toDate(r.date_demande))),1)]),_:2},1024),t(f,{caption:""},{default:s(()=>[r.status===1?(u(),m(y,{key:0,color:"positive"},{default:s(()=>a[3]||(a[3]=[d("Disponible")])),_:1})):r.status===2?(u(),m(y,{key:1,color:"info"},{default:s(()=>a[4]||(a[4]=[d("Remis")])),_:1})):(u(),m(y,{key:2,color:"warning"},{default:s(()=>a[5]||(a[5]=[d("En cours de traitement")])),_:1}))]),_:2},1024),r.status?Q("",!0):(u(),m(f,{key:0,style:{"min-height":"32px","min-width":"32px","margin-top":"16px"}},{default:s(()=>[t(p,{onClick:M(O=>i.showDelete(r),["stop"]),dense:"",flat:"",color:"red",class:"absolute-bottom-right"},{default:s(()=>[t(z,{name:"delete"})]),_:2},1032,["onClick"])]),_:2},1024))]),_:2},1024)]),_:2},1032,["style","onClick"]),t(k)],64))),128))]),_:1})]),_:1}),t(R,{modelValue:h.show,"onUpdate:modelValue":a[1]||(a[1]=r=>h.show=r),maximized:"",position:"bottom"},{default:s(()=>[t($,{"onDoc:sent":i.docEnvoye,title:h.title},null,8,["onDoc:sent","title"])]),_:1},8,["modelValue"])]),_:1}),t(L,{to:"#footer-portal"},{default:s(()=>[t(p,{flat:"",onClick:i.showDialog,icon:"icon_nouveau_document",label:""},null,8,["onClick"])]),_:1})],64)}const ke=C(ae,[["render",oe]]);export{ke as default};
