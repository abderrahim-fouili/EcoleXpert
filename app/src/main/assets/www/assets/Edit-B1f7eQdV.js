import{aO as x,aP as k,B as I,A as d,C,a4 as M,S as Q,a5 as t,a6 as m,a2 as c,aF as w,a3 as g,aG as B,a9 as S}from"./index-Bl2lQPd7.js";import{Q as F}from"./QForm-Dk45GsL9.js";const E={__name:"Edit",props:{menuId:{type:[String,Number],default:null}},emits:["saved","cancelled"],setup(y,{emit:b}){const u=y,f=b,i=x(),o=k(),s=I(()=>!u.menuId),n=d(!1),p=d(null),l=d({designation:"",description:"",prix:null,active:1}),V=async()=>{if(!s.value){const r=o.getters["snack/menuById"](u.menuId);if(r)l.value={...r};else try{n.value=!0;const e=await o.dispatch("snack/fetchMenuById",u.menuId);l.value={...e}}catch{i.notify({type:"negative",message:"Erreur lors du chargement du menu"}),f("cancelled")}finally{n.value=!1}}},v=async()=>{if(!await p.value.validate()){i.notify({type:"negative",message:"Veuillez corriger les erreurs du formulaire"});return}try{n.value=!0;const e=s.value?"snack/createMenu":"snack/updateMenu",a={...l.value,...s.value?{}:{id:u.menuId}};await o.dispatch(e,a),f("saved")}catch(e){console.error(e),i.notify({type:"negative",message:`Erreur lors de la ${s.value?"création":"modification"} du menu`})}finally{n.value=!1}};return C(()=>{V()}),(r,e)=>(Q(),M(S,null,[t(w,null,{default:m(()=>[t(F,{onSubmit:v,class:"q-gutter-md",ref_key:"editFormRef",ref:p},{default:m(()=>[t(c,{modelValue:l.value.designation,"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.designation=a),label:"Désignation",rules:[a=>!!a||"La désignation est requise"],filled:""},null,8,["modelValue","rules"]),t(c,{modelValue:l.value.description,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.description=a),type:"textarea",label:"Description",filled:""},null,8,["modelValue"]),t(c,{modelValue:l.value.prix,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.prix=a),modelModifiers:{number:!0},type:"number",label:"Prix",rules:[a=>!!a||"Le prix est requis",a=>a>0||"Le prix doit être supérieur à 0"],suffix:"DH",filled:""},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),t(B,{align:"right",class:"bg-white"},{default:m(()=>[t(g,{flat:"",label:"Annuler",color:"grey",disable:n.value,onClick:e[3]||(e[3]=a=>r.$emit("cancelled"))},null,8,["disable"]),t(g,{flat:"",type:"submit",label:s.value?"Créer":"Modifier",color:"primary",loading:n.value,onClick:v},null,8,["label","loading"])]),_:1})],64))}};export{E as default};
