import{_ as V,as as A,at as N,ag as p,a4 as g,S as r,Q as d,R as f,a6 as a,a5 as e,az as Q,aC as v,a8 as i,aD as D,aE as _,aF as h,a7 as F,aG as P,av as C,a3 as c,ad as k,ab as S,a9 as b,aa as O,ay as y,aw as j,ax as G,aA as x,o as q,aH as H,aI as K}from"./index-Bl2lQPd7.js";import{Q as T}from"./QBanner-xBGiroIy.js";import{Q as U,a as w}from"./QItem-De3v03wU.js";import{Q as J}from"./QList-CMzNTEGD.js";import{Q as M}from"./QPageSticky-adQ0nSeI.js";import{C as L}from"./ClosePopup-BY_YGFBZ.js";import{B as W,L as X}from"./BottomLeaf-Bpfn8hNE.js";import{E as Y}from"./Header-iKAj_IF4.js";import"./QHeader-B4MlZ-LM.js";import"./QSpace-CKKoNTi_.js";import"./QToolbar-DR-_wX4W.js";const Z={name:"scan",props:["show","value"],components:{LeftLeaf:X,BottomLeaf:W,EpHeader:Y},data(){return{message:"",confirm:!1,frontCamera:!1,light:!1,hide:!1,selected:null,log:[]}},computed:{...N({}),ecoles(){this.selected;let s=K();if(this.log.push(s),Object.keys(s).length){let n=Object.keys(s);this.log.push(n);let u=[];for(var t=0;t<n.length;t++){this.log.push([s[n[t]],atob(s[n[t]])]);let l=atob(s[n[t]]).split("|");u.push({key:n[t],titre:l[1],code:s[n[t]]})}return this.log.push(u),u}return[]}},methods:{...A({getInfo:"ecole/getInfo"}),crash(){cordova.plugins.AppCrash.crash("crash")},toggleCamera(){this.frontCamera=!this.frontCamera,this.frontCamera?QRScanner.useFrontCamera():QRScanner.useBackCamera()},toggleLight(){this.light=!this.light,this.light?QRScanner.enableLight():QRScanner.disableLight()},deleteEtab(){console.log(this.selected),H(this.selected.key),this.selected=null},hideScanner(){QRScanner.destroy(function(s){}),this.hide=!1,document.body.classList.remove("ecp-scanner")},scan(){this.message="",this.$q.platform.is.cordova&&(this.$q.platform.is.ios&&QRScanner.prepare((s,t)=>{s&&console.error(s),t.authorized||t.denied}),QRScanner.scan((s,t)=>{this.hide=!1,s&&(this.message="Scanning failed: "+s._message,console.error(s._message)),q(t)?(this.getInfo().then(()=>{}),this.hideScanner(),this.$router.replace("/login")):this.message="Code incorrect! veuillez réessayer "}),this.hide=!0,document.body.classList.add("ecp-scanner"),QRScanner.show())},select(s){q(s.code)&&(this.getInfo(),this.$router.replace("/login"))}},mounted(){this.$q.platform.is.cordova&&QRScanner.prepare((s,t)=>{s&&console.error(s),t.authorized||t.denied})}},$={class:"col-xs-12 col-md-4 q-pl-xl q-pr-xl"},ee={style:{"text-align":"center"}},te={class:"bg-secondary fixed-bottom text-white q-pa-sm"};function ae(s,t,n,u,l,o){const R=p("ep-header"),B=p("left-leaf"),E=p("bottom-leaf");return r(),g(b,null,[l.hide?f("",!0):(r(),d(x,{key:0,class:"login"},{default:a(()=>[e(R,{htype:1}),e(Q,{class:"full-height"},{default:a(()=>[e(v,{class:"login-content"},{default:a(()=>[e(D,{modelValue:l.confirm,"onUpdate:modelValue":t[0]||(t[0]=m=>l.confirm=m),persistent:""},{default:a(()=>[e(_,null,{default:a(()=>[e(h,{class:"row items-center"},{default:a(()=>[e(F,{icon:"warning",color:"primary","text-color":"white"}),t[1]||(t[1]=i("span",{class:"q-ml-sm"},"Êtes-vous sûr de vouloir supprimer cet établissement ?",-1))]),_:1}),e(P,{align:"right"},{default:a(()=>[C(e(c,{flat:"",label:"Non",color:"primary"},null,512),[[L]]),C(e(c,{flat:"",label:"Oui",color:"primary",onClick:o.deleteEtab},null,8,["onClick"]),[[L]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),i("div",$,[l.message?(r(),d(T,{key:0,"inline-actions":"",class:"text-white bg-red"},{action:a(()=>[e(c,{flat:"",color:"white",label:"Rescan",onClick:o.scan},null,8,["onClick"])]),default:a(()=>[k(" Erreur: "+S(l.message)+" ",1)]),_:1})):f("",!0),e(_,{flat:"",class:"bg-transparent"},{default:a(()=>[e(h),e(h,null,{default:a(()=>[i("div",ee,[e(c,{class:"q-py-sm",rounded:"",color:"primary",size:"md",label:"Flasher le QRCode",icon:"qr_code",onClick:o.scan},null,8,["onClick"]),t[2]||(t[2]=i("div",{style:{"text-align":"center","text-size":"0.5rem","margin-top":"1rem"}},"Code communiqué par votre établissement ",-1))])]),_:1})]),_:1})]),o.ecoles.length?(r(),d(_,{key:0,style:{position:"absolute",bottom:"0",width:"100%","z-index":"1"}},{default:a(()=>[o.ecoles.length?(r(),d(h,{key:0},{default:a(()=>t[3]||(t[3]=[k(" Sélectionner un établissement: ")])),_:1})):f("",!0),e(J,{bordered:""},{default:a(()=>[(r(!0),g(b,null,O(o.ecoles,(m,I)=>(r(),g(b,{key:I},[C((r(),d(U,{clickable:""},{default:a(()=>[e(w,{onClick:z=>o.select(m)},{default:a(()=>[k(S(m.titre),1)]),_:2},1032,["onClick"]),e(w,{side:"",onClick:z=>{l.selected=m,l.confirm=!0}},{default:a(()=>[e(y,{name:"delete"})]),_:2},1032,["onClick"])]),_:2},1024)),[[j]]),e(G)],64))),128))]),_:1})]),_:1})):f("",!0),e(B),e(E)]),_:1})]),_:1})]),_:1})),l.hide?(r(),d(x,{key:1,class:"qrscanner"},{default:a(()=>[e(Q,null,{default:a(()=>[e(v,null,{default:a(()=>[t[4]||(t[4]=i("div",{style:{"text-align":"center"},class:"bg-secondary"},[i("img",{src:"/logo.png",alt:"logo",style:{width:"50px"}})],-1)),t[5]||(t[5]=i("div",{class:"qrscanner-area"},null,-1)),e(M,{position:"bottom",offset:[0,80]},{default:a(()=>[e(c,{onClick:o.toggleLight,fab:"",class:"q-mr-md",color:"dark"},{default:a(()=>[e(y,{name:"flash_on"})]),_:1},8,["onClick"]),e(c,{onClick:o.toggleCamera,fab:"",color:"dark"},{default:a(()=>[e(y,{name:"flip_camera_ios"})]),_:1},8,["onClick"])]),_:1}),i("div",te,[e(c,{icon:"icon_retour_mobile",flat:"",onClick:o.hideScanner},null,8,["onClick"])])]),_:1})]),_:1})]),_:1})):f("",!0)],64)}const he=V(Z,[["render",ae]]);export{he as default};
