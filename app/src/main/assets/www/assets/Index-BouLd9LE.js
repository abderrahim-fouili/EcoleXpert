import{cv as Y,z as $,aO as G,aP as J,B as i,A as k,Y as K,ag as q,Q as w,S as f,a6 as n,a8 as V,a5 as t,a4 as H,R as L,aS as M,bd as O,ad as S,ab as g,ay as R,ax as W,a9 as X,aa as Z,a7 as ee,aB as se,aV as ae,a3 as te,aC as ne}from"./index-Bl2lQPd7.js";import{Q as le,a as C}from"./QItem-De3v03wU.js";import{Q as oe}from"./QItemLabel-BkJiB6aE.js";import{Q as re}from"./QList-CMzNTEGD.js";import{f as b}from"./index-C9ZTL5MN.js";import"./index-BXMW6yyY.js";import"./index-CbPSoDvq.js";const ce={class:"q-pa-lg flex flex-center"},ie={key:0,style:{position:"absolute",top:"55px"}},ue=["src"],de={style:{}},ye={__name:"Index",setup(pe){const B=$();let h;Y(()=>{h=B.appContext.config.globalProperties.$i18n,h.t=B.appContext.config.globalProperties.$t});const P=G(),s=J(),y=i(()=>s.getters["profEmploi/seances"]),I=i(()=>s.getters["profAbsences/absences"]),A=i(()=>s.getters["profAbsences/appel"]),u=i(()=>s.getters["user/current"]);let o=k(1),r=k([]),m=k("Assiduité"),d=new Date;const v=()=>y.value[o.value-1],U=i(()=>{if(y.value.length){o.value||(o.value=1);let e=v(),a=" de "+c(e.debut).substr(0,2)+":"+c(e.debut).substr(2,2)+" à "+c(e.fin).substr(0,2)+":"+c(e.fin).substr(2,2);return m.value="Assiduité - "+e.matieres.bref,b(d,"E dd MMM")+a}else m.value="Assiduité";return null}),_=i(()=>{if(u.value&&u.value.hasOwnProperty("annee"))return u.value.annee}),p=i(()=>{if(u.value&&u.value.hasOwnProperty("classe"))return u.value.classe});K(p,(e,a)=>{Q()});function c(e){return e.toString().padStart(4,0)}function E(e){return e.absences_eleve&&e.absences_eleve.length?e.absences_eleve[0].active===1:!1}const x=()=>{let e=v();if(!e){s.commit("profAbsences/setAbsences",[]);return}s.dispatch("profAbsences/getAbsences",{annee:_.value.idannee,classe:p.value.idclasse,seance:e.id}).then(()=>{I.value.forEach(a=>{a.absences_eleve&&a.absences_eleve.length&&!r.value.includes(a.idpers)&&r.value.push(a.idpers)})})},N=()=>{let e=v();if(!e){s.commit("profAbsences/setAppel",null);return}let a=c(e.debut).substr(0,2)+":"+c(e.debut).substr(2,2)+":00";s.dispatch("profAbsences/getAppel",{annee:_.value.idannee,classe:p.value.idclasse,seance:e.id,date_appel:b(d,"yyyy-MM-dd "+a)})},z=()=>{let e=v();s.dispatch("profAbsences/update",{annee:_.value.idannee,classe:p.value.idclasse,date:b(d,"yyyy-MM-dd HH:mm:ss"),date_absence:b(d,"yyyyMMdd"+c(e.debut)+"00"),jour:b(d,"i"),seance:e.id,absent:r.value}).then(()=>{P.notify({color:"positive",message:h.t("stats.success"),position:"bottom",icon:"check",actions:[{label:P.lang.label.close,color:"white"}]}),x(),N()})};s.commit("setRefresh",e=>{Q(),e()}),s.commit("setTitle",m);function Q(){return s.commit("profAbsences/setAbsences",[]),s.commit("profAbsences/setAppel",null),s.dispatch("profEmploi/getSeances",{annee:_.value.idannee,classe:p.value.idclasse}).then(e=>(s.commit("setTitle",m),x(),N(),e))}return Q(),(e,a)=>{const D=q("ep-pagination"),j=q("ep-footer");return f(),w(ne,{class:"page-content"},{default:n(()=>[V("div",ce,[t(D,{"onUpdate:modelValue":[x,a[0]||(a[0]=l=>O(o)?o.value=l:o=l)],modelValue:M(o),max:y.value.length,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:n(()=>[S(g(U.value),1)]),_:1},8,["modelValue","max"]),A.value&&A.value.success?(f(),H("div",ie,[t(R,{name:"done",color:"green"}),S(" Appel effectué le "+g(A.value.data.created_at),1)])):L("",!0)]),t(re,{style:{margin:"0"},flat:""},{default:n(()=>[t(W),(f(!0),H(X,null,Z(I.value,(l,F)=>(f(),w(le,{key:"abs"+F},{default:n(()=>[t(C,{avatar:""},{default:n(()=>[t(ee,{square:"",size:"lg"},{default:n(()=>[V("img",{src:M(se)(l)},null,8,ue)]),_:2},1024)]),_:2},1024),t(C,null,{default:n(()=>[t(oe,{lines:"1",style:{"font-weight":"600"}},{default:n(()=>[S(g(l.nom)+" "+g(l.prenom),1)]),_:2},1024)]),_:2},1024),t(C,{side:""},{default:n(()=>[V("div",de,[E(l)?(f(),w(R,{key:0,name:"done",color:"green"})):L("",!0),t(ae,{disable:E(l),modelValue:M(r),"onUpdate:modelValue":a[1]||(a[1]=T=>O(r)?r.value=T:r=T),"checked-icon":"icon_absences",color:"red",label:"Absent","unchecked-icon":"clear",val:l.idpers},null,8,["disable","modelValue","val"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(j,{to:"#footer-portal"},{default:n(()=>[t(te,{flat:"",onClick:z,icon:"icon_absences",label:"Appel terminé"})]),_:1})]),_:1})}}};export{ye as default};
