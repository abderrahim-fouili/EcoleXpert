import{_ as b,b2 as w,as as Q,at as x,ag as k,Q as p,S as o,a6 as e,a8 as u,a5 as s,ad as n,ab as r,a4 as h,ax as g,a9 as _,aa as N,a7 as L,R as V,a3 as S,ay as B,aC as T,h as m,aB as C}from"./index-Bl2lQPd7.js";import{Q as I,a as f}from"./QItem-De3v03wU.js";import{Q as c}from"./QItemLabel-BkJiB6aE.js";import{Q as A}from"./QBadge-Bjfo5tRO.js";import{Q as D}from"./QList-CMzNTEGD.js";import{i as J}from"./stomp-SbqQEsfg.js";const O={data(){return{raw:[],stomp:null,timer:null,mode:1,modes:["Tous","Validés","Non Validés"]}},computed:{...x({config:"user/config",user:"user/user"}),data(){return this.mode===2?this.raw.filter(t=>t.status):this.mode===3?this.raw.filter(t=>!t.status):this.raw}},methods:{...Q({getData:"badge/getData",valid:"badge/valid",setRefresh:"setRefresh"}),toNow:w,startTimer(){this.timer=setTimeout(()=>{this.getList(),this.startTimer()},3e4)},topic(){let t="/topic/"+m+"-";return this.config.roles.prof?t+=this.user.idpers:t+="scan-admin",t},personAvatar(t){return C(t)},getList(){return this.getData().then(t=>{console.log(t),t.success&&(this.raw=[...new Map(t.data.map(i=>[i.data.eleve.idpers,i])).values()])})},validate(t){this.valid(t.id).then(()=>{this.stomp?(this.stomp.publish({destination:"/topic/"+m+"-scan-"+t.id,body:JSON.stringify({message:t.id})}),this.stomp.publish({destination:"/topic/"+m+"-scan-admin",body:JSON.stringify({message:t.id})}),this.stomp.publish({destination:this.topic(),body:JSON.stringify({message:t.id})}),t.personne_id&&this.stomp.publish({destination:"/topic/"+m+"-"+t.personne_id,body:JSON.stringify({message:t.id})})):this.getList()})}},watch:{},mounted(){this.getList(),this.setRefresh(t=>{this.getList(),t()}),this.setTitle("Sortie de l'élève"),this.startTimer(),J(t=>{console.log("stomp activated"),this.stomp=t,t.subscribe(this.topic(),()=>{this.getList()})})},unmounted(){this.stomp&&(this.stomp.deactivate(),console.log("stomp deactivated")),this.timer!==null&&(clearTimeout(this.timer),console.log("timer deactivated"))}},R={class:"q-pa-lg flex flex-center"},P=["src"],q={style:{"font-weight":"500"}},U={style:{"padding-top":"10px"}};function z(t,i,E,F,l,d){const v=k("ep-pagination");return o(),p(T,{class:"page-content"},{default:e(()=>[u("div",R,[s(v,{modelValue:l.mode,"onUpdate:modelValue":i[0]||(i[0]=a=>l.mode=a),max:3,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:e(()=>[n(r(l.modes[l.mode-1]),1)]),_:1},8,["modelValue"])]),s(D,{style:{margin:"0"},flat:""},{default:e(()=>[s(g),(o(!0),h(_,null,N(d.data,(a,y)=>(o(),h(_,{key:y},[s(I,null,{default:e(()=>[s(f,{avatar:""},{default:e(()=>[s(L,{square:"",size:"lg"},{default:e(()=>[u("img",{src:d.personAvatar(a.data.eleve)},null,8,P)]),_:2},1024)]),_:2},1024),s(f,null,{default:e(()=>[s(c,{lines:"1",style:{"font-weight":"600"}},{default:e(()=>[n(r(a.data.eleve.nom)+" "+r(a.data.eleve.prenom),1)]),_:2},1024),s(c,{caption:"",lines:"2"}),a.data.prof?(o(),p(c,{key:0,lines:"2"},{default:e(()=>[i[1]||(i[1]=n(" Prof: ")),u("span",q,r(a.data.prof.nom)+" "+r(a.data.prof.prenom),1)]),_:2},1024)):V("",!0)]),_:2},1024),s(f,{side:"",top:""},{default:e(()=>[s(c,{caption:""},{default:e(()=>[n(r(d.toNow(a.created_at*1e3)),1)]),_:2},1024),u("div",U,[a.status?(o(),p(A,{key:0,color:"positive"},{default:e(()=>i[2]||(i[2]=[n("Validé")])),_:1})):(o(),p(S,{key:1,onClick:G=>d.validate(a),dense:"",unelevated:"",color:"primary"},{default:e(()=>[s(B,{name:"done"})]),_:2},1032,["onClick"]))])]),_:2},1024)]),_:2},1024),s(g)],64))),128))]),_:1})]),_:1})}const Y=b(O,[["render",z]]);export{Y as default};
