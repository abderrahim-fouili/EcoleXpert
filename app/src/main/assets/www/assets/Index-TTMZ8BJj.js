import{Q as W,a as E}from"./QTabs-yl5EIOig.js";import{v as Y,cf as J,bO as K,A as S,B,Y as _,bJ as X,bI as Z,D as ee,C as te,z as se,bA as ae,y as D,bp as ie,c_ as I,cm as C,cp as N,aR as R,bK as Q,bY as le,aX as oe,_ as ne,as as re,at as ce,Q as q,S as f,a6 as m,a8 as h,a5 as d,a4 as A,R as F,a9 as ue,aa as de,aE as fe,ad as me,ab as p,ay as U,aF as he,aG as pe,a3 as ge,aC as ve,i as be,c$ as ye,aW as _e,cT as Ae}from"./index-Bl2lQPd7.js";import{Q as Se}from"./QImg-BMvxJu3S.js";import{Q as Ie}from"./QSpace-CKKoNTi_.js";import{Q as Te}from"./QSpinnerDots-BW9ZsFNG.js";import{f as xe}from"./index-C9ZTL5MN.js";import{f as Pe}from"./index-Dx01H97j.js";import"./rtl-DFPa-2ov.js";import"./index-BXMW6yyY.js";import"./index-CbPSoDvq.js";const{passive:g}=J,Le=Y({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:K,initialIndex:{type:Number,default:0},disable:Boolean,reverse:Boolean},emits:["load"],setup(e,{slots:t,emit:r}){const o=S(!1),i=S(!0),n=S(null),s=S(null);let v=e.initialIndex,a,c;const $=B(()=>"q-infinite-scroll__loading"+(o.value===!0?"":" invisible"));function b(){if(e.disable===!0||o.value===!0||i.value===!1)return;const l=I(a),u=C(a),y=N(a);e.reverse===!1?Math.round(u+y+e.offset)>=Math.round(l)&&T():Math.round(u)<=e.offset&&T()}function T(){if(e.disable===!0||o.value===!0||i.value===!1)return;v++,o.value=!0;const l=I(a);r("load",v,u=>{i.value===!0&&(o.value=!1,R(()=>{if(e.reverse===!0){const y=I(a),O=C(a),G=y-l;Q(a,O+G)}u===!0?x():n.value&&n.value.closest("body")&&c()}))})}function j(){v=0}function M(){i.value===!1&&(i.value=!0,a.addEventListener("scroll",c,g)),b()}function x(){i.value===!0&&(i.value=!1,o.value=!1,a.removeEventListener("scroll",c,g),c?.cancel?.())}function P(){if(a&&i.value===!0&&a.removeEventListener("scroll",c,g),a=le(n.value,e.scrollTarget),i.value===!0){if(a.addEventListener("scroll",c,g),e.reverse===!0){const l=I(a),u=N(a);Q(a,l-u)}b()}}function z(l){v=l}function V(l){l=parseInt(l,10);const u=c;c=l<=0?b:oe(b,isNaN(l)===!0?100:l),a&&i.value===!0&&(u!==void 0&&a.removeEventListener("scroll",u,g),a.addEventListener("scroll",c,g))}function L(l){if(w.value===!0){if(s.value===null){l!==!0&&R(()=>{L(!0)});return}const u=`${o.value===!0?"un":""}pauseAnimations`;Array.from(s.value.getElementsByTagName("svg")).forEach(y=>{y[u]()})}}const w=B(()=>e.disable!==!0&&i.value===!0);_([o,w],()=>{L()}),_(()=>e.disable,l=>{l===!0?x():M()}),_(()=>e.reverse,()=>{o.value===!1&&i.value===!0&&b()}),_(()=>e.scrollTarget,P),_(()=>e.debounce,V);let k=!1;X(()=>{k!==!1&&a&&Q(a,k)}),Z(()=>{k=a?C(a):!1}),ee(()=>{i.value===!0&&a.removeEventListener("scroll",c,g)}),te(()=>{V(e.debounce),P(),o.value===!1&&L()});const H=se();return Object.assign(H.proxy,{poll:()=>{c?.()},trigger:T,stop:x,reset:j,resume:M,setIndex:z,updateScrollTarget:P}),()=>{const l=ae(t.default,[]);return w.value===!0&&l[e.reverse===!1?"push":"unshift"](D("div",{ref:s,class:$.value},ie(t.loading))),D("div",{class:"q-infinite-scroll",ref:n},l)}}}),we={name:"MediaAlbumIndex",data(){return{type:1,albums:[],currentPage:1,totalPages:1,loading:!1,allAlbumsLoaded:!1}},watch:{"$route.params.type":{immediate:!0,handler(e){const t=e==="photos"?1:0;(this.type!==t||this.albums.length===0&&!this.loading)&&(this.type=t,this.resetAndLoadAlbums())}},typeTab(e){const t=e==="photos"?"photos":"videos";this.$route.params.type!==t&&this.$router.push({name:"parentMediaList",params:{type:t}})}},computed:{...ce({user:"user/user",current:"user/current"}),typeTab:{get(){return this.type===1?"photos":"videos"},set(e){}},classeId(){return this.current?.annee?.pivot?.idclasse},currentRouteTypeParam(){return this.$route.params.type||"photos"},infiniteScrollInstance(){return this.$refs.infiniteScroll}},methods:{...re({fetchMediaAlbums:"media/getData"}),async loadMoreAlbums(e,t){if(this.allAlbumsLoaded){t(!0),this.infiniteScrollInstance&&this.infiniteScrollInstance.stop();return}if(this.loading){t();return}this.loading=!0;try{const r=await this.fetchMediaAlbums({page:this.currentPage,filter:{classe:this.classeId,type:this.type}});if(r&&r.data){const o=r.data.data||r.data,i=r.last_page,n=r.current_page;o&&o.length>0&&(this.albums=[...this.albums,...o],this.currentPage++),this.totalPages=i,n>=i||o.length===0?(this.allAlbumsLoaded=!0,t(!0),this.infiniteScrollInstance&&this.infiniteScrollInstance.stop()):t()}else this.allAlbumsLoaded=!0,t(!0),this.infiniteScrollInstance&&this.infiniteScrollInstance.stop()}catch(r){console.error("Failed to load media albums:",r),this.allAlbumsLoaded=!0,t(!0),this.infiniteScrollInstance&&this.infiniteScrollInstance.stop()}finally{this.loading=!1}},resetAndLoadAlbums(){this.albums=[],this.currentPage=1,this.totalPages=1,this.loading=!1,this.allAlbumsLoaded=!1,this.infiniteScrollInstance&&(this.infiniteScrollInstance.reset(),this.infiniteScrollInstance.resume()),this.$nextTick(()=>{this.albums.length===0&&this.infiniteScrollInstance&&!this.loading&&!this.allAlbumsLoaded&&this.infiniteScrollInstance.trigger()}),this.updatePageTitle()},getAlbumCover(e){if(e.cover_image_url)return e.cover_image_url;if(e.meta&&e.meta.media&&e.meta.media.length>0){const t=e.meta.media[0];if(t.type===1)return t.lien&&t.lien.includes("http")?t.lien:ye(_e("api")+t.lien);if(t.type===0)return`https://img.youtube.com/vi/${Ae(t.lien)}/hqdefault.jpg`}return this.type===1?"https://cdn.quasar.dev/img/mountains.jpg":"https://cdn.quasar.dev/img/video.jpg"},getAlbumItemTypeLabel(e,t=!1){return e?e.media===1?t?"photos":"photo":t?"vidéos":"vidéo":t?"éléments":"élément"},viewAlbumDetail(e){this.$router.push({name:"parentMediaAlbumView",params:{type:this.currentRouteTypeParam,albumId:e.id}})},formatAlbumDate(e){return e?xe(Pe(e),"dd MMM yyyy",{locale:be}):""},updatePageTitle(){const e=this.type===1?"Albums Photo":"Collections Vidéo";this.setTitle(e)},setTitle(e){typeof this.setAppTitle=="function"?this.setAppTitle(e):document.title=`${e} - EcolePlus`}},mounted(){this.updatePageTitle()}},ke={class:"q-pa-md q-gutter-sm bg-primary text-white shadow-2",style:{"z-index":"10"}},Ce={class:"row q-col-gutter-md"},Qe=["onClick"],qe={class:"absolute-bottom text-subtitle1 text-center album-title-overlay"},Me={key:0,class:"text-caption"},Ve={key:1,class:"text-caption"},Ee={class:"absolute-top-right q-pa-xs bg-transparent"},Be={class:"text-caption ellipsis-3-lines"},De={class:"text-caption text-grey-7"},Ne={class:"row justify-center q-my-md"},Re={key:0,class:"text-center q-pa-xl text-grey-6"};function Fe(e,t,r,o,i,n){return f(),q(ve,{class:"page-content"},{default:m(()=>[h("div",ke,[d(W,{modelValue:n.typeTab,"onUpdate:modelValue":t[2]||(t[2]=s=>n.typeTab=s),dense:"",class:"text-white","active-color":"white","indicator-color":"accent",align:"justify","narrow-indicator":""},{default:m(()=>[d(E,{name:"photos",icon:"photo_album",label:"Albums Photo",onClick:t[0]||(t[0]=s=>e.go("photos"))}),d(E,{name:"videos",icon:"video_library",label:"Collections Vidéo",onClick:t[1]||(t[1]=s=>e.go("videos"))})]),_:1},8,["modelValue"])]),d(Le,{onLoad:n.loadMoreAlbums,offset:250,class:"q-pa-sm",ref:"infiniteScroll"},{loading:m(()=>[h("div",Ne,[d(Te,{color:"primary",size:"40px"})])]),default:m(()=>[h("div",Ce,[(f(!0),A(ue,null,de(i.albums,(s,v)=>(f(),A("div",{key:s.id||`album-${v}`,class:"col-12 col-sm-6 col-md-4 col-lg-3 cursor-pointer album-post-container",onClick:a=>n.viewAlbumDetail(s)},[d(fe,{flat:"",bordered:"",class:"album-card full-height column"},{default:m(()=>[d(Se,{src:n.getAlbumCover(s),ratio:4/3,fit:"cover",class:"album-cover-img"},{default:m(()=>[h("div",qe,[me(p(s.titre)+" ",1),s.meta&&s.meta.media&&s.meta.media.length>=0?(f(),A("div",Me,p(s.meta.media.length)+" "+p(n.getAlbumItemTypeLabel(s,s.meta.media.length>1||s.meta.media.length===0)),1)):s.items_count!==void 0?(f(),A("div",Ve,p(s.items_count)+" "+p(s.items_count===1?"élément":"éléments"),1)):F("",!0)]),h("div",Ee,[d(U,{name:s.media===1?"photo_album":"video_library",color:"white",size:"sm",class:"bg-black-opac"},null,8,["name"])])]),_:2},1032,["src"]),s.description?(f(),q(he,{key:0,class:"col-auto album-description"},{default:m(()=>[h("p",Be,p(s.description),1)]),_:2},1024)):(f(),q(Ie,{key:1})),d(pe,{align:"between",class:"q-pt-none q-px-sm q-pb-sm"},{default:m(()=>[h("span",De,p(n.formatAlbumDate(s.created_at)),1),d(ge,{flat:"",round:"",dense:"",icon:"arrow_forward",color:"primary",size:"sm","aria-label":"Voir l'album"})]),_:2},1024)]),_:2},1024)],8,Qe))),128))])]),_:1},8,["onLoad"]),!i.loading&&i.albums.length===0?(f(),A("div",Re,[d(U,{name:i.type===1?"photo_album":"video_library",size:"3em"},null,8,["name"]),h("p",null,"Aucun "+p(i.type===1?"album photo":"collection vidéo")+" trouvé pour le moment.",1)])):F("",!0)]),_:1})}const Ke=ne(we,[["render",Fe],["__scopeId","data-v-5522ef43"]]);export{Ke as default};
