import{_ as h,as as g,at as w,a4 as m,S as c,R as b,a8 as a,a5 as i,a6 as l,a2 as d,aK as u,ay as r,a3 as f,af as _,aL as y,k as p,aM as v}from"./index-Bl2lQPd7.js";import{Q as q}from"./QForm-Dk45GsL9.js";import{q as C}from"./date-C1Mon-Jj.js";import"./format-IcNrutKL.js";const $={data(){return{isPwd:!0,tentative:0,form:{username:null,password:null}}},computed:{...w({user:"user/user",darkMode:"darkMode",ecole:"ecole/info"})},methods:{...g({login:"user/login",getConfig:"user/getConfig",setStore:"user/setStore"}),logo(){if(this.ecole&&this.ecole.logo)return v("m_logo.png")},wait(e){p.set("wait",{time:e,date:new Date})},waitTimeLeft(){let e=p.get("wait");return e?e.time-C.getDateDiff(new Date,new Date(e.date),"seconds"):0},mustWait(){return this.waitTimeLeft()>0},submit(){this.mustWait()?this.$q.notify({color:"warning",message:this.$t("stats.signlater"),position:"bottom",icon:"error_outline",actions:[{label:this.$q.lang.label.close,color:"yellow"}]}):this.$refs.loginForm.validate().then(e=>{if(!e)return this.$q.notify({color:"negative",message:this.$t("stats.fields"),position:"bottom",icon:"error_outline",actions:[{label:this.$q.lang.label.close,color:"yellow"}]}),!1;this.login(this.form).then(()=>{this.getConfig().then(({data:t})=>{parseInt(this.user.active)===1?this.$router.replace(y(t)):this.$q.notify({color:"negative",message:this.$t("stats.verifyit"),position:"bottom",icon:"sentiment_very_dissatisfied",actions:[{label:this.$q.lang.label.close,color:"yellow"}]})})}).catch(()=>{this.tentative+=1,this.$q.notify({color:"negative",message:this.$t("stats.signfail"),position:"bottom",icon:"sentiment_very_dissatisfied",actions:[{label:this.$q.lang.label.close,color:"yellow"}]}),this.tentative>=3&&(this.tentative=0,this.wait(30))})})}}},k={class:"q-pa-lg"},V={key:0,class:"row justify-center items-center q-mb-sm"},x={class:"col-md-12 col-xs-12"},D={class:"col-md-12 col-xs-12"},K={class:"col-md-12 col-xs-12 q-mt-md q-mb-sm"},L={class:"row justify-center items-center q-gutter-md",style:{"margin-bottom":"75px"}};function P(e,t,Q,z,s,n){return c(),m("div",k,[e.ecole?(c(),m("div",V)):b("",!0),a("div",{class:_(["q-ma-lg",{}])},[i(q,{ref:"loginForm",class:"form-group row q-col-gutter-md"},{default:l(()=>[a("div",x,[i(d,{dense:"",label:this.$t("stats.username"),modelValue:s.form.username,"onUpdate:modelValue":t[0]||(t[0]=o=>s.form.username=o),onKeydown:u(n.submit,["enter"]),name:"username",rules:[o=>!!o||"Champ requis"]},{prepend:l(()=>[i(r,{name:"account_circle",size:"sm"})]),_:1},8,["label","modelValue","onKeydown","rules"])]),a("div",D,[i(d,{dense:"",modelValue:s.form.password,"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.password=o),type:s.isPwd?"password":"text",label:this.$t("stats.password"),onKeydown:u(n.submit,["enter"]),name:"password",rules:[o=>!!o||"Champ requis"]},{prepend:l(()=>[i(r,{name:"password",size:"sm"})]),append:l(()=>[i(r,{name:s.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[1]||(t[1]=o=>s.isPwd=!s.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","label","onKeydown","rules"])])]),_:1},512),a("div",K,[i(f,{unelevated:"",rounded:"",size:"lg",class:"full-width",color:"primary",label:this.$t("stats.signin"),onClick:n.submit},null,8,["label","onClick"])])]),a("div",L,[i(f,{dense:"","no-caps":"",icon:"qr_code",flat:"",label:"Sélectionner un établissement",to:"/scan"})])])}const I=h($,[["render",P]]);export{I as default};
