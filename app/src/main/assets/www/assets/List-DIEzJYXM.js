import{Q as W}from"./QBadge-Bjfo5tRO.js";import{_ as z,bt as H,Q as v,S as u,a6 as t,a5 as l,aF as X,a8 as d,a2 as F,aE as h,A as c,C as L,ag as b,a4 as _,R as M,a3 as g,ad as f,ay as U,ab as y,b7 as Y,ax as E,a9 as q,aa as Z,ah as ee,aC as le,af as I,av as D,aG as ae,aD as N,aO as te,aP as oe,B as ne}from"./index-Bl2lQPd7.js";import{Q as P}from"./QItemLabel-BkJiB6aE.js";import{Q as se,a as B}from"./QItem-De3v03wU.js";import{Q as ie}from"./QTooltip-r7WoEuzy.js";import{Q as re}from"./QList-CMzNTEGD.js";import{Q as x}from"./QToolbarTitle-C8APieXG.js";import{Q as T}from"./QToolbar-DR-_wX4W.js";import{C as S}from"./ClosePopup-BY_YGFBZ.js";import ue from"./Edit-B1f7eQdV.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./QForm-Dk45GsL9.js";const de=H({name:"MenuFilter",emits:["filter","update:modelValue"],props:{modelValue:{type:Object,default:()=>({designation:null,prix_min:null,prix_max:null})}},setup(e,{emit:a}){const i=c({designation:null,prix_min:null,prix_max:null});return L(()=>{let r=e.modelValue;i.value={...r}}),{filters:i,onFilter:()=>{i.value.designation&&i.value.designation.length<3||a("update:modelValue",i.value)}}}}),me={class:"row q-col-gutter-sm"},pe={class:"col-12 col-sm-4"},fe={class:"col-12 col-sm-4"},ce={class:"col-12 col-sm-4"};function ge(e,a,i,m,r,k){return u(),v(h,{flat:"",bordered:""},{default:t(()=>[l(X,null,{default:t(()=>[d("div",me,[d("div",pe,[l(F,{modelValue:e.filters.designation,"onUpdate:modelValue":[a[0]||(a[0]=s=>e.filters.designation=s),e.onFilter],label:"Rechercher par désignation","lazy-rules":"",filled:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),d("div",fe,[l(F,{modelValue:e.filters.prix_min,"onUpdate:modelValue":[a[1]||(a[1]=s=>e.filters.prix_min=s),e.onFilter],modelModifiers:{number:!0},label:"Prix minimum",type:"number",dense:"",filled:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),d("div",ce,[l(F,{modelValue:e.filters.prix_max,"onUpdate:modelValue":[a[2]||(a[2]=s=>e.filters.prix_max=s),e.onFilter],modelModifiers:{number:!0},label:"Prix maximum",type:"number",dense:"",filled:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:1})]),_:1})}const ve=z(de,[["render",ge]]),we=H({name:"SnackList",components:{MenuFilter:ve,MenuEdit:ue},setup(){const e=te(),a=oe(),i=c(!1),m=c({designation:null,prix_min:null,prix_max:null}),r=c({page:1,rowsPerPage:10,rowsNumber:0}),k=c(!1),s=c(!1),p=c(null),V=ne(()=>a.state.snack.menus.data),Q=n=>(Object.keys(n).forEach($=>{n[$]===null&&delete n[$]}),n),o=()=>{for(let n in m.value)if(m.value[n])return!0;return!1},C=n=>{r.value.page=n.current_page,r.value.rowsPerPage=n.per_page,r.value.rowsNumber=n.total},w=async()=>{let n=Q({...m.value});try{i.value=!0,await a.dispatch("snack/fetchMenus",{page:r.value.page,filters:n}),C(V.value)}finally{i.value=!1}},O=()=>{r.value.page=1,w()},j=()=>{w()},A=n=>{p.value=n,s.value=!0},R=()=>{p.value=null,s.value=!0},G=()=>{s.value=!1,w(),e.notify({type:"positive",message:`Menu ${p.value?"modifié":"créé"} avec succès`})},J=()=>{p.value=null},K=n=>{e.dialog({title:"Confirmation",message:`Voulez-vous vraiment supprimer le menu "${n.designation}" ?`,cancel:!0,persistent:!0}).onOk(async()=>{try{await a.dispatch("snack/deleteMenu",n.idsnack),e.notify({type:"positive",message:"Menu supprimé avec succès"}),w()}catch{e.notify({type:"negative",message:"Erreur lors de la suppression du menu"})}})};return L(()=>{w(),a.commit("setTitle","Menus")}),{showFilters:k,showEditDialog:s,editingId:p,loading:i,filters:m,pagination:r,menus:V,onFilter:O,onPagination:j,editMenu:A,createMenu:R,onMenuSaved:G,onDialogHide:J,confirmDelete:K,hasFilter:o}}}),ye={class:"q-pa-lg flex flex-center"},Ve={class:"row q-col-gutter-md"},be={class:"col-12"},_e={key:0,class:"row justify-center q-pa-md"},he={key:1,class:"text-center q-pa-md text-grey"},ke={class:"row items-center full-width q-px-sm"},Qe={class:"col"};function Ce(e,a,i,m,r,k){const s=b("ep-pagination"),p=b("ep-footer"),V=b("menu-filter"),Q=b("menu-edit");return u(),_(q,null,[l(le,{class:"page-content"},{default:t(()=>[d("div",ye,[e.menus&&e.menus.current_page?(u(),v(s,{key:0,modelValue:e.menus.current_page,"onUpdate:modelValue":[a[1]||(a[1]=o=>e.menus.current_page=o),e.onPagination],max:e.menus.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:t(()=>[l(g,{flat:"",onClick:a[0]||(a[0]=o=>e.showFilters=!0)},{default:t(()=>[e.hasFilter()?(u(),v(W,{key:0,color:"warning",rounded:"",align:"top"})):M("",!0),l(U,{name:"filter_list"}),f(" Page "+y(e.menus.current_page),1)]),_:1})]),_:1},8,["modelValue","max","onUpdate:modelValue"])):M("",!0)]),d("div",Ve,[d("div",be,[l(h,{flat:"",style:{margin:"0 -8px"}},{default:t(()=>[e.loading?(u(),_("div",_e,[l(Y,{color:"primary",size:"2em"})])):e.menus?.data?.length?(u(),v(re,{key:2,separator:""},{default:t(()=>[l(E),(u(!0),_(q,null,Z(e.menus.data,o=>(u(),v(se,{key:o.idsnack,clickable:"",onClick:C=>e.editMenu(o.idsnack),class:"q-pl-lg"},{default:t(()=>[l(B,null,{default:t(()=>[l(P,{class:"text-weight-medium"},{default:t(()=>[f(y(o.designation),1)]),_:2},1024),l(P,{caption:""},{default:t(()=>[l(U,{name:"payments",size:"xs"}),f(" "+y(o.prix)+" DH ",1)]),_:2},1024),l(P,null,{default:t(()=>[f(y(o.description),1)]),_:2},1024)]),_:2},1024),l(B,{side:""},{default:t(()=>[l(g,{flat:"",round:"",color:"negative",icon:"delete",onClick:ee(C=>e.confirmDelete(o),["stop"])},{default:t(()=>[l(ie,null,{default:t(()=>a[7]||(a[7]=[f("Supprimer")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128)),l(E)]),_:1})):(u(),_("div",he," Aucun menu trouvé "))]),_:1})])])]),_:1}),l(p,{to:"#footer-portal"},{default:t(()=>[d("div",ke,[d("div",Qe,[l(g,{icon:"restaurant_menu",label:"Nouveau Menu",onClick:e.createMenu,flat:""},null,8,["onClick"])])])]),_:1}),l(N,{modelValue:e.showFilters,"onUpdate:modelValue":a[4]||(a[4]=o=>e.showFilters=o),position:"top"},{default:t(()=>[l(h,null,{default:t(()=>[l(T,{class:I({"bg-secondary":!e.filters.active,"bg-positive":e.filters.active,"text-white":!0,"shadow-2":!0})},{default:t(()=>[D(l(g,{flat:"",dense:"",icon:"arrow_back"},null,512),[[S]]),l(x,null,{default:t(()=>a[8]||(a[8]=[f(" Filtres ")])),_:1})]),_:1},8,["class"]),l(V,{modelValue:e.filters,"onUpdate:modelValue":[a[2]||(a[2]=o=>e.filters=o),e.onFilter],onClose:a[3]||(a[3]=o=>e.showFilters=!1)},null,8,["modelValue","onUpdate:modelValue"]),l(ae,{align:"right",class:"bg-white text-teal"},{default:t(()=>[D(l(g,{flat:"",label:"Fermer"},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(N,{modelValue:e.showEditDialog,"onUpdate:modelValue":a[6]||(a[6]=o=>e.showEditDialog=o),onHide:e.onDialogHide,position:"bottom"},{default:t(()=>[l(h,{style:{"min-width":"350px",width:"100%","max-width":"600px"}},{default:t(()=>[l(T,{class:I({"bg-primary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[D(l(g,{flat:"",dense:"",icon:"arrow_back"},null,512),[[S]]),l(x,null,{default:t(()=>[f(y(e.editingId?"Modifier le menu":"Nouveau menu"),1)]),_:1})]),_:1}),e.showEditDialog?(u(),v(Q,{key:0,"menu-id":e.editingId,onSaved:e.onMenuSaved,onCancelled:a[5]||(a[5]=o=>e.showEditDialog=!1)},null,8,["menu-id","onSaved"])):M("",!0)]),_:1})]),_:1},8,["modelValue","onHide"])],64)}const Te=z(we,[["render",Ce]]);export{Te as default};
