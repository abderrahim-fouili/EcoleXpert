import{_ as Q,as as v,h as u,aB as k,a4 as f,S as n,Q as m,R as p,a6 as a,a5 as s,a7 as I,a8 as i,ad as h,ab as l,aF as B,aE as R,at as q,ag as V,az as L,aC as w,a3 as g,ay as z,aA as N,a9 as _,aa as A,aD as P}from"./index-Bl2lQPd7.js";import{Q as E}from"./QPageSticky-adQ0nSeI.js";import{E as D}from"./Header-iKAj_IF4.js";import{Q as F,a as b}from"./QItem-De3v03wU.js";import{Q as c}from"./QItemLabel-BkJiB6aE.js";import{Q as O}from"./QBadge-Bjfo5tRO.js";import{i as T}from"./stomp-SbqQEsfg.js";import"./QHeader-B4MlZ-LM.js";import"./QSpace-CKKoNTi_.js";import"./QToolbar-DR-_wX4W.js";const J={props:["item","stomp"],data(){return{data:null}},methods:{...v({getInfo:"badge/getInfo"}),personAvatar(e){return k(e)},publish(){this.stomp&&(this.stomp.publish({destination:"/topic/"+u+"-scan-admin",body:JSON.stringify({message:this.data.notif})}),this.data.prof&&this.stomp.publish({destination:"/topic/"+u+"-"+this.data.prof.idpers,body:JSON.stringify({message:this.data.notif})}))}},mounted(){this.getInfo(this.item).then(e=>{e&&e.success?(this.data=e.data,this.publish()):e.message&&this.$q.notify(e.message)}),setTimeout(()=>this.$emit("bi:expired",this.item),5e3)}},U=["src"],$={class:"text-weight-bold"};function G(e,t,y,C,o,r){return n(),f("div",null,[o.data?(n(),m(R,{key:0,class:"q-mb-md"},{default:a(()=>[s(F,null,{default:a(()=>[s(b,{avatar:""},{default:a(()=>[s(I,{square:"",size:"lg"},{default:a(()=>[i("img",{src:r.personAvatar(o.data.eleve)},null,8,U)]),_:1})]),_:1}),s(b,null,{default:a(()=>[s(c,{lines:"1"},{default:a(()=>[h(l(o.data.eleve.nom)+" "+l(o.data.eleve.prenom),1)]),_:1}),s(c,{caption:"",lines:"2"},{default:a(()=>[s(O,{color:"secondary"},{default:a(()=>[i("span",$,l(o.data.classe.classe_fr),1)]),_:1})]),_:1}),o.data.prof?(n(),m(c,{key:0,lines:"2"},{default:a(()=>[h(" Prof: "+l(o.data.prof.nom)+" "+l(o.data.prof.prenom),1)]),_:1})):p("",!0)]),_:1})]),_:1}),s(B,{class:"row"},{default:a(()=>t[0]||(t[0]=[i("div",null,"Votre demande a été transmise. Veuillez patienter à la porte de sortie pour retrouver votre enfant.",-1),i("div",{dir:"rtl"}," تم توصيل طلبكم. يرجى الانتظار في باب الخروج لاستقبال طفلكم.",-1)])),_:1})]),_:1})):p("",!0)])}const H=Q(J,[["render",G]]),j={name:"scan",props:["show","value"],components:{EpHeader:D,BadgeItem:H},data(){return{data:[],last:null,stomp:null,message:"",confirm:!1,frontCamera:!1,light:!1,hide:!0,modal:!0,selected:null,log:[]}},computed:{...q({})},methods:{...v({getInfo:"badge/getInfo"}),removeItem(e){console.log("remove",e),this.data.splice(this.data.indexOf(e),1)},toggleCamera(){this.frontCamera=!this.frontCamera,this.frontCamera?QRScanner.useFrontCamera():QRScanner.useBackCamera()},toggleLight(){this.light=!this.light,this.light?QRScanner.enableLight():QRScanner.disableLight()},hideScanner(){QRScanner.destroy(function(e){}),document.body.classList.remove("ecp-scanner"),this.hide=!1,this.$router.push("/admin/badge-list")},scan(){this.message="",this.$q.platform.is.cordova&&(this.$q.platform.is.ios&&QRScanner.prepare((e,t)=>{e&&console.error(e),t.authorized||t.denied}),QRScanner.scan((e,t)=>{e&&(this.message="Scanning failed: "+e._message,console.error(e._message)),console.log(t,e,this.data),!this.data.includes(t)&&t!==this.last&&(this.data.length>=2?(this.data.shift(),this.$nextTick(()=>{this.data.push(t)})):this.data.push(t),this.modal=!0,this.last=t),this.scan()}),document.body.classList.add("ecp-scanner"),this.hide=!0,QRScanner.show())}},mounted(){this.$q.platform.is.cordova&&(QRScanner.prepare((e,t)=>{e&&console.error(e),t.authorized||t.denied}),this.scan()),T(e=>{this.stomp=e})},unmounted(){this.stomp&&this.stomp.deactivate()}},K={class:"bg-transparent fixed-bottom text-white q-pa-sm"},M={class:"reverseorder"};function W(e,t,y,C,o,r){const S=V("badge-item");return n(),f(_,null,[o.hide?(n(),m(N,{key:0,class:"qrscanner"},{default:a(()=>[s(L,null,{default:a(()=>[s(w,null,{default:a(()=>[t[1]||(t[1]=i("div",{style:{"text-align":"center"},class:"bg-transparent"},[i("img",{src:"/logo.png",alt:"logo",style:{width:"50px"}})],-1)),t[2]||(t[2]=i("div",{class:"qrscanner-area2"},null,-1)),s(E,{position:"bottom",offset:[0,10],style:{"z-index":"2"}},{default:a(()=>[s(g,{onClick:r.toggleCamera,fab:"",color:"dark"},{default:a(()=>[s(z,{name:"flip_camera_ios"})]),_:1},8,["onClick"])]),_:1}),i("div",K,[s(g,{icon:"icon_retour_mobile",flat:"",onClick:r.hideScanner},null,8,["onClick"])])]),_:1})]),_:1})]),_:1})):p("",!0),s(P,{modelValue:o.modal,"onUpdate:modelValue":t[0]||(t[0]=d=>o.modal=d),seamless:"",position:"bottom",class:"scan-dialog","auto-close":""},{default:a(()=>[i("div",M,[(n(!0),f(_,null,A(o.data,(d,x)=>(n(),m(S,{key:d+"-"+x,item:d,stomp:o.stomp,"onBi:expired":r.removeItem},null,8,["item","stomp","onBi:expired"]))),128))])]),_:1},8,["modelValue"])],64)}const re=Q(j,[["render",W]]);export{re as default};
