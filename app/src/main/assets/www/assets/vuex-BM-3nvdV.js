import{r as P,t as h,l,a as s,u as g,c as ge,s as M,g as G,b as w,d as L,P as _,e as p,N as c,f as O,h as fe,i as _e,j as pe,k as T,m as $,n as Ee}from"./index-Bl2lQPd7.js";import{q as Se}from"./date-C1Mon-Jj.js";import{p as I}from"./index-DXqHobUu.js";import{a as N}from"./index-B29DxFTF.js";import{f as m}from"./index-C9ZTL5MN.js";import"./format-IcNrutKL.js";import"./index-BXMW6yyY.js";import"./index-CbPSoDvq.js";import"./defineProperty-CfK5lsJW.js";import"./index-QVwDN08p.js";function Te(e){P(1,arguments);var t=h(e),n=t.getDay();return n===0&&(n=7),n}function Re(e,t){P(2,arguments);var n=h(e),r=h(t);return n.getTime()<r.getTime()}const j=()=>({inbox:[],outbox:[],messages:[],read:[],notread:[],stats:null,message:null}),ve=j();function Oe(e){return e.inbox}function ye(e){return e.outbox}function he(e){return e.message}function Ae(e){return e.messages}function be(e,t){return e.stats}function De(e,t){return e.read}function Le(e,t){return e.notread}const $e=Object.freeze(Object.defineProperty({__proto__:null,inbox:Oe,message:he,messages:Ae,notread:Le,outbox:ye,read:De,stats:be},Symbol.toStringTag,{value:"Module"}));function Ie(e,t){e.inbox=t}function Ne(e,t){e.outbox=t}function me(e,t){e.message=t}function Pe(e,t){e.messages=t}function Me(e,t){e.stats=t}function Ge(e,t){e.read=t}function we(e,t){e.notread=t}function je(e){var t=j();e.inbox=t.inbox,e.outbox=t.outbox,e.messages=t.messages,e.message=t.message}const Ce=Object.freeze(Object.defineProperty({__proto__:null,notread:we,read:Ge,reset:je,setInbox:Ie,setMessage:me,setMessages:Pe,setOutbox:Ne,stats:Me},Symbol.toStringTag,{value:"Module"}));function Ue({commit:e}){e("reset")}function Fe({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/messages?mode=1&page="+t+"&"+g(n)).then(r=>(e("setInbox",r.data),r))}function ke({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/messages?mode=2&page="+t+"&"+g(n)).then(r=>(e("setOutbox",r.data),r))}function ze({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/messages?page="+t+"&"+g(n)).then(r=>(e("setMessages",r.data),r))}function Be({commit:e},{page:t,filter:n,form:r}){if(l.isLogged())return s("post","/messages/read?mode=1&page="+t+"&"+g(n),r).then(a=>(e("read",a.data),a))}function xe({commit:e},{page:t,filter:n,form:r}){if(l.isLogged())return s("post","/messages/read?mode=2&page="+t+"&"+g(n),r).then(a=>(e("notread",a.data),a))}function Ve({commit:e},t){if(l.isLogged())return s("post","/messages/stats",t).then(n=>(e("stats",n.data),n))}function Ye({commit:e},{id:t,status:n}){if(l.isLogged())return s("post","/messages/status/"+t+"/"+n).then(r=>r)}function qe({commit:e},t){return e("setMessage",null),s("get","/messages/"+t).then(n=>{var r=n.data;return e("setMessage",r),r})}function He({commit:e},t){return s("post","/messages",t).then(n=>{var r=n.data;return r})}const Ke=Object.freeze(Object.defineProperty({__proto__:null,getInbox:Fe,getMessages:ze,getOutbox:ke,load:qe,notread:xe,read:Be,reset:Ue,send:He,setStatus:Ye,stats:Ve},Symbol.toStringTag,{value:"Module"})),We={namespaced:!0,state:ve,getters:$e,mutations:Ce,actions:Ke},A=()=>({data:[],form:{id:null,code:null,card:null,nom:null,prenom:null,birthdate:Se.formatDate(new Date,"YYYY-MM-DD"),sexe:"M",country_id:null,email:null,gsm:null}}),Je=A(),C=()=>{var e=A();return{globalSettings:null,profile:null,id:null,config:null,organization:null,lang:null,rappel:null,data:[],users:[],nav:[],defaults:{},form:{id:null,username:null,password:null,person_id:null,store_id:null,person:e.form}}};function Qe(e){return e.defaults}function Xe(e){let t=e.config;return t?.meta?.annees?t.meta.annees.find(n=>n.courant===1):null}function Ze(e){return e.globalSettings}function et(e){return e.nav}function tt(e){return e.rappel}function nt(e){return e.profile}function rt(e){return e.config}function at(e){return e.data}function st(e){return e.users}function ot(e){return e.form}function it(e){return e.organization&&e.organization.hasOwnProperty("data")&&typeof e.organization.data=="string"&&(e.organization.data=JSON.parse(e.organization.data)),e.organization}function lt(e){return e.lang}const ut=Object.freeze(Object.defineProperty({__proto__:null,anneeCourante:Xe,config:rt,current:Qe,data:at,form:ot,globalSettings:Ze,lang:lt,nav:et,org:it,rappel:tt,user:nt,users:st},Symbol.toStringTag,{value:"Module"}));function ct(e,t){e.globalSettings=t}function dt(e,t){e.defaults=t}function gt(e,t){e.nav=t}function ft(e,t){e.rappel=t}function _t(e,t){e.id=t.info.id,e.profile=t.info}function pt(e){e.id=null,e.profile=null}function Et(e,t){e.config=t}function St(e,t){e.organization=t}function Tt(e,t){e.lang=t}function Rt(e,t){e.data=t}function vt(e,t){e.users=t}function Ot(e,t){e.form=t}function yt(e,t){e.form.person_id=t.id,e.form.person=t}function ht(e){var t=C();e.form=t.form,e.data=t.data}const At=Object.freeze(Object.defineProperty({__proto__:null,globalSettings:ct,login:_t,logout:pt,nav:gt,newone:yt,rappel:ft,reset:ht,setConfig:Et,setData:Rt,setDefaults:dt,setLang:Tt,setStore:St,setUsers:vt,update:Ot},Symbol.toStringTag,{value:"Module"}));function bt({commit:e},t){return s("put","/pers/"+t.idpers,t).then(n=>{var r=n.data;return r})}function Dt({commit:e},t){return s("post","/settings").then(n=>(e("globalSettings",n.data),n.data))}function Lt({commit:e}){if(l.isLogged())return s("get","/nav").then(({data:t})=>(e("nav",t),t))}function $t({commit:e},t){if(l.isLogged())return s("post","/rappel",t).then(({data:n})=>(e("rappel",n),n))}function It({commit:e},t){if(l.isLogged()){let r={};if(t.meta.hasOwnProperty("eleves")){r.eleve=t.meta.eleves[0];for(var n=0;n<r.eleve.annees.length;n++)r.eleve.annees[n].courant===1&&(r.annee=r.eleve.annees[n]);r.annee||(r.annee=r.eleve.annees[r.eleve.annees.length-1])}else if(t.meta.hasOwnProperty("annees")){if(t.roles.admin)for(var n=0;n<t.meta.annees.length;n++)t.meta.annees[n].courant===1&&(r.annee=t.meta.annees[n]);else if(t.roles.prof){r.classe=t.meta.annees[0];for(var n=0;n<r.classe.annees.length;n++)if(r.classe.annees[n].courant===1){r.annee=r.classe.annees[n];break}r.annee||(r.annee=r.classe.annees[r.classe.annees.length-1]),r.classes=[];for(var n=0;n<t.meta.annees.length;n++)r.annee&&t.meta.annees[n].annees.find(o=>o.idannee===r.annee.idannee)&&r.classes.push(t.meta.annees[n])}}e("setDefaults",r)}}function Nt({commit:e,getters:t},n){if(l.isLogged()){let a=t.current;if(a){a.eleve=n,a.annee=a.eleve.annees[0];for(var r=0;r<a.eleve.annees.length;r++)if(a.eleve.annees[r].courant===1){a.annee=a.eleve.annees[r];break}}e("setDefaults",a)}}function mt({commit:e,getters:t},n){if(l.isLogged()){let a=t.current;if(a){a.classe=n,a.annee=a.classe.annees[0];for(var r=0;r<a.classe.annees.length;r++)if(a.classe.annees[r].courant===1){a.annee=a.classe.annees[r];break}}e("setDefaults",a)}}function Pt({commit:e,getters:t},n){if(l.isLogged()){let r=t.current;r&&(r.annee=n),e("setDefaults",r)}}function Mt({commit:e},t){return s("post","/register-customer",t).then(n=>n)}function Gt({commit:e},t){return s("post","/user/update/"+t.id,t).then(n=>n)}function wt({commit:e},t){return s("get","/register/verify/"+t).then(n=>n)}function jt({commit:e},t){return s("post","/user/reset",t).then(n=>n)}function Ct({commit:e},t){return s("post","/user/reset/verify",t).then(n=>n)}function Ut({commit:e},t){return ge(t.username,t.password).then(n=>{var r=n.data.access_token;return M(r),G().then(a=>{var o={token:r,info:a.data};l.set(o),e("login",o),e("setRefresh",null,{root:!0})})})}function Ft({commit:e}){var t=l.get();return G().then(n=>(t.info=n.data,l.set(t),e("login",t),t))}function kt({commit:e},t){if(t)l.setLang(t),e("setLang",t);else if(l.isLogged()){var n=l.get(),t=w(n.config);l.setLang(org),e("setLang",t)}}function zt({commit:e}){return s("get","/auth/logout").then(t=>(l.isLogged()&&l.clear(),e("logout"),e("setRefresh",null,{root:!0}),L(),t)).catch(t=>(l.isLogged()&&l.clear(),e("logout"),e("setRefresh",null,{root:!0}),L(),t))}function Bt({commit:e}){if(l.isLogged()){var t=l.get();M(t.token),e("login",t),e("setConfig",t.config),e("setLang",w(t.config))}}function xt({commit:e}){if(l.isLogged())return console.log("isLogged"),s("get","/config").then(({data:t})=>{console.log("get/config");var n=l.get();return n.config=t.data,l.set(n),e("setConfig",t.data),t})}function Vt({commit:e}){e("reset")}function Yt({commit:e},{page:t,filter:n,order:r,users:a=!1}){return s("get","/users",{params:{page:t,...n,order:r}}).then(o=>(e(a?"setUsers":"setData",o.data),o))}function qt({commit:e,state:t}){return t.form.id?s("put","/user/"+t.form.id,t.form).then(n=>{var r=n.data;return r}):s("post","/user",t.form).then(n=>{var r=n.data;return r})}function Ht({commit:e},t){return e("update",t)}function Kt({commit:e},t){return s("delete","/user/"+t.id).then(n=>{var r=n.data;return r})}function Wt({commit:e},t){return s("get","/user/view/"+t).then(n=>{var r=n.data;return e("update",r.data),r})}function Jt({commit:e},t){return s("get","/user/permissions/"+t).then(n=>{var r=n.data;return r})}function Qt({commit:e},{id:t,status:n}){return s("post","/user/allow/"+t,{id:t,status:n}).then(r=>{var a=r.data;return a})}function Xt({commit:e},{id:t,org:n,permissions:r}){return s("post","/user/tache/"+t,{id:t,org:n,permissions:r}).then(a=>{var o=a.data;return o})}function Zt({commit:e},{org:t,item:n,permissions:r}){return s("post","/user/attach/"+n.person.id,{org:t,item:n.person.id,permissions:r}).then(a=>{var o=a.data;return o})}function en({commit:e},{org:t,item:n,role:r}){return s("delete","/user/attach/"+n.id,{org:t.id,item:n.id}).then(a=>{var o=a.data;return o})}function tn({commit:e},t){return s("get","/person/new/"+t).then(n=>{var r=n.data;return e("newone",r.data),r})}const nn=Object.freeze(Object.defineProperty({__proto__:null,allow:Qt,attach:Zt,enregistrer:bt,getConfig:xt,getData:Yt,getUserInfo:Ft,getnew:tn,globalSettings:Dt,load:Wt,login:Ut,logout:zt,nav:Lt,permissions:Jt,profileUpdate:Gt,rappel:$t,register:Mt,remove:Kt,removeFrom:en,reset:Vt,resetPasword:jt,save:qt,setAnnee:Pt,setClasse:mt,setDefaults:It,setEleve:Nt,setLang:kt,tache:Xt,update:Ht,verify:Bt,verifyEmail:wt,verifyPassword:Ct},Symbol.toStringTag,{value:"Module"})),rn={namespaced:!0,state:C,getters:ut,mutations:At,actions:nn},U=()=>({data:[]}),an=U();function sn(e){return e.data}const on=Object.freeze(Object.defineProperty({__proto__:null,data:sn},Symbol.toStringTag,{value:"Module"}));function ln(e,t){e.data=t}function un(e){var t=U();e.data=t.data}const cn=Object.freeze(Object.defineProperty({__proto__:null,reset:un,setData:ln},Symbol.toStringTag,{value:"Module"}));function dn({commit:e}){e("reset")}function gn({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/actualite?page="+t+"&"+g(n)).then(r=>(e("setData",r.data),r))}function fn({commit:e},{id:t,status:n}){if(l.isLogged())return s("post","/actualite/status/"+t+"/"+n).then(r=>r)}function _n({commit:e},t){return s("get","/actualite/view/"+t).then(n=>{var r=n.data;return e("update",r.data),r})}const pn=Object.freeze(Object.defineProperty({__proto__:null,getData:gn,load:_n,reset:dn,setStatus:fn},Symbol.toStringTag,{value:"Module"})),En={namespaced:!0,state:an,getters:on,mutations:cn,actions:pn},F=()=>({data:[]}),Sn=F();function Tn(e){return e.data}const Rn=Object.freeze(Object.defineProperty({__proto__:null,data:Tn},Symbol.toStringTag,{value:"Module"}));function vn(e,t){e.data=t}function On(e){var t=F();e.data=t.data}const yn=Object.freeze(Object.defineProperty({__proto__:null,reset:On,setData:vn},Symbol.toStringTag,{value:"Module"}));function hn({commit:e}){e("reset")}function An({commit:e},t){if(l.isLogged())return s("get","/emploi/"+t.idannee+"/"+t.pivot.idclasse).then(n=>(e("setData",n.data),n))}const bn=Object.freeze(Object.defineProperty({__proto__:null,getData:An,reset:hn},Symbol.toStringTag,{value:"Module"})),Dn={namespaced:!0,state:Sn,getters:Rn,mutations:yn,actions:bn},k=()=>({devoirs:null,devoirsAvenir:null,reponses:[],nonfait:[],devoir:null,form:{notReponse:!0,id:null,objet:null,rendre_le:null,descriptif:null,idannee:null,status:0,type:0,obligatoire:0,personne_id:null,classes:[],fichiers:[],reset(){this.id=null,this.objet=null,this.rendre_le=null,this.descriptif=null,this.idannee=null,this.status=0,this.type=0,this.obligatoire=0,this.personne_id=null,this.classes=[],this.fichiers=[]}}}),Ln=k();function $n(e){return e.devoirs}function In(e){return e.devoirsAvenir}function Nn(e){return e.reponses}function mn(e){return e.nonfait}function Pn(e){return e.devoir}function Mn(e){return e.form}const Gn=Object.freeze(Object.defineProperty({__proto__:null,devoir:Pn,devoirs:$n,devoirsAvenir:In,form:Mn,nonfait:mn,reponses:Nn},Symbol.toStringTag,{value:"Module"}));function wn(e,t){e.devoirs=t}function jn(e,t){e.devoirsAvenir=t}function Cn(e,t){e.reponses=t}function Un(e,t){e.nonfait=t}function Fn(e,t){e.devoir=t}function kn(e){var t=k();e.devoir=t.devoir,e.devoirs=t.devoirs,e.reponses=t.reponses}const zn=Object.freeze(Object.defineProperty({__proto__:null,reset:kn,setDevoir:Fn,setDevoirs:wn,setDevoirsAvenir:jn,setDevoirsReponses:Cn,setNonfait:Un},Symbol.toStringTag,{value:"Module"}));function Bn({commit:e}){e("reset")}function xn({commit:e},{page:t,filter:n}){if(l.isLogged())return n.type||(n.type=0),s("get","/devoirs?page="+t+"&"+g(n)).then(r=>(e("setDevoirs",r.data),r))}function Vn({commit:e},{page:t,filter:n}){if(l.isLogged())return n.type=0,s("get","/devoirs/avenir?page="+t+"&"+g(n)).then(r=>(e("setDevoirsAvenir",r.data),r))}function Yn({commit:e},{eleve_id:t,devoir_id:n}){if(l.isLogged())return s("get","/devoirs/reponses/"+n+"/"+t).then(r=>(e("setDevoirsReponses",r.data),r))}function qn({commit:e},t){if(l.isLogged())return s("post","/devoirs/reponses-prof",t).then(n=>(e("setDevoirsReponses",n.data),n))}function Hn({commit:e},{id:t,status:n}){if(l.isLogged())return s("post","/devoirs/status/"+t+"/"+n).then(r=>r)}function Kn({commit:e},t){return e("setDevoir",null),s("get","/devoirs/"+t).then(n=>{var r=n.data;return e("setDevoir",r),r})}function Wn({commit:e},t){return s("post","/devoirs",t).then(n=>{var r=n.data;return r})}function Jn({commit:e},t){return s("post","/devoirs",t).then(n=>{var r=n.data;return r})}function Qn({commit:e},t){return s("put","/devoirs/"+t.id,t).then(n=>{var r=n.data;return r})}function Xn({commit:e},t){return s("post","/devoirs/save-non-fait",t).then(n=>{var r=n.data;return r})}function Zn({commit:e},t){return s("post","/devoirs/non-fait",t).then(n=>{var r=n.data;return e("setNonfait",r),r})}function er({commit:e},t){return s("delete","/devoirs/"+t.id,t).then(n=>{var r=n.data;return r})}const tr=Object.freeze(Object.defineProperty({__proto__:null,create:Jn,getDevoirs:xn,getDevoirsAvenir:Vn,getReponses:Yn,getReponsesProf:qn,load:Kn,nonFait:Zn,remove:er,reset:Bn,saveNonFait:Xn,send:Wn,setStatus:Hn,update:Qn},Symbol.toStringTag,{value:"Module"})),nr={namespaced:!0,state:Ln,getters:Gn,mutations:zn,actions:tr},rr=()=>({info:null,id:null,invoiceSettings:null,badgeSettings:null});function ar(e){return e.info}function sr(e){return e.id}function or(e){return e.invoiceSettings}function ir(e){return e.badgeSettings}const lr=Object.freeze(Object.defineProperty({__proto__:null,badgeSettings:ir,id:sr,info:ar,invoiceSettings:or},Symbol.toStringTag,{value:"Module"})),ur=24*60*60*1e3;function z(){return"ecole_"+p()+"_"}function b(e){return`${z()}${e}`}function B(e){const t=b(e),n=_.getItem(t);if(!n)return null;const{timestamp:r,data:a}=n;return Date.now()-r>ur?(_.remove(t),null):a}function x(e,t){const n=b(e),r={timestamp:Date.now(),data:t};_.set(n,r)}function D(e=null){if(e){const t=b(e);_.remove(t)}else for(let t=0;t<_.length;t++){const n=_.key(t);n&&n.startsWith(z())&&_.remove(n)}}const S={INFO:"info",ID:"id",INVOICE_SETTINGS:"invoice_settings"};function cr(e,t){e.info=t}function dr(e,t){e.id=t}function gr(e,t){e.invoiceSettings=t}function fr(e,t){e.badgeSettings=t}function _r(e){D()}const pr=Object.freeze(Object.defineProperty({__proto__:null,reset:_r,setBadgeSettings:fr,setId:dr,setInfo:cr,setInvoiceSettings:gr},Symbol.toStringTag,{value:"Module"}));function Er({commit:e}){D(),e("reset")}function Sr({commit:e}){const t=B(S.INFO);return t?(e("setInfo",t),Promise.resolve({data:t})):s("get","/info").then(n=>{const r=n.data;return e("setInfo",r),x(S.INFO,r),n}).catch(n=>{throw console.error("Error fetching ecole info:",n),n})}function Tr({commit:e}){const t=B(S.ID);return t?(e("setId",t),Promise.resolve({data:t})):s("get","/ecole-id").then(n=>{const r=n.data;return e("setId",r),x(S.ID,r),n}).catch(n=>{throw console.error("Error fetching ecole ID:",n),n})}function Rr({commit:e}){return s("get","/invoice-settings").then(t=>{const n=t.data.data;return e("setInvoiceSettings",n),t.data}).catch(t=>{if(console.error("Error fetching invoice settings:",t),t.response&&t.response.status===404)return console.warn("Invoice settings not found (404). Committing null."),e("setInvoiceSettings",null),D(S.INVOICE_SETTINGS),{data:null,status:"not_found",message:t.response.data.message||"Settings not found"};throw t})}function vr({commit:e},t){return s("post","/invoice-settings/update",t).then(n=>{const r=n.data.data;return e("setInvoiceSettings",r),n.data}).catch(n=>{throw console.error("Error updating invoice settings:",n),n})}function Or({commit:e},t){return s("post","/invoice-settings/initialize",t).then(n=>{const r=n.data.data;return e("setInvoiceSettings",r),n.data}).catch(n=>{throw console.error("Error initializing invoice settings:",n),n})}function yr({commit:e}){return s("get","/badge-settings").then(t=>{const n=t.data.data;return e("setBadgeSettings",n),t.data}).catch(t=>{if(console.error("Error fetching school badge settings:",t),t.response&&t.response.status===404)return console.warn("School badge settings not found (404). Committing null."),e("setBadgeSettings",null),{data:null,status:"not_found",message:t.response.data.message||"Settings not found"};throw t})}function hr({commit:e},t){return s("post","/badge-settings/update",t).then(n=>{const r=n.data.data;return e("setBadgeSettings",r),n.data}).catch(n=>{throw console.error("Error updating school badge settings:",n),n})}function Ar({commit:e},t){return s("post","/badge-settings/initialize",t).then(n=>{const r=n.data.data;return e("setBadgeSettings",r),n.data}).catch(n=>{throw console.error("Error initializing school badge settings:",n),n})}const br=Object.freeze(Object.defineProperty({__proto__:null,fetchBadgeSettings:yr,fetchInvoiceSettings:Rr,getId:Tr,getInfo:Sr,initializeBadgeSettings:Ar,initializeInvoiceSettings:Or,reset:Er,updateBadgeSettings:hr,updateInvoiceSettings:vr},Symbol.toStringTag,{value:"Module"})),Dr={namespaced:!0,state:rr,getters:lr,mutations:pr,actions:br},V=()=>({notes:[],notesCls:[]}),Lr=V();function $r(e){return e.notes}function Ir(e){return e.notesCls}const Nr=Object.freeze(Object.defineProperty({__proto__:null,notes:$r,notesCls:Ir},Symbol.toStringTag,{value:"Module"}));function mr(e,t){e.notes=t.notes,e.notesCls=t.notesCls}function Pr(e,t){e.notes=t}function Mr(e,t){e.notesCls=t}function Gr(e){var t=V();e.data=t.data}const wr=Object.freeze(Object.defineProperty({__proto__:null,reset:Gr,setData:mr,setNotes:Pr,setNotesCls:Mr},Symbol.toStringTag,{value:"Module"}));function jr({commit:e}){e("reset")}function Cr({commit:e},t){if(l.isLogged())return s("post","/parent/notes",t).then(n=>(e("setData",n.data),n))}const Ur=Object.freeze(Object.defineProperty({__proto__:null,getData:Cr,reset:jr},Symbol.toStringTag,{value:"Module"})),Fr={namespaced:!0,state:Lr,getters:Nr,mutations:wr,actions:Ur},Y=()=>({notifs:null,absences:null,retards:null,form:{id:null,motif:null,du:null,au:null,status:0,personne_id:null}});function kr(e){return e.form}function zr(e){return e.notifs}function Br(e){return e.data}function xr(e){return e.absences}function Vr(e){return e.retards}const Yr=Object.freeze(Object.defineProperty({__proto__:null,absences:xr,data:Br,form:kr,notifs:zr,retards:Vr},Symbol.toStringTag,{value:"Module"}));function qr(e){}function Hr(e){let t=Y();e.form=t.form}function Kr(e,t){e.retards=t}function Wr(e,t){e.absences=t}function Jr(e,t){e.notifs=t}const Qr=Object.freeze(Object.defineProperty({__proto__:null,reset:qr,resetForm:Hr,setAbsences:Wr,setNotifs:Jr,setRetards:Kr},Symbol.toStringTag,{value:"Module"}));function Xr({commit:e}){e("reset")}function Zr({commit:e}){e("resetForm")}function ea({commit:e},{page:t,filter:n}){if(l.isLogged())return s("post","/absences/list?page="+t+"&"+g(n)).then(r=>(e("setAbsences",r.data),r))}function ta({commit:e},{page:t,filter:n}){if(l.isLogged())return s("post","/absences/list?page="+t+"&"+g(n)).then(r=>(e("setRetards",r.data),r))}function na({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/absences?page="+t+"&"+g(n)).then(r=>(e("setNotifs",r.data),r))}function ra({commit:e},t){return s("post","/absences",t).then(n=>{var r=n.data;return r})}function aa({commit:e},t){return s("put","/absences/"+t.id,t).then(n=>{var r=n.data;return r})}function sa({commit:e},t){return s("delete","/absences/"+t.id,t).then(n=>{var r=n.data;return r})}const oa=Object.freeze(Object.defineProperty({__proto__:null,create:ra,getAbsences:ea,getNotifs:na,getRetards:ta,remove:sa,reset:Xr,resetForm:Zr,update:aa},Symbol.toStringTag,{value:"Module"})),ia={settings:[],cycles:[],isLoading:!1,error:null},la={reset(e){e.settings=[],e.cycles=[],e.isLoading=!1,e.error=null},SET_LOADING(e,t){e.isLoading=t},SET_SETTINGS_AND_CYCLES(e,t){e.settings=t.settings||[],e.cycles=t.cycles||[],e.error=null},UPDATE_SETTING(e,{cycleId:t,field:n,value:r}){const a=e.settings.find(o=>o.idcycle===t);if(a)a[n]=r;else{const o={idcycle:t,is_active:!1,morning_execution_time:null,midday_execution_time:null};o[n]=r,e.settings.push(o)}},SET_ERROR(e,t){e.error=t,c.create({type:"negative",message:t||"Une erreur est survenue.",position:"top"})},CLEAR_ERROR(e){e.error=null}},ua={async fetchSettingsAndCycles({commit:e}){e("SET_LOADING",!0),e("CLEAR_ERROR");try{const t=await s("get","/absences/auto-settings/"),n=t.data.cycles||[];let r=t.data.settings||[];const a=n.map(o=>{const i=r.find(u=>u.idcycle===o.idcycle);return i?{...i,morning_execution_time:i.morning_execution_time||null,midday_execution_time:i.midday_execution_time||null}:{idcycle:o.idcycle,cycle:o,is_active:!1,morning_execution_time:null,midday_execution_time:null}});e("SET_SETTINGS_AND_CYCLES",{settings:a,cycles:n})}catch(t){console.error("Error fetching auto absence settings:",t),e("SET_ERROR","Erreur lors du chargement des paramètres d'absence automatique.")}finally{e("SET_LOADING",!1)}},async saveSettings({commit:e,state:t}){e("SET_LOADING",!0),e("CLEAR_ERROR");try{const n=t.settings.map(o=>({idcycle:o.idcycle,is_active:o.is_active,morning_execution_time:o.morning_execution_time?`${o.morning_execution_time}:00`:null,midday_execution_time:o.midday_execution_time?`${o.midday_execution_time}:00`:null})),r=await s("post","/absences/auto-settings/",n);c.create({type:"positive",message:r.data.message||"Paramètres enregistrés avec succès.",position:"top"});const a=r.data.data.map(o=>({...o,morning_execution_time:o.morning_execution_time?o.morning_execution_time.substring(0,5):null,midday_execution_time:o.midday_execution_time?o.midday_execution_time.substring(0,5):null}));e("SET_SETTINGS_AND_CYCLES",{settings:a,cycles:t.cycles})}catch(n){console.error("Error saving auto absence settings:",n);const r=n.response?.data?.message||"Erreur lors de l'enregistrement des paramètres.";if(n.response?.data?.errors){const a=Object.values(n.response.data.errors).flat().join(" ");e("SET_ERROR",`${r} ${a}`)}else e("SET_ERROR",r)}finally{e("SET_LOADING",!1)}}},ca={allSettings:e=>e.settings,allCycles:e=>e.cycles,isLoading:e=>e.isLoading,error:e=>e.error},da={namespaced:!0,state:ia,mutations:la,actions:ua,getters:ca},ga={billetsList:[],pagination:{page:1,rowsPerPage:15,rowsNumber:0,sortBy:"date_billet",descending:!0},currentBillet:null,isLoading:!1,isSubmitting:!1,error:null,studentSearchResults:[]},fa={reset(e){e.billetsList=[],e.pagination={page:1,rowsPerPage:15,rowsNumber:0,sortBy:"date_billet",descending:!0},e.currentBillet=null,e.isLoading=!1,e.isSubmitting=!1,e.error=null,e.studentSearchResults=[]},SET_LOADING(e,t){e.isLoading=t},SET_SUBMITTING(e,t){e.isSubmitting=t},SET_BILLETS(e,t){e.billetsList=t.data,e.pagination.page=t.current_page,e.pagination.rowsPerPage=t.per_page,e.pagination.rowsNumber=t.total,e.error=null},SET_CURRENT_BILLET(e,t){e.currentBillet=t},CLEAR_CURRENT_BILLET(e){e.currentBillet=null},ADD_BILLET(e,t){e.billetsList.unshift(t)},UPDATE_BILLET(e,t){const n=e.billetsList.findIndex(r=>r.idbillet===t.idbillet);n!==-1&&e.billetsList.splice(n,1,t)},REMOVE_BILLET(e,t){const n=e.billetsList.find(r=>r.idbillet===t);n&&(n.active=0)},SET_STUDENT_SEARCH_RESULTS(e,t){e.studentSearchResults=t},SET_PAGINATION(e,{sortBy:t,descending:n,page:r,rowsPerPage:a}){t!==void 0&&(e.pagination.sortBy=t),n!==void 0&&(e.pagination.descending=n),r!==void 0&&(e.pagination.page=r),a!==void 0&&(e.pagination.rowsPerPage=a)},SET_ERROR(e,t){e.error=t,c.create({type:"negative",message:t||"Une erreur est survenue.",position:"top"})},CLEAR_ERROR(e){e.error=null}},_a={async validateBillet({commit:e},t){e("SET_LOADING",!0),e("CLEAR_ERROR");try{return(await s("post",`/absences/billets/validate/${t}`)).data}catch(n){console.error("Error validating billet:",n),e("SET_ERROR","Erreur lors de la validation du billet.")}finally{e("SET_LOADING",!1)}},async fetchBillets({commit:e,state:t},n){e("SET_LOADING",!0),e("CLEAR_ERROR");const r={page:t.pagination.page,per_page:t.pagination.rowsPerPage,sortBy:t.pagination.sortBy,descending:t.pagination.descending,...n};try{const a=await s("get","/absences/billets",{params:r});e("SET_BILLETS",a.data)}catch(a){console.error("Error fetching billets:",a),e("SET_ERROR","Erreur lors du chargement des billets d'excuse.")}finally{e("SET_LOADING",!1)}},async fetchBilletById({commit:e},t){e("SET_LOADING",!0),e("CLEAR_CURRENT_BILLET");try{let r=(await s("get",`/absences/billets/${t}`)).data;if(r.date_billet&&typeof r.date_billet=="string"){const a=new Date(r.date_billet);r.date_billet_date=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,r.date_billet_time=`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`}else if(r.date_billet&&typeof r.date_billet=="number"){const a=String(r.date_billet);a.length>=12&&(r.date_billet_date=`${a.substring(0,4)}-${a.substring(4,6)}-${a.substring(6,8)}`,r.date_billet_time=`${a.substring(8,10)}:${a.substring(10,12)}`)}return e("SET_CURRENT_BILLET",r),r}catch(n){throw console.error("Error fetching billet by ID:",n),e("SET_ERROR","Erreur lors du chargement du billet."),n}finally{e("SET_LOADING",!1)}},async storeBillet({dispatch:e,commit:t},n){t("SET_SUBMITTING",!0),t("CLEAR_ERROR");try{const r=await s("post","/absences/billets/",n,{headers:{"Content-Type":"multipart/form-data"}});return c.create({type:"positive",message:r.data.message}),e("fetchBillets",{}),r.data.data}catch(r){console.error("Error storing billet:",r);const a=r.response?.data?.message||"Erreur lors de la création du billet.";if(r.response?.data?.errors){const o=Object.values(r.response.data.errors).flat().join(" ");t("SET_ERROR",`${a} ${o}`)}else t("SET_ERROR",a);throw r}finally{t("SET_SUBMITTING",!1)}},async updateBillet({dispatch:e,commit:t},{idbillet:n,billetData:r}){t("SET_SUBMITTING",!0),t("CLEAR_ERROR");try{const a=await s("post",`/absences/billets/${n}`,r,{headers:{"Content-Type":"multipart/form-data"}});return c.create({type:"positive",message:a.data.message}),e("fetchBillets",{}),a.data.data}catch(a){console.error("Error updating billet:",a);const o=a.response?.data?.message||"Erreur lors de la mise à jour du billet.";if(a.response?.data?.errors){const i=Object.values(a.response.data.errors).flat().join(" ");t("SET_ERROR",`${o} ${i}`)}else t("SET_ERROR",o);throw a}finally{t("SET_SUBMITTING",!1)}},async destroyBillet({dispatch:e,commit:t},n){t("SET_LOADING",!0),t("CLEAR_ERROR");try{const r=await s("delete",`/absences/billets/${n}`);c.create({type:"positive",message:r.data.message}),t("REMOVE_BILLET",n)}catch(r){throw console.error("Error destroying billet:",r),t("SET_ERROR","Erreur lors de la désactivation du billet."),r}finally{t("SET_LOADING",!1)}},async searchStudents({commit:e,rootGetters:t},n){if(!n||n.length<2){e("SET_STUDENT_SEARCH_RESULTS",[]);return}try{const r=t["user/current"]?.annee?.idannee,{data:a}=await s("get",`/filters/students/${r}`,{params:{term:n}});return e("SET_STUDENT_SEARCH_RESULTS",a.data),a.data}catch(r){return console.error("Error searching students:",r),e("SET_STUDENT_SEARCH_RESULTS",[]),[]}},handleRequestServer({commit:e,dispatch:t},n){const{page:r,rowsPerPage:a,sortBy:o,descending:i}=n.pagination;e("SET_PAGINATION",{page:r,rowsPerPage:a,sortBy:o,descending:i}),t("fetchBillets",n.filter)}},pa={billetsList:e=>e.billetsList,currentBillet:e=>e.currentBillet,pagination:e=>e.pagination,isLoading:e=>e.isLoading,isSubmitting:e=>e.isSubmitting,error:e=>e.error,studentSearchResults:e=>e.studentSearchResults},Ea={namespaced:!0,state:ga,mutations:fa,actions:_a,getters:pa},Sa={absencesList:[],pagination:{page:1,rowsPerPage:15,rowsNumber:0,sortBy:"date_absence",descending:!0},isLoading:!1,isSubmitting:!1,error:null},Ta={reset(e){e.absencesList=[],e.pagination={page:1,rowsPerPage:15,rowsNumber:0,sortBy:"date_absence",descending:!0},e.isLoading=!1,e.isSubmitting=!1,e.error=null},SET_LOADING(e,t){e.isLoading=t},SET_SUBMITTING(e,t){e.isSubmitting=t},SET_ABSENCES(e,t){e.absencesList=t.data,e.pagination.page=t.current_page,e.pagination.rowsPerPage=t.per_page,e.pagination.rowsNumber=t.total,e.error=null},UPDATE_ABSENCE_STATUS(e,{absenceId:t,active:n,send_sms:r,send_email:a,updated_by:o,updated_at:i}){const u=e.absencesList.find(d=>d.id===t);u&&(u.active=n,u.send_sms=r,u.send_email=a,o&&(u.updated_by=o),i&&(u.updated_at=i))},UPDATE_BATCH_ABSENCES_STATUS(e,{absence_ids:t,active:n,send_sms:r,send_email:a,updated_by:o,updated_at:i}){e.absencesList.forEach(u=>{t.includes(u.id)&&(u.active=n,u.send_sms=r,u.send_email=a,o&&(u.updated_by=o),i&&(u.updated_at=i))})},SET_PAGINATION(e,{sortBy:t,descending:n,page:r,rowsPerPage:a}){t!==void 0&&(e.pagination.sortBy=t),n!==void 0&&(e.pagination.descending=n),r!==void 0&&(e.pagination.page=r),a!==void 0&&(e.pagination.rowsPerPage=a)},SET_ERROR(e,t){e.error=t,c.create({type:"negative",message:t||"Une erreur est survenue.",position:"top"})},CLEAR_ERROR(e){e.error=null}},Ra={async fetchAbsencesForValidation({commit:e,state:t},n){e("SET_LOADING",!0),e("CLEAR_ERROR");const r={page:t.pagination.page,per_page:t.pagination.rowsPerPage,...n};try{const a=await s("get","/absence-validation/list",{params:r});e("SET_ABSENCES",a.data)}catch(a){console.error("Error fetching absences for validation:",a);const o=a.response?.data?.message||"Erreur lors du chargement des absences.";if(a.response?.data?.errors){const i=Object.values(a.response.data.errors).flat().join(" ");e("SET_ERROR",`${o} ${i}`)}else e("SET_ERROR",o)}finally{e("SET_LOADING",!1)}},async performSingleValidation({commit:e,dispatch:t},{absenceId:n,validationData:r}){e("SET_SUBMITTING",!0),e("CLEAR_ERROR");try{const a=await s("post",`/absence-validation/${n}/validate`,r);c.create({type:"positive",message:a.data.message});const o=a.data.data;return e("UPDATE_ABSENCE_STATUS",{absenceId:o.id,active:o.active,send_sms:o.send_sms,send_email:o.send_email}),o}catch(a){console.error("Error performing single validation:",a);const o=a.response?.data?.message||"Erreur lors de la validation de l'absence.";throw e("SET_ERROR",o),a}finally{e("SET_SUBMITTING",!1)}},async performBatchValidation({commit:e,dispatch:t},n){e("SET_SUBMITTING",!0),e("CLEAR_ERROR");try{const r=await s("post","/absence-validation/batch-validate",n);return c.create({type:"positive",message:r.data.message}),e("UPDATE_BATCH_ABSENCES_STATUS",{absence_ids:n.absence_ids,active:n.active,send_sms:n.send_sms,send_email:n.send_email}),r.data}catch(r){console.error("Error performing batch validation:",r);const a=r.response?.data?.message||"Erreur lors de la validation groupée des absences.";throw e("SET_ERROR",a),r}finally{e("SET_SUBMITTING",!1)}},handleRequestServer({commit:e,dispatch:t},n){const{page:r,rowsPerPage:a,sortBy:o,descending:i}=n.pagination;e("SET_PAGINATION",{page:r,rowsPerPage:a,sortBy:o,descending:i}),t("fetchAbsencesForValidation",n.filter)}},va={absencesList:e=>e.absencesList,pagination:e=>e.pagination,isLoading:e=>e.isLoading,isSubmitting:e=>e.isSubmitting,error:e=>e.error},Oa={namespaced:!0,state:Sa,mutations:Ta,actions:Ra,getters:va},q={notificationsList:[],pagination:{page:1,rowsPerPage:15,rowsNumber:0,sortBy:"created_at",descending:!0},currentNotification:null,isLoading:!1,isSubmitting:!1,error:null,statusMap:{},studentSearchResults:[]},ya={RESET_STATE(e){e.notificationsList=[],e.pagination={page:1,rowsPerPage:15,rowsNumber:0,sortBy:"created_at",descending:!0},e.currentNotification=null,e.isLoading=!1,e.isSubmitting=!1,e.error=null,e.statusMap={},e.studentSearchResults=[]},SET_LOADING(e,t){e.isLoading=t},SET_SUBMITTING(e,t){e.isSubmitting=t},SET_NOTIFICATIONS(e,t){console.log("Setting notifications..."),e.notificationsList=t.data,console.log("Notifications set"),e.pagination.page=t.current_page,console.log("Page set"),e.pagination.rowsPerPage=t.per_page,console.log("Rows per page set"),e.pagination.rowsNumber=t.total,console.log("Rows number set"),e.error=null,console.log("Error set")},SET_CURRENT_NOTIFICATION(e,t){e.currentNotification=t},UPDATE_NOTIFICATION_IN_LIST(e,t){const n=e.notificationsList.findIndex(r=>r.id===t.id);n!==-1&&e.notificationsList.splice(n,1,t),e.currentNotification&&e.currentNotification.id===t.id&&(e.currentNotification=t)},SET_STATUS_MAP(e,t){e.statusMap=t},SET_STUDENT_SEARCH_RESULTS(e,t){e.studentSearchResults=t},SET_PAGINATION(e,{sortBy:t,descending:n,page:r,rowsPerPage:a}){t!==void 0&&(e.pagination.sortBy=t),n!==void 0&&(e.pagination.descending=n),r!==void 0&&(e.pagination.page=r),a!==void 0&&(e.pagination.rowsPerPage=a)},SET_ERROR(e,t){e.error=t,c.create({type:"negative",message:t?.message||t||"Une erreur est survenue.",position:"top"})},CLEAR_ERROR(e){e.error=null}},ha={async fetchNotifications({commit:e,state:t},n){e("SET_LOADING",!0),e("CLEAR_ERROR");const r={page:t.pagination.page,per_page:t.pagination.rowsPerPage,sortBy:t.pagination.sortBy,descending:t.pagination.descending,...n};try{const a=await s("get","/absence-notifications",{params:r});e("SET_NOTIFICATIONS",a.data)}catch(a){console.error("Error fetching absence notifications:",a),e("SET_ERROR",a.response?.data?.errors||a.response?.data?.message||"Erreur chargement notifications.")}finally{e("SET_LOADING",!1)}},async fetchNotificationById({commit:e},t){e("SET_LOADING",!0),e("CLEAR_ERROR");try{const n=await s("get",`/absence-notifications/${t}`);return e("SET_CURRENT_NOTIFICATION",n.data),n.data}catch(n){throw console.error("Error fetching notification by ID:",n),e("SET_ERROR","Erreur chargement détails notification."),n}finally{e("SET_LOADING",!1)}},async updateNotificationStatus({commit:e},{id:t,status:n}){e("SET_SUBMITTING",!0),e("CLEAR_ERROR");try{const r=await s("put",`/absence-notifications/${t}/status`,{status:n});return e("UPDATE_NOTIFICATION_IN_LIST",r.data.data),c.create({type:"positive",message:r.data.message}),r.data.data}catch(r){console.error("Error updating notification status:",r);const a=r.response?.data;throw e("SET_ERROR",a?.errors||a?.message||"Erreur mise à jour statut."),r}finally{e("SET_SUBMITTING",!1)}},async fetchStatuses({commit:e}){if(Object.keys(q.statusMap).length===0)try{const t=await s("get","/absence-notifications/statuses");e("SET_STATUS_MAP",t.data)}catch(t){console.error("Error fetching statuses:",t)}},async searchStudents({commit:e,rootGetters:t},{term:n,anneeId:r}){if(!n||n.length<2)return e("SET_STUDENT_SEARCH_RESULTS",[]),[];try{const a=r||t["user/currentAnnee"]?.idannee,o={term:n};a&&(o.idannee=a);const i=await s("get","/absence-notifications/search-students",{params:o});return e("SET_STUDENT_SEARCH_RESULTS",i.data),i.data}catch(a){return console.error("Error searching students:",a),e("SET_STUDENT_SEARCH_RESULTS",[]),[]}},handleRequestServer({commit:e,dispatch:t},n){const{page:r,rowsPerPage:a,sortBy:o,descending:i}=n.pagination;e("SET_PAGINATION",{page:r,rowsPerPage:a,sortBy:o,descending:i}),t("fetchNotifications",n.filter)},resetState({commit:e}){e("RESET_STATE")}},Aa={notificationsList:e=>e.notificationsList,currentNotification:e=>e.currentNotification,pagination:e=>e.pagination,isLoading:e=>e.isLoading,isSubmitting:e=>e.isSubmitting,error:e=>e.error,statusMap:e=>e.statusMap,studentSearchResults:e=>e.studentSearchResults},ba={namespaced:!0,state:q,mutations:ya,actions:ha,getters:Aa},Da={namespaced:!0,state:Y,getters:Yr,mutations:Qr,actions:oa,modules:{autoSettings:da,billets:Ea,validation:Oa,notifications:ba}},H=()=>({data:null,certificats:null,form:{id:null,date_demande:null,idcertificate:null,numero:null,idannee:null,idpers:null,date_traitement:null,idadmin:null,status:null,copie:null}});function La(e){return e.form}function $a(e){return e.data}function Ia(e){return e.certificats}const Na=Object.freeze(Object.defineProperty({__proto__:null,certificats:Ia,data:$a,form:La},Symbol.toStringTag,{value:"Module"}));function ma(e){}function Pa(e){let t=H();e.form=t.form}function Ma(e,t){e.data=t}function Ga(e,t){e.certificats=t}const wa=Object.freeze(Object.defineProperty({__proto__:null,reset:ma,resetForm:Pa,setCertificats:Ga,setData:Ma},Symbol.toStringTag,{value:"Module"}));function ja({commit:e}){e("reset")}function Ca({commit:e}){e("resetForm")}function Ua({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/documents?page="+t+"&"+g(n)).then(r=>(e("setData",r.data),r))}function Fa({commit:e}){if(l.isLogged())return s("post","/documents/certificats").then(t=>(e("setCertificats",t.data),t))}function ka({commit:e},t){return s("post","/documents",t).then(n=>{var r=n.data;return r})}function za({commit:e},t){return s("put","/documents/"+t.id,t).then(n=>{var r=n.data;return r})}function Ba({commit:e},t){return s("delete","/documents/"+t.id,t).then(n=>{var r=n.data;return r})}const xa=Object.freeze(Object.defineProperty({__proto__:null,create:ka,getCertificats:Fa,getData:Ua,remove:Ba,reset:ja,resetForm:Ca,update:za},Symbol.toStringTag,{value:"Module"})),Va={namespaced:!0,state:H,getters:Na,mutations:wa,actions:xa},K=()=>({data:null,settings:null,form:{id:null,titre:null,description:null,status:2,type:0,media:0,classes:[],fichiers:[],visibility:[],meta:{user:null,media:[]},reset(){this.id=null,this.titre=null,this.description=null,this.status=2,this.type=0,this.media=0,this.meta={user:null,media:[]},this.visibility=[],this.classes=[],this.fichiers=[]}}});function Ya(e){return e.data}function qa(e){return e.form}function Ha(e){return e.settings}const Ka=Object.freeze(Object.defineProperty({__proto__:null,data:Ya,form:qa,settings:Ha},Symbol.toStringTag,{value:"Module"}));function Wa(e,t){e.data=t}function Ja(e,t){e.settings=t}function Qa(e){var t=K();e.data=t.data,e.settings=t.settings,e.form.reset()}const Xa=Object.freeze(Object.defineProperty({__proto__:null,reset:Qa,setData:Wa,setSettings:Ja},Symbol.toStringTag,{value:"Module"}));function Za({commit:e}){e("reset")}function es({commit:e},{page:t,filter:n}){if(l.isLogged())return s("post","/parent/media?page="+t,n).then(r=>(e("setData",r.data),r))}function ts({commit:e},{page:t,filter:n}){if(l.isLogged())return s("post","/prof/media?page="+t,n).then(r=>(e("setData",r.data),r))}function ns({commit:e}){if(l.isLogged())return s("post","/prof/media/settings").then(t=>(e("setSettings",t.data),t))}function rs({commit:e},t){return s("post","/prof/media/store",t).then(n=>{var r=n.data;return r})}function as({commit:e},t){return s("post","/prof/media/store",t).then(n=>{var r=n.data;return r})}function ss({commit:e},t){return s("post","/prof/media/delete",t).then(n=>{var r=n.data;return r})}const os=Object.freeze(Object.defineProperty({__proto__:null,create:rs,getData:es,getDataProf:ts,getSettings:ns,remove:ss,reset:Za,update:as},Symbol.toStringTag,{value:"Module"})),is={namespaced:!0,state:K,getters:Ka,mutations:Xa,actions:os},W=()=>({data:[],synthese:null,elevesData:null,settings:null});function ls(e){return e.data}function us(e){return e.synthese}function cs(e){return e.elevesData}function ds(e){return e.settings}const gs=Object.freeze(Object.defineProperty({__proto__:null,data:ls,elevesData:cs,settings:ds,synthese:us},Symbol.toStringTag,{value:"Module"}));function fs(e,t){e.data=t.data}function _s(e,t){e.settings=t}function ps(e,t){e.synthese=t}function Es(e){var t=W();e.data=t.data,e.synthese=t.synthese,e.elevesData=t.elevesData}const Ss=Object.freeze(Object.defineProperty({__proto__:null,reset:Es,setData:fs,setSettings:_s,setSynthese:ps},Symbol.toStringTag,{value:"Module"}));function Ts({commit:e}){e("reset")}function Rs({commit:e},t){if(l.isLogged())return s("post","/parent/suivi",t).then(n=>(e("setData",n),n))}function vs({commit:e}){if(l.isLogged())return s("post","/suivi/settings").then(t=>(e("setSettings",t.data),t))}function Os({commit:e},t){if(l.isLogged())return s("post","/suivi/synthese",t).then(n=>(e("setSynthese",n.data),n))}const ys=Object.freeze(Object.defineProperty({__proto__:null,getData:Rs,getSettings:vs,reset:Ts,synthese:Os},Symbol.toStringTag,{value:"Module"})),hs={namespaced:!0,state:W,getters:gs,mutations:Ss,actions:ys},J=()=>({data:null,newData:[],counter:0});function As(e){return e.data}function bs(e){return e.newData}function Ds(e){return e.counter}const Ls=Object.freeze(Object.defineProperty({__proto__:null,counter:Ds,data:As,newData:bs},Symbol.toStringTag,{value:"Module"}));function $s(e,t){e.data=t}function Is(e,t){e.counter=t}function Ns(e,t){e.counter+=t}function ms(e,t){e.newData.push(t)}function Ps(e){var t=J();e.data=t.data}const Ms=Object.freeze(Object.defineProperty({__proto__:null,addCounter:Ns,newData:ms,reset:Ps,setCounter:Is,setData:$s},Symbol.toStringTag,{value:"Module"}));function Gs({commit:e}){e("reset")}function ws({commit:e},t){if(l.isLogged())return s("post","/notifications",t).then(n=>(e("setData",n.data),n))}function js({commit:e},t){e("setCounter",t)}const Cs=Object.freeze(Object.defineProperty({__proto__:null,getData:ws,reset:Gs,setCounter:js},Symbol.toStringTag,{value:"Module"})),Us={namespaced:!0,state:J,getters:Ls,mutations:Ms,actions:Cs},Q=()=>({accs:[]});function Fs(e){return e.accs}const ks=Object.freeze(Object.defineProperty({__proto__:null,accs:Fs},Symbol.toStringTag,{value:"Module"}));function zs(e,t){e.accs=t}function Bs(e){var t=Q();e.info=t.info}const xs=Object.freeze(Object.defineProperty({__proto__:null,reset:Bs,setAccs:zs},Symbol.toStringTag,{value:"Module"}));function Vs({commit:e}){e("reset")}function Ys({commit:e},t){return s("get","/accompagnants?eleve="+t).then(n=>(e("setAccs",n.data),n))}const qs=Object.freeze(Object.defineProperty({__proto__:null,getAccs:Ys,reset:Vs},Symbol.toStringTag,{value:"Module"})),Hs={namespaced:!0,state:Q,getters:ks,mutations:xs,actions:qs},X=()=>({devoirs:null,devoirsAvenir:null,reponses:[],devoir:null}),Ks=X();function Ws(e){return e.devoirs}function Js(e){return e.devoirsAvenir}function Qs(e){return e.reponses}function Xs(e){return e.devoir}const Zs=Object.freeze(Object.defineProperty({__proto__:null,devoir:Xs,devoirs:Ws,devoirsAvenir:Js,reponses:Qs},Symbol.toStringTag,{value:"Module"}));function eo(e,t){e.devoirs=t}function to(e,t){e.devoirsAvenir=t}function no(e,t){e.reponses=t}function ro(e,t){e.devoir=t}function ao(e){var t=X();e.devoir=t.devoir,e.devoirs=t.devoirs,e.reponses=t.reponses}const so=Object.freeze(Object.defineProperty({__proto__:null,reset:ao,setDevoir:ro,setDevoirs:eo,setDevoirsAvenir:to,setDevoirsReponses:no},Symbol.toStringTag,{value:"Module"}));function oo({commit:e}){e("reset")}function io({commit:e},{page:t,filter:n}){if(l.isLogged())return n.type||(n.type=0),s("get","/devoirs?page="+t+"&"+g(n)).then(r=>(e("setDevoirs",r.data),r))}function lo({commit:e},{page:t,filter:n}){if(l.isLogged())return n.type=0,s("get","/devoirs/avenir?page="+t+"&"+g(n)).then(r=>(e("setDevoirsAvenir",r.data),r))}function uo({commit:e},{eleve_id:t,devoir_id:n}){if(l.isLogged())return s("get","/devoirs/reponses/"+n+"/"+t).then(r=>(e("setDevoirsReponses",r.data),r))}function co({commit:e},{id:t,status:n}){if(l.isLogged())return s("post","/devoirs/status/"+t+"/"+n).then(r=>r)}function go({commit:e},t){return e("setDevoir",null),s("get","/devoirs/"+t).then(n=>{var r=n.data;return e("setDevoir",r),r})}function fo({commit:e},t){return s("post","/devoirs",t).then(n=>{var r=n.data;return r})}const _o=Object.freeze(Object.defineProperty({__proto__:null,getDevoirs:io,getDevoirsAvenir:lo,getReponses:uo,load:go,reset:oo,send:fo,setStatus:co},Symbol.toStringTag,{value:"Module"})),po={namespaced:!0,state:Ks,getters:Zs,mutations:so,actions:_o},Z=()=>({data:null});function Eo(e){return e.data}const So=Object.freeze(Object.defineProperty({__proto__:null,data:Eo},Symbol.toStringTag,{value:"Module"}));function To(e,t){e.data=t}function Ro(e){var t=Z();e.data=t.data}const vo=Object.freeze(Object.defineProperty({__proto__:null,reset:Ro,setData:To},Symbol.toStringTag,{value:"Module"}));function Oo({commit:e}){e("reset")}function yo({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/infractions?page="+t+"&"+g(n)).then(r=>(e("setData",r.data),r))}const ho=Object.freeze(Object.defineProperty({__proto__:null,getData:yo,reset:Oo},Symbol.toStringTag,{value:"Module"})),Ao={namespaced:!0,state:Z,getters:So,mutations:vo,actions:ho};function bo(){return{}}const Do=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));function Lo(e){}const $o=Object.freeze(Object.defineProperty({__proto__:null,reset:Lo},Symbol.toStringTag,{value:"Module"}));function Io({commit:e},t){return s("post","/badge/info",{code:t}).then(n=>n.data)}function No({commit:e},t){return s("post","/badge/data",t).then(n=>n.data)}function mo({commit:e},t){return s("post","/badge/valid",{id:t}).then(n=>n.data)}const Po=Object.freeze(Object.defineProperty({__proto__:null,getData:No,getInfo:Io,valid:mo},Symbol.toStringTag,{value:"Module"})),Mo={namespaced:!0,state:bo,getters:Do,mutations:$o,actions:Po},ee=()=>({data:null,parks:null,activeTrip:{id:null,idauto:null,idannee:null,trip_type:null,status:"PLANNED",students:{},error:null,loading:!1,studentsLastKnownLocation:[]},lastTrip:{id:null,idauto:null,idannee:null,trip_type:null,status:"PLANNED",students:{},error:null,loading:!1,events:[]}});function Go(e){return e.data}function wo(e){return e.activeTrip}function jo(e){return e.activeTrip.id!==null&&e.activeTrip.status==="IN_PROGRESS"}function Co(e){return!0}function Uo(e){return t=>e.activeTrip.students[t]?.actual_status||"PENDING"}function Fo(e){return t=>e.lastTrip.students[t]?.actual_status||"PENDING"}function ko(e){return t=>e.activeTrip.id!==null&&e.activeTrip.idauto===t&&e.activeTrip.status==="IN_PROGRESS"}const zo=Object.freeze(Object.defineProperty({__proto__:null,activeTrip:wo,allStudentsAreProcessed:Co,data:Go,getStudentLastTripStatus:Fo,getStudentStatus:Uo,hasActiveTripForAuto:ko,isTripInProgress:jo},Symbol.toStringTag,{value:"Module"}));function Bo(e,t){e.data=t}function xo(e,t){e.parks=t}function Vo(e){Object.assign(e,ee())}function Yo(e,t){e.activeTrip.loading=t,e.activeTrip.error=null}function qo(e,t){e.activeTrip.id=t.id,e.activeTrip.idauto=t.idauto,e.activeTrip.idannee=t.idannee,e.activeTrip.trip_type=t.trip_type,e.activeTrip.status=t.status,e.activeTrip.students={},t.students&&Object.keys(t.students).length>0&&Object.keys(t.students).forEach(n=>{const r=t.students[n];e.activeTrip.students[r.student_idpers]={actual_status:r.actual_status||"PENDING",pickup_event_id:r.pickup_event_id||null,dropoff_event_id:r.dropoff_event_id||null,student_idpers:r.student_idpers}}),e.activeTrip.studentsLastKnownLocation=t.studentsLastKnownLocation,e.activeTrip.loading=!1,e.activeTrip.error=null}function Ho(e){e.activeTrip.id=null,e.activeTrip.idauto=null,e.activeTrip.idannee=null,e.activeTrip.trip_type=null,e.activeTrip.status="PLANNED",e.activeTrip.students={},e.activeTrip.loading=!1,e.activeTrip.error=null}function Ko(e,t){e.activeTrip.status=t,e.activeTrip.loading=!1}function Wo(e,{studentId:t,status:n,eventId:r,eventType:a}){e.activeTrip.students[t]&&(e.activeTrip.students[t].actual_status=n,a==="PICKUP"&&r?e.activeTrip.students[t].pickup_event_id=r:a==="DROPPED_OFF"&&r&&(e.activeTrip.students[t].dropoff_event_id=r)),e.activeTrip.loading=!1}function Jo(e,t){e.activeTrip.error=t,e.activeTrip.loading=!1}function Qo(e,t){e.lastTrip.loading=t,e.lastTrip.error=null}function Xo(e,t){e.lastTrip.id=t.id,e.lastTrip.idauto=t.idauto,e.lastTrip.idannee=t.idannee,e.lastTrip.trip_type=t.trip_type,e.lastTrip.status=t.status,e.lastTrip.students={},t.students&&Object.keys(t.students).length>0&&Object.keys(t.students).forEach(n=>{const r=t.students[n];e.lastTrip.students[r.student_idpers]={actual_status:r.actual_status||"PENDING",pickup_event_id:r.pickup_event_id||null,dropoff_event_id:r.dropoff_event_id||null,student_idpers:r.student_idpers}}),e.lastTrip.events=t.events,e.lastTrip.loading=!1,e.lastTrip.error=null}function Zo(e){e.lastTrip.id=null,e.lastTrip.idauto=null,e.lastTrip.idannee=null,e.lastTrip.trip_type=null,e.lastTrip.status="PLANNED",e.lastTrip.students={},e.lastTrip.loading=!1,e.lastTrip.error=null,e.lastTrip.events=[]}function ei(e,t){e.lastTrip.error=t,e.lastTrip.loading=!1}const ti=Object.freeze(Object.defineProperty({__proto__:null,clearActiveTrip:Ho,clearLastTrip:Zo,reset:Vo,setActiveTrip:qo,setActiveTripError:Jo,setActiveTripLoading:Yo,setActiveTripStatus:Ko,setData:Bo,setLastTrip:Xo,setLastTripError:ei,setLastTripLoading:Qo,setParks:xo,updateStudentStatus:Wo},Symbol.toStringTag,{value:"Module"}));function ni({commit:e}){e("reset")}async function ri({commit:e},t){if(l.isLogged()){e("setLastTripLoading",!0);try{const n=await s("get","/transport/last-trip/"+t);n.data&&n.data.id?e("setLastTrip",n.data):e("clearLastTrip")}catch(n){console.error("Error loading active trip:",n),e("setLastTripError","Erreur chargement trajet actif."),e("clearLastTrip")}finally{e("setLastTripLoading",!1)}}}async function ai({commit:e}){if(l.isLogged())try{const t=await s("get","/transport/parks");t.data&&t.data.length&&e("setParks",t.data)}catch(t){console.log("Error loading parks:",t),e("setActiveTripError","Erreur lors du chargements des parks auto")}}function si({commit:e},t){return l.isLogged()?(O.show(),s("get","/park"+(t?"?idauto="+t:"")).then(n=>(e("setData",n.data),O.hide(),n)).catch(n=>{throw console.error("Error fetching park data:",n),c.create({type:"negative",message:"Erreur de chargement des données."}),O.hide(),n})):(c.create({type:"warning",message:"Utilisateur non connecté."}),Promise.reject("User not logged in"))}async function oi({commit:e,rootGetters:t}){if(l.isLogged()){e("setActiveTripLoading",!0);try{const n=await s("get","/transport/active-trip");n.data&&n.data.id?e("setActiveTrip",n.data):e("clearActiveTrip")}catch(n){console.error("Error loading active trip:",n),e("setActiveTripError","Erreur chargement trajet actif."),e("clearActiveTrip")}finally{e("setActiveTripLoading",!1)}}}async function ii({commit:e,rootGetters:t},{idauto:n,tripType:r,location:a}){if(!l.isLogged())return c.create({type:"warning",message:"Utilisateur non connecté."}),Promise.reject("User not logged in");e("setActiveTripLoading",!0);try{const o=t["user/anneeCourante"],i={idauto:n,idannee:o?o.idannee:null,trip_type:r,start_latitude:a?.latitude,start_longitude:a?.longitude};if(!i.idannee)throw new Error("Année scolaire courante non trouvée.");if(!a)throw new Error("Localisation requise pour démarrer.");const u=await s("post","/transport/trips",i);e("setActiveTrip",u.data),c.create({type:"positive",message:"Trajet démarré !"})}catch(o){throw console.error("Error starting trip:",o),e("setActiveTripError",o.message||"Erreur démarrage trajet."),c.create({type:"negative",message:`Erreur démarrage trajet: ${o.message||"Inconnue"}`}),e("clearActiveTrip"),o}finally{e("setActiveTripLoading",!1)}}async function li({commit:e,state:t},{eventType:n,studentId:r,location:a}){if(!t.activeTrip.id)return c.create({type:"warning",message:"Aucun trajet actif."}),Promise.reject("No active trip");e("setActiveTripLoading",!0);let o="",i=!1;switch(n){case"PICKUP":o="PICKED_UP",i=!0;break;case"DROPPED_OFF":o="DROPPED_OFF",i=!0;break;case"BUS_STOP":o="BUS_STOPPED",i=!0;break;case"STUDENT_ABSENT":o="ABSENT",i=!1;break;default:return c.create({type:"negative",message:"Type d'événement inconnu."}),e("setActiveTripLoading",!1),Promise.reject("Unknown event type")}if(i&&!a)return c.create({type:"negative",message:"Localisation requise pour cet événement."}),e("setActiveTripLoading",!1),Promise.reject("Location required");try{const u={student_idpers:r,event_type:n,latitude:a?.latitude,longitude:a?.longitude,accuracy:a?.accuracy},f=(await s("post",`/transport/trips/${t.activeTrip.id}/events`,u)).data?.id||null;e("updateStudentStatus",{studentId:r,status:o,eventId:f,eventType:n}),c.create({type:"positive",message:"Événement enregistré."})}catch(u){throw console.error(`Error recording event ${n}:`,u),c.create({type:"negative",message:`Erreur enregistrement: ${u.message||"Inconnue"}`}),e("setActiveTripError",`Erreur event ${n}: ${u.message||"Inconnue"}`),u}finally{e("setActiveTripLoading",!1)}}async function ui({commit:e,state:t},{location:n}){if(!t.activeTrip.id||t.activeTrip.status!=="IN_PROGRESS")return c.create({type:"warning",message:"Aucun trajet en cours à terminer."}),Promise.reject("No trip in progress");if(e("setActiveTripLoading",!0),!n)return c.create({type:"negative",message:"Localisation requise pour terminer."}),e("setActiveTripLoading",!1),Promise.reject("Location required");try{const r={end_latitude:n?.latitude,end_longitude:n?.longitude,status:"COMPLETED"};await s("put",`/transport/trips/${t.activeTrip.id}`,r),e("setActiveTripStatus","COMPLETED"),c.create({type:"positive",message:"Trajet terminé."}),setTimeout(()=>e("clearActiveTrip"),2e3)}catch(r){throw console.error("Error ending trip:",r),c.create({type:"negative",message:`Erreur fin trajet: ${r.message||"Inconnue"}`}),e("setActiveTripError",`Erreur fin trajet: ${r.message||"Inconnue"}`),r}finally{e("setActiveTripLoading",!1)}}async function ci({commit:e},t){try{await s("post","/transport/notification",t),c.create({type:"positive",message:"Notification envoyée."})}catch(n){throw console.error("Error sending notification:",n),c.create({type:"negative",message:`Erreur envoi notification: ${n.message||"Inconnue"}`}),e("setActiveTripError",`Erreur envoi notification: ${n.message||"Inconnue"}`),n}}function di({commit:e},t){return s("post","/park/valid",t).then(n=>n.data)}const gi=Object.freeze(Object.defineProperty({__proto__:null,endTrip:ui,getData:si,getLastTrip:ri,getParcks:ai,loadActiveTrip:oi,recordEvent:li,reset:ni,sendNotification:ci,startTrip:ii,valid:di},Symbol.toStringTag,{value:"Module"})),fi={namespaced:!0,state:ee,getters:zo,mutations:ti,actions:gi},te=()=>({absences:[],appel:null,form:{eleves:[],seance:null,annee:null,classe:null}});function _i(e){return e.form}function pi(e){return e.data}function Ei(e){return e.absences}function Si(e){return e.appel}const Ti=Object.freeze(Object.defineProperty({__proto__:null,absences:Ei,appel:Si,data:pi,form:_i},Symbol.toStringTag,{value:"Module"}));function Ri(e){}function vi(e){let t=te();e.form=t.form}function Oi(e,t){e.absences=t}function yi(e,t){e.appel=t}const hi=Object.freeze(Object.defineProperty({__proto__:null,reset:Ri,resetForm:vi,setAbsences:Oi,setAppel:yi},Symbol.toStringTag,{value:"Module"}));function Ai({commit:e}){e("reset")}function bi({commit:e}){e("resetForm")}function Di({commit:e},t){if(l.isLogged())return s("post","/prof/absences",t).then(n=>(e("setAbsences",n.data),n))}function Li({commit:e},t){if(l.isLogged())return s("post","/prof/absences/appel",t).then(n=>(e("setAppel",n.data),n))}function $i({commit:e},t){return s("post","/prof/absences/store",t).then(n=>{var r=n.data;return r})}function Ii({commit:e},t){return s("post","/prof/absences/store",t).then(n=>{var r=n.data;return r})}function Ni({commit:e},t){return s("delete","/prof/absences",t).then(n=>{var r=n.data;return r})}const mi=Object.freeze(Object.defineProperty({__proto__:null,create:$i,getAbsences:Di,getAppel:Li,remove:Ni,reset:Ai,resetForm:bi,update:Ii},Symbol.toStringTag,{value:"Module"})),Pi={namespaced:!0,state:te,getters:Ti,mutations:hi,actions:mi},ne=()=>({absences:[],appel:null,form:{eleves:[],seance:null,annee:null,classe:null}});function Mi(e){return e.form}function Gi(e){return e.data}function wi(e){return e.absences}function ji(e){return e.appel}const Ci=Object.freeze(Object.defineProperty({__proto__:null,absences:wi,appel:ji,data:Gi,form:Mi},Symbol.toStringTag,{value:"Module"}));function Ui(e){}function Fi(e){let t=ne();e.form=t.form}function ki(e,t){e.absences=t}function zi(e,t){e.appel=t}const Bi=Object.freeze(Object.defineProperty({__proto__:null,reset:Ui,resetForm:Fi,setAbsences:ki,setAppel:zi},Symbol.toStringTag,{value:"Module"}));function xi({commit:e}){e("reset")}function Vi({commit:e}){e("resetForm")}function Yi({commit:e},t){if(l.isLogged())return s("post","/prof/absences",t).then(n=>(e("setAbsences",n.data),n))}function qi({commit:e},t){if(l.isLogged())return s("post","/prof/absences/appel",t).then(n=>(e("setAppel",n.data),n))}function Hi({commit:e},t){return s("post","/prof/absences/store",t).then(n=>{var r=n.data;return r})}function Ki({commit:e},t){return s("post","/prof/absences/store",t).then(n=>{var r=n.data;return r})}function Wi({commit:e},t){return s("delete","/prof/absences",t).then(n=>{var r=n.data;return r})}const Ji=Object.freeze(Object.defineProperty({__proto__:null,create:Hi,getAbsences:Yi,getAppel:qi,remove:Wi,reset:xi,resetForm:Vi,update:Ki},Symbol.toStringTag,{value:"Module"})),Qi={namespaced:!0,state:ne,getters:Ci,mutations:Bi,actions:Ji},re=()=>({data:[],seances:[],seance:null}),Xi=re();function Zi(e){return e.data}function el(e){return e.seances}function tl(e){return e.seance}const nl=Object.freeze(Object.defineProperty({__proto__:null,data:Zi,seance:tl,seances:el},Symbol.toStringTag,{value:"Module"}));function rl(e,t){e.data=t}function al(e,t){e.seances=t}function sl(e,t){e.seance=t}function ol(e){var t=re();e.data=t.data}const il=Object.freeze(Object.defineProperty({__proto__:null,reset:ol,setData:rl,setSeance:sl,setSeances:al},Symbol.toStringTag,{value:"Module"}));function ll({commit:e}){e("reset")}function ul({commit:e},t){if(l.isLogged())return s("post","/prof/emploi",t).then(n=>(e("setData",n.data),n))}function cl({commit:e},t){if(l.isLogged())return s("post","/prof/seances",t).then(n=>(e("setSeances",n.data),n))}const dl=Object.freeze(Object.defineProperty({__proto__:null,getData:ul,getSeances:cl,reset:ll},Symbol.toStringTag,{value:"Module"})),gl={namespaced:!0,state:Xi,getters:nl,mutations:il,actions:dl},ae=()=>({settings:null,devoirs:null,devoirsAvenir:null,reponses:[],nonfait:[],devoir:null,form:{notReponse:!0,id:null,titre:null,date_ds:null,description:null,idannee:null,discipline:null,status:0,type:0,classes:[],fichiers:[],reset(){this.id=null,this.titre=null,this.date_ds=null,this.description=null,this.discipline=null,this.idannee=null,this.status=0,this.type=0,this.classes=[],this.fichiers=[]}}}),fl=ae();function _l(e){return e.devoirs}function pl(e){return e.settings}function El(e){return e.devoirsAvenir}function Sl(e){return e.reponses}function Tl(e){return e.nonfait}function Rl(e){return e.devoir}function vl(e){return e.form}const Ol=Object.freeze(Object.defineProperty({__proto__:null,devoir:Rl,devoirs:_l,devoirsAvenir:El,form:vl,nonfait:Tl,reponses:Sl,settings:pl},Symbol.toStringTag,{value:"Module"}));function yl(e,t){e.settings=t}function hl(e,t){e.devoirs=t}function Al(e,t){e.devoirsAvenir=t}function bl(e,t){e.reponses=t}function Dl(e,t){e.nonfait=t}function Ll(e,t){e.devoir=t}function $l(e){var t=ae();e.form.reset(),e.devoir=t.devoir,e.devoirs=t.devoirs,e.reponses=t.reponses,e.settings=t.settings}const Il=Object.freeze(Object.defineProperty({__proto__:null,reset:$l,setDevoir:Ll,setDevoirs:hl,setDevoirsAvenir:Al,setDevoirsReponses:bl,setNonfait:Dl,setSettings:yl},Symbol.toStringTag,{value:"Module"}));function Nl({commit:e}){e("reset")}function ml({commit:e}){if(l.isLogged())return s("post","/ds/settings").then(t=>(e("setSettings",t.data),t))}function Pl({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/ds?page="+t+"&"+g(n)).then(r=>(e("setDevoirs",r.data),r))}function Ml({commit:e},{page:t,filter:n}){if(l.isLogged())return n.type=0,s("get","/ds/avenir?page="+t+"&"+g(n)).then(r=>(e("setDevoirsAvenir",r.data),r))}function Gl({commit:e},{eleve_id:t,devoir_id:n}){if(l.isLogged())return s("get","/ds/reponses/"+n+"/"+t).then(r=>(e("setDevoirsReponses",r.data),r))}function wl({commit:e},t){if(l.isLogged())return s("post","/ds/reponses-prof",t).then(n=>(e("setDevoirsReponses",n.data),n))}function jl({commit:e},{id:t,status:n}){if(l.isLogged())return s("post","/ds/valider/"+t,{status:n}).then(r=>r)}function Cl({commit:e},t){return e("setDevoir",null),s("get","/ds/"+t).then(n=>{var r=n.data;return e("setDevoir",r),r})}function Ul({commit:e},t){return s("post","/ds",t).then(n=>{var r=n.data;return r})}function Fl({commit:e},t){return s("post","/ds",t).then(n=>{var r=n.data;return r})}function kl({commit:e},t){return s("put","/ds/"+t.id,t).then(n=>{var r=n.data;return r})}function zl({commit:e},t){return s("post","/ds/save-non-fait",t).then(n=>{var r=n.data;return r})}function Bl({commit:e},t){return s("post","/ds/non-fait",t).then(n=>{var r=n.data;return e("setNonfait",r),r})}function xl({commit:e},t){return s("delete","/ds/"+t.id,t).then(n=>{var r=n.data;return r})}function Vl({commit:e},t){return s("post","/ds/valider/"+t,{}).then(n=>n.data)}const Yl=Object.freeze(Object.defineProperty({__proto__:null,create:Fl,getDevoirs:Pl,getDevoirsAvenir:Ml,getReponses:Gl,getReponsesProf:wl,getSettings:ml,load:Cl,nonFait:Bl,remove:xl,reset:Nl,saveNonFait:zl,send:Ul,setStatus:jl,update:kl,valider:Vl},Symbol.toStringTag,{value:"Module"})),ql={namespaced:!0,state:fl,getters:Ol,mutations:Il,actions:Yl},se=()=>({bilan:null,notes:null,eleves:[]}),Hl=se();function Kl(e){return e.bilan}function Wl(e){return e.eleves}function Jl(e){return e.notes}const Ql=Object.freeze(Object.defineProperty({__proto__:null,bilan:Kl,eleves:Wl,notes:Jl},Symbol.toStringTag,{value:"Module"}));function Xl(e,t){e.bilan=t}function Zl(e,t){e.eleves=t}function eu(e,t){e.notes=t}function tu(e){var t=se();e.bilan=t.bilan,e.eleves=t.eleves,e.notes=t.notes}const nu=Object.freeze(Object.defineProperty({__proto__:null,reset:tu,setBilan:Xl,setEleves:Zl,setNotes:eu},Symbol.toStringTag,{value:"Module"}));function ru({commit:e}){e("reset")}function au({commit:e},t){if(l.isLogged())return s("post","/stats/synthese",t).then(n=>(e("setBilan",n.data),n))}function su({commit:e},t){if(l.isLogged())return s("post","/stats/eleves",t).then(n=>(e("setEleves",n.data),n))}function ou({commit:e},t){if(l.isLogged())return s("post","/stats/notes",t).then(n=>(e("setNotes",n.data),n))}const iu=Object.freeze(Object.defineProperty({__proto__:null,getBilan:au,getEleves:su,getNotes:ou,reset:ru},Symbol.toStringTag,{value:"Module"})),lu={namespaced:!0,state:Hl,getters:Ql,mutations:nu,actions:iu},v=()=>({data:null,form:{idreclamation:null,ideleve:null,idreclamateur:null,objet:null,contenu:null,status:1,idclasse:null,idannee:null,idrole:null,idtarget:null,reset(){this.id=null,this.ideleve=null,this.idreclamateur=null,this.objet=null,this.contenu=null,this.status=1,this.idclasse=null,this.idannee=null,this.idrole=null,this.idtarget=null}}}),uu=v();function cu(e){return e.data}function du(e){return e.form}const gu=Object.freeze(Object.defineProperty({__proto__:null,data:cu,form:du},Symbol.toStringTag,{value:"Module"}));function fu(e,t){e.data=t}function _u(e,t){e.form=t}function pu(e){e.form=v().form}function Eu(e){var t=v();e.form=t.form,e.data=t.data}const Su=Object.freeze(Object.defineProperty({__proto__:null,reset:Eu,resetForm:pu,setData:fu,setForm:_u},Symbol.toStringTag,{value:"Module"}));function Tu({commit:e}){e("reset")}function Ru({commit:e},{page:t,filter:n}){if(l.isLogged())return s("get","/reclamations?page="+t+"&"+g(n)).then(r=>(e("setData",r.data),r))}function vu({commit:e},t){return e("setForm",null),s("get","/reclamations/"+t).then(n=>{var r=n.data;return e("setForm",r),r})}function Ou({commit:e},t){return s("post","/reclamations",t).then(n=>{var r=n.data;return r})}function yu({commit:e},t){for(let n in t){let r=!1;for(let a in v().form)if(n===a){r=!0;break}r||delete t[n]}return s("put","/reclamations/"+t.idreclamation,t).then(n=>{var r=n.data;return r})}function hu({commit:e},t){return s("delete","/reclamations/"+t.idreclamation,t).then(n=>{var r=n.data;return r})}const Au=Object.freeze(Object.defineProperty({__proto__:null,getData:Ru,remove:hu,reset:Tu,save:Ou,update:yu,view:vu},Symbol.toStringTag,{value:"Module"})),bu={namespaced:!0,state:uu,getters:gu,mutations:Su,actions:Au};function Du(e){return e.data}function Lu(e){return e.form}const $u=Object.freeze(Object.defineProperty({__proto__:null,data:Du,form:Lu},Symbol.toStringTag,{value:"Module"}));function Iu(e,t){e.data=t}function Nu(e,t){e.form=t}function mu(e){var t=A();e.form=t.form,e.data=t.data}const Pu=Object.freeze(Object.defineProperty({__proto__:null,reset:mu,setData:Iu,update:Nu},Symbol.toStringTag,{value:"Module"}));function Mu({commit:e}){e("reset")}function Gu({commit:e},{page:t,filter:n}){return console.log(n,g(n)),s("get","/person?page="+t+"&"+g(n)).then(r=>(e("setData",r.data),r))}function wu({commit:e,state:t}){return t.form.id?s("put","/person/"+t.form.id,t.form).then(n=>{var r=n.data;return r}):s("post","/person",t.form).then(n=>{var r=n.data;return r})}function ju({commit:e},t){return e("update",t)}function Cu({commit:e},t){return s("delete","/person/"+t.id).then(n=>{var r=n.data;return r})}function Uu({commit:e},t){return s("get","/person/view/"+t).then(n=>{var r=n.data;return e("update",r.data),r})}const Fu=Object.freeze(Object.defineProperty({__proto__:null,getData:Gu,load:Uu,remove:Cu,reset:Mu,save:wu,update:ju},Symbol.toStringTag,{value:"Module"})),ku={namespaced:!0,state:Je,getters:$u,mutations:Pu,actions:Fu};function oe(){return{menus:{data:[],loading:!1,error:null,pagination:{current_page:1,per_page:15,total:0,last_page:1},filters:{},cache:{byId:{},timestamp:null,expiresIn:5*60*1e3}},ordres:{data:[],loading:!1,error:null,pagination:{current_page:1,per_page:15,total:0,last_page:1},filters:{},cache:{byId:{},timestamp:null,expiresIn:5*60*1e3}},solde:{data:0,loading:!1,error:null,cache:{byId:{},timestamp:null,expiresIn:5*60*1e3}},menuCache:{},ordreCache:{}}}const zu=e=>t=>!t||!e.menus.data||!e.menus.data.data?null:e.menus.data.data.find(n=>n.idsnack===parseInt(t)),Bu=e=>t=>e.ordres.data.filter(n=>n.idpers===t),xu=e=>e.menus.data.filter(t=>t.active===1),Vu=e=>e.menus.pagination.total,Yu=e=>e.ordres.pagination.total,qu=Object.freeze(Object.defineProperty({__proto__:null,activeMenus:xu,menuById:zu,ordresByPerson:Bu,totalMenuCount:Vu,totalOrdreCount:Yu},Symbol.toStringTag,{value:"Module"})),R=e=>!e||typeof e!="string"||!e.startsWith(p())?!1:new RegExp(`^${p()}_(menu|order)_\\d+$`).test(e),ie=e=>{if(!e||typeof e!="object"||!e.menu&&!e.order||!e.timestamp||e.menu&&(!e.menu.idsnack||!e.menu.designation)||e.order&&(!e.order.idorder||!e.order.status))return!1;const t=parseInt(e.timestamp);return!(isNaN(t)||t>Date.now())},Hu=e=>{try{const t=JSON.parse(e);return ie(t)?t:null}catch(t){return console.warn("Failed to parse cache data:",t),null}},E={get:e=>{try{if(!R(`${p()}_${e}`))return null;const t=localStorage.getItem(`${p()}_${e}`);return t?Hu(t):null}catch(t){return console.warn("Cache get operation failed:",t),null}},set:(e,t,n)=>{try{if(!R(`${p()}_${e}`))return!1;const r={[e.startsWith("menu_")?"menu":"order"]:t,timestamp:n||Date.now()};return ie(r)?(localStorage.setItem(`${p()}_${e}`,JSON.stringify(r)),!0):!1}catch(r){return console.warn("Cache set operation failed:",r),!1}},remove:e=>{try{return R(`${p()}_${e}`)?(localStorage.removeItem(`${p()}_${e}`),!0):!1}catch(t){return console.warn("Cache remove operation failed:",t),!1}},clear:()=>{try{return Object.keys(localStorage).filter(t=>R(t)).forEach(t=>localStorage.removeItem(t)),!0}catch(e){return console.warn("Cache clear operation failed:",e),!1}}};function Ku(e){let t=oe();Object.assign(e.menus,t.menus),Object.assign(e.ordres,t.ordres)}const Wu=(e,t)=>{e.menus.data=t},Ju=(e,t)=>{e.menus.loading=t},Qu=(e,t)=>{e.menus.error=t},Xu=(e,t)=>{e.menus.filters=t},Zu=(e,t)=>{e.menus.pagination=t},ec=(e,t)=>{e.ordres.data=t},tc=(e,t)=>{e.ordres.loading=t},nc=(e,t)=>{e.ordres.error=t},rc=(e,t)=>{e.ordres.filters=t},ac=(e,t)=>{e.ordres.pagination=t},sc=(e,t)=>{e.menus.data.data||(e.menus.data.data=[]);const n=e.menus.data.data.findIndex(r=>r.idsnack===t.idsnack);n!==-1?e.menus.data.data.splice(n,1,t):e.menus.data.data.push(t)},oc=(e,t)=>{e.menus.cache.byId[t.idsnack]=t,e.menus.cache.timestamp=Date.now(),E.set(t.idsnack,t,e.menus.cache.timestamp)},ic=(e,{id:t,data:n})=>{e.menus.cache.byId[t]=n,e.menus.cache.timestamp=Date.now()},lc=e=>{e.menus.cache.byId={},e.menus.cache.timestamp=null,E.clear()},uc=(e,t)=>{e.ordres.data.data||(e.ordres.data.data=[]);const n=e.ordres.data.data.findIndex(r=>r.idorder===t.idorder);n!==-1?e.ordres.data.data.splice(n,1,t):e.ordres.data.data.push(t)},cc=(e,t)=>{e.ordres.cache||(e.ordres.cache={byId:{},timestamp:null,expiresIn:5*60*1e3}),e.ordres.cache.byId[t.idorder]=t,e.ordres.cache.timestamp=Date.now(),E.set(`order_${t.idorder}`,t,e.ordres.cache.timestamp)},dc=(e,{id:t,data:n})=>{e.ordres.cache||(e.ordres.cache={byId:{},timestamp:null,expiresIn:5*60*1e3}),e.ordres.cache.byId[t]=n,e.ordres.cache.timestamp=Date.now()},gc=e=>{e.ordres.cache&&(e.ordres.cache.byId={},e.ordres.cache.timestamp=null);try{Object.keys(localStorage).filter(t=>t.startsWith(`${fe}_order_`)).forEach(t=>localStorage.removeItem(t))}catch(t){console.warn("Failed to clear order cache from localStorage:",t)}},fc=(e,t)=>{e.solde.data=t},_c=(e,t)=>{e.solde.loading=t},pc=(e,t)=>{e.solde.error=t},Ec=(e,t)=>{e.ordres.loading=t},Sc=(e,t)=>{e.ordres.error=t},Tc=Object.freeze(Object.defineProperty({__proto__:null,ADD_OR_UPDATE_MENU:sc,ADD_OR_UPDATE_ORDER:uc,CACHE_MENU:oc,CACHE_ORDER:cc,CLEAR_MENU_CACHE:lc,CLEAR_ORDER_CACHE:gc,LOAD_CACHED_MENU:ic,LOAD_CACHED_ORDER:dc,SET_MENUS:Wu,SET_MENUS_ERROR:Qu,SET_MENUS_FILTERS:Xu,SET_MENUS_LOADING:Ju,SET_MENUS_PAGINATION:Zu,SET_ORDER_ERROR:Sc,SET_ORDER_LOADING:Ec,SET_ORDRES:ec,SET_ORDRES_ERROR:nc,SET_ORDRES_FILTERS:rc,SET_ORDRES_LOADING:tc,SET_ORDRES_PAGINATION:ac,SET_SOLDE:fc,SET_SOLDE_ERROR:pc,SET_SOLDE_LOADING:_c,reset:Ku},Symbol.toStringTag,{value:"Module"})),Rc=e=>{const t=E.get(e);return t?Date.now()-t.timestamp<5*60*1e3?t.menu:(E.remove(e),null):null},vc=async({commit:e,state:t},{page:n=1,per_page:r=15,filters:a={}}={})=>{try{e("SET_MENUS_LOADING",!0),e("SET_MENUS_ERROR",null);const o=await s("get","/snack/menus",{params:{page:n,per_page:r,...a,...t.menus.filters}});return e("SET_MENUS",o.data),e("SET_MENUS_PAGINATION",{current_page:o.data.current_page,per_page:o.data.per_page,total:o.data.total,last_page:o.data.last_page}),o.data}catch(o){e("SET_MENUS_ERROR",o.message)}finally{e("SET_MENUS_LOADING",!1)}},Oc=async({commit:e,dispatch:t},n)=>{try{e("SET_MENUS_LOADING",!0),e("SET_MENUS_ERROR",null);const r=await s("post","/snack/menus",n);return t("clearMenuCache"),r}catch(r){throw e("SET_MENUS_ERROR",r.message),r}finally{e("SET_MENUS_LOADING",!1)}},yc=async({commit:e,dispatch:t},n)=>{try{e("SET_MENUS_LOADING",!0),e("SET_MENUS_ERROR",null);let{id:r}=n;const a=await s("put",`/snack/menus/${r}`,n);return t("clearMenuCache"),a}catch(r){throw e("SET_MENUS_ERROR",r.message),r}finally{e("SET_MENUS_LOADING",!1)}},hc=async({commit:e,dispatch:t},n)=>{try{e("SET_MENUS_LOADING",!0),e("SET_MENUS_ERROR",null),await s("delete",`/snack/menus/${n}`),t("clearMenuCache")}catch(r){throw e("SET_MENUS_ERROR",r.message),r}finally{e("SET_MENUS_LOADING",!1)}},Ac=async({commit:e,state:t},{page:n=1,filters:r={}}={})=>{try{e("SET_ORDRES_LOADING",!0),e("SET_ORDRES_ERROR",null);const a=await s("get","/snack/ordres",{params:{page:n,...r,...t.ordres.filters}});return e("SET_ORDRES",a.data.data),e("SET_ORDRES_PAGINATION",{current_page:a.data.current_page,per_page:a.data.per_page,total:a.data.total,last_page:a.data.last_page}),a.data}catch(a){e("SET_ORDRES_ERROR",a.message)}finally{e("SET_ORDRES_LOADING",!1)}},bc=async({commit:e},t)=>{try{return e("SET_ORDRES_LOADING",!0),e("SET_ORDRES_ERROR",null),await s("post","/snack/ordres",t)}catch(n){throw e("SET_ORDRES_ERROR",n.message),n}finally{e("SET_ORDRES_LOADING",!1)}},Dc=async({commit:e},{id:t,data:n})=>{try{return e("SET_ORDRES_LOADING",!0),e("SET_ORDRES_ERROR",null),await s("put",`/snack/ordres/${t}`,n)}catch(r){throw e("SET_ORDRES_ERROR",r.message),r}finally{e("SET_ORDRES_LOADING",!1)}},Lc=async({commit:e},t)=>{try{e("SET_ORDRES_LOADING",!0),e("SET_ORDRES_ERROR",null),await s("delete",`/snack/ordres/${t}`)}catch(n){throw e("SET_ORDRES_ERROR",n.message),n}finally{e("SET_ORDRES_LOADING",!1)}},$c=({commit:e},t)=>{e("SET_MENUS_FILTERS",t)},Ic=({commit:e},t)=>{e("SET_ORDRES_FILTERS",t)},Nc=async({commit:e,state:t},n)=>{try{const r=t.menus.cache.byId[n];if(r&&t.menus.cache.timestamp&&Date.now()-t.menus.cache.timestamp<t.menus.cache.expiresIn)return r;const a=Rc(n);if(a)return e("LOAD_CACHED_MENU",{id:n,data:a}),a;e("SET_MENUS_LOADING",!0),e("SET_MENUS_ERROR",null);let i=(await s("get",`/snack/menus/${n}`)).data;return e("CACHE_MENU",i),e("ADD_OR_UPDATE_MENU",i),i}catch(r){throw e("SET_MENUS_ERROR",r.message),r}finally{e("SET_MENUS_LOADING",!1)}},mc=async({commit:e,state:t},n)=>{try{const r=t.ordres?.cache?.byId?.[n];if(r&&t.ordres?.cache?.timestamp&&Date.now()-t.ordres.cache.timestamp<t.ordres.cache.expiresIn)return r;const a=E.get(`order_${n}`);if(a)return e("LOAD_CACHED_ORDER",{id:n,data:a.order}),a.order;e("SET_ORDERS_LOADING",!0),e("SET_ORDERS_ERROR",null);let i=(await s("get",`/snack/ordres/${n}`)).data;return e("CACHE_ORDER",i),e("ADD_OR_UPDATE_ORDER",i),i}catch(r){throw e("SET_ORDERS_ERROR",r.message),r}finally{e("SET_ORDERS_LOADING",!1)}},Pc=async({commit:e},t)=>{try{e("SET_SOLDE_LOADING",!0),e("SET_SOLDE_ERROR",null);const n=await s("get",`/snack/solde/${t}`);return e("SET_SOLDE",n.data.solde),n.data}catch(n){throw e("SET_SOLDE_ERROR",n.message),n}finally{e("SET_SOLDE_LOADING",!1)}},Mc=async({commit:e,dispatch:t},n)=>{try{e("SET_ORDER_LOADING",!0),e("SET_ORDER_ERROR",null);const r=await s("post","/snack/ordres",n);return n.user_id&&await t("fetchSolde",n.user_id),r}catch(r){throw e("SET_ORDER_ERROR",r.message),r}finally{e("SET_ORDER_LOADING",!1)}},Gc=({commit:e})=>{e("CLEAR_MENU_CACHE")};async function wc({commit:e}){try{const{data:t}=await s("get","/snack/dashboard");return t}catch(t){throw t}}const jc=Object.freeze(Object.defineProperty({__proto__:null,clearMenuCache:Gc,createMenu:Oc,createOrdre:bc,deleteMenu:hc,deleteOrdre:Lc,fetchMenuById:Nc,fetchMenus:vc,fetchOrderById:mc,fetchOrdres:Ac,fetchSolde:Pc,getDashboardData:wc,placeOrder:Mc,updateMenu:yc,updateMenuFilters:$c,updateOrdre:Dc,updateOrdreFilters:Ic},Symbol.toStringTag,{value:"Module"})),Cc={namespaced:!0,state:oe,getters:qu,mutations:Tc,actions:jc};function le(){return{geoData:null,loading:!1,error:null}}function Uc(e){return e.geoData}function Fc(e){return e.loading}function kc(e){return e.error}function zc(e){return e.geoData!==null}const Bc=Object.freeze(Object.defineProperty({__proto__:null,error:kc,geoData:Uc,hasLocation:zc,loading:Fc},Symbol.toStringTag,{value:"Module"}));function xc(e){let t=le();Object.assign(e,t)}function Vc(e,t){e.geoData=t}function Yc(e,t){e.loading=t}function qc(e,t){e.error=t}const Hc=Object.freeze(Object.defineProperty({__proto__:null,reset:xc,setError:qc,setGeoData:Vc,setLoading:Yc},Symbol.toStringTag,{value:"Module"}));async function Kc({commit:e}){e("setLoading",!0),e("setError",null);try{const{data:t}=await s("get","/ecole-geo");e("setGeoData",t)}catch(t){throw e("setError",t.response?.data?.message||"Erreur lors de la récupération des données"),t}finally{e("setLoading",!1)}}async function Wc({commit:e},t){e("setLoading",!0),e("setError",null);try{const{data:n}=await s("post","/ecole-geo",t);return e("setGeoData",n),n}catch(n){throw e("setError",n.response?.data?.message||"Erreur lors de la sauvegarde des données"),n}finally{e("setLoading",!1)}}async function Jc({commit:e}){e("setLoading",!0),e("setError",null);try{await s("delete","/ecole-geo"),e("setGeoData",null)}catch(t){throw e("setError",t.response?.data?.message||"Erreur lors de la suppression des données"),t}finally{e("setLoading",!1)}}const Qc=Object.freeze(Object.defineProperty({__proto__:null,deleteGeoData:Jc,fetchGeoData:Kc,saveGeoData:Wc},Symbol.toStringTag,{value:"Module"})),Xc={namespaced:!0,state:le,getters:Bc,mutations:Hc,actions:Qc},Zc={notifications:[],loading:!1,error:null,filters:{type:null,status:null,date:null,date_range:null,eleve:null,eleve_nom:null,search:null},pagination:{current_page:1,per_page:15,total:0}},ed={reset(e){Object.assign(e,{notifications:[],loading:!1,error:null,filters:{type:null,status:null,date:null,date_range:null,eleve:null,eleve_nom:null,search:null},pagination:{current_page:1,per_page:15,total:0}})},SET_NOTIFICATIONS(e,t){e.notifications=t},SET_LOADING(e,t){e.loading=t},SET_ERROR(e,t){e.error=t},SET_FILTER(e,{filter:t,value:n}){e.filters[t]=n},RESET_FILTERS(e){Object.keys(e.filters).forEach(t=>{e.filters[t]=null})},SET_PAGINATION(e,t){e.pagination={...e.pagination,...t}},UPDATE_NOTIFICATION(e,t){const n=e.notifications.findIndex(r=>r.id===t.id);n!==-1&&e.notifications.splice(n,1,t)}};function ue(){return"notifications_"+p()+"_"}function td(e){return`${ue()}${e}`}function y(e=null){if(e){const t=td(e);_.remove(t)}else for(let t=0;t<_.length;t++){const n=_.key(t);n.startsWith(ue())&&_.remove(n)}}const nd={NOTIFICATIONS:"notifications"},rd={async fetchNotifications({commit:e,state:t}){try{e("SET_LOADING",!0),e("SET_ERROR",null);const n={...t.filters,page:t.pagination.current_page,per_page:t.pagination.per_page};Object.keys(n).forEach(a=>{n[a]===null&&delete n[a]});const r=await s("get","/notifications-sortie",{params:n});e("SET_NOTIFICATIONS",r.data.data),e("SET_PAGINATION",{current_page:r.data.current_page,total:r.data.total})}catch(n){throw e("SET_ERROR",n.response?.data?.message||"Error fetching notifications"),n}finally{e("SET_LOADING",!1)}},setFilter({commit:e,dispatch:t},{filter:n,value:r}){e("SET_FILTER",{filter:n,value:r}),e("SET_PAGINATION",{current_page:1})},resetFilters({commit:e,dispatch:t}){return e("RESET_FILTERS"),e("SET_PAGINATION",{current_page:1}),y(),t("fetchNotifications")},resetCache({commit:e}){y()},setPage({commit:e,dispatch:t},n){return e("SET_PAGINATION",{current_page:n}),t("fetchNotifications")},async updateNotification({commit:e,dispatch:t},{id:n,data:r}){try{e("SET_ERROR",null);const a=await s("put",`/notifications-sortie/${n}`,r);return e("UPDATE_NOTIFICATION",a.data),y(nd.NOTIFICATIONS),a.data}catch(a){throw e("SET_ERROR",a.response?.data?.message||"Error updating notification"),a}}},ad={notifications:e=>e.notifications,loading:e=>e.loading,error:e=>e.error,filters:e=>e.filters,pagination:e=>e.pagination,activeFilters:e=>Object.entries(e.filters).filter(([t,n])=>n!==null).reduce((t,[n,r])=>(t[n]=r,t),{}),hasActiveFilters:(e,t)=>Object.keys(t.activeFilters).length>0,lastNotification:e=>e.notifications.length>0?e.notifications[0]:null},sd={namespaced:!0,state:Zc,mutations:ed,actions:rd,getters:ad};function od(){return{payments:{data:[],loading:!1,error:null,filters:{},cache:{byId:{},timestamp:null,expiresIn:5*60*1e3}},transaction:{data:null,loading:!1,error:null}}}const id=e=>e.payments.data||[],ld=e=>e.payments.loading,ud=e=>e.payments.error,cd=e=>e.payments.filters,dd=e=>t=>e.payments.data.filter(n=>n.ideleve===t),gd=e=>e.transaction.data||null,fd=e=>e.transaction.loading,_d=e=>e.transaction.error,pd=Object.freeze(Object.defineProperty({__proto__:null,error:ud,filters:cd,loading:ld,payments:id,paymentsByEleve:dd,transaction:gd,transactionError:_d,transactionLoading:fd},Symbol.toStringTag,{value:"Module"})),Ed=(e,t)=>{e.payments.data=t},Sd=(e,t)=>{e.payments.loading=t},Td=(e,t)=>{e.payments.error=t},Rd=(e,t)=>{e.payments.filters=t},vd=(e,t)=>{e.transaction.data=t},Od=(e,t)=>{e.transaction.loading=t},yd=(e,t)=>{e.transaction.error=t},hd=e=>{},Ad=Object.freeze(Object.defineProperty({__proto__:null,SET_PAYMENTS:Ed,SET_PAYMENTS_ERROR:Td,SET_PAYMENTS_FILTERS:Rd,SET_PAYMENTS_LOADING:Sd,SET_TRANSACTION:vd,SET_TRANSACTION_ERROR:yd,SET_TRANSACTION_LOADING:Od,reset:hd},Symbol.toStringTag,{value:"Module"})),bd=({commit:e},t)=>(e("SET_PAYMENTS_LOADING",!0),e("SET_PAYMENTS_ERROR",null),s("post","/pay",t).then(n=>{e("SET_PAYMENTS",n.data),e("SET_PAYMENTS_LOADING",!1)}).catch(n=>{e("SET_PAYMENTS_ERROR",n),e("SET_PAYMENTS_LOADING",!1)})),Dd=({commit:e},t)=>(e("SET_TRANSACTION_LOADING",!0),e("SET_TRANSACTION_ERROR",null),s("post","/pay/transaction",t).then(n=>{e("SET_TRANSACTION",n.data),e("SET_TRANSACTION_LOADING",!1)}).catch(n=>{e("SET_TRANSACTION_ERROR",n),e("SET_TRANSACTION_LOADING",!1)})),Ld=({commit:e},t)=>(e("SET_TRANSACTION_LOADING",!0),e("SET_TRANSACTION_ERROR",null),s("post","/pay/transaction/status",t).then(n=>{e("SET_TRANSACTION",n.data),e("SET_TRANSACTION_LOADING",!1)}).catch(n=>{e("SET_TRANSACTION_ERROR",n),e("SET_TRANSACTION_LOADING",!1)})),$d=Object.freeze(Object.defineProperty({__proto__:null,createTransaction:Dd,getPayments:bd,setTransactionStatus:Ld},Symbol.toStringTag,{value:"Module"})),Id={namespaced:!0,state:od,getters:pd,mutations:Ad,actions:$d};function Nd(){return{grades:{data:{data:[]},loading:!1,error:null,pagination:{current_page:1,per_page:15,total:0,last_page:1},filters:{}},settings:{data:null,loading:!1,error:null},eleves:{data:[],loading:!1,error:null},elevesSansNotes:{data:[],loading:!1,error:null}}}const md=e=>t=>!t||!e.grades.data||!e.grades.data.data?null:e.grades.data.data.find(n=>n.idgrade===parseInt(t)),Pd=e=>e.grades.pagination.total,Md=e=>e.settings.data,Gd=e=>e.grades.data.data,wd=e=>e.grades.loading,jd=e=>e.grades.error,Cd=e=>e.grades.filters,Ud=e=>e.grades.pagination,Fd=e=>e.eleves.data,kd=e=>e.eleves.loading,zd=e=>e.eleves.error,Bd=e=>e.elevesSansNotes.data,xd=e=>e.elevesSansNotes.loading,Vd=e=>e.elevesSansNotes.error,Yd=Object.freeze(Object.defineProperty({__proto__:null,eleves:Fd,elevesError:zd,elevesLoading:kd,elevesSansNotes:Bd,elevesSansNotesError:Vd,elevesSansNotesLoading:xd,gradeById:md,grades:Gd,gradesError:jd,gradesFilters:Cd,gradesLoading:wd,gradesPagination:Ud,settings:Md,totalGradesCount:Pd},Symbol.toStringTag,{value:"Module"})),qd=(e,t)=>{e.grades.data=t},Hd=(e,t)=>{e.grades.loading=t},Kd=(e,t)=>{e.grades.error=t},Wd=(e,t)=>{e.grades.filters=t},Jd=(e,t)=>{e.grades.pagination=t},Qd=(e,t)=>{e.grades.data?.data||(e.grades.data.data=[]);const n=e.grades.data.data.findIndex(r=>r.idnote===t.idnote);n!==-1?e.grades.data.data.splice(n,1,t):e.grades.data.data.push(t)},Xd=(e,t)=>{for(const n in t)e.grades.filters[n]=t[n]},Zd=(e,t)=>{const{[t]:n,...r}=e.grades.filters;e.grades.filters=r},eg=(e,t)=>{console.log(t),e.settings.data=t},tg=(e,t)=>{e.settings.loading=t},ng=(e,t)=>{e.settings.error=t},rg=(e,t)=>{e.eleves.data=t},ag=(e,t)=>{e.eleves.loading=t},sg=(e,t)=>{e.eleves.error=t},og=(e,t)=>{e.elevesSansNotes.data=t},ig=(e,t)=>{e.elevesSansNotes.loading=t},lg=(e,t)=>{e.elevesSansNotes.error=t},ug=e=>{e.grades.data={data:[],pagination:{page:1,perPage:10,total:0},filters:{}},e.grades.loading=!1,e.grades.error=null,e.grades.filters={},e.grades.pagination={page:1,perPage:10,total:0},e.settings.data=null,e.settings.loading=!1,e.settings.error=null,e.eleves.data=[],e.eleves.loading=!1,e.eleves.error=null,e.elevesSansNotes.data=[],e.elevesSansNotes.loading=!1,e.elevesSansNotes.error=null},cg=Object.freeze(Object.defineProperty({__proto__:null,ADD_FILTER:Xd,ADD_OR_UPDATE_GRADE:Qd,REMOVE_FILTER:Zd,SET_ELEVES:rg,SET_ELEVES_ERROR:sg,SET_ELEVES_LOADING:ag,SET_ELEVES_SANS_NOTES:og,SET_ELEVES_SANS_NOTES_ERROR:lg,SET_ELEVES_SANS_NOTES_LOADING:ig,SET_GRADES:qd,SET_GRADES_ERROR:Kd,SET_GRADES_FILTERS:Wd,SET_GRADES_LOADING:Hd,SET_GRADES_PAGINATION:Jd,SET_GRADES_SETTINGS:eg,SET_GRADES_SETTINGS_ERROR:ng,SET_GRADES_SETTINGS_LOADING:tg,reset:ug},Symbol.toStringTag,{value:"Module"})),dg=async({commit:e,state:t},{filters:n={}})=>{try{e("SET_GRADES_LOADING",!0),e("SET_GRADES_ERROR",null);const r=t.grades.pagination?.current_page||1,a=t.grades.pagination?.per_page||10,o=await s("get","/grades",{params:{page:r,per_page:a,...n,...t.grades.filters}});return console.log(o.data),e("SET_GRADES",o.data),e("SET_GRADES_PAGINATION",{current_page:o.data.current_page,per_page:o.data.per_page,total:o.data.total,last_page:o.data.last_page}),o.data}catch(r){throw e("SET_GRADES_ERROR",r.message),r}finally{e("SET_GRADES_LOADING",!1)}},gg=async({commit:e},t)=>{try{e("SET_GRADES_SETTINGS_LOADING",!0),e("SET_GRADES_SETTINGS_ERROR",null);const n=await s("get","/grades/settings",{params:t});return e("SET_GRADES_SETTINGS",n.data),n.data}catch(n){throw e("SET_GRADES_SETTINGS_ERROR",n.message),n}finally{e("SET_GRADES_SETTINGS_LOADING",!1)}},fg=async({commit:e},t)=>{try{e("SET_ELEVES_LOADING",!0),e("SET_ELEVES_ERROR",null);const n=await s("get","/grades/eleves",{params:t});return e("SET_ELEVES",n.data),n.data}catch(n){throw e("SET_ELEVES_ERROR",n.message),n}finally{e("SET_ELEVES_LOADING",!1)}},_g=async({commit:e},{note:t})=>{try{e("SET_ELEVES_SANS_NOTES_LOADING",!0),e("SET_ELEVES_SANS_NOTES_ERROR",null);const n=await s("get","/grades/eleves-sans-note/"+t);return e("SET_ELEVES_SANS_NOTES",n.data),n.data}catch(n){throw e("SET_ELEVES_SANS_NOTES_ERROR",n.message),n}finally{e("SET_ELEVES_SANS_NOTES_LOADING",!1)}},pg=async({commit:e},t)=>{try{return e("SET_GRADES_LOADING",!0),e("SET_GRADES_ERROR",null),await s("post","/grades",t)}catch(n){throw e("SET_GRADES_ERROR",n.message),n}finally{e("SET_GRADES_LOADING",!1)}},Eg=async({commit:e},{id:t,data:n})=>{try{return e("SET_GRADES_LOADING",!0),e("SET_GRADES_ERROR",null),await s("put",`/grades/${t}`,n)}catch(r){throw e("SET_GRADES_ERROR",r.message),r}finally{e("SET_GRADES_LOADING",!1)}},Sg=async({commit:e},t)=>{try{e("SET_GRADES_LOADING",!0),e("SET_GRADES_ERROR",null),await s("delete",`/grades/${t}`)}catch(n){throw e("SET_GRADES_ERROR",n.message),n}finally{e("SET_GRADES_LOADING",!1)}},Tg=({commit:e},t)=>{e("SET_GRADES_FILTERS",t)},Rg=async({commit:e},t)=>{try{e("SET_GRADES_LOADING",!0),e("SET_GRADES_ERROR",null);const n=await s("get",`/grades/${t}`);return e("ADD_OR_UPDATE_GRADE",n.data),n.data}catch(n){throw e("SET_GRADES_ERROR",n.message),n}finally{e("SET_GRADES_LOADING",!1)}},vg=async({commit:e},t)=>{try{e("SET_GRADES_LOADING",!0),e("SET_GRADES_ERROR",null);const n=await s("put",`/grades/${t.idpers}/${t.idnote}`,t);return e("ADD_OR_UPDATE_GRADE",n.data),n.data}catch(n){throw e("SET_GRADES_ERROR",n.message),n}finally{e("SET_GRADES_LOADING",!1)}},Og=Object.freeze(Object.defineProperty({__proto__:null,createGrade:pg,deleteGrade:Sg,fetchEleves:fg,fetchElevesSansNotes:_g,fetchGradeById:Rg,fetchGrades:dg,fetchGradesSettings:gg,saveGrade:vg,updateGrade:Eg,updateGradesFilters:Tg},Symbol.toStringTag,{value:"Module"})),yg={namespaced:!0,state:Nd,getters:Yd,mutations:cg,actions:Og},ce=()=>({totals:null,details:null,loading:!1,detailsLoading:!1,error:null,errorDetails:null,evolutionData:null,evolutionLoading:!1,evolutionError:null}),hg=e=>e.totals,Ag=e=>e.loading,bg=e=>e.error,Dg=e=>e.details,Lg=e=>e.detailsLoading,$g=e=>e.detailsError,Ig=e=>e.evolutionData,Ng=e=>e.evolutionLoading,mg=e=>e.evolutionError,Pg=Object.freeze(Object.defineProperty({__proto__:null,getDetails:Dg,getDetailsError:$g,getError:bg,getEvolutionData:Ig,getEvolutionError:mg,getTotals:hg,isDetailsLoading:Lg,isEvolutionLoading:Ng,isLoading:Ag},Symbol.toStringTag,{value:"Module"}));function Mg(e){let t=ce();Object.assign(e,t)}const Gg=(e,t)=>{e.totals=t},wg=(e,t)=>{e.loading=t},jg=(e,t)=>{e.error=t},Cg=(e,t)=>{e.details=t},Ug=(e,t)=>{e.errorDetails=t},Fg=(e,t)=>{e.detailsLoading=t},kg=e=>{e.errorDetails=null},zg=e=>{e.error=null},Bg=(e,t)=>{e.evolutionData=t},xg=(e,t)=>{e.evolutionLoading=t},Vg=(e,t)=>{e.evolutionError=t},Yg=e=>{e.evolutionError=null},qg=Object.freeze(Object.defineProperty({__proto__:null,CLEAR_DETAILS_ERROR:kg,CLEAR_ERROR:zg,CLEAR_EVOLUTION_ERROR:Yg,SET_DETAILS:Cg,SET_DETAILS_LOADING:Fg,SET_ERROR:jg,SET_ERROR_DETAILS:Ug,SET_EVOLUTION_DATA:Bg,SET_EVOLUTION_ERROR:Vg,SET_EVOLUTION_LOADING:xg,SET_LOADING:wg,SET_TOTALS:Gg,reset:Mg},Symbol.toStringTag,{value:"Module"})),Hg=({commit:e,rootGetters:t},n={})=>{e("SET_LOADING",!0),e("CLEAR_ERROR");const a=t["user/current"]?.annee?.idannee;if(!a||a<=0){const d="Veuillez sélectionner une année scolaire valide.";e("SET_ERROR",d),c.create({type:"warning",message:d}),e("SET_LOADING",!1),e("SET_TOTALS",null);return}const o=`/dashboard/total/${a}`,i=new URLSearchParams;n.start_date&&i.append("start_date",n.start_date),n.end_date&&i.append("end_date",n.end_date);const u=i.toString()?`${o}?${i.toString()}`:o;s("get",u).then(({data:d})=>{if(d&&typeof d.data?.total_paye=="number"&&typeof d.data?.total_a_payer=="number"&&d.status==="success")e("SET_TOTALS",d.data);else{const f=d?.message||"Format de données invalide reçu du serveur pour les totaux.";e("SET_ERROR",f),c.create({type:"negative",message:f}),e("SET_TOTALS",null)}}).catch(d=>{console.error(`Error fetching dashboard totals for year ${a}:`,d);const f=d?.response?.data?.message||d?.message||"Échec de la récupération des totaux financiers.";e("SET_ERROR",f),c.create({type:"negative",message:f}),e("SET_TOTALS",null)}).finally(()=>{e("SET_LOADING",!1)})},Kg=({commit:e,rootGetters:t},n={})=>{e("SET_DETAILS_LOADING",!0),e("CLEAR_DETAILS_ERROR");const a=t["user/current"]?.annee?.idannee;if(!a||a<=0){const u="Veuillez sélectionner une année scolaire valide.";e("SET_ERROR_DETAILS",u),c.create({type:"warning",message:u}),e("SET_DETAILS_LOADING",!1),e("SET_DETAILS",null);return}const o=new URLSearchParams;n.start_date&&o.append("start_date",n.start_date),n.end_date&&o.append("end_date",n.end_date),n.group_by&&o.append("group_by",n.group_by),["service_ids","class_ids","student_ids","service_types"].forEach(u=>{n[u]&&Array.isArray(n[u])&&n[u].length>0&&n[u].forEach(d=>{o.append(`${u}[]`,d)})});const i=`/dashboard/details/${a}${o.toString()?`?${o.toString()}`:""}`;s("get",i).then(({data:u})=>{if(u&&u.data&&u.data.totals&&typeof u.data.totals.objectif=="number"&&typeof u.data.totals.realisation=="number"&&u.status==="success")e("SET_DETAILS",u.data);else{const d=u?.message||"Format de données invalide reçu du serveur pour les détails.";e("SET_ERROR_DETAILS",d),c.create({type:"negative",message:d}),e("SET_DETAILS",null)}}).catch(u=>{console.error(`Error fetching dashboard details for year ${a}:`,u);const d=u?.response?.data?.message||u?.message||"Échec de la récupération des données détaillées.";e("SET_ERROR_DETAILS",d),c.create({type:"negative",message:d}),e("SET_DETAILS",null)}).finally(()=>{e("SET_DETAILS_LOADING",!1)})},Wg=({commit:e,rootGetters:t})=>{e("SET_EVOLUTION_LOADING",!0),e("CLEAR_EVOLUTION_ERROR");const r=t["user/current"]?.annee?.idannee;if(!r||r<=0){e("SET_EVOLUTION_ERROR","Veuillez sélectionner une année scolaire valide pour voir l'évolution."),e("SET_EVOLUTION_LOADING",!1),e("SET_EVOLUTION_DATA",null);return}const a=`/stats/student-evolution/${r}`;s("get",a).then(({data:o})=>{if(o&&Array.isArray(o.data)&&o.status==="success")e("SET_EVOLUTION_DATA",o.data);else{const i=o?.message||"Format de données invalide reçu pour l'évolution des élèves.";e("SET_EVOLUTION_ERROR",i),c.create({type:"negative",message:i}),e("SET_EVOLUTION_DATA",null)}}).catch(o=>{console.error(`Error fetching student evolution for year ${r}:`,o);const i=o?.response?.data?.message||o?.message||"Échec de la récupération de l'évolution des élèves.";e("SET_EVOLUTION_ERROR",i),c.create({type:"negative",message:i}),e("SET_EVOLUTION_DATA",null)}).finally(()=>{e("SET_EVOLUTION_LOADING",!1)})},Jg=Object.freeze(Object.defineProperty({__proto__:null,fetchDashboardDetails:Kg,fetchDashboardTotal:Hg,fetchStudentEvolution:Wg},Symbol.toStringTag,{value:"Module"})),Qg={namespaced:!0,state:ce,getters:Pg,mutations:qg,actions:Jg},Xg={namespaced:!0,state:{canteenSettings:null},getters:{canteenSettings:e=>e.canteenSettings},mutations:{SET_SETTINGS(e,t){e.canteenSettings=t},reset(e){e.canteenSettings=null}},actions:{async fetchCanteenSettings({commit:e}){try{const t=await s("get","/canteen/settings");return e("SET_SETTINGS",t.data.data),t.data.data}catch(t){throw console.error("Error fetching canteen settings:",t),t.response&&t.response.status===404?(e("SET_SETTINGS",null),new Error("Canteen settings not found (404)")):t}},async updateCanteenSettings({commit:e},t){try{const n=await s("put","/canteen/settings",t);return e("SET_SETTINGS",n.data.data),n.data}catch(n){throw console.error("Error updating canteen settings:",n),n}}}},Zg={loading:!1,error:null,statsData:null,currentAnneeId:null},ef={reset(e){e.statsData=null,e.error=null,e.loading=!1},SET_LOADING(e,t){e.loading=t},SET_ERROR(e,t){e.error=t,e.statsData=null},SET_STATS_DATA(e,t){e.statsData=t,e.error=null},CLEAR_STATS(e){e.statsData=null,e.error=null,e.loading=!1,e.currentAnneeId=null},SET_CURRENT_ANNEE_ID(e,t){e.currentAnneeId=t}},tf={async fetchTodayStats({commit:e,rootGetters:t}){const n=t["user/current"]?.annee;if(!n||!n.idannee){e("SET_ERROR","Année scolaire non sélectionnée."),c.create({type:"warning",message:"Veuillez sélectionner une année scolaire pour afficher les statistiques."}),e("SET_LOADING",!1);return}e("SET_LOADING",!0),e("SET_ERROR",null),e("SET_CURRENT_ANNEE_ID",n.idannee);try{const{data:r}=await s("get",`/canteen/stats/today?idannee=${n.idannee}`);r&&r.status==="success"?e("SET_STATS_DATA",r.data):(e("SET_ERROR",r?.message||"Impossible de charger les statistiques du jour."),c.create({type:"warning",message:r?.message||"Impossible de charger les statistiques du jour."}))}catch(r){console.error("Error fetching today's canteen stats:",r);const a=r?.response?.data?.message||"Erreur réseau.";e("SET_ERROR",a),c.create({type:"negative",message:a})}finally{e("SET_LOADING",!1)}},async fetchRangeStats({commit:e,rootGetters:t},{startDate:n,endDate:r}){const a=t["user/current"]?.annee;if(!a||!a.idannee){e("SET_ERROR","Année scolaire non sélectionnée."),c.create({type:"warning",message:"Veuillez sélectionner une année scolaire pour afficher les statistiques."}),e("SET_LOADING",!1);return}e("SET_LOADING",!0),e("SET_ERROR",null),e("SET_CURRENT_ANNEE_ID",a.idannee);try{const o=new URLSearchParams({start_date:n,end_date:r,idannee:a.idannee}),{data:i}=await s("get",`/canteen/stats/range?${o.toString()}`);i&&i.status==="success"?e("SET_STATS_DATA",i.data):i&&i.status==="validation_error"?(e("SET_ERROR",i.message),c.create({type:"warning",message:i.message})):(e("SET_ERROR",i?.message||"Impossible de charger les statistiques."),c.create({type:"warning",message:i?.message||"Impossible de charger les statistiques."}))}catch(o){console.error("Error fetching canteen stats for range:",o);const i=o?.response?.status===422?o.response?.data?.message||"Dates invalides.":o?.response?.data?.message||"Erreur réseau.";e("SET_ERROR",i),c.create({type:"negative",message:i})}finally{e("SET_LOADING",!1)}},async fetchProgramStats({commit:e},t){e("SET_LOADING",!0),e("SET_ERROR",null),e("SET_CURRENT_ANNEE_ID",null);try{const{data:n}=await s("get",`/canteen/stats/program/${t}`);n&&n.status==="success"?e("SET_STATS_DATA",n.data):n&&n.status==="not_found"?(e("SET_ERROR",n.message),c.create({type:"warning",message:n.message})):(e("SET_ERROR",n?.message||"Impossible de charger les statistiques du programme."),c.create({type:"warning",message:n?.message||"Impossible de charger les statistiques du programme."}))}catch{}finally{e("SET_LOADING",!1)}},clearCanteenStats({commit:e}){e("CLEAR_STATS")}},nf={isCanteenStatsLoading:e=>e.loading,getCanteenStatsError:e=>e.error,getCanteenStatsData:e=>e.statsData},rf={namespaced:!0,state:Zg,mutations:ef,actions:tf,getters:nf},af={staffList:[],loadingStaffList:!1,ticketReportData:null,loadingReport:!1,reportError:null},sf={staffList:e=>e.staffList,isLoadingStaffList:e=>e.loadingStaffList,ticketReportData:e=>e.ticketReportData,isLoadingReport:e=>e.loadingReport,reportError:e=>e.reportError},of={reset(e){e.staffList=[],e.loadingStaffList=!1,e.ticketReportData=null,e.loadingReport=!1,e.reportError=null},SET_STAFF_LIST(e,t){e.staffList=t},SET_LOADING_STAFF_LIST(e,t){e.loadingStaffList=t},SET_TICKET_REPORT_DATA(e,t){e.ticketReportData=t,e.reportError=null},SET_LOADING_REPORT(e,t){e.loadingReport=t},SET_REPORT_ERROR(e,t){e.reportError=t,e.ticketReportData=null},CLEAR_REPORT_DATA(e){e.ticketReportData=null,e.reportError=null},UPDATE_TICKET_IN_REPORT(e,{ticketId:t,payedStatus:n}){if(e.ticketReportData&&e.ticketReportData.tickets){const r=e.ticketReportData.tickets.findIndex(a=>a.id===t);if(r!==-1){const a={...e.ticketReportData.tickets[r],payed:n};e.ticketReportData.tickets.splice(r,1,a);const o=e.ticketReportData.tickets;e.ticketReportData.summary.total_paid_count=o.filter(i=>i.payed).length,e.ticketReportData.summary.total_paid_value=o.filter(i=>i.payed).reduce((i,u)=>i+u.tarif,0),e.ticketReportData.summary.total_unpaid_count=o.filter(i=>!i.payed).length,e.ticketReportData.summary.total_unpaid_value=o.filter(i=>!i.payed).reduce((i,u)=>i+u.tarif,0),e.ticketReportData={...e.ticketReportData}}}}},lf={async fetchStaffList({commit:e,rootGetters:t},{searchTerm:n=""}={}){e("SET_LOADING_STAFF_LIST",!0);try{const r={};n&&(r.search=n);const a=await s("get","/canteen/staff-ticket-management/staff-list",{params:r});a.data.status==="success"?e("SET_STAFF_LIST",a.data.data):(c.create({type:"negative",message:a.data.message||"Erreur lors de la récupération du personnel."}),e("SET_STAFF_LIST",[]))}catch{c.create({type:"negative",message:"Erreur réseau ou serveur lors de la récupération du personnel."}),e("SET_STAFF_LIST",[])}finally{e("SET_LOADING_STAFF_LIST",!1)}},async fetchStaffTicketReport({commit:e,rootGetters:t},n){e("SET_LOADING_REPORT",!0),e("CLEAR_REPORT_DATA");const r=t["user/current"]?.annee?.idannee;if(!r){c.create({type:"negative",message:"Année scolaire non sélectionnée. Veuillez sélectionner une année scolaire active."}),e("SET_REPORT_ERROR","Année scolaire non sélectionnée."),e("SET_LOADING_REPORT",!1);return}try{const a=await s("get","/canteen/staff-ticket-management/report",{params:{staff_id:n.staffId,start_date:n.startDate,end_date:n.endDate,idannee:r}});a.data.status==="success"?e("SET_TICKET_REPORT_DATA",a.data.data):(e("SET_REPORT_ERROR",a.data.message||"Erreur lors de la récupération du rapport."),c.create({type:"negative",message:a.data.message||"Erreur lors de la récupération du rapport."}))}catch(a){const o=a.response?.data?.message||"Erreur réseau ou serveur lors de la récupération du rapport.";e("SET_REPORT_ERROR",o),c.create({type:"negative",message:o})}finally{e("SET_LOADING_REPORT",!1)}},async markTicketAsPaid({commit:e,dispatch:t},{staffTicketId:n,currentReportParams:r}){try{const a=await s("post",`/canteen/staff-tickets/${n}/mark-paid`);a.data.status==="success"?(c.create({type:"positive",message:a.data.message||"Ticket marqué comme payé."}),e("UPDATE_TICKET_IN_REPORT",{ticketId:n,payedStatus:!0})):c.create({type:"negative",message:a.data.message||"Erreur lors de la mise à jour du ticket."})}catch{c.create({type:"negative",message:"Erreur réseau ou serveur lors de la mise à jour du ticket."})}}},uf={namespaced:!0,state:af,getters:sf,mutations:of,actions:lf},cf={academicYears:[],classes:[],professors:[],timetableData:{},timetableMetadata:null,isLoading:!1,isLoadingFilters:{academicYears:!1,classes:!1,professors:!1},error:null},df={reset(e){e.academicYears=[],e.classes=[],e.professors=[],e.timetableData={},e.timetableMetadata=null,e.isLoading=!1,e.isLoadingFilters={academicYears:!1,classes:!1,professors:!1},e.error=null},SET_LOADING(e,t){e.isLoading=t},SET_FILTER_LOADING(e,{filter:t,value:n}){e.isLoadingFilters.hasOwnProperty(t)&&(e.isLoadingFilters[t]=n)},SET_ACADEMIC_YEARS(e,t){e.academicYears=t},SET_CLASSES(e,t){e.classes=t},SET_PROFESSORS(e,t){e.professors=t},SET_TIMETABLE(e,t){e.timetableData=t.data||{},e.timetableMetadata=t.timetable_metadata||null,e.error=null},CLEAR_TIMETABLE_DATA(e){e.timetableData={},e.timetableMetadata=null},CLEAR_CLASSES(e){e.classes=[]},CLEAR_PROFESSORS(e){e.professors=[]},SET_ERROR(e,t){e.error=t,c.create({type:"negative",message:t||"Une erreur est survenue lors du traitement de votre demande.",position:"top"})},CLEAR_ERROR(e){e.error=null}},gf={async fetchAcademicYears({commit:e}){e("SET_FILTER_LOADING",{filter:"academicYears",value:!0}),e("CLEAR_ERROR");try{const t=await s("get","/infirmary/form-data/academic-years");e("SET_ACADEMIC_YEARS",t.data)}catch(t){console.error("Error fetching academic years:",t),e("SET_ERROR","Erreur lors du chargement des années scolaires.")}finally{e("SET_FILTER_LOADING",{filter:"academicYears",value:!1})}},async fetchClassesForYear({commit:e},t){if(!t){e("CLEAR_CLASSES");return}e("SET_FILTER_LOADING",{filter:"classes",value:!0}),e("CLEAR_CLASSES"),e("CLEAR_ERROR");try{const{data:n}=await s("get",`/filters/classes/${t}`);e("SET_CLASSES",n.data)}catch(n){console.error("Error fetching classes:",n),e("SET_ERROR","Erreur lors du chargement des classes.")}finally{e("SET_FILTER_LOADING",{filter:"classes",value:!1})}},async fetchProfessorsForYear({commit:e},t){if(!t){e("CLEAR_PROFESSORS");return}e("SET_FILTER_LOADING",{filter:"professors",value:!0}),e("CLEAR_PROFESSORS"),e("CLEAR_ERROR");try{const{data:n}=await s("get",`/filters/professors/${t}`);console.log(n);const r=n.data;e("SET_PROFESSORS",r)}catch(n){console.error("Error fetching professors:",n),e("SET_ERROR","Erreur lors du chargement des professeurs.")}finally{e("SET_FILTER_LOADING",{filter:"professors",value:!1})}},async fetchTimetable({commit:e},t){if(!t.anneeId||!t.date){e("SET_ERROR","Année scolaire et date sont requises.");return}e("SET_LOADING",!0),e("CLEAR_TIMETABLE_DATA"),e("CLEAR_ERROR");try{const n={annee_id:t.anneeId,date:t.date,view_type:t.viewType||"week"};t.classIds&&t.classIds.length>0&&(n.class_ids=t.classIds.join(",")),t.profIds&&t.profIds.length>0&&(n.prof_ids=t.profIds.join(","));const r=await s("get","/timetable",{params:n});e("SET_TIMETABLE",r.data)}catch(n){console.error("Error fetching timetable:",n);const r=n.response?.data?.message||"Erreur lors du chargement de l'emploi du temps.";e("SET_ERROR",r),e("CLEAR_TIMETABLE_DATA")}finally{e("SET_LOADING",!1)}}},ff={academicYears:e=>e.academicYears,classes:e=>e.classes,professors:e=>e.professors,timetableData:e=>e.timetableData,timetableMetadata:e=>e.timetableMetadata,isLoading:e=>e.isLoading,isLoadingFilters:e=>e.isLoadingFilters,error:e=>e.error,orderedDaysWithData:e=>{const t=[];if(!e.timetableMetadata||!e.timetableMetadata.date_view_starts||!e.timetableMetadata.date_view_ends||!e.timetableMetadata.days_map)return t;const n=I(e.timetableMetadata.date_view_starts,"yyyy-MM-dd",new Date),r=I(e.timetableMetadata.date_view_ends,"yyyy-MM-dd",new Date);let a=n;for(;Re(a,N(r,1));){const o=String(Te(a)),i=e.timetableMetadata.days_map[o];if(i){const u=m(a,"yyyy-MM-dd"),d=(e.timetableData[o]||[]).filter(f=>f.date_specific===u).sort((f,de)=>f.debut.localeCompare(de.debut));t.push({iso:o,name:i,specificDate:u,formattedFullDate:m(a,"eeee d MMMM yyyy",{locale:_e}),sessions:d})}a=N(a,1)}return t}},_f={namespaced:!0,state:cf,mutations:df,actions:gf,getters:ff};function pf(){return new pe({state:{footerButtons:[],title:"",lastUrl:"/",darkMode:!1,footer:!0,printing:!1,online:!0,useBar:!1,print:null,refresh:null},mutations:{setRefresh(t,n){t.refresh=n},setFooterButtons(t,n){t.footerButtons=n},setFooter(t,n){t.footer=n},setTitle(t,n){t.title=n},toggleDarkMode(t){t.darkMode=!t.darkMode,$.set(t.darkMode),T.set("darkMode",t.darkMode)},setDarkMode(t,n){t.darkMode=n,$.set(t.darkMode),T.set("darkMode",t.darkMode)},togglePrinting(t){t.printing=!t.printing,T.set("printing",t.printing)},setPrinting(t,n){t.printing=n,T.set("printing",t.printing)},setLastUrl(t,n){t.lastUrl=n},setBar(t,n){t.useBar=n},online(t){t.online=!0},offline(t){t.online=!1},startPrinting(t,n){t.print=n},stopPrinting(t){t.print=null}},getters:{refresh(t){return t.refresh},footer(t){return t.footer},title(t){return t.title},darkMode(t){return t.darkMode},printing(t){return t.printing},lastUrl(t){return t.lastUrl},showSyncDialog(t){return t.showSyncDialog},bar(t){return t.useBar},online(t){return t.online},print(t){return t.print}},actions:{setRefresh({commit:t},n){t("setRefresh",n)},setFooter({commit:t},n){t("setFooter",n)},toggleDarkMode({commit:t}){t("toggleDarkMode")},setDarkMode({commit:t},n){t("setDarkMode",n)},togglePrinting({commit:t}){t("togglePrinting")},setPrinting({commit:t},n){t("setPrinting",n)},setLastUrl({commit:t},n){t("setLastUrl",n)},online({commit:t},n){t("online")},offline({commit:t},n){t("offline")},setBar({commit:t},n){t("setBar",n)},print({commit:t},n){t("startPrinting",n)},stopPrint({commit:t}){t("stopPrinting")}},modules:{user:rn,actualite:En,emploi:Dn,message:We,devoirs:nr,ecole:Dr,notes:Fr,absence:Da,document:Va,media:is,suivi:hs,notification:Us,eleve:Hs,resources:po,infraction:Ao,badge:Mo,transport:fi,person:ku,adminAbsences:Pi,profAbsences:Qi,profEmploi:gl,ds:ql,reclamation:bu,stats:lu,snack:Cc,"ecole-geo":Xc,notifications:sd,pay:Id,grades:yg,dashboard:Qg,canteen:Xg,canteenStats:rf,canteenStaffTicketManagement:uf,timetable:_f}})}const Df=Ee(({app:e,router:t})=>{const n=pf();e.use(n),console.log("Vuex store initialized",n)});export{Df as default};
