import{Q as ie}from"./QBadge-Bjfo5tRO.js";import{aP as xe,A as b,B as d,a4 as O,S as _,a5 as e,a6 as t,aE as J,a8 as a,av as L,ad as w,ab as m,Q as V,a3 as h,aF as ee,a2 as z,ay as K,a9 as te,aa as qe,R as B,a7 as ne,aS as Z,aB as Ye,af as re,aD as de,aV as Ve,aG as $e,aO as Ee,C as Ue,aA as Ie,az as Oe,b6 as Pe,b3 as Le,_ as ze,c5 as Re,Y as Me,ag as He,ac as Be,ah as Se,aC as Je}from"./index-Bl2lQPd7.js";import{Q as Ke}from"./QSpinnerDots-BW9ZsFNG.js";import{Q as W}from"./QItemLabel-BkJiB6aE.js";import{Q as Qe,a as F}from"./QItem-De3v03wU.js";import{Q as Ce}from"./QList-CMzNTEGD.js";import{Q as ue}from"./QToolbarTitle-C8APieXG.js";import{Q as ce}from"./QToolbar-DR-_wX4W.js";import{Q as G}from"./QSelect-DchnWyXK.js";import{C as j}from"./ClosePopup-BY_YGFBZ.js";import{u as We}from"./composables-CAkrP3jA.js";import{q as I}from"./date-C1Mon-Jj.js";import{Q as De}from"./QSpace-CKKoNTi_.js";import{Q as oe}from"./QTooltip-r7WoEuzy.js";import{Q as Fe}from"./QForm-Dk45GsL9.js";import{Q as Xe}from"./QHeader-B4MlZ-LM.js";import{Q as Ze}from"./QDate-C_jC-zMt.js";import{Q as et}from"./QTime-DY-qDies.js";import{Q as tt}from"./QPopupProxy-CQ30ymZI.js";import{Q as lt}from"./QSlideTransition-CrdUnXBf.js";import{Q as at}from"./QFooter-BqOQs2Wv.js";import"./QChip-C9OfA2gn.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-datetime-hbLWgGn4.js";import"./TouchPan-jBhMORlX.js";import"./touch-BjYP5sR0.js";const st={class:"row items-center q-mb-md"},ot={class:"col-12 col-sm-4"},it={class:"col-12 col-sm-8 row justify-end items-center q-gutter-sm"},nt={class:"text-caption text-grey-8"},rt={class:"row q-col-gutter-md"},dt={class:"col-12"},ut={class:"full-width row items-center no-wrap gt-xs"},ct=["src"],mt={class:"row q-gutter-sm"},pt={class:"full-width lt-sm"},vt={class:"row items-center q-pb-md"},ft={class:"col-auto"},gt=["src"],_t={class:"col q-px-md"},bt={class:""},ht={class:"text-caption"},yt={class:"col-auto"},wt={class:"row items-center justify-between q-gutter-y-sm"},Vt={class:re("col-12 row items-center justify-between bg-grey-1  q-pa-sm")},Dt={key:0,class:"col-12 row justify-end q-gutter-x-sm"},xt={class:"row q-col-gutter-md"},qt={class:"col-12"},$t={class:"text-h6"},Qt={class:"text-caption text-grey-7"},Ct={class:"col-12"},kt={class:"text-caption"},Yt={class:"col-12 col-sm-6"},Mt={__name:"notes-personnes-dialog",props:{show:{type:Boolean,required:!0},note:{type:Object,required:!0},settings:{type:Object,required:!0}},emits:["close","update:show"],setup(U,{emit:X}){const u=U,C=xe(),q=u.settings?.max_note?.note||20,T=b(""),$=b(!1),Q=b(null),N=b(!1),M=b({note:null,present:!0,comment:"",idnote:u.note.idnote,idpers:null});console.log(C.getters["grades/grades"]);const P=d(()=>C.getters["grades/grades"].find(r=>r.idnote===u.note.idnote)?.personnes||[]),A=d(()=>{let r=P.value;if(T.value){const c=T.value.toLowerCase();r=r.filter(o=>o.nom.toLowerCase().includes(c)||o.prenom.toLowerCase().includes(c))}return r}),k=d(()=>A.value.filter(r=>r.pivot.present).length),Y=d(()=>A.value.filter(r=>!r.pivot.present).length),S=d(()=>{const r=A.value.filter(c=>c.pivot.present);return r.length?r.reduce((c,o)=>c+Number(o.pivot.note),0)/r.length:0}),g=r=>{const c=q/2,o=q*.8;return Number(r)<c?"text-negative text-weight-bold":Number(r)>=o?"text-positive text-weight-bold":Number(r)>=o-q/10?"text-primary ":"text-warning"},p=r=>{Q.value=r,M.value={note:r.pivot.note,present:r.pivot.present,idnote:u.note.idnote,idpers:r.idpers,comment:""},$.value=!0},D=async()=>{try{N.value=!0,await C.dispatch("grades/saveGrade",M.value),await x(),$.value=!1,Q.value=null}catch(r){console.error("Error saving student:",r)}finally{N.value=!1}},x=async()=>{try{await C.dispatch("grades/fetchGradeById",u.note.idnote)}catch(r){console.error("Error fetching note by id:",r),$q.notify({type:"negative",message:"Erreur lors de la récupération des données. Veuillez réessayer plus tard."})}};return(r,c)=>(_(),O(te,null,[e(de,{"model-value":U.show,"onUpdate:modelValue":c[1]||(c[1]=o=>r.$emit("update:show",o)),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:t(()=>[e(J,{class:"glass"},{default:t(()=>[e(ce,{class:"bg-primary text-white"},{default:t(()=>[e(ue,null,{default:t(()=>[w(" #"+m(U.note.periodes?.periode_fr+"/"+U.note.numero)+" - "+m(U.note.matieres?.bref),1)]),_:1}),e(De),L((_(),V(h,{dense:"",flat:"",icon:"close"},{default:t(()=>[e(oe,null,{default:t(()=>c[5]||(c[5]=[w("Fermer")])),_:1})]),_:1})),[[j]])]),_:1}),e(ee,{class:"q-pb-none"},{default:t(()=>[a("div",st,[a("div",ot,[e(z,{modelValue:T.value,"onUpdate:modelValue":c[0]||(c[0]=o=>T.value=o),dense:"",outlined:"",placeholder:"Recherche...",class:"q-mb-md q-mb-sm-none"},{append:t(()=>[e(K,{name:"search"})]),_:1},8,["modelValue"])]),a("div",it,[a("div",nt," Présents: "+m(k.value)+" | Absents: "+m(Y.value)+" | Moyenne: "+m(S.value.toFixed(1)),1)])])]),_:1}),a("div",rt,[a("div",dt,[e(Ce,{separator:"",class:"rounded-borders"},{default:t(()=>[(_(!0),O(te,null,qe(A.value,o=>(_(),V(Qe,{key:o.idpers,class:"q-py-md student-item"},{default:t(()=>[a("div",ut,[e(F,{avatar:""},{default:t(()=>[e(ne,{color:"primary","text-color":"white"},{default:t(()=>[a("img",{src:Z(Ye)(o)},null,8,ct)]),_:2},1024)]),_:2},1024),e(F,null,{default:t(()=>[e(W,{class:""},{default:t(()=>[w(m(o.nom)+" "+m(o.prenom),1)]),_:2},1024),e(W,{caption:""},{default:t(()=>[w("ID: "+m(o.code),1)]),_:2},1024)]),_:2},1024),e(F,{side:""},{default:t(()=>[e(ie,{color:o.pivot.present?"positive":"negative",label:o.pivot.present?"Présent":"Absent"},null,8,["color","label"])]),_:2},1024),e(F,{side:""},{default:t(()=>[a("div",{class:re(["text-weight-bold",g(o.pivot.note)])},m(o.pivot.note)+"/"+m(Z(q)),3)]),_:2},1024),U.note.active?B("",!0):(_(),V(F,{key:0,side:""},{default:t(()=>[a("div",mt,[e(h,{flat:"",round:"",color:"primary",icon:"edit",onClick:R=>p(o)},{default:t(()=>[e(oe,null,{default:t(()=>c[6]||(c[6]=[w("Modifier l'étudiant")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024))]),a("div",pt,[a("div",vt,[a("div",ft,[e(ne,{color:"primary","text-color":"white",size:"48px",rounded:""},{default:t(()=>[a("img",{src:Z(Ye)(o)},null,8,gt)]),_:2},1024)]),a("div",_t,[a("div",bt,m(o?.nom)+" "+m(o?.prenom),1),a("div",ht,"ID: "+m(o?.code),1)]),a("div",yt,[e(ie,{color:o?.pivot.present?"positive":"negative",label:o?.pivot.present?"Présent":"Absent"},null,8,["color","label"])])]),a("div",wt,[a("div",Vt,[c[7]||(c[7]=a("div",{class:"text-caption text-grey-8"},"Note",-1)),a("div",{class:re(["text-weight-bold",g(o?.pivot.note)])},m(o?.pivot.note)+"/"+m(Z(q)),3)]),U.note.active?B("",!0):(_(),O("div",Dt,[e(h,{flat:"",color:"primary",icon:"edit",label:"Modifier",onClick:R=>p(o)},null,8,["onClick"])]))])])]),_:2},1024))),128))]),_:1})])])]),_:1})]),_:1},8,["model-value"]),e(de,{modelValue:$.value,"onUpdate:modelValue":c[4]||(c[4]=o=>$.value=o),persistent:""},{default:t(()=>[e(J,{class:"edit-dialog"},{default:t(()=>[e(ce,{class:"bg-primary text-white"},{default:t(()=>[e(ue,{class:"text-weight-bold"},{default:t(()=>[w(m(Q.value?"Modifier":"Ajouter")+" la note de l'étudiant",1)]),_:1}),e(De),L((_(),V(h,{dense:"",flat:"",icon:"close"},{default:t(()=>[e(oe,null,{default:t(()=>c[8]||(c[8]=[w("Fermer")])),_:1})]),_:1})),[[j]])]),_:1}),e(Fe,{onSubmit:D,class:"q-gutter-md"},{default:t(()=>[e(ee,null,{default:t(()=>[a("div",xt,[a("div",qt,[a("div",$t,m(Q.value?.nom)+" "+m(Q.value?.prenom),1),a("div",Qt,"ID: "+m(Q.value?.code),1)]),a("div",Ct,[e(z,{modelValue:M.value.note,"onUpdate:modelValue":c[2]||(c[2]=o=>M.value.note=o),modelModifiers:{number:!0},type:"number",label:"Note",rules:[o=>o!==null&&o!==""||"La note est requise",o=>o>=0&&o<=20||"La note doit être entre 0 et 20"],min:"0",max:"20",step:"0.05",outlined:"",dense:"",class:"full-width"},{append:t(()=>[a("div",kt,"/"+m(Z(q)),1)]),_:1},8,["modelValue","rules"])]),a("div",Yt,[e(Ve,{modelValue:M.value.present,"onUpdate:modelValue":c[3]||(c[3]=o=>M.value.present=o),label:"Présent",color:"positive","left-label":"",class:"full-width justify-between","true-value":1,"false-value":0},null,8,["modelValue"])])])]),_:1}),e($e,{align:"right",class:"bg-grey-1 q-pa-md"},{default:t(()=>[L(e(h,{flat:"",label:"Annuler",color:"grey-7",disable:N.value},null,8,["disable"]),[[j]]),e(h,{flat:"",type:"submit",label:"Enregistrer",color:"primary",loading:N.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},St={class:""},Et={class:"row q-col-gutter-md"},Ut={class:"col-12"},Lt={class:"row q-col-gutter-md"},Ft={class:"col-12 col-sm-6 col-md-3"},Tt={class:"col-12 col-sm-6 col-md-3"},Nt={class:"col-12 col-sm-6 col-md-3"},jt={class:"row items-center justify-end"},At={class:"row items-center justify-end"},Gt={class:"col-12 col-sm-6 col-md-3"},It={class:"col-12 col-sm-6 col-md-3"},Ot={class:"col-12 col-sm-6 col-md-3"},Pt={class:"row items-center justify-between q-mb-md mobile-stack"},zt={class:"row items-center q-gutter-sm full-width-mobile"},Rt={class:"col-auto row justify-end"},Ht={class:"full-width row items-center q-gutter-md gt-xs"},Bt={class:"text-caption"},Jt={class:"full-width lt-sm"},Kt={class:"row items-center q-pb-sm"},Wt={class:"col-auto"},Xt={class:"col q-px-sm"},Zt={class:"ellipsis"},el={class:"text-caption text-grey-7"},tl={class:"col-auto"},ll={class:"row q-col-gutter-sm q-pt-sm"},al={class:"col-12"},sl={class:"text-caption"},ol={__name:"create-evaluation-dialog",props:{show:{type:Boolean,required:!0},note:{type:Object,required:!1}},emits:["update:show","evaluation-created","hide"],setup(U,{emit:X}){const u=U,C=b(null),q=b(!1),T=X,$=xe(),Q=Ee(),N=d(()=>$.getters["user/current"]),M=d(()=>N.value?.annee),P=d(()=>N.value?.classe),A=d(()=>$.getters["grades/eleves"]||[]),k=b([]),Y=b(""),S=b(!1),g=b(null);I.formatDate(new Date,"YYYY-MM-DD 19:00:00");const p=b({discipline:null,idmatiere:null,idperiode:null,numero:null,date_note:I.formatDate(new Date,"YYYY-MM-DD 08:00:00")}),D=d(()=>$.getters["grades/settings"]),x=d(()=>D.value?.max_note?.note||20),r=b("masar"),c=d(()=>{let i=k.value;if(Y.value){const s=Y.value.toLowerCase();i=i.filter(l=>l.name.toLowerCase().includes(s)||l.idpers.toString().includes(s))}if(r.value==="masar")return i.sort((s,l)=>s.code.localeCompare(l.code));if(r.value==="alphabetique")return i.sort((s,l)=>s.name.localeCompare(l.name))}),o=d(()=>D.value?.matieres||[]),R=d(()=>D.value?.disciplines||[]),le=d(()=>R.value.map(i=>({label:i.description,value:i.iddiscipline}))),ae=d(()=>p.value.discipline?o.value.filter(i=>i.discipline[0]?.iddiscipline===p.value.discipline):o.value),me=d(()=>ae.value.map(i=>({label:i.matiere_fr,value:i.idmatiere}))),pe=d(()=>D.value?.periodes||[]),ve=d(()=>pe.value.map(i=>({label:i.periode_fr,value:i.idperiode}))),fe=d(()=>D.value?.numeros||[]),ge=d(()=>fe.value.map((i,s)=>({label:i,value:s+1}))),_e=d(()=>D.value?.durrees||[{label:"30 minutes",value:30},{label:"45 minutes",value:45},{label:"1 heure",value:60},{label:"1 heure et 30 minutes",value:90},{label:"2 heures",value:120},{label:"2 heures et 30 minutes",value:150},{label:"3 heures",value:180},{label:"3 heures et 30 minutes",value:210},{label:"4 heures",value:240}]),be=d(()=>D.value?.heures||[8,9,10,11,12,13,14,15,16,17,18]),se=i=>i<=I.formatDate(new Date,"YYYY/MM/DD"),he=i=>(console.log("validateDate",i,i<=I.formatDate(new Date,"YYYY-MM-DD 19:59"),I.formatDate(new Date,"YYYY-MM-DD 19:59")),i<=I.formatDate(new Date,"YYYY-MM-DD 19:59")),ye=()=>{k.value=A.value.map(i=>({idpers:i.idpers,code:i.code,name:i.nom+" "+i.prenom,present:1,note:null,comment:""})),r.value=D.value?.ordre_eleve||"masar",u.note&&u.note.idnote&&(console.log("note",u.note),p.value.date_note=I.formatDate(Le(u.note.date_note),"YYYY-MM-DD HH:mm"),p.value.idperiode=u.note.idperiode,p.value.idmatiere=u.note.idmatiere,p.value.numero=u.note.numero,p.value.durree=u.note.durree,k.value.forEach(i=>{i.present=u.note.personnes.find(s=>s.idpers===i.idpers)?.pivot?.present||0,i.note=u.note.personnes.find(s=>s.idpers===i.idpers)?.pivot?.note||null,i.comment=u.note.personnes.find(s=>s.idpers===i.idpers)?.pivot?.comment||""}))},we=()=>{r.value==="masar"?r.value="alphabetique":r.value="masar"},H=async()=>{try{if(S.value=!0,console.log(A.value),!await g.value.validate()){Q.notify({type:"negative",message:"Veuillez vérifier les champs."});return}const s=k.value.filter(E=>E.present&&(E.note===null||E.note<0||E.note>x.value));if(s.length>0){Q.notify({type:"negative",message:"Veuillez vérifier les notes des élèves."}),console.log(s);return}const l={note:{...p.value,idannee:M.value.idannee,idclasse:P.value.idclasse,idtype:1},personnes:k.value.map(E=>({idpers:E.idpers,present:E.present,note:E.present?E.note:0,comment:E.comment}))};u.note&&u.note.idnote?await $.dispatch("grades/updateGrade",{data:l,id:u.note.idnote}):await $.dispatch("grades/createGrade",l),T("evaluation-created",l),T("update:show",!1);let y="Contrôle ajouté avec succès !";u.note&&u.note.idnote&&(y="Contrôle mis à jour avec succès !"),Q.notify({type:"positive",message:y})}catch(i){let s="Erreur lors de la création du contrôle";i?.response?.data?.erreur&&(s+=": "+i?.response?.data?.erreur),u.note&&u.note.idnote&&(s="Erreur lors de la mise à jour du contrôle."),console.error(s+":",i),Q.notify({type:"negative",message:s})}finally{S.value=!1}};return Ue(()=>{ye()}),(i,s)=>(_(),V(de,{"model-value":U.show,onHide:s[11]||(s[11]=l=>i.$emit("hide")),"onUpdate:modelValue":s[12]||(s[12]=l=>i.$emit("update:show",l)),persistent:"",maximized:""},{default:t(()=>[a("div",St,[e(Ie,{view:"hHh lpR fFf",container:"",class:"bg-grey-1"},{default:t(()=>[e(Xe,{class:"bg-primary text-white"},{default:t(()=>[e(ce,null,{default:t(()=>[e(ue,{class:"text-weight-bold"},{default:t(()=>s[13]||(s[13]=[w("Créer une nouvelle contrôle")])),_:1}),e(De),L((_(),V(h,{dense:"",flat:"",icon:"close"},{default:t(()=>[e(oe,null,{default:t(()=>s[14]||(s[14]=[w("Fermer")])),_:1})]),_:1})),[[j]])]),_:1})]),_:1}),e(Oe,null,{default:t(()=>[e(Fe,{onSubmit:H,ref_key:"form",ref:g},{default:t(()=>[e(J,{flat:""},{default:t(()=>[a("div",Et,[a("div",Ut,[e(J,{flat:""},{default:t(()=>[e(ee,null,{default:t(()=>[s[15]||(s[15]=a("div",{class:"text-h6 q-mb-md"},"Détails du contrôle",-1)),a("div",Lt,[a("div",Ft,[e(G,{filled:"",modelValue:p.value.discipline,"onUpdate:modelValue":s[0]||(s[0]=l=>p.value.discipline=l),label:"Discipline",options:le.value,"emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"])]),a("div",Tt,[e(G,{filled:"",modelValue:p.value.idmatiere,"onUpdate:modelValue":s[1]||(s[1]=l=>p.value.idmatiere=l),label:"Matière",options:me.value,"emit-value":"","map-options":"",rules:[l=>!!l||"La matière est requise"]},null,8,["modelValue","options","rules"])]),a("div",Nt,[e(z,{modelValue:p.value.date_note,"onUpdate:modelValue":s[6]||(s[6]=l=>p.value.date_note=l),label:"Date",rules:[l=>!!l||"La date est requise",l=>he(l)||"La date est invalide"],filled:"",mask:"####-##-## ##:##"},{append:t(()=>[e(K,{name:"event",class:"cursor-pointer"},{default:t(()=>[e(tt,{ref_key:"qDateProxy",ref:C,"transition-show":"scale","transition-hide":"scale",onHide:s[5]||(s[5]=l=>q.value=!1)},{default:t(()=>[q.value?(_(),V(et,{key:1,"hour-options":be.value,modelValue:p.value.date_note,"onUpdate:modelValue":s[4]||(s[4]=l=>p.value.date_note=l),format24h:"",mask:"YYYY-MM-DD HH:mm"},{default:t(()=>[a("div",At,[L(e(h,{dense:"",flat:"",label:"fermer",color:"primary"},null,512),[[j]])])]),_:1},8,["hour-options","modelValue"])):(_(),V(Ze,{key:0,mask:"YYYY-MM-DD HH:mm",modelValue:p.value.date_note,"onUpdate:modelValue":[s[2]||(s[2]=l=>p.value.date_note=l),s[3]||(s[3]=l=>q.value=!0)],options:se},{default:t(()=>[a("div",jt,[L(e(h,{dense:"",flat:"",label:"fermer",color:"primary"},null,512),[[j]])])]),_:1},8,["modelValue"]))]),_:1},512)]),_:1})]),_:1},8,["modelValue","rules"])]),a("div",Gt,[e(G,{filled:"",modelValue:p.value.idperiode,"onUpdate:modelValue":s[7]||(s[7]=l=>p.value.idperiode=l),label:"Semestre",options:ve.value,"emit-value":"","map-options":"",rules:[l=>!!l||"La période est requise"]},null,8,["modelValue","options","rules"])]),a("div",It,[e(G,{filled:"",modelValue:p.value.numero,"onUpdate:modelValue":s[8]||(s[8]=l=>p.value.numero=l),label:"Numéro de contrôle",options:ge.value,"emit-value":"","map-options":"",rules:[l=>!!l||"Le numéro est requis"]},null,8,["modelValue","options","rules"])]),a("div",Ot,[e(G,{filled:"",modelValue:p.value.durree,"onUpdate:modelValue":s[9]||(s[9]=l=>p.value.durree=l),label:"Durée",options:_e.value,"emit-value":"","map-options":"",rules:[l=>!!l||"La durée est requise"]},null,8,["modelValue","options","rules"])])])]),_:1})]),_:1})]),a("div",{class:re(["col-12",i.$q.screen.gt.sm?"col-md-8":""])},[e(J,{class:"professional-card student-list-mobile"},{default:t(()=>[e(ee,null,{default:t(()=>[a("div",Pt,[s[16]||(s[16]=a("div",{class:"text-h6 q-mb-sm-none"},"Notes des étudiants",-1)),a("div",zt,[e(z,{modelValue:Y.value,"onUpdate:modelValue":s[10]||(s[10]=l=>Y.value=l),placeholder:"Rechercher des étudiants...",dense:"",filled:"",class:"col-6"},{append:t(()=>[e(K,{name:"search"})]),_:1},8,["modelValue"]),a("div",Rt,[e(h,{flat:"",label:r.value==="masar"?"Trier par code":"Trier par nom",icon:"sort",dense:"",onClick:we,class:"col-auto"},null,8,["label"])])])]),e(Ce,{separator:"",class:"rounded-borders"},{default:t(()=>[(_(!0),O(te,null,qe(c.value,l=>(_(),V(Qe,{key:l.idpers,class:"student-item"},{default:t(()=>[a("div",Ht,[e(F,{avatar:""},{default:t(()=>[e(ne,{color:"primary","text-color":"white"},{default:t(()=>[w(m(l.name.charAt(0)),1)]),_:2},1024)]),_:2},1024),e(F,null,{default:t(()=>[e(W,null,{default:t(()=>[w(m(l.name),1)]),_:2},1024),e(W,{caption:""},{default:t(()=>[w("ID: "+m(l.code),1)]),_:2},1024)]),_:2},1024),e(F,{side:""},{default:t(()=>[e(Ve,{modelValue:l.present,"onUpdate:modelValue":y=>l.present=y,color:"positive",label:"Présent","true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(F,{side:"",style:{"min-width":"120px"}},{default:t(()=>[e(z,{modelValue:l.note,"onUpdate:modelValue":y=>l.note=y,modelModifiers:{number:!0},type:"number",disable:!l.present,dense:"",filled:"",rules:[y=>!l.present||y>=0&&y<=x.value||"La note doit être entre 0 et "+x.value],min:"0",max:x.value,step:"0.5",mask:"##.##"},{append:t(()=>[a("div",Bt,"/"+m(x.value),1)]),_:2},1032,["modelValue","onUpdate:modelValue","disable","rules","max"])]),_:2},1024)]),a("div",Jt,[a("div",Kt,[a("div",Wt,[e(ne,{color:"primary","text-color":"white",size:"32px"},{default:t(()=>[w(m(l.name.charAt(0)),1)]),_:2},1024)]),a("div",Xt,[a("div",Zt,m(l.name),1),a("div",el,"ID: "+m(l.code),1)]),a("div",tl,[e(Ve,{label:"Présent",modelValue:l.present,"onUpdate:modelValue":y=>l.present=y,color:"positive",dense:"","true-value":1,"false-value":0},null,8,["modelValue","onUpdate:modelValue"])])]),e(lt,null,{default:t(()=>[L(a("div",ll,[a("div",al,[e(z,{modelValue:l.note,"onUpdate:modelValue":y=>l.note=y,modelModifiers:{number:!0},type:"number",label:"Note",dense:"",filled:"",rules:[y=>!l.present||y>=0&&y<=x.value||"Invalide"],min:"0",max:x.value,step:"0.05",mask:"##.##"},{append:t(()=>[a("div",sl,"/"+m(x.value),1)]),_:2},1032,["modelValue","onUpdate:modelValue","rules","max"])])],512),[[Pe,l.present]])]),_:2},1024)])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})],2)])]),_:1})]),_:1},512)]),_:1}),e(at,{class:"bg-primary text-white"},{default:t(()=>[e($e,{align:"right",class:"bg-grey-1 q-pa-md form-actions"},{default:t(()=>[L(e(h,{flat:"",label:"Annuler",color:"grey-7",disable:S.value},null,8,["disable"]),[[j]]),e(h,{flat:"",label:"Enregistrer",color:"primary",loading:S.value,onClick:H},null,8,["loading"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model-value"]))}},il={class:"q-pa-md"},nl={class:"row justify-between items-center q-gutter-md"},rl={key:0,class:"row justify-center q-pa-md"},dl={class:"row items-center text-grey-8"},ul={class:"q-mr-sm row items-center"},cl={class:"q-mr-md row items-center"},ml={class:"q-mr-md row items-center"},pl={key:0,class:"full-width row flex-center q-pa-md text-grey-8"},vl={__name:"List",setup(U){const{setTitle:X}=We(),u=xe(),C=Ee();Re();const q=b(!1),T=b(!1),$=b(!1),Q=d(()=>u.state.grades.grades?.data?.data||[]),N=d(()=>u.state.grades.grades?.pagination),M=b(!1),P=d(()=>u.getters["user/current"]),A=d(()=>P.value?.classes||[]);d(()=>A.value.map(n=>({label:n.classe_fr,value:n.idclasse})));const k=d(()=>P.value?.annee),Y=d(()=>P.value?.classe),S={with_matiere:!0,with_classes:!0,with_semestre:!0,idannee:k.value.idannee,idclasse:Y.value?.idclasse},g=b({discipline:null,idmatiere:null,search:null,idperiode:null,numero:null}),p=d(()=>Object.keys(g.value).some(n=>g.value[n]!==null&&g.value[n]!==void 0&&g.value[n]!=="")),D=b(!1),x=b(!1);b(!1);const r=b(null),c=d(()=>u.getters["grades/eleves"]),o=d(()=>u.getters["grades/settings"]);d(()=>u.getters["grades/elevesSansNotes"]?.data||[]);const R=d(()=>o.value?.matieres||[]),le=d(()=>o.value?.disciplines||[]),ae=d(()=>le.value.map(n=>({label:n.description,value:n.iddiscipline}))),me=d(()=>g.value.discipline?R.value.filter(n=>n.discipline[0]?.iddiscipline===g.value.discipline):R.value),pe=d(()=>me.value.map(n=>({label:n.matiere_fr,value:n.idmatiere}))),ve=d(()=>o.value?.periodes||[]),fe=d(()=>ve.value.map(n=>({label:n.periode_fr,value:n.idperiode}))),ge=d(()=>o.value?.numeros||[]),_e=d(()=>ge.value.map((n,v)=>({label:n,value:v+1}))),be=n=>{r.value=n,D.value=!0},se=()=>{T.value||(r.value=null),$.value=!0,x.value=!0},he=n=>{console.log("grade",n),r.value=n,T.value=!0,se()},ye=n=>{H()},we=()=>{$.value=!1,x.value=!1,r.value=null},H=async()=>{try{q.value=!0,await y(),await E(),await l()}finally{q.value=!1}},i=n=>{try{C.dialog({title:"Suppression",message:"Êtes-vous sûr de vouloir supprimer cette note ?",cancel:!0,persistent:!0,ok:{label:"Oui",color:"negative",flat:!0,icon:"delete"},cancel:{flat:!0,icon:"cancel",label:"Non"}}).onOk(async()=>{await s(n)})}catch(v){C.notify({type:"negative",message:`Erreur lors de la suppression de la note: ${v.message}`})}},s=async n=>{console.log("delete",n),await u.dispatch("grades/deleteGrade",n),C.notify({type:"positive",message:"Note supprimée avec succès"}),await l()},l=async(n={})=>{const v={filters:g.value,page:n.page||N.value.current_page,per_page:N.value.per_page};await u.dispatch("grades/fetchGrades",v)},y=async()=>{try{await u.dispatch("grades/fetchGradesSettings",{annee:k.value.idannee,classe:Y.value?.idclasse})}catch(n){console.error("Error fetching settings:",n),C.notify({type:"negative",message:"Erreur lors de la récupération des données. Veuillez réessayer plus tard."})}},E=async()=>{try{await u.dispatch("grades/fetchEleves",{annee:k.value.idannee,classe:Y.value?.idclasse})}catch(n){console.error("Error fetching eleves:",n),C.notify({type:"negative",message:"Erreur lors de la récupération des données. Veuillez réessayer plus tard."})}},Te=n=>I.formatDate(Le(n),"DD MMMM YYYY"),Ne=()=>{u.commit("grades/SET_GRADES_FILTERS",{...S,...g.value}),l()},je=()=>{g.value={search:null,idmatiere:null,idperiode:null,numero:null,discipline:null},S.idannee=k.value.idannee,S.idclasse=Y.value.idclasse,u.commit("grades/SET_GRADES_FILTERS",{...S}),l()},Ae=n=>n?.matieres?.discipline&&n?.matieres?.discipline.length?n?.matieres?.discipline[0].color:"var(--q-secondary)";return Me(()=>Y.value,()=>{u.commit("grades/ADD_FILTER",{idclasse:Y.value?.idclasse,idannee:k.value.idannee}),H()}),Me(o,()=>{o.value?.title&&o.value?.title!==""&&X(o.value?.title)}),Ue(async()=>{try{X("Gestion des notes"),u.commit("grades/SET_GRADES_FILTERS",{...S}),await H(),console.log(ae.value,le.value)}catch(n){console.error("Error fetching initial data:",n),C.notify({type:"negative",message:"Erreur lors de la récupération des données. Veuillez réessayer plus tard."})}}),(n,v)=>{const Ge=He("ep-footer");return _(),V(Je,{class:"bg-grey-100 page-content"},{default:t(()=>[a("div",il,[a("div",nl,[a("div",null,[e(h,{color:"primary",flat:"",label:"Filtres",onClick:v[0]||(v[0]=f=>M.value=!0),icon:p.value?"filter_alt_off":"filter_list"},{default:t(()=>[p.value?(_(),V(ie,{key:0,color:"secondary",floating:""})):B("",!0)]),_:1},8,["icon"])])])]),q.value?(_(),O("div",rl,[e(Ke,{color:"primary",size:"2em"})])):(_(),V(Ce,{key:1,padding:"",bordered:"",separator:""},{default:t(()=>[(_(!0),O(te,null,qe(Q.value,f=>(_(),V(Qe,{key:f.idnote,clickable:"",onClick:ke=>be(f)},{default:t(()=>[e(F,null,{default:t(()=>[e(W,{class:"text-weight-bold q-py-xs"},{default:t(()=>[a("div",{class:"q-pa-xs inline-block discipline",style:Be({"--discipline-color":Ae(f)})},m(f.matieres?.bref||""),5)]),_:2},1024),e(W,{caption:""},{default:t(()=>[a("div",dl,[a("div",ul,[e(K,{name:"date_range",class:"q-mr-xs"}),w(" "+m(f.periodes?.periode_fr),1)]),a("div",cl,[e(K,{name:"numbers",class:"q-mr-xs"}),w(" "+m(f.numero),1)]),a("div",ml,[e(K,{name:"event",class:"q-mr-xs"}),w(" "+m(Te(f.date_note)),1)])])]),_:2},1024)]),_:2},1024),e(F,{side:"",top:""},{default:t(()=>[f.active?(_(),V(ie,{key:0,color:"green",class:"q-mt-xs"},{default:t(()=>v[10]||(v[10]=[w(" Validé ")])),_:1})):(_(),O(te,{key:1},[e(h,{flat:"",dense:"",color:"primary",icon:"edit",onClick:Se(ke=>he(f),["stop"])},null,8,["onClick"]),e(h,{flat:"",dense:"",color:"negative",icon:"delete",onClick:Se(ke=>i(f.idnote),["stop"])},null,8,["onClick"])],64))]),_:2},1024)]),_:2},1032,["onClick"]))),128)),Q.value.length===0?(_(),O("div",pl," Aucune note trouvée ")):B("",!0)]),_:1})),e(Ge,{to:"#footer-portal"},{default:t(()=>[e(h,{flat:"",label:"Nouveau controle",onClick:se})]),_:1}),e(de,{modelValue:M.value,"onUpdate:modelValue":v[6]||(v[6]=f=>M.value=f),position:"top"},{default:t(()=>[e(J,null,{default:t(()=>[e(ce,{class:"bg-primary text-white"},{default:t(()=>[e(ue,null,{default:t(()=>v[11]||(v[11]=[w("Filtres")])),_:1}),L(e(h,{flat:"",round:"",dense:"",icon:"close"},null,512),[[j]])]),_:1}),e(ee,{class:"q-gutter-md"},{default:t(()=>[e(z,{filled:"",modelValue:g.value.search,"onUpdate:modelValue":v[1]||(v[1]=f=>g.value.search=f),label:"Recherche",clearable:""},null,8,["modelValue"]),e(G,{filled:"",modelValue:g.value.discipline,"onUpdate:modelValue":v[2]||(v[2]=f=>g.value.discipline=f),label:"Discipline",options:ae.value,clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),e(G,{filled:"",modelValue:g.value.idmatiere,"onUpdate:modelValue":v[3]||(v[3]=f=>g.value.idmatiere=f),label:"Matière",options:pe.value,clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),e(G,{filled:"",modelValue:g.value.idperiode,"onUpdate:modelValue":v[4]||(v[4]=f=>g.value.idperiode=f),label:"Période",options:fe.value,clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),e(G,{filled:"",modelValue:g.value.numero,"onUpdate:modelValue":v[5]||(v[5]=f=>g.value.numero=f),label:"Numéro",options:_e.value,clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),_:1}),e($e,{align:"right"},{default:t(()=>[L(e(h,{flat:"",label:"Réinitialiser",color:"primary",onClick:je},null,512),[[j]]),L(e(h,{label:"Appliquer",color:"primary",onClick:Ne},null,512),[[j]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r.value?(_(),V(Mt,{key:2,settings:o.value,show:D.value,"onUpdate:show":v[7]||(v[7]=f=>D.value=f),note:r.value,onClose:v[8]||(v[8]=f=>D.value=!1)},null,8,["settings","show","note"])):B("",!0),$.value&&c.value&&c.value.length>0?(_(),V(ol,{key:3,onHide:we,settings:o.value,show:x.value,"onUpdate:show":v[9]||(v[9]=f=>x.value=f),onEvaluationCreated:ye,note:r.value,students:c.value},null,8,["settings","show","note","students"])):B("",!0)]),_:1})}}},Rl=ze(vl,[["__scopeId","data-v-ba929721"]]);export{Rl as default};
