import{Q as S}from"./QSpinnerDots-BW9ZsFNG.js";import{r as y,t as b,d0 as T,M as J,bg as K,bi as Z,d1 as $,bh as L,d2 as z,_ as O,A as ee,Y as N,B as te,Q as w,S as u,a6 as f,a5 as o,aE as X,R as g,a4 as m,a3 as M,ad as E,ab as _,aF as Q,av as ae,aD as ie,i as le,cT as P,c$ as B,aW as Y,as as re,at as ne,ag as U,a8 as h,ay as k,a9 as se,aa as oe,ah as de,aC as ue}from"./index-Bl2lQPd7.js";import{Q as ce}from"./QChip-C9OfA2gn.js";import{Q as j}from"./QImg-BMvxJu3S.js";import{Q as me}from"./QToolbarTitle-C8APieXG.js";import{Q as fe}from"./QToolbar-DR-_wX4W.js";import{Q as he}from"./QSpinnerGears-DmolwAR1.js";import{Q as ge}from"./QVideo-CbIcEHVn.js";import{T as V}from"./TouchSwipe-jpsGI2FR.js";import{d as be,g as ve}from"./index-F64n39US.js";import{f as pe}from"./index-Dx01H97j.js";import{_ as _e,a as Ie,b as xe}from"./_xfBase-4bk-g_Vj.js";import"./touch-BjYP5sR0.js";import"./selection-DaBtDCZ0.js";import"./index-CbPSoDvq.js";function ye(e,t){y(2,arguments);var a=b(e),i=b(t),s=a.getFullYear()-i.getFullYear(),n=a.getMonth()-i.getMonth();return s*12+n}function De(e){y(1,arguments);var t=b(e);return t.setHours(23,59,59,999),t}function Me(e){y(1,arguments);var t=b(e),a=t.getMonth();return t.setFullYear(t.getFullYear(),a+1,0),t.setHours(23,59,59,999),t}function ke(e){y(1,arguments);var t=b(e);return De(t).getTime()===Me(t).getTime()}function we(e,t){y(2,arguments);var a=b(e),i=b(t),s=T(a,i),n=Math.abs(ye(a,i)),r;if(n<1)r=0;else{a.getMonth()===1&&a.getDate()>27&&a.setDate(30),a.setMonth(a.getMonth()-s*n);var v=T(a,i)===-s;ke(b(e))&&n===1&&T(e,i)===1&&(v=!1),r=s*(n-Number(v))}return r===0?0:r}function Te(e,t,a){y(2,arguments);var i=be(e,t)/1e3;return ve()(i)}var F=1440,qe=2520,A=43200,Ae=86400;function Ce(e,t,a){var i,s;y(2,arguments);var n=J(),r=(i=(s=a?.locale)!==null&&s!==void 0?s:n.locale)!==null&&i!==void 0?i:K;if(!r.formatDistance)throw new RangeError("locale must contain formatDistance property");var v=T(e,t);if(isNaN(v))throw new RangeError("Invalid time value");var l=Z($(a),{addSuffix:!!a?.addSuffix,comparison:v}),p,I;v>0?(p=b(t),I=b(e)):(p=b(e),I=b(t));var D=Te(I,p),c=(L(I)-L(p))/1e3,d=Math.round((D-c)/60),x;if(d<2)return a!=null&&a.includeSeconds?D<5?r.formatDistance("lessThanXSeconds",5,l):D<10?r.formatDistance("lessThanXSeconds",10,l):D<20?r.formatDistance("lessThanXSeconds",20,l):D<40?r.formatDistance("halfAMinute",0,l):D<60?r.formatDistance("lessThanXMinutes",1,l):r.formatDistance("xMinutes",1,l):d===0?r.formatDistance("lessThanXMinutes",1,l):r.formatDistance("xMinutes",d,l);if(d<45)return r.formatDistance("xMinutes",d,l);if(d<90)return r.formatDistance("aboutXHours",1,l);if(d<F){var H=Math.round(d/60);return r.formatDistance("aboutXHours",H,l)}else{if(d<qe)return r.formatDistance("xDays",1,l);if(d<A){var W=Math.round(d/F);return r.formatDistance("xDays",W,l)}else if(d<Ae)return x=Math.round(d/A),r.formatDistance("aboutXMonths",x,l)}if(x=we(I,p),x<12){var G=Math.round(d/A);return r.formatDistance("xMonths",G,l)}else{var C=x%12,q=Math.floor(x/12);return C<3?r.formatDistance("aboutXYears",q,l):C<9?r.formatDistance("overXYears",q,l):r.formatDistance("almostXYears",q+1,l)}}function Se(e,t){return y(1,arguments),Ce(e,Date.now(),t)}var Le=function(){function e(t,a){this.xf=a,this.f=t,this.found=!1}return e.prototype["@@transducer/init"]=_e.init,e.prototype["@@transducer/result"]=function(t){return this.found||(t=this.xf["@@transducer/step"](t,void 0)),this.xf["@@transducer/result"](t)},e.prototype["@@transducer/step"]=function(t,a){return this.f(a)&&(this.found=!0,t=Ie(this.xf["@@transducer/step"](t,a))),t},e}(),Ne=z(function(t,a){return new Le(t,a)}),R=z(xe(["find"],Ne,function(t,a){for(var i=0,s=a.length;i<s;){if(t(a[i]))return a[i];i+=1}}));const Qe={name:"MediaDetailDialog",props:{modelValue:Boolean,item:{type:Object,required:!0},allItems:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0}},emits:["update:modelValue","toggle-like","update:item"],setup(e,{emit:t}){const a=ee(e.initialIndex);N(()=>e.initialIndex,c=>{a.value=c}),N(()=>e.item,c=>{const d=e.allItems.findIndex(x=>x.uniqueId===c.uniqueId);d!==-1?a.value=d:a.value=e.initialIndex},{deep:!0});const i=te(()=>e.allItems.length>0&&a.value>=0&&a.value<e.allItems.length?e.allItems[a.value]:e.item),s=c=>!c||!c.lien?"":c.lien.includes("http")?c.lien:B(Y("api")+c.lien),n=c=>c?`https://www.youtube.com/embed/${P(c)}?rel=0&autoplay=1`:"",r=c=>c?Se(pe(c),{addSuffix:!0,locale:le}):"",v=()=>{t("update:modelValue",!1)},l=()=>{const c={...i.value,liked:!i.value.liked};t("toggle-like",c)},p=c=>{const d=a.value+c;d>=0&&d<e.allItems.length&&(a.value=d)};return{currentItemToDisplay:i,currentIndex:a,photoUrl:s,youtubeEmbedUrl:n,formatDate:r,emitClose:v,internalToggleLike:l,navigateNext:()=>p(1),navigatePrev:()=>p(-1)}}},Ue={key:0,class:"full-width full-height flex flex-center"},Ve={class:"media-container full-width full-height flex items-center justify-center"},Fe={key:1,class:"w-[90%] md:w-1/2"},Re={key:0,class:"text-subtitle1"},ze={key:1,class:"text-caption q-mt-xs"},Oe={key:2,class:"text-caption q-mt-xs"},Xe={key:3,class:"text-caption text-grey-5 q-mt-xs"},Ee={key:1,class:"absolute-center full-width row justify-between items-center no-pointer-events q-px-sm gt-sm"};function Pe(e,t,a,i,s,n){return u(),w(ie,{"model-value":a.modelValue,"onUpdate:modelValue":i.emitClose,maximized:"","transition-show":"slide-up","transition-hide":"slide-down",class:"media-detail-dialog"},{default:f(()=>[o(X,{class:"bg-dark text-white column no-wrap"},{default:f(()=>[o(fe,null,{default:f(()=>[o(M,{flat:"",round:"",dense:"",icon:"arrow_back",onClick:i.emitClose},null,8,["onClick"]),o(me,{class:"ellipsis"},{default:f(()=>[E(_(i.currentItemToDisplay.album_titre||i.currentItemToDisplay.titre||"Média"),1)]),_:1}),o(M,{flat:"",round:"",dense:"",icon:i.currentItemToDisplay.liked?"favorite":"favorite_border",color:i.currentItemToDisplay.liked?"red":"white",onClick:i.internalToggleLike},null,8,["icon","color","onClick"]),o(M,{flat:"",round:"",dense:"",icon:"close",onClick:i.emitClose},null,8,["onClick"])]),_:1}),o(Q,{class:"col column items-center justify-center q-pa-none media-content-section"},{default:f(()=>[i.currentItemToDisplay?(u(),m("div",Ue,[ae((u(),m("div",Ve,[i.currentItemToDisplay.type===1?(u(),w(j,{key:0,src:i.photoUrl(i.currentItemToDisplay),fit:"contain",class:"full-width full-height media-display-element",alt:i.currentItemToDisplay.titre||"Photo"},{loading:f(()=>[o(he,{color:"white"})]),_:1},8,["src","alt"])):i.currentItemToDisplay.type===0?(u(),m("div",Fe,[o(ge,{src:i.youtubeEmbedUrl(i.currentItemToDisplay.lien),ratio:16/9,class:"media-display-element",frameborder:"0",allowfullscreen:""},null,8,["src"])])):g("",!0)])),[[V,i.navigateNext,void 0,{mouse:!0,left:!0}],[V,i.navigatePrev,void 0,{mouse:!0,right:!0}]])])):g("",!0)]),_:1}),i.currentItemToDisplay.titre||i.currentItemToDisplay.album_description?(u(),w(Q,{key:0,class:"q-pt-md q-pb-sm media-info-section"},{default:f(()=>[i.currentItemToDisplay.titre&&i.currentItemToDisplay.album_titre!==i.currentItemToDisplay.titre?(u(),m("div",Re,_(i.currentItemToDisplay.titre),1)):g("",!0),i.currentItemToDisplay.description?(u(),m("div",ze,_(i.currentItemToDisplay.description),1)):i.currentItemToDisplay.album_description&&!i.currentItemToDisplay.description?(u(),m("div",Oe,_(i.currentItemToDisplay.album_description),1)):g("",!0),i.currentItemToDisplay.created_at?(u(),m("div",Xe," Publié "+_(i.formatDate(i.currentItemToDisplay.created_at)),1)):g("",!0)]),_:1})):g("",!0),a.allItems.length>1?(u(),m("div",Ee,[o(M,{round:"",dense:"",color:"black","text-color":"white",icon:"chevron_left",onClick:i.navigatePrev,disable:i.currentIndex<=0,class:"pointer-events-auto nav-button"},null,8,["onClick","disable"]),o(M,{round:"",dense:"",color:"black","text-color":"white",icon:"chevron_right",onClick:i.navigateNext,disable:i.currentIndex>=a.allItems.length-1,class:"pointer-events-auto nav-button"},null,8,["onClick","disable"])])):g("",!0)]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"])}const Be=O(Qe,[["render",Pe],["__scopeId","data-v-37bd32aa"]]),Ye={name:"MediaAlbumView",components:{MediaDetailDialog:Be},data(){return{album:null,loadingAlbumState:!0,showDetailDialog:!1,selectedMediaItem:null,selectedMediaIndex:0}},computed:{...ne({vuexMediaData:"media/data",currentUser:"user/current"}),albumIdFromRoute(){return parseInt(this.$route.params.albumId)},classeIdFromUser(){return this.currentUser?.annee?.pivot?.idclasse},albumTypeFromRoute(){return this.$route.params.type==="photos"?1:0},mediaItems(){return this.album&&this.album?.meta&&this.album?.meta.media?this.album?.meta.media.map((e,t)=>({...e,uniqueId:`${this.album?.id}-${e.id||`item-${t}`}-${Date.now()}`,album_id:this.album?.id,album_titre:this.album?.titre,album_description:this.album?.description,liked:e.liked||!1})):[]}},methods:{...re({fetchAlbumListFromStoreAction:"media/getData"}),async initializeAlbumData(){this.loadingAlbumState=!0,this.album=null;let e=null;if(this.vuexMediaData&&this.vuexMediaData.data&&this.vuexMediaData.data.length>0&&(e=R(t=>t.id===this.albumIdFromRoute,this.vuexMediaData.data),console.log("Found album:",e),this.setTitle(e?.titre)),!e){console.warn(`Album ${this.albumIdFromRoute} not in Vuex store. Attempting to fetch album list...`);try{const t=await this.fetchAlbumListFromStoreAction({page:1,filter:{classe:this.classeIdFromUser,type:this.albumTypeFromRoute}});this.vuexMediaData&&this.vuexMediaData.data&&(e=R(a=>a.id===this.albumIdFromRoute,this.vuexMediaData.data))}catch(t){console.error("Error fetching album list to find current album:",t)}}e?(this.album={...e},this.setTitle(this.album?.titre)):(console.error(`Album with ID ${this.albumIdFromRoute} could not be found.`),this.setTitle("Album non trouvé")),this.loadingAlbumState=!1},getItemThumbnail(e){return e.type===1?e.lien&&e.lien.includes("http")?e.lien:B(Y("api")+e.lien):`https://img.youtube.com/vi/${P(e.lien)}/mqdefault.jpg`},getItemTypeLabel(e=!1){return this.album?this.album?.media===1?e?"photos":"photo":e?"vidéos":"vidéo":e?"éléments":"élément"},viewMediaDetail(e,t){this.selectedMediaItem=e,this.selectedMediaIndex=t,this.showDetailDialog=!0},toggleLike(e){if(!this.album||!this.album?.meta||!this.album?.meta.media)return;const t=this.album?.meta.media.findIndex(a=>a.id===e.id);if(t!==-1){const a=this.album?.meta.media[t],i=!a.liked;a.liked=i,console.log(`Item ${e.id} liked: ${i}`)}},toggleLikeInDialog(e){this.toggleLike(e),this.selectedMediaItem&&this.selectedMediaItem.uniqueId===e.uniqueId&&(this.selectedMediaItem.liked=e.liked)},updateMediaItemLocally(e){if(!this.album||!this.album?.meta||!this.album?.meta.media)return;const t=this.album?.meta.media.findIndex(a=>a.id===e.id);if(t!==-1){const a=[...this.album?.meta.media];a[t]={...a[t],...e},this.album={...this.album,meta:{...this.album?.meta,media:a}},this.selectedMediaItem&&this.selectedMediaItem.uniqueId===e.uniqueId&&(this.selectedMediaItem={...this.selectedMediaItem,...e})}},goBackToAlbumList(){const e=this.$route.params.type||"photos";this.$router.push({name:"parentMediaList",params:{type:e}})}},watch:{albumIdFromRoute:{immediate:!0,handler:"initializeAlbumData"},vuexMediaData:{deep:!0,handler(e,t){!this.album&&e&&e.data&&e.data.length>0&&(console.log("Vuex media data updated, re-attempting to initialize album view."),this.initializeAlbumData())}}},created(){}},je={key:0,class:"fullscreen flex flex-center column bg-grey-1"},He={key:1,class:"fullscreen flex flex-center column text-center q-pa-md bg-grey-1"},We={class:"empty-state-container shadow-2 q-pa-xl rounded-borders bg-white"},Ge={key:2,class:"album-content-area q-pa-md q-pb-xl"},Je={key:0,class:"q-mb-lg q-pa-lg rounded-borders shadow-3 bg-white description-card"},Ke={class:"text-body1 text-weight-regular text-grey-9",style:{"white-space":"pre-wrap","line-height":"1.7"}},Ze={class:"grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-6"},$e=["onClick"],et={class:"text-center full-width full-height flex flex-center"},tt={class:"absolute-top-right q-pa-sm"},at={class:"text-caption"},it={key:0,class:"absolute-center"},lt={class:"absolute-bottom-right q-pa-sm"},rt={key:1,class:"empty-media-container text-center q-pa-xl text-grey-7 bg-grey-1 rounded-borders q-mt-lg"},nt={key:0,class:"text-subtitle2 q-mr-sm text-weight-medium text-white"};function st(e,t,a,i,s,n){const r=U("ep-footer"),v=U("media-detail-dialog");return u(),w(ue,{class:"page-content page-content-album-view"},{default:f(()=>[s.loadingAlbumState?(u(),m("div",je,[o(S,{color:"primary",size:"60px"}),t[1]||(t[1]=h("p",{class:"q-mt-md text-primary text-h6 text-weight-light"},"Chargement de l'album...",-1))])):s.album?(u(),m("div",Ge,[s.album?.description?(u(),m("div",Je,[o(k,{name:"format_quote",size:"1.5rem",color:"primary",class:"q-mr-sm float-left"}),h("p",Ke,_(s.album?.description),1)])):g("",!0),h("div",Ze,[(u(!0),m(se,null,oe(n.mediaItems,(l,p)=>(u(),m("div",{key:l.uniqueId,class:"cursor-pointer media-item-container",onClick:I=>n.viewMediaDetail(l,p)},[o(X,{class:"media-card full-height no-border"},{default:f(()=>[o(j,{"loading-show-delay":"500",src:n.getItemThumbnail(l),ratio:1,fit:"cover",class:"media-thumbnail rounded-borders"},{loading:f(()=>[h("div",et,[o(S,{color:"white",size:"40px"})])]),default:f(()=>[h("div",tt,[o(ce,{dense:"",outline:"",color:l.type===1?"primary":"secondary","text-color":"white",class:"glossy"},{default:f(()=>[o(k,{name:l.type===1?"photo_camera":"videocam",left:""},null,8,["name"]),h("span",at,_(l.type===1?"Photo":"Vidéo"),1)]),_:2},1032,["color"])]),l.type===0?(u(),m("div",it,[o(k,{name:"play_circle_filled",color:"white",size:"4rem",class:"pulse-animation"})])):g("",!0),h("div",lt,[o(M,{round:"",glossy:"",icon:l.liked?"favorite":"favorite_border",color:l.liked?"red-7":"grey-7",onClick:de(I=>n.toggleLike(l),["stop"]),size:"md",class:"shadow-5"},null,8,["icon","color","onClick"])])]),_:2},1032,["src"])]),_:2},1024)],8,$e))),128))]),n.mediaItems.length===0&&!s.loadingAlbumState?(u(),m("div",rt,[o(k,{name:"image_not_supported",size:"4em",color:"grey-5",class:"q-mb-md"}),t[4]||(t[4]=h("p",{class:"text-h6 text-weight-medium"},"Aucun média",-1)),t[5]||(t[5]=h("p",{class:"text-subtitle1"},"Cet album ne contient aucun média pour le moment.",-1))])):g("",!0)])):(u(),m("div",He,[h("div",We,[o(k,{name:"sentiment_dissatisfied",size:"5em",color:"grey-6",class:"q-mb-md"}),t[2]||(t[2]=h("p",{class:"text-h5 text-weight-medium text-primary"},"Oops!",-1)),t[3]||(t[3]=h("p",{class:"text-subtitle1 text-grey-8 q-mb-lg"},"L'album demandé n'a pas pu être trouvé ou est inaccessible.",-1)),o(M,{label:"Retour aux albums",color:"primary",unelevated:"",rounded:"",class:"q-px-md q-py-sm",onClick:n.goBackToAlbumList},null,8,["onClick"])])])),o(r,{to:"#footer-portal",class:"media-footer"},{default:f(()=>[n.mediaItems.length>=0?(u(),m("span",nt,[o(k,{name:"photo_library",class:"q-mr-xs"}),E(" "+_(n.mediaItems.length)+" "+_(n.getItemTypeLabel(n.mediaItems.length>1||n.mediaItems.length===0)),1)])):g("",!0)]),_:1}),s.selectedMediaItem?(u(),w(v,{key:3,item:s.selectedMediaItem,"all-items":n.mediaItems,"initial-index":s.selectedMediaIndex,modelValue:s.showDetailDialog,"onUpdate:modelValue":t[0]||(t[0]=l=>s.showDetailDialog=l),"onUpdate:item":n.updateMediaItemLocally,onToggleLike:n.toggleLikeInDialog},null,8,["item","all-items","initial-index","modelValue","onUpdate:item","onToggleLike"])):g("",!0)]),_:1})}const Dt=O(Ye,[["render",st],["__scopeId","data-v-0cb66a23"]]);export{Dt as default};
