import{Q as Oe}from"./QSelect-DchnWyXK.js";import{Q as G}from"./QImg-BMvxJu3S.js";import{_ as me,aO as se,aP as ne,B as C,a4 as D,S as l,a5 as e,a6 as t,Q as v,R as E,af as re,av as te,a3 as K,ad as i,ab as s,aF as ae,aS as n,a8 as H,a7 as Y,ay as O,a9 as N,aa as W,aE as X,aD as J,ck as ke,A as z,bd as U,dk as ye,C as Ne,ac as ge,b3 as he,aB as Ee,cv as et,z as tt,a as Ae,Y as at,ds as Le,ag as lt,ax as st,aC as nt,a2 as rt,aG as it}from"./index-Bl2lQPd7.js";import{Q as I,a as g}from"./QItem-De3v03wU.js";import{Q as c}from"./QItemLabel-BkJiB6aE.js";import{Q as ie}from"./QList-CMzNTEGD.js";import{Q as oe}from"./QToolbarTitle-C8APieXG.js";import{Q as ue}from"./QToolbar-DR-_wX4W.js";import{Q as ot}from"./QForm-Dk45GsL9.js";import{C as le}from"./ClosePopup-BY_YGFBZ.js";import{u as Ce,a as Ve,b as $e,c as Qe,H as Se,cn as De}from"./index.esm.min-FpMw1SSI.js";import{g as pe,a as ut,p as _e}from"./groupBy-BPtQCKGy.js";import{s as dt,a as be,i as ct,b as Te,c as Ye,d as ft}from"./index-BlE9ZCrH.js";import{i as ze}from"./install-C7aL04A7.js";import{b as mt}from"./install-Dh964sWS.js";import{a as Be}from"./install-qCEEq-uE.js";import{i as qe}from"./installSVGRenderer-BO49usYp.js";import{Q as xe}from"./QBadge-Bjfo5tRO.js";import{f as Me}from"./index-C9ZTL5MN.js";import{Q as vt}from"./QSpace-CKKoNTi_.js";import{Q as Re}from"./QChip-C9OfA2gn.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";import"./_xfBase-4bk-g_Vj.js";import"./index-BXMW6yyY.js";import"./index-CbPSoDvq.js";const pt={class:"row q-col-gutter-sm"},_t={class:"col-md-3 col-sm-12 col-6"},bt={class:"col-md-3 col-sm-12 col-6"},gt={__name:"Details",props:["data","eleve","classe"],setup(x){Ce([Ve,$e,Qe,ze,mt,Be,qe]),ke(De,"light");const h=x;se();const A=ne();C(()=>A.getters["user/current"]),C(()=>A.getters["stats/notes"]);const $=C(()=>{let f=h.data.eleve.find(r=>r.id===h.data.data.id);return pe(r=>r.idperiode+"_"+r.numero,f.data)}),_=C(()=>{let f=h.data.classe.find(r=>r.id===h.data.data.id);return pe(r=>r.idperiode+"_"+r.numero,f.data)}),m=dt(ut("id")),b=C(()=>{let f=Object.keys($.value).map(r=>({id:r,label:$.value[r][0].periodes.periode_fr+" - C"+$.value[r][0].numero,data:$.value[r]}));return m(f)}),B=C(()=>{let f=Object.keys(_.value).map(r=>({id:r,label:_.value[r][0].periodes.periode_fr+" - C"+_.value[r][0].numero,data:_.value[r]}));return m(f)}),k=C(()=>({tooltip:{trigger:"item"},grid:{left:0,right:0},legend:{center:"top",data:[h.eleve.nom+" "+h.eleve.prenom,h.classe.classe_fr]},xAxis:{type:"category",data:Q.value},yAxis:{type:"value",show:!1},series:[{data:j.value,type:"line",name:h.eleve.nom+" "+h.eleve.prenom,color:"#32D305"},{data:q.value,type:"line",name:h.classe.classe_fr,color:"#07331B"}]})),Q=C(()=>F().map(f=>f.label)),j=C(()=>F().map(f=>f.data.toFixed(2))),q=C(()=>{let f=F(!0);return F().map(r=>{let p=f.find(y=>y.id===r.id);return p?p.data.toFixed(2):null})});function F(f){let r=null;return f?r=B.value:r=b.value,r.map(p=>{let y=_e("notes_personnes",p.data).map(w=>w.length?be(_e("note",w))/w.length:0);return y.length?y=be(y)/y.length:y=0,{id:p.id,label:p.label,data:y}})}function a(f){return be(_e("note",f))}function S(){let f=0,r=null;for(let p=0;p<b.value.length;p++){const y=b.value[p];for(let w=0;w<y.data.length;w++){const L=y.data[w];let P=a(L.notes_personnes);P>=f&&(r={data:L,note:P},f=P)}}return r}function d(){let f=100,r=null;for(let p=0;p<b.value.length;p++){const y=b.value[p];for(let w=0;w<y.data.length;w++){const L=y.data[w];let P=a(L.notes_personnes);P<=f&&(r={data:L,note:P},f=P)}}return r}function M(f){return f.data.matieres.matiere_fr}return(f,r)=>(l(),D(N,null,[e(X,{style:{"min-width":"100vw","max-width":"100vw"},square:""},{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[te(e(K,{flat:"",dense:"",icon:"arrow_back"},null,512),[[le]]),e(oe,null,{default:t(()=>[i(s(x.data.data.discipline[0].description)+" - "+s(x.eleve.nom)+" "+s(x.eleve.prenom),1)]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(n(Se),{class:"chart",option:k.value},null,8,["option"])]),_:1}),e(ae,{class:"bg-grey-2"},{default:t(()=>[H("div",pt,[H("div",_t,[e(I,{class:"bg-white shadow-1"},{default:t(()=>[e(g,{avatar:"",class:"text-positive"},{default:t(()=>[e(Y,{"font-size":"40px"},{default:t(()=>[e(O,{name:"keyboard_double_arrow_up"})]),_:1})]),_:1}),e(g,null,{default:t(()=>[e(c,{class:"text-h4"},{default:t(()=>[i(s(S().note.toFixed(2)),1)]),_:1}),e(c,null,{default:t(()=>[i(s(M(S())),1)]),_:1}),e(c,{caption:""},{default:t(()=>[i(s(S().data.periodes.periode_fr+" - C"+S().data.numero),1)]),_:1})]),_:1})]),_:1})]),H("div",bt,[e(I,{class:"bg-white shadow-1"},{default:t(()=>[e(g,{avatar:"",class:"text-negative"},{default:t(()=>[e(Y,{"font-size":"40px"},{default:t(()=>[e(O,{name:"keyboard_double_arrow_down"})]),_:1})]),_:1}),e(g,null,{default:t(()=>[e(c,{class:"text-h4"},{default:t(()=>[i(s(d().note.toFixed(2)),1)]),_:1}),e(c,null,{default:t(()=>[i(s(M(d())),1)]),_:1}),e(c,{caption:""},{default:t(()=>[i(s(d().data.periodes.periode_fr+" - C"+d().data.numero),1)]),_:1})]),_:1})]),_:1})])])]),_:1}),b.value?(l(),v(ie,{key:0,separator:"",bordered:""},{default:t(()=>[(l(!0),D(N,null,W(b.value,(p,y)=>(l(),D(N,null,[e(I,{clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,{style:{"font-weight":"600","font-size":"var(--taille-m)"}},{default:t(()=>[i(s(p.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),(l(!0),D(N,null,W(p.data,(w,L)=>(l(),v(I,{dense:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(w.matieres.matiere_fr),1)]),_:2},1024)]),_:2},1024),e(g,{avatar:""},{default:t(()=>[e(c,null,{default:t(()=>[i(s(a(w.notes_personnes)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))],64))),256))]),_:1})):E("",!0)]),_:1}),e(J)],64))}},ht=me(gt,[["__scopeId","data-v-2bb34517"]]),yt={key:1,class:"relative-position",style:{"min-height":"20vh"}},wt={__name:"Notes",props:["eleve","classe","annee"],setup(x){Ce([Ve,$e,Qe,ze,ct,Be,qe]),ke(De,"light");let h=z(!1),A=z(null);const $=x;se();const _=ne();C(()=>_.getters["user/current"]);const m=C(()=>_.getters["stats/notes"]),b=C(()=>(console.log(m.value.eleve),pe(r=>(console.log(r),r.matieres.discipline[0].iddiscipline),m.value.eleve))),B=C(()=>(console.log(m.value.classe),pe(r=>r.matieres.discipline[0].iddiscipline,m.value.classe))),k=C(()=>Object.keys(b.value).map(p=>({id:parseInt(p),discipline:b.value[p][0].matieres.discipline,data:b.value[p]}))),Q=C(()=>Object.keys(B.value).map(p=>({id:parseInt(p),discipline:B.value[p][0].matieres.discipline,data:B.value[p]}))),j=C(()=>({tooltip:{trigger:"item"},grid:{bottom:120,left:0,right:0},legend:{center:"top",data:[$.eleve.nom+" "+$.eleve.prenom,$.classe.classe_fr]},xAxis:{type:"category",data:q.value,axisLabel:{show:!0,interval:0,rotate:45}},yAxis:{type:"value",show:!1},series:[{data:F.value,type:"bar",name:$.eleve.nom+" "+$.eleve.prenom,color:"#32D305"},{data:a.value,type:"bar",name:$.classe.classe_fr,color:"#07331B"}]})),q=C(()=>d().map(r=>r.discipline[0].description)),F=C(()=>d().map(r=>r.data.toFixed(2))),a=C(()=>{let r=d(!0);return d().map(p=>{let y=r.find(w=>w.id===p.id);return y?y.data.toFixed(2):null})});function S(r){A.value={data:r,eleve:k.value,classe:Q.value},h.value=!0}function d(r){let p=null;return r?p=Q.value:p=k.value,p.map(y=>{let w=_e("notes_personnes",y.data).map(L=>L.length?be(_e("note",L))/L.length:0);return w.length?w=be(w)/w.length:w=0,{id:y.id,discipline:y.discipline,data:w}})}function M(){_.dispatch("stats/getNotes",f())}function f(){let r={annee:$.annee.idannee,classe:$.classe.idclasse};return $.eleve&&(r.eleve=$.eleve.idpers),r}return _.commit("stats/setNotes",null),M(),(r,p)=>(l(),D(N,null,[e(X,{style:{"min-width":"100vw","max-width":"100vw"}},{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[te(e(K,{flat:"",dense:"",icon:"arrow_back"},null,512),[[le]]),e(oe,null,{default:t(()=>[i(s(x.eleve.nom)+" "+s(x.eleve.prenom),1)]),_:1})]),_:1}),m.value&&d().length?(l(),D(N,{key:0},[e(ae,null,{default:t(()=>[e(n(Se),{class:"chart",option:j.value},null,8,["option"])]),_:1}),b.value?(l(),v(ie,{key:0,separator:"",bordered:""},{default:t(()=>[(l(!0),D(N,null,W(d(),(y,w)=>(l(),v(I,{onClick:L=>S(y),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,{style:{"font-weight":"600","font-size":"var(--taille-m)"}},{default:t(()=>[i(s(y.discipline[0].description),1)]),_:2},1024)]),_:2},1024),e(g,{avatar:""},{default:t(()=>[e(c,null,{default:t(()=>[i(s(y.data.toFixed(2)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),256))]),_:1})):E("",!0)],64)):(l(),D("div",yt,[e(G,{class:"q-mt-md",src:"/edu2.svg",style:{"max-width":"550px"}})]))]),_:1}),e(J,{modelValue:n(h),"onUpdate:modelValue":p[0]||(p[0]=y=>U(h)?h.value=y:h=y),position:"bottom",maximized:""},{default:t(()=>[n(A)?(l(),v(ht,{key:0,data:n(A),eleve:x.eleve,classe:x.classe},null,8,["data","eleve","classe"])):E("",!0)]),_:1},8,["modelValue"])],64))}},xt=me(wt,[["__scopeId","data-v-5d31dba3"]]),kt={key:2,class:"relative-position",style:{"min-height":"20vh"}},Ct={__name:"Absences",props:["bilan","classe","annee"],setup(x){ye(a=>({bf97eae8:n($)})),Ce([Ve,$e,Qe,ze,Te,Be,qe,Ye]),ke(De,"light");const h=x;se();const A=ne();C(()=>A.getters["user/current"]);let $="350px",_=F();const m=[],b=["800","1000","1200","1400","1600","1800"],B=[1,2,3,4,5,6],k=["","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],Q=z(!1);Ne(()=>Q.value=!0),_.forEach((a,S)=>{let d=[];a.data.forEach((M,f)=>{d.push([M.jour,M.debut,M.duree_absence])}),m.push({name:a.label,type:"scatter",data:d,itemStyle:{color:a.discipline.color},symbolSize:function(M){return M[2]/3}})});const j=z({legend:{show:!0},grid:{containLabel:!0,left:0,right:0,bottom:0},tooltip:{trigger:"item",formatter:a=>a.marker+"<b>"+a.seriesName+"</b><br>"+(a.data[0]<7?k[a.data[0]]:"")+" à "+String(a.data[1]).replace(/(.)(?=(\d{2})+$)/g,"$1h")+"<br>"+a.data[2]+"min"},xAxis:{type:"category",data:B.sort(),min:0,max:5,axisLabel:{show:!0,rotate:45,formatter:(a,S)=>a<7?k[a]:""}},yAxis:{type:"value",data:b,min:600,axisLabel:{show:!0,interval:200,formatter:function(a,S){return String(a).replace(/(.)(?=(\d{2})+$)/g,"$1h")}}},series:m});function q(){return h.bilan&&h.bilan.eleve&&h.bilan.eleve.absences_eleve?h.bilan.eleve.absences_eleve.filter(a=>a.is_absence===1):[]}function F(){let a=pe(d=>d.idmatiere,q());return Object.keys(a).map(d=>({id:parseInt(d),label:a[d][0].matieres.matiere_fr,discipline:a[d][0].matieres.discipline[0],data:a[d]}))}return(a,S)=>(l(),v(X,{style:{"min-width":"100vw","max-width":"100vw"}},{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[te(e(K,{flat:"",dense:"",icon:"arrow_back"},null,512),[[le]]),e(oe,null,{default:t(()=>[i(s(x.bilan.eleve.nom)+" "+s(x.bilan.eleve.prenom),1)]),_:1})]),_:1}),j.value&&n(_)&&n(_).length&&Q.value?(l(),v(ae,{key:0},{default:t(()=>[e(n(Se),{class:"chart",option:j.value},null,8,["option"])]),_:1})):E("",!0),n(_)&&n(_).length?(l(),v(ie,{key:1,separator:"",bordered:""},{default:t(()=>[(l(!0),D(N,null,W(n(_),(d,M)=>(l(),D(N,null,[e(I,{clickable:"",style:ge({"border-bottom":d.discipline.color+" 5px solid"})},{default:t(()=>[e(g,null,{default:t(()=>[e(c,{style:{"font-weight":"600","font-size":"var(--taille-m)"}},{default:t(()=>[i(s(d.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["style"]),(l(!0),D(N,null,W(d.data,(f,r)=>(l(),v(I,null,{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(n(Me)(n(he)(String(f.date_absence).substring(0,8)),"E d MMM Y"))+" ",1),e(c,null,{default:t(()=>[f.justifer?(l(),v(xe,{key:0,color:"positive"},{default:t(()=>S[0]||(S[0]=[i("Justifé")])),_:1})):(l(),v(xe,{key:1,color:"negative"},{default:t(()=>S[1]||(S[1]=[i("Non justifé")])),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:t(()=>[e(c,null,{default:t(()=>[i(s(String(f.debut).replace(/(.)(?=(\d{2})+$)/g,"$1h")),1)]),_:2},1024),e(c,null,{default:t(()=>[i(s(f.duree_absence)+"min ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))],64))),256))]),_:1})):(l(),D("div",kt,[e(G,{class:"q-mt-md",src:"/under.svg",style:{"max-width":"550px"}})]))]),_:1}))}},Vt=me(Ct,[["__scopeId","data-v-1eaf11b8"]]),$t={key:2,class:"relative-position",style:{"min-height":"20vh"}},Qt={__name:"Retards",props:["bilan","classe","annee"],setup(x){ye(a=>({d3e6b1ca:n($)})),Ce([Ve,$e,Qe,ze,Te,Be,qe,Ye]),ke(De,"light");const h=x;se();const A=ne();C(()=>A.getters["user/current"]);let $="350px";const _=z(!1);Ne(()=>_.value=!0);let m=F();const b=[],B=["800","1000","1200","1400","1600","1800"],k=[1,2,3,4,5,6],Q=["","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"];m.forEach((a,S)=>{let d=[];a.data.forEach((M,f)=>{d.push([M.jour,M.debut,M.duree_absence])}),b.push({name:a.label,type:"scatter",data:d,itemStyle:{color:a.discipline.color},symbolSize:function(M){return M[2]/2}})});const j=z({legend:{show:!0},grid:{containLabel:!0,left:0,right:0,bottom:0},tooltip:{trigger:"item",formatter:a=>a.marker+"<b>"+a.seriesName+"</b><br>"+(a.data[0]<7?Q[a.data[0]]:"")+" à "+String(a.data[1]).replace(/(.)(?=(\d{2})+$)/g,"$1h")+"<br>"+a.data[2]+"min"},xAxis:{type:"category",data:k.sort(),min:0,max:5,axisLabel:{show:!0,rotate:45,formatter:(a,S)=>a<7?Q[a]:""}},yAxis:{type:"value",data:B,min:600,axisLabel:{show:!0,interval:200,formatter:function(a,S){return String(a).replace(/(.)(?=(\d{2})+$)/g,"$1h")}}},series:b});function q(){return h.bilan&&h.bilan.eleve&&h.bilan.eleve.absences_eleve?h.bilan.eleve.absences_eleve.filter(a=>a.is_absence===0):[]}function F(){let a=pe(d=>d.idmatiere,q());return Object.keys(a).map(d=>({id:parseInt(d),label:a[d][0].matieres.matiere_fr,discipline:a[d][0].matieres.discipline[0],data:a[d]}))}return(a,S)=>(l(),v(X,{style:{"min-width":"100vw","max-width":"100vw"}},{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[te(e(K,{flat:"",dense:"",icon:"arrow_back"},null,512),[[le]]),e(oe,null,{default:t(()=>[i(s(x.bilan.eleve.nom)+" "+s(x.bilan.eleve.prenom),1)]),_:1})]),_:1}),j.value&&n(m)&&n(m).length&&_.value?(l(),v(ae,{key:0},{default:t(()=>[e(n(Se),{class:"chart",option:j.value},null,8,["option"])]),_:1})):E("",!0),n(m)&&n(m).length?(l(),v(ie,{key:1,separator:"",bordered:""},{default:t(()=>[(l(!0),D(N,null,W(n(m),(d,M)=>(l(),D(N,null,[e(I,{clickable:"",style:ge({"border-bottom":d.discipline.color+" 5px solid"})},{default:t(()=>[e(g,null,{default:t(()=>[e(c,{style:{"font-weight":"600","font-size":"var(--taille-m)"}},{default:t(()=>[i(s(d.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["style"]),(l(!0),D(N,null,W(d.data,(f,r)=>(l(),v(I,null,{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(n(Me)(n(he)(String(f.date_absence).substring(0,8)),"E d MMM Y"))+" ",1),e(c,null,{default:t(()=>[f.justifer?(l(),v(xe,{key:0,color:"positive"},{default:t(()=>S[0]||(S[0]=[i("Justifé")])),_:1})):(l(),v(xe,{key:1,color:"negative"},{default:t(()=>S[1]||(S[1]=[i("Non justifé")])),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:t(()=>[e(c,null,{default:t(()=>[i(s(String(f.debut).replace(/(.)(?=(\d{2})+$)/g,"$1h")),1)]),_:2},1024),e(c,null,{default:t(()=>[i(s(f.duree_absence)+"min ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))],64))),256))]),_:1})):(l(),D("div",$t,[e(G,{class:"q-mt-md",src:"/under.svg",style:{"max-width":"550px"}})]))]),_:1}))}},St=me(Qt,[["__scopeId","data-v-4c17fd8c"]]),Dt={key:1,class:"relative-position",style:{"min-height":"20vh"}},zt={__name:"Maladies",props:["bilan","classe","annee"],setup(x){ye(m=>({"54de0995":n($)}));const h=x;se();const A=ne();C(()=>A.getters["user/current"]);let $="350px",_=h.bilan.eleve.maladies;return(m,b)=>(l(),v(X,{style:{"min-width":"100vw","max-width":"100vw"}},{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[te(e(K,{flat:"",dense:"",icon:"arrow_back"},null,512),[[le]]),e(oe,null,{default:t(()=>[i(s(x.bilan.eleve.nom)+" "+s(x.bilan.eleve.prenom),1)]),_:1})]),_:1}),n(_)&&n(_).length?(l(),v(ie,{key:0,separator:"",bordered:""},{default:t(()=>[(l(!0),D(N,null,W(n(_),(B,k)=>(l(),v(I,{clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,{style:{"font-weight":"600","font-size":"var(--taille-m)"}},{default:t(()=>[i(s(B.maladies.description),1)]),_:2},1024),e(c,null,{default:t(()=>[e(O,{class:"float-left",name:"sym_o_medication"}),b[0]||(b[0]=i()),H("span",null,s(B.traitement.description),1)]),_:2},1024),B.idreport>1?(l(),v(c,{key:0},{default:t(()=>[i(s(B.report.description),1)]),_:2},1024)):E("",!0)]),_:2},1024),B.idtype>1?(l(),v(g,{key:0,side:"",top:""},{default:t(()=>[e(c,null,{default:t(()=>[i(s(B.type.description),1)]),_:2},1024)]),_:2},1024)):E("",!0)]),_:2},1024))),256))]),_:1})):(l(),D("div",Dt,[e(G,{class:"q-mt-md",src:"/med.svg",style:{"max-width":"550px"}})]))]),_:1}))}},Bt=me(zt,[["__scopeId","data-v-41ef40ec"]]),qt={key:1,class:"relative-position",style:{"min-height":"20vh"}},Mt={class:"flex flex-center",style:{"max-width":"85%"}},It={__name:"Infractions",props:["bilan","classe","annee"],setup(x){ye(Q=>({"700f2f7d":n($)}));const h=x;se();const A=ne();C(()=>A.getters["user/current"]);let $="350px",_=h.bilan.eleve.infractions,m=z(!1),b=null;function B(Q){b=Q,m.value=!0}function k(Q){if(Q.grave===1)return"var(--q-positive)";if(Q.grave===2)return"var(--q-warning)";if(Q.grave===3)return"var(--q-negative)"}return(Q,j)=>(l(),v(X,{style:{"min-width":"100vw","max-width":"100vw"}},{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[te(e(K,{flat:"",dense:"",icon:"arrow_back"},null,512),[[le]]),e(oe,null,{default:t(()=>[i(s(x.bilan.eleve.nom)+" "+s(x.bilan.eleve.prenom),1)]),_:1})]),_:1}),n(_)&&n(_).length?(l(),v(ie,{key:0,separator:""},{default:t(()=>[(l(!0),D(N,null,W(n(_),(q,F)=>(l(),v(I,{key:F,clickable:"",style:ge("border-left: 5px solid "+k(q)),onClick:a=>B(q)},{default:t(()=>[e(g,null,{default:t(()=>[e(c,{style:{"font-weight":"600"}},{default:t(()=>[i(s(q.infraction.description),1)]),_:2},1024),e(c,{lines:1},{default:t(()=>[i(s(q.observation),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["style","onClick"]))),128))]),_:1})):(l(),D("div",qt,[e(G,{class:"q-mt-md",src:"/camp.svg",style:{"max-width":"550px"}})])),e(J,{modelValue:n(m),"onUpdate:modelValue":j[0]||(j[0]=q=>U(m)?m.value=q:m=q),position:"left",maximized:""},{default:t(()=>[e(X,null,{default:t(()=>[e(ae,{class:"row text-white",style:ge("font-weight:600;background-color: "+k(n(b)))},{default:t(()=>[H("div",Mt,s(n(b).infraction.description),1),e(vt),te(e(K,{icon:"close",flat:"",round:"",dense:""},null,512),[[le]])]),_:1},8,["style"]),e(ae,null,{default:t(()=>[i(s(n(b).observation),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},At=me(It,[["__scopeId","data-v-59c39eff"]]),Lt={key:1,class:"relative-position",style:{"min-height":"20vh"}},Et={__name:"Rencontres",props:["bilan","classe","annee"],setup(x){ye(b=>({32002238:n($)}));const h=x;se();const A=ne();C(()=>A.getters["user/current"]);let $="350px",_=h.bilan.eleve.meetings_eleve;function m(b){if(b.result===1)return"var(--q-positive)";if(b.result===2)return"var(--q-warning)";if(b.result===3)return"var(--q-negative)"}return(b,B)=>(l(),v(X,{style:{"min-width":"100vw","max-width":"100vw"}},{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[te(e(K,{flat:"",dense:"",icon:"arrow_back"},null,512),[[le]]),e(oe,null,{default:t(()=>[i(s(x.bilan.eleve.nom)+" "+s(x.bilan.eleve.prenom),1)]),_:1})]),_:1}),n(_)&&n(_).length?(l(),v(ie,{key:0,separator:""},{default:t(()=>[(l(!0),D(N,null,W(n(_),(k,Q)=>(l(),v(I,{clickable:"",style:ge("border-left: 5px solid "+m(k))},{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[k.parent?(l(),v(Re,{key:0,class:"q-ma-none",dense:"",square:"",color:"secondary","text-color":"white"},{default:t(()=>[e(Y,null,{default:t(()=>[e(G,{src:n(Ee)(k.parent),ratio:"1"},null,8,["src"])]),_:2},1024),i("  "+s(k.parent.nom)+" "+s(k.parent.prenom),1)]),_:2},1024)):E("",!0),e(O,{name:"width"}),k.personne?(l(),v(Re,{key:1,class:"q-ma-none",dense:"",square:"",color:"primary","text-color":"white"},{default:t(()=>[e(Y,null,{default:t(()=>[e(G,{src:n(Ee)(k.personne),ratio:"1"},null,8,["src"])]),_:2},1024),i("  "+s(k.personne.nom)+" "+s(k.personne.prenom),1)]),_:2},1024)):E("",!0)]),_:2},1024),e(c,{style:{"font-weight":"600","font-size":"var(--taille-m)"}},{default:t(()=>[i(s(k.objet),1)]),_:2},1024),e(c,null,{default:t(()=>[i(s(k.observation),1)]),_:2},1024),e(c,{caption:""},{default:t(()=>[i(s(n(Me)(n(he)(k.date_meeting),"E d MMM Y  H:mm")),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["style"]))),256))]),_:1})):(l(),D("div",Lt,[e(G,{class:"q-mt-md",src:"/meet.svg",style:{"max-width":"550px"}})]))]),_:1}))}},Nt=me(Et,[["__scopeId","data-v-ffb09156"]]),jt={class:"q-pa-lg flex flex-center tour"},Ft={key:0},Pt={class:"bg-grey-2 q-pa-md"},Ut={class:"row q-col-gutter-sm"},Ot={class:"col-md-3 col-sm-12 col-6"},Rt={key:1,class:"relative-position full-height",style:{"min-height":"50vh"}},ya={__name:"BilanEducatif",setup(x){const h=tt();let A,$=null;et(()=>{A=h.appContext.config.globalProperties.$i18n,$=A.t});const _=se(),m=ne(),b=C(()=>m.getters["user/current"]),k=C(()=>m.getters["user/config"]).value.roles,Q=z(!0),j=z(!0),q=z(null),F=z(null);m.dispatch("stats/reset");const a=C(()=>m.getters["stats/bilan"]),S=C(()=>m.getters["stats/eleves"]);let d=z(null);const M={useKeyboardNavigation:!1,highlight:!0,labels:{buttonSkip:"Fermer",buttonPrevious:"Precedant",buttonNext:"Suivant",buttonStop:"Fermer"}};let f=[{target:".tour",content:"Veuillez sélectionner un élève"}];Je(),Ne(()=>{Q.value||d.value.start()});let r=z(null);r.value||Ae("post","/settings").then(V=>{r.value=V.data});const p=C(()=>r.value&&r.value.hasOwnProperty("classes")?r.value.classes:[]);let y=z(S.value.map(V=>({label:V.nom+" "+V.prenom,value:V.idpers}))),w=z(!1),L=z(!1),P=z(!1),de=z(!1),ce=z(!1),fe=z(!1);const Z=C(()=>{if(b.value&&b.value.hasOwnProperty("annee"))return b.value.annee}),R=z(null);let ee=z(null),Ie=z([]);at(Z,(V,o)=>{Pe()}),m.commit("setTitle","Bilan éducatif");function Je(){Le.has("bilanPass")&&(Q.value=!1,Ae("post","/stats/can",{pass:Le.get("bilanPass")}).then(V=>{Q.value=!1,d.value.start()}).catch(()=>{Q.value=!0}))}function je(){F.value.validate().then(V=>V?(Ae("post","/stats/can",{pass:q.value}).then(({data:o})=>{o&&o.success&&(Le.set("bilanPass",q.value),Q.value=!1,d.value.start())}).catch(()=>{Q.value=!0,_.notify({color:"negative",message:"Mot de passe erroné",position:"bottom",icon:"error_outline",actions:[{label:_.lang.label.close,color:"yellow"}]})}),!1):(_.notify({color:"negative",message:$("stats.fields"),position:"bottom",icon:"error_outline",actions:[{label:_.lang.label.close,color:"yellow"}]}),!1))}function Fe(){d.value.finish()}function Pe(){We(),R.value=p.value.find(V=>V.idclasse===R.value),R.value&&m.dispatch("stats/getEleves",Ue())}function He(){ee.value&&m.dispatch("stats/getBilan",Ue()).then(()=>{a.value&&m.commit("setTitle",a.value.titre)})}function Ge(){return a.value&&a.value.eleve&&a.value.eleve.absences_eleve?a.value.eleve.absences_eleve.filter(V=>V.is_absence===1):[]}function Ke(){return a.value&&a.value.eleve&&a.value.eleve.absences_eleve?a.value.eleve.absences_eleve.filter(V=>V.is_absence===0):[]}function ve(V,o,T){if(a.value){let u=null;if(T?u=a.value.section.find(we=>we.key===V&&we.type===T):u=a.value.section.find(we=>we.key===V),u)return u.label}return o}function We(){m.dispatch("stats/reset"),ee.value=null}function Ue(){let V={annee:Z.value.idannee,classe:R.value.idclasse};return ee.value&&(V.eleve=ee.value.value),V}function Xe(V,o){if(V===""){o(()=>{y.value=S.value.map(T=>({label:T.nom+" "+T.prenom,value:T.idpers}))});return}o(()=>{const T=V.toLowerCase();y.value=S.value.map(u=>({label:u.nom+" "+u.prenom,value:u.idpers})).filter(u=>u.label.toLowerCase().indexOf(T)>-1)})}function Ze(V,o){if(V===""){o(()=>{Ie.value=p.value});return}o(()=>{const T=V.toLowerCase();Ie.value=p.value.filter(u=>u.classe_fr.toLowerCase().indexOf(T)>-1)})}return(V,o)=>{const T=lt("v-tour");return l(),D(N,null,[e(nt,{class:"page-content"},{default:t(()=>[H("div",jt,[e(Oe,{modelValue:R.value,"onUpdate:modelValue":[o[0]||(o[0]=u=>R.value=u),Pe],options:n(Ie),label:"Classes","emit-value":"","option-value":"idclasse","option-label":"classe_fr","map-options":"","use-input":"","input-debounce":"0",onFilter:Ze,onClick:Fe,class:"full-width"},null,8,["modelValue","options"]),e(Oe,{"use-input":"","input-debounce":"0",onFilter:Xe,onClick:Fe,options:n(y),label:"Eleve",modelValue:n(ee),"onUpdate:modelValue":[o[1]||(o[1]=u=>U(ee)?ee.value=u:ee=u),He],class:"full-width"},null,8,["options","modelValue"])]),a.value&&a.value.eleve?(l(),D("div",Ft,[e(X,{flat:"",bordered:""},{default:t(()=>[e(I,null,{default:t(()=>[e(g,{avatar:""},{default:t(()=>[e(Y,{size:"60px"},{default:t(()=>[e(G,{src:n(Ee)(a.value.eleve),ratio:"1"},null,8,["src"])]),_:1})]),_:1}),e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(a.value.eleve.nom)+" "+s(a.value.eleve.prenom),1)]),_:1}),e(c,{caption:"",style:{"font-weight":"600"}},{default:t(()=>[i(s(R.value.classe_fr),1)]),_:1}),e(c,{caption:""},{default:t(()=>[i(s(a.value.eleve.code),1)]),_:1}),e(c,{caption:""},{default:t(()=>[e(O,{name:"icon_anniversaire"}),i(" "+s(n(Me)(n(he)(a.value.eleve.datenaissance),"d/MM/Y"))+" ("+s(n(ft)(new Date,n(he)(a.value.eleve.datenaissance)))+") ",1)]),_:1})]),_:1})]),_:1}),a.value.eleve.ara_adresse&&n(k).admin?(l(),D(N,{key:0},[e(st),e(I,null,{default:t(()=>[e(g,{avatar:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(O,{name:"family_restroom"})]),_:1})]),_:1}),e(g,null,{default:t(()=>[e(c,{style:{"font-size":"var(--taille-m)","font-weight":"600"}},{default:t(()=>o[18]||(o[18]=[i("Situation familiale ")])),_:1}),e(c,null,{default:t(()=>[i(s(a.value.eleve.ara_adresse),1)]),_:1})]),_:1})]),_:1})],64)):E("",!0)]),_:1}),H("div",Pt,[H("div",Ut,[H("div",Ot,[e(I,{class:"bg-white shadow-1",onClick:o[2]||(o[2]=u=>U(ce)?ce.value=!0:ce=!0),clickable:""},{default:t(()=>[e(g,{avatar:"",class:"text-red"},{default:t(()=>[e(Y,{"font-size":"30px"},{default:t(()=>[e(O,{name:"icon_absences"})]),_:1})]),_:1}),e(g,null,{default:t(()=>[e(c,{class:"text-h4"},{default:t(()=>[i(s(Ge().length),1)]),_:1}),e(c,null,{default:t(()=>[i(s(ve("eleve.absencesEleve","Absences","absence")),1)]),_:1})]),_:1})]),_:1})]),H("div",{class:"col-md-3 col-sm-12 col-6",onClick:o[3]||(o[3]=u=>U(fe)?fe.value=!0:fe=!0),clickable:""},[e(I,{class:"bg-white shadow-1"},{default:t(()=>[e(g,{avatar:"",class:"text-blue"},{default:t(()=>[e(Y,{"font-size":"30px"},{default:t(()=>[e(O,{name:"icon_retard"})]),_:1})]),_:1}),e(g,null,{default:t(()=>[e(c,{class:"text-h4"},{default:t(()=>[i(s(Ke().length),1)]),_:1}),e(c,null,{default:t(()=>[i(s(ve("eleve.absencesEleve","Retards","retard")),1)]),_:1})]),_:1})]),_:1})])])]),e(ie,{separator:"",dense:"",bordered:""},{default:t(()=>[e(I,{onClick:o[4]||(o[4]=u=>U(w)?w.value=!0:w=!0),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(ve("eleve.notes","Notes")),1)]),_:1})]),_:1}),e(g,{avatar:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(O,{name:"arrow_forward_ios"})]),_:1})]),_:1})]),_:1}),n(k).admin?(l(),v(I,{key:0,onClick:o[5]||(o[5]=u=>U(L)?L.value=!0:L=!0),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(ve("eleve.infractions","infractions")),1)]),_:1})]),_:1}),e(g,{avatar:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(O,{name:"arrow_forward_ios"})]),_:1})]),_:1})]),_:1})):E("",!0),n(k).admin?(l(),v(I,{key:1,onClick:o[6]||(o[6]=u=>U(P)?P.value=!0:P=!0),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(ve("eleve.maladies","maladies")),1)]),_:1})]),_:1}),e(g,{avatar:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(O,{name:"arrow_forward_ios"})]),_:1})]),_:1})]),_:1})):E("",!0),n(k).admin?(l(),v(I,{key:2,onClick:o[7]||(o[7]=u=>U(de)?de.value=!0:de=!0),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(c,null,{default:t(()=>[i(s(ve("eleve.meetingsEleve","Rencontres")),1)]),_:1})]),_:1}),e(g,{avatar:""},{default:t(()=>[e(Y,null,{default:t(()=>[e(O,{name:"arrow_forward_ios"})]),_:1})]),_:1})]),_:1})):E("",!0)]),_:1})])):(l(),D("div",Rt,[e(G,{class:"absolute-center",src:"/birkar.svg",style:{"max-width":"550px"}})]))]),_:1}),a.value?(l(),v(J,{key:0,modelValue:n(w),"onUpdate:modelValue":o[8]||(o[8]=u=>U(w)?w.value=u:w=u),maximized:"",position:"right"},{default:t(()=>[e(xt,{eleve:a.value.eleve,annee:Z.value,classe:R.value},null,8,["eleve","annee","classe"])]),_:1},8,["modelValue"])):E("",!0),a.value?(l(),v(J,{key:1,modelValue:n(ce),"onUpdate:modelValue":o[9]||(o[9]=u=>U(ce)?ce.value=u:ce=u),maximized:"",position:"right"},{default:t(()=>[e(Vt,{bilan:a.value,annee:Z.value,classe:R.value},null,8,["bilan","annee","classe"])]),_:1},8,["modelValue"])):E("",!0),a.value?(l(),v(J,{key:2,modelValue:n(fe),"onUpdate:modelValue":o[10]||(o[10]=u=>U(fe)?fe.value=u:fe=u),maximized:"",position:"right"},{default:t(()=>[e(St,{bilan:a.value,annee:Z.value,classe:R.value},null,8,["bilan","annee","classe"])]),_:1},8,["modelValue"])):E("",!0),a.value?(l(),v(J,{key:3,modelValue:n(P),"onUpdate:modelValue":o[11]||(o[11]=u=>U(P)?P.value=u:P=u),maximized:"",position:"right"},{default:t(()=>[e(Bt,{bilan:a.value,annee:Z.value,classe:R.value},null,8,["bilan","annee","classe"])]),_:1},8,["modelValue"])):E("",!0),a.value?(l(),v(J,{key:4,modelValue:n(L),"onUpdate:modelValue":o[12]||(o[12]=u=>U(L)?L.value=u:L=u),maximized:"",position:"right"},{default:t(()=>[e(At,{bilan:a.value,annee:Z.value,classe:R.value},null,8,["bilan","annee","classe"])]),_:1},8,["modelValue"])):E("",!0),a.value?(l(),v(J,{key:5,modelValue:n(de),"onUpdate:modelValue":o[13]||(o[13]=u=>U(de)?de.value=u:de=u),maximized:"",position:"right"},{default:t(()=>[e(Nt,{bilan:a.value,annee:Z.value,classe:R.value},null,8,["bilan","annee","classe"])]),_:1},8,["modelValue"])):E("",!0),e(J,{modelValue:Q.value,"onUpdate:modelValue":o[17]||(o[17]=u=>Q.value=u),maximized:"",persistent:""},{default:t(()=>[e(X,null,{default:t(()=>[e(ue,{class:re({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:t(()=>[e(K,{flat:"",dense:"",icon:"arrow_back",onClick:o[14]||(o[14]=u=>V.go("/"))}),e(oe)]),_:1}),e(ae,null,{default:t(()=>[e(ot,{ref_key:"unlock",ref:F,onSubmit:je},{default:t(()=>[e(rt,{modelValue:q.value,"onUpdate:modelValue":o[16]||(o[16]=u=>q.value=u),type:j.value?"password":"text",label:"Code d'activation",name:"password",rules:[u=>!!u||"Champ requis"]},{prepend:t(()=>[e(O,{name:"password",size:"sm"})]),append:t(()=>[e(O,{name:j.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:o[15]||(o[15]=u=>j.value=!j.value)},null,8,["name"])]),_:1},8,["modelValue","type","rules"])]),_:1},512)]),_:1}),e(it,{align:"right"},{default:t(()=>[e(K,{color:"primary",onClick:je},{default:t(()=>o[19]||(o[19]=[i(" Envoyer")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(T,{ref_key:"tour",ref:d,steps:n(f),options:M},null,8,["steps"])],64)}}};export{ya as default};
