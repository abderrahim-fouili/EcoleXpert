import{Q as v,S as u,a6 as i,a5 as s,af as be,av as ne,a3 as P,ad as x,ab as C,aF as D,a8 as l,aE as H,_ as ye,cv as he,z as _e,aO as ke,aP as we,B as r,A as o,a as xe,dm as Ce,Y as Qe,ag as qe,a4 as w,R as h,aS as V,bd as Fe,a9 as R,aa as ae,ac as le,aC as Ae,aD as se,ax as Ve,aG as Se}from"./index-Bl2lQPd7.js";import{Q as S}from"./QSelect-DchnWyXK.js";import{Q as Pe}from"./QSlideTransition-CrdUnXBf.js";import{Q as G}from"./QItemLabel-BkJiB6aE.js";import{Q as De}from"./QBadge-Bjfo5tRO.js";import{Q as Ne,a as Me}from"./QItem-De3v03wU.js";import{Q as Te}from"./QList-CMzNTEGD.js";import{C as re}from"./ClosePopup-BY_YGFBZ.js";import{Q as Be}from"./QToolbarTitle-C8APieXG.js";import{Q as Oe}from"./QToolbar-DR-_wX4W.js";import{u as $e,H as Ee,a as Ie,b as ze,c as Le,i as Ue}from"./index.esm.min-FpMw1SSI.js";import{g as ie,p as je}from"./groupBy-BPtQCKGy.js";import{i as Re}from"./installSVGRenderer-BO49usYp.js";import"./QChip-C9OfA2gn.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";import"./_xfBase-4bk-g_Vj.js";const Ge={__name:"Details",props:["model","classe","annee"],setup(N){return(X,M)=>(u(),v(H,{square:"",style:{"min-width":"100vw","max-width":"100vw"}},{default:i(()=>[s(Oe,{class:be({"bg-secondary":!0,"text-white":!0,"shadow-2":!0})},{default:i(()=>[ne(s(P,{flat:"",dense:"",icon:"arrow_back"},null,512),[[re]]),s(Be,null,{default:i(()=>[x(C(N.model[0].tree.text),1)]),_:1})]),_:1}),s(D,null,{default:i(()=>[l("pre",null," "+C(N.model[0]),1)]),_:1})]),_:1}))}},He={class:"q-pr-lg q-pl-lg q-pt-md q-pb-md flex flex-center tour"},Xe={class:"full-width"},Ye={key:0,class:"full-width"},Je={class:"q-mr-md"},Ke={__name:"Synthese",setup(N){$e([Ie,ze,Le,Ue,Re]);const X=_e();let M;he(()=>{M=X.appContext.config.globalProperties.$i18n,M.t}),ke();const d=we(),T=r(()=>d.getters["user/current"]);r(()=>d.getters["user/config"]).value.roles,o(!0),o(!0),o(null),o(null),d.dispatch("stats/reset"),d.dispatch("suivi/reset");const B=r(()=>d.getters["stats/eleves"]),m=r(()=>d.getters["suivi/synthese"]),Y=r(()=>d.getters["suivi/settings"]);let f=o(null);const J={1:"#008000",2:"#FF880F",3:"#F80A0A",4:"#45B851",5:"#ADDE1F",6:"#FFDA01"},K={1:"Très bonne maîtrise",2:"Début de maîtrise",3:"Maîtrise insuffisante",4:"Maîtrise satisfaisante",5:"Presque maîtrisé",6:"Maîtrise fragile"},O=o(!0),Q=o(!1),g=o(null),b=o(null),k=o(null),$=o(null),E=o(!1);f.value||xe("post","/settings").then(e=>{f.value=e.data}),d.commit("setTitle","Suivi"),Y.value||d.dispatch("suivi/getSettings").then(()=>d.commit("setTitle",Y.value.titre));const W=r(()=>f.value&&f.value.hasOwnProperty("classes")?f.value.classes:[]),oe=r(()=>f.value&&f.value.hasOwnProperty("niveaux")?f.value.niveaux:[]),Z=r(()=>{if(T.value&&T.value.hasOwnProperty("annee"))return T.value.annee}),q=r(()=>{if(m.value&&m.value.hasOwnProperty("eleves"))return m.value.eleves}),ue=r(()=>{if(m.value&&m.value.hasOwnProperty("periodes"))return Object.keys(m.value.periodes).map(e=>({value:e,label:m.value.periodes[e]}))}),ee=r(()=>q.value?ie(e=>e.status,q.value):[]),I=r(()=>Object.keys(ee.value).map(t=>({id:parseInt(t),status:K[t],data:ee.value[t]}))),de=r(()=>({tooltip:{trigger:"item",formatter:"{b} : {d}%"},legend:{type:"scroll",padding:[5,5,10],orient:"horizontal",top:"top"},series:[{name:"Par status",type:"pie",center:["50%"," 55%"],data:I.value.map(e=>({value:e.data.length,name:K[e.id],itemStyle:{color:J[e.id]}})),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})),z=r(()=>q.value?ie(e=>e.competence_id,q.value):[]),F=r(()=>Object.keys(z.value).map(t=>({id:parseInt(t),cpt:z.value[t][0].competence,data:z.value[t]}))),pe=r(()=>{let e={};if(F.value&&F.value.length)for(let t=0;t<m.value.tree.length;t++){const n=m.value.tree[t];Ce.reduce((a,_)=>{for(let p=0;p<F.value.length;p++){const c=F.value[p];_.id&&_.id===c.id&&(e[n.id]||(e[n.id]=[]),e[n.id].push({tree:n,cpt:c}))}return e},!1,n)}return e});let L=o(B.value.map(e=>({label:e.nom+" "+e.prenom,value:e.idpers}))),y=o(null),ce=r(()=>W.value.filter(e=>e.idniveau===b.value));Qe(Z,(e,t)=>{k.value=null,j()});function me(e){let t=je("cpt",e),n={};for(let a=0;a<t.length;a++){const _=t[a].data;for(let p=0;p<_.length;p++){const c=_[p];c&&(n[c.status]||(n[c.status]=[]),n[c.status].push(c))}}return n}function U(){b.value&&d.dispatch("suivi/synthese",te())}function te(){let e={annee:Z.value.idannee,niveau:b.value};return g.value&&(e.classe=g.value.idclasse),y.value&&(e.eleve=y.value.value),k.value&&(e.periode=k.value.value),e}function A(){}function ve(e){$.value=e,E.value=!0}function j(){fe(),g.value=W.value.find(e=>e.idclasse===g.value),g.value&&d.dispatch("stats/getEleves",te()),U()}function fe(){d.dispatch("stats/reset"),y.value=null}function ge(e,t){if(e===""){t(()=>{L.value=B.value.map(n=>({label:n.nom+" "+n.prenom,value:n.idpers}))});return}t(()=>{const n=e.toLowerCase();L.value=B.value.map(a=>({label:a.nom+" "+a.prenom,value:a.idpers})).filter(a=>a.label.toLowerCase().indexOf(n)>-1)})}return(e,t)=>{const n=qe("ep-footer");return u(),w(R,null,[s(Ae,{class:"page-content"},{default:i(()=>[l("div",He,[l("div",Xe,[s(P,{flat:"",dense:"",class:"float-right",icon:"filter_list",onClick:t[0]||(t[0]=a=>O.value=!O.value)})]),s(Pe,null,{default:i(()=>[O.value?(u(),w("div",Ye,[s(S,{modelValue:b.value,"onUpdate:modelValue":[t[1]||(t[1]=a=>b.value=a),j],options:oe.value,label:"Niveau","emit-value":"","option-value":"idniveau","option-label":"niveau_fr","map-options":"",onClick:A,class:"full-width"},null,8,["modelValue","options"]),b.value?(u(),v(S,{key:0,clearable:"",modelValue:g.value,"onUpdate:modelValue":[t[2]||(t[2]=a=>g.value=a),j],options:V(ce),label:"Classes","emit-value":"","option-value":"idclasse","option-label":"classe_fr","map-options":"",onClick:A,class:"full-width"},null,8,["modelValue","options"])):h("",!0),g.value?(u(),v(S,{key:1,clearable:"","use-input":"","input-debounce":"0",onFilter:ge,onClick:A,options:V(L),label:"Eleve",modelValue:V(y),"onUpdate:modelValue":[t[3]||(t[3]=a=>Fe(y)?y.value=a:y=a),U],class:"full-width"},null,8,["options","modelValue"])):h("",!0),b.value?(u(),v(S,{key:2,clearable:"",onClick:A,options:ue.value,label:"Semestre",modelValue:k.value,"onUpdate:modelValue":[t[4]||(t[4]=a=>k.value=a),U],class:"full-width"},null,8,["options","modelValue"])):h("",!0)])):h("",!0)]),_:1})]),s(H,{square:"",bordered:"",flat:""},{default:i(()=>[I.value&&I.value.length?(u(),v(D,{key:0},{default:i(()=>[s(V(Ee),{class:"chart",option:de.value},null,8,["option"])]),_:1})):h("",!0),s(Te,{separator:"",bordered:""},{default:i(()=>[(u(!0),w(R,null,ae(pe.value,(a,_)=>(u(),v(Ne,{onClick:p=>ve(a),clickable:""},{default:i(()=>[s(Me,null,{default:i(()=>[a[0].tree.data&&a[0].tree.data.node.matieres.length&&a[0].tree.data.node.matieres[0].discipline&&a[0].tree.data.node.matieres[0].discipline.length?(u(),v(G,{key:0,style:le({"border-left":"5px solid "+a[0].tree.data.node.matieres[0].discipline[0].color}),class:"q-pl-sm"},{default:i(()=>[x(C(a[0].tree.data.node.matieres[0].discipline[0].description),1)]),_:2},1032,["style"])):h("",!0),s(G,{style:{"font-weight":"500","font-size":"var(--taille-m)"}},{default:i(()=>[x(C(a[0].tree.text),1)]),_:2},1024),s(G,null,{default:i(()=>[(u(!0),w(R,null,ae(me(a),(p,c)=>(u(),w("span",Je,[s(De,{rounded:"",style:le({"background-color":J[c]})},null,8,["style"]),x(" "+C(p.length),1)]))),256))]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),256))]),_:1})]),_:1})]),_:1}),s(n,{to:"#footer-portal"},{default:i(()=>[s(P,{flat:"",onClick:t[5]||(t[5]=a=>Q.value=!Q.value),icon:"help"})]),_:1}),s(se,{modelValue:E.value,"onUpdate:modelValue":t[6]||(t[6]=a=>E.value=a),position:"right","full-width":"",maximized:""},{default:i(()=>[$.value?(u(),v(Ge,{key:0,model:$.value},null,8,["model"])):h("",!0)]),_:1},8,["modelValue"]),s(se,{modelValue:Q.value,"onUpdate:modelValue":t[7]||(t[7]=a=>Q.value=a),position:"bottom","full-width":""},{default:i(()=>[s(H,{class:"relative-position"},{default:i(()=>[s(D,null,{default:i(()=>t[8]||(t[8]=[l("div",{class:"text-h5"},"Légende",-1)])),_:1}),s(D,null,{default:i(()=>t[9]||(t[9]=[l("div",null,"Niveau de maîtrise",-1),l("div",{style:{"padding-left":"1rem","padding-top":"0.5rem"}},[l("span",{style:{display:"inline-block",width:"2rem","text-align":"center"}},[l("span",{class:"NiveauAcquisition NiveauAcquisition_Pastille",style:{"background-color":"#008000",color:"#FFFFFF"},title:"Très bonne maîtrise","aria-label":"Très bonne maîtrise"}," ")]),l("span",{style:{"padding-left":"1.2rem"}},"Très bonne maîtrise")],-1),l("div",{style:{"padding-left":"1rem","padding-top":"0.5rem"}},[l("span",{style:{display:"inline-block",width:"2rem","text-align":"center"}},[l("span",{class:"NiveauAcquisition NiveauAcquisition_Pastille",style:{"background-color":"#45B851"},title:"Maîtrise satisfaisante","aria-label":"Maîtrise satisfaisante"}," ")]),l("span",{style:{"padding-left":"1.2rem"}},"Maîtrise satisfaisante")],-1),l("div",{style:{"padding-left":"1rem","padding-top":"0.5rem"}},[l("span",{style:{display:"inline-block",width:"2rem","text-align":"center"}},[l("span",{class:"NiveauAcquisition NiveauAcquisition_Pastille",style:{"background-color":"#ADDE1F"},title:"Presque maîtrisé","aria-label":"Presque maîtrisé"}," ")]),l("span",{style:{"padding-left":"1.2rem"}},"Presque maîtrisé")],-1),l("div",{style:{"padding-left":"1rem","padding-top":"0.5rem"}},[l("span",{style:{display:"inline-block",width:"2rem","text-align":"center"}},[l("span",{class:"NiveauAcquisition NiveauAcquisition_Pastille",style:{"background-color":"#FFDA01"},title:"Maîtrise fragile","aria-label":"Maîtrise fragile"}," ")]),l("span",{style:{"padding-left":"1.2rem"}},"Maîtrise fragile")],-1),l("div",{style:{"padding-left":"1rem","padding-top":"0.5rem"}},[l("span",{style:{display:"inline-block",width:"2rem","text-align":"center"}},[l("span",{class:"NiveauAcquisition NiveauAcquisition_Pastille",style:{"background-color":"#FF880F"},title:"Début de maîtrise","aria-label":"Début de maîtrise"}," ")]),l("span",{style:{"padding-left":"1.2rem"}},"Début de maîtrise")],-1),l("div",{style:{"padding-left":"1rem","padding-top":"0.5rem"}},[l("span",{style:{display:"inline-block",width:"2rem","text-align":"center"}},[l("span",{class:"NiveauAcquisition NiveauAcquisition_Pastille",style:{"background-color":"#F80A0A"},title:"Maîtrise insuffisante","aria-label":"Maîtrise insuffisante"}," ")]),l("span",{style:{"padding-left":"1.2rem"}},"Maîtrise insuffisante")],-1)])),_:1}),s(Ve),s(Se,{align:"right",class:"bg-white"},{default:i(()=>[ne((u(),v(P,{flat:""},{default:i(()=>t[10]||(t[10]=[x("Fermer")])),_:1})),[[re]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}},ht=ye(Ke,[["__scopeId","data-v-edece902"]]);export{ht as default};
