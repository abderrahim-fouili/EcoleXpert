import{_ as h,bt as C,Q as D,S as f,a6 as i,a5 as s,aE as M,ax as v,aF as H,a8 as n,a4 as b,R as y,ad as V,ay as p,b7 as P,a2 as g,a3 as w,aC as $,aP as E,aO as z,A as _,B as k,Y as B,C as T}from"./index-Bl2lQPd7.js";import{Q as q}from"./QTime-DY-qDies.js";import{Q}from"./QPopupProxy-CQ30ymZI.js";import{Q as L}from"./QForm-Dk45GsL9.js";import{Q as U}from"./QSpinnerGears-DmolwAR1.js";import{Q as j}from"./QInnerLoading-WxvcYHvS.js";import"./TouchPan-jBhMORlX.js";import"./touch-BjYP5sR0.js";import"./selection-DaBtDCZ0.js";import"./use-datetime-hbLWgGn4.js";import"./date-C1Mon-Jj.js";import"./format-IcNrutKL.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";const F=C({name:"CanteenSettingsPage",setup(){const a=E(),t=z(),u=_(null),d=_(!1),m=_({staff_ticket_tarif:null,ticket_request_deadline_time:null,serving_cutoff_time:null}),c=k(()=>a.getters["canteen/canteenSettings"]),e=k(()=>!!c.value);return B(c,o=>{if(o){const r={staff_ticket_tarif:o.staff_ticket_tarif,ticket_request_deadline_time:o.ticket_request_deadline_time,serving_cutoff_time:o.serving_cutoff_time};Object.assign(m.value,r)}else Object.assign(m.value,{staff_ticket_tarif:null,ticket_request_deadline_time:null,serving_cutoff_time:null})},{immediate:!0}),T(async()=>{d.value=!0;try{await a.dispatch("canteen/fetchCanteenSettings")}catch(o){console.error("Échec de la récupération des paramètres de la cantine:",o),o.message&&o.message.includes("(404)")?console.info("Canteen settings not found on load, displaying empty form."):t.notify({type:"negative",message:"Échec du chargement des paramètres de la cantine. "+(o.message||"Erreur inconnue")})}finally{d.value=!1}}),{loading:d,formData:m,form:u,onSubmit:async()=>{if(!await u.value.validate()){t.notify({type:"negative",message:"Veuillez corriger les erreurs de validation."});return}d.value=!0;try{const r={...m.value},l=await a.dispatch("canteen/updateCanteenSettings",r);t.notify({type:"positive",message:l.message||"Paramètres enregistrés avec succès!",icon:"save"})}catch(r){console.error("Échec de l'enregistrement des paramètres de la cantine:",r);let l="Échec de l'enregistrement des paramètres de la cantine.";if(r.response)if(r.response.status===422){const S=r.response.data.errors;l="Validation échouée: "+Object.values(S).flat().join(", ")}else r.response.data&&r.response.data.message?l=r.response.data.message:l=`La requête a échoué avec le statut ${r.response.status}.`;else r.message&&(l=r.message);t.notify({type:"negative",message:l,icon:"error"})}finally{d.value=!1}},settingsExist:e}}}),I={key:0,class:"q-mb-md bg-yellow-1 q-pa-md rounded-borders"},N={key:1,class:"q-mb-md bg-info-1 q-pa-md rounded-borders"},O={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},G={class:"col-12"},R={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},A={class:"col-12"},Y={class:"col-12"},J={class:"q-mt-lg"};function K(a,t,u,d,m,c){return f(),D($,{class:"page-content"},{default:i(()=>[s(M,{flat:""},{default:i(()=>[s(v),s(H,null,{default:i(()=>[t[8]||(t[8]=n("div",{class:"text-h6 q-mb-md"},"Paramètres de la Cantine",-1)),s(L,{onSubmit:a.onSubmit,class:"q-gutter-md",ref:"form"},{default:i(()=>[!a.settingsExist&&!a.loading?(f(),b("div",I,[s(p,{name:"warning",color:"warning",class:"q-mr-sm"}),t[5]||(t[5]=V(" Paramètres de la cantine non trouvés. Veuillez remplir les détails ci-dessous pour les créer. "))])):y("",!0),!a.settingsExist&&a.loading?(f(),b("div",N,[s(P,{size:"1em",class:"q-mr-sm"}),t[6]||(t[6]=V(" Chargement des paramètres... "))])):y("",!0),t[7]||(t[7]=n("div",{class:"text-subtitle1 q-mt-md text-primary"},"Paramètres Généraux",-1)),s(v,{spaced:""}),n("div",O,[n("div",G,[s(g,{modelValue:a.formData.staff_ticket_tarif,"onUpdate:modelValue":t[0]||(t[0]=e=>a.formData.staff_ticket_tarif=e),modelModifiers:{number:!0},label:"Tarif Ticket Personnel",type:"number",step:"0.01",filled:"",rules:[e=>e===null||e===""||typeof e=="number"&&e>=0||"Veuillez entrer un nombre positif ou zéro",e=>e===null||e===""||String(e).length<=10||"Le tarif est trop élevé"]},null,8,["modelValue","rules"])])]),n("div",R,[n("div",A,[s(g,{modelValue:a.formData.ticket_request_deadline_time,"onUpdate:modelValue":t[2]||(t[2]=e=>a.formData.ticket_request_deadline_time=e),label:"Heure Limite Réservation Ticket (HH:MM)",mask:"##:##",filled:"",rules:[e=>e===null||e===""||/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e)||"Format de temps invalide (HH:MM)"]},{append:i(()=>[s(p,{name:"access_time",class:"cursor-pointer"},{default:i(()=>[s(Q,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[s(q,{modelValue:a.formData.ticket_request_deadline_time,"onUpdate:modelValue":t[1]||(t[1]=e=>a.formData.ticket_request_deadline_time=e),format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])]),n("div",Y,[s(g,{modelValue:a.formData.serving_cutoff_time,"onUpdate:modelValue":t[4]||(t[4]=e=>a.formData.serving_cutoff_time=e),label:"Heure Limite Service (HH:MM)",mask:"##:##",filled:"",rules:[e=>e===null||e===""||/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e)||"Format de temps invalide (HH:MM)"]},{append:i(()=>[s(p,{name:"access_time",class:"cursor-pointer"},{default:i(()=>[s(Q,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[s(q,{modelValue:a.formData.serving_cutoff_time,"onUpdate:modelValue":t[3]||(t[3]=e=>a.formData.serving_cutoff_time=e),format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"])])]),n("div",J,[s(w,{label:"Enregistrer les paramètres",type:"submit",color:"primary",loading:a.loading,icon:"save",class:"q-px-md"},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1}),s(j,{showing:a.loading},{default:i(()=>[s(U,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1})]),_:1})}const ue=h(F,[["render",K],["__scopeId","data-v-50d59a8e"]]);export{ue as default};
