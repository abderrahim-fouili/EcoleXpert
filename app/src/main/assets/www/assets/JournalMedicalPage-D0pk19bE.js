import{_ as Ae,aP as xe,B as k,aO as he,aT as Se,A as v,aU as W,aX as ve,Y as le,Q as D,S as c,a6 as n,a5 as a,aE as je,av as re,a3 as N,ad as w,ab as f,aF as fe,a4 as H,R as P,a8 as _,a9 as Fe,aS as Q,ax as Me,a2 as B,ay as A,aV as Ie,aD as Ce,a as T,N as Y,C as Ue,a7 as De,ah as _e,aG as Te,aC as Pe,aB as ze}from"./index-Bl2lQPd7.js";import{Q as Z,a as q}from"./QItem-De3v03wU.js";import{Q as O}from"./QSelect-DchnWyXK.js";import{Q as ge}from"./QDate-C_jC-zMt.js";import{Q as oe}from"./QPopupProxy-CQ30ymZI.js";import{Q as Oe}from"./QSpinnerDots-BW9ZsFNG.js";import{Q as G}from"./QItemLabel-BkJiB6aE.js";import{Q as we}from"./QChip-C9OfA2gn.js";import{Q as ce}from"./QTooltip-r7WoEuzy.js";import{Q as He}from"./QVirtualScroll-CENgsPEr.js";import{Q as Be}from"./QList-CMzNTEGD.js";import{Q as qe}from"./QPagination-UgiQF7o2.js";import{C as se}from"./ClosePopup-BY_YGFBZ.js";import{q as S}from"./date-C1Mon-Jj.js";import{Q as Je}from"./QToolbarTitle-C8APieXG.js";import{Q as Re}from"./QSpace-CKKoNTi_.js";import{Q as Le}from"./QToolbar-DR-_wX4W.js";import{Q as Ke}from"./QTime-DY-qDies.js";import{Q as Xe}from"./QForm-Dk45GsL9.js";import{u as Ge,a as Ee,b as We}from"./app-B6uniWGw.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-datetime-hbLWgGn4.js";import"./TouchPan-jBhMORlX.js";import"./touch-BjYP5sR0.js";const Ze={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},et={key:2,class:"mt-4 p-3 bg-slate-100 rounded-md text-sm text-slate-600 space-y-1"},tt={key:0},at={__name:"EleveTraitementJournalDialog",props:{isDialogVisible:Boolean,traitementId:[Number,String,null],journalEntryId:[Number,String,null],studentIdForNew:[Number,String,null],isViewMode:Boolean},emits:["update:isDialogVisible","journalEntrySaved"],setup(ne,{emit:ie}){const ee=xe(),$=k(()=>ee.getters["user/current"]?.annee?.idannee),u=ne,J=ie;he();const z=Ge(),{user:h}=Se(z),te=v(null),g=k(()=>u.traitementId),F=k(()=>!u.journalEntryId),d=k(()=>u.isViewMode?"Détails de l'Entrée au Journal":F.value?"Nouvelle Entrée au Journal":"Modifier Entrée au Journal"),p=()=>({id_journal:null,id_traitement_eleve:g.value||null,id_eleve:u.studentIdForNew||null,date_administration:S.formatDate(Date.now(),"YYYY-MM-DD"),heure_administration:S.formatDate(Date.now(),"HH:mm"),administre_par_idpers:null,auto_administration_rapportee:!1,dosage_administre_reel:"",id_horaire_associe:null,observations_notes:"",created_by:null}),l=W(p()),M=W({idcycle:null}),y=v(null),I=v(!1),i=v({}),j=v([]),R=v([]),E=v([]),K=v(!1),b=v(g.value||null),x=v([]),C=v(!1),{staffOptions:de,fetchStaff:ue,fetchStudents:X}=Ee(),ae=k(()=>F.value&&!g.value?!!l.id_eleve&&!!l.id_traitement_eleve:!!l.id_traitement_eleve),me=k(()=>{let r=[];for(const e of R.value)e.eleve_classes&&e.eleve_classes.length>0&&(r.find(t=>t.idcycle===e.eleve_classes[0].niveau.cycle.idcycle)||r.push(e.eleve_classes[0].niveau.cycle));return r});k(()=>{let r=[];for(const e of R.value)e.eleve_classes&&e.eleve_classes.length>0&&(r.find(t=>t.idniveau===e.eleve_classes[0].niveau.idniveau)||r.push(e.eleve_classes[0].niveau));return r}),k(()=>{let r=[];for(const e of R.value)e.eleve_classes&&e.eleve_classes.length>0&&(r.find(t=>t.idclasse===e.eleve_classes[0].idclasse)||r.push(e.eleve_classes[0]));return r});const L=k({get:()=>u.isDialogVisible,set:r=>J("update:isDialogVisible",r)}),m=async r=>{try{const e=await T("get",`/journal-entries/${r}`);y.value=e.data,Object.assign(l,e.data),e.data.dateheure_administration&&(l.date_administration=S.formatDate(e.data.dateheure_administration,"YYYY-MM-DD"),l.heure_administration=S.formatDate(e.data.dateheure_administration,"HH:mm")),l.id_eleve=e.data.traitement_eleve?.id_eleve||null,b.value=e.data.id_traitement_eleve,l.id_traitement_eleve&&await pe(l.id_traitement_eleve)}catch(e){console.error("Error fetching journal entry details:",e),Y.create({type:"negative",message:"Erreur chargement détails entrée journal.",position:"top"}),Ve()}},s=ve((r,e,t)=>{X(r,$.value,{hasPlan:!0,planNotFinished:!0,...M}).then($e=>{e(()=>{j.value=$e})}).catch(()=>t())},500),o=async r=>{l.id_traitement_eleve=null,b.value=null,E.value=[],x.value=[],r&&await V(r)},V=async r=>{if(r){K.value=!0;try{const e=await T("get",`/eleves/${r}/traitement-plans-actifs`);E.value=e.data,console.log("Traitement plans fetched:",E.value),b.value=E.value[0]?.id_traitement||null,l.id_traitement_eleve=b.value,l.dosage_administre_reel=E.value[0]?.instructions_dosage||null}catch(e){console.error("Error fetching treatment plans for student:",e),E.value=[]}finally{K.value=!1}}},ke=r=>r?`[#${r.id_traitement}] ${r.condition_medicale||"N/A"} - ${r.nom_medicament_procedure||"N/A"} (Année: ${r.annee_scolaire?.description})`:"",pe=async r=>{if(!r){x.value=[];return}C.value=!0;try{const e=await T("get",`/eleve-traitements/${r}/horaires`);x.value=e.data,console.log(x.value),x.value.length&&(l.id_horaire_associe=x.value[0].id_horaire)}catch(e){console.error("Error fetching horaires for journal:",e),x.value=[]}finally{C.value=!1}};le(()=>l.id_traitement_eleve,r=>{pe(r)});const be=async()=>{if(ye(),await ue(),R.value=await X(u.studentIdForNew,$.value),u.journalEntryId)await m(u.journalEntryId);else{if(u.studentIdForNew){if(l.id_eleve=u.studentIdForNew,!j.value.some(r=>r.idpers===u.studentIdForNew)){const r=await X(u.studentIdForNew,$.value,{hasPlan:!0});r.length===1&&j.value.unshift(r[0])}await V(u.studentIdForNew)}if(g.value&&(l.id_traitement_eleve=g.value,b.value=g.value,await pe(g.value),!l.id_eleve&&g.value))try{const r=await T("get",`/eleve-traitements/${g.value}`);l.id_eleve=r.data.id_eleve}catch(r){console.error("Could not fetch parent treatment for student ID",r)}!l.auto_administration_rapportee&&h.value&&(l.administre_par_idpers=h.value.idpers)}},ye=()=>{Object.assign(l,p()),y.value=null,b.value=g.value||null,E.value=[],x.value=[],i.value={},!u.journalEntryId&&u.studentIdForNew&&(j.value=[])},Qe=()=>{ye()},Ve=()=>{L.value=!1},U=r=>{i.value[r]&&delete i.value[r]},Ne=r=>{if(!r||!r.id_horaire)return"";let e=`[#${r.id_horaire}] ${r.type_horaire.replace(/_/g," ").toLowerCase().replace(/\b\w/g,t=>t.toUpperCase())}`;switch(r.type_horaire){case"FIXED_TIME":e+=` - ${r.heure_fixe||"N/D"}`;break;case"EVENT_BASED":e+=` - ${r.description_evenement||"N/D"}`;break;case"AS_NEEDED":e+=` - ${r.description_declencheur_as_needed?.substring(0,25)||"N/D"}...`;break;case"INTERVAL":e+=` - Début ${r.heure_debut_intervalle||"N/D"}`;break}return e},Ye=async()=>{if(!ae.value){Y.create({type:"warning",message:"Veuillez sélectionner un élève et un protocole de traitement.",position:"top"});return}if(!await te.value.validate()){Y.create({type:"warning",message:"Veuillez corriger les erreurs.",position:"top"});return}I.value=!0,i.value={};const e={...l};e.dateheure_administration=`${l.date_administration} ${l.heure_administration}:00`,delete e.date_administration,delete e.heure_administration,delete e.id_eleve,h.value&&(F.value&&(e.created_by=h.value.idpers),e.updated_by=h.value.idpers),e.auto_administration_rapportee&&(e.administre_par_idpers=null);try{let t;F.value?t=await T("post",`/eleve-traitements/${l.id_traitement_eleve}/journal`,e):t=await T("put",`/journal-entries/${u.journalEntryId}`,e),Y.create({type:"positive",message:"Entrée au journal enregistrée avec succès.",position:"top"}),J("journalEntrySaved",t.data.data),Ve()}catch(t){console.error("Error saving journal entry:",t.response),t.response&&t.response.status===422&&t.response.data.errors?(i.value=t.response.data.errors,i.value.id_traitement_eleve&&F.value&&!g.value?Y.create({type:"negative",message:"Erreur avec le protocole de traitement sélectionné.",position:"top"}):Y.create({type:"negative",message:"Veuillez vérifier les champs.",position:"top"})):Y.create({type:"negative",message:t.response?.data?.message||"Erreur lors de l'enregistrement.",position:"top"})}finally{I.value=!1}};return le(()=>l.auto_administration_rapportee,r=>{r?l.administre_par_idpers=null:h.value&&!u.isViewMode&&(l.administre_par_idpers=h.value.idpers)}),le([()=>u.traitementId,()=>u.studentIdForNew,()=>u.journalEntryId],()=>{L.value&&be()}),(r,e)=>(c(),D(Ce,{modelValue:L.value,"onUpdate:modelValue":e[19]||(e[19]=t=>L.value=t),persistent:"",onBeforeShow:be,onHide:Qe,maximized:""},{default:n(()=>[a(je,{class:"flex flex-col h-full"},{default:n(()=>[a(Le,{class:"bg-accent text-white shadow-md"},{default:n(()=>[re(a(N,{flat:"",dense:"",icon:"sym_o_arrow_back"},null,512),[[se]]),a(Je,null,{default:n(()=>[w(f(d.value),1)]),_:1}),a(Re),a(N,{label:"Enregistrer Entrée",icon:"sym_o_save",onClick:Ye,loading:I.value,class:"mr-sm rounded-md",unelevated:"",disable:!ae.value},null,8,["loading","disable"]),re(a(N,{flat:"",dense:"",icon:"sym_o_close"},null,512),[[se]])]),_:1}),a(fe,{class:"flex-grow overflow-auto p-4"},{default:n(()=>[a(Xe,{ref_key:"journalFormRef",ref:te,class:"space-y-4"},{default:n(()=>[F.value&&!g.value?(c(),H(Fe,{key:0},[a(O,{dense:"",filled:"",modelValue:M.idcycle,"onUpdate:modelValue":e[0]||(e[0]=t=>M.idcycle=t),options:me.value,label:"Cycle","emit-value":"","map-options":"","option-value":"idcycle","option-label":"cycle",clearable:"",standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","options"]),a(O,{dense:"",filled:"",required:"",modelValue:l.id_eleve,"onUpdate:modelValue":[e[1]||(e[1]=t=>l.id_eleve=t),o],options:j.value,label:"Élève *","use-input":"","emit-value":"","map-options":"",onFilter:Q(s),"option-value":"idpers","option-label":t=>`${t.nom} ${t.prenom} (${t.code||"N/A"})`,rules:[t=>!!t||"Élève requis"],error:!!i.value.id_eleve,"error-message":i.value.id_eleve,standout:"bg-sky-50",class:"rounded-md"},{"no-option":n(()=>[a(Z,null,{default:n(()=>[a(q,{class:"text-gray-500"},{default:n(()=>e[20]||(e[20]=[w("Aucun élève trouvé.")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","option-label","rules","error","error-message"]),a(O,{dense:"",filled:"",required:"",modelValue:b.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>b.value=t),e[3]||(e[3]=t=>l.id_traitement_eleve=t)],options:E.value,label:"Protocole de Traitement Associé *","emit-value":"","map-options":"","option-value":"id_traitement","option-label":ke,rules:[t=>!!t||"Protocole de traitement requis"],loading:K.value,disable:!l.id_eleve,error:!!i.value.id_traitement_eleve,"error-message":i.value.id_traitement_eleve,standout:"bg-sky-50",class:"rounded-md"},{"no-option":n(()=>[a(Z,null,{default:n(()=>[a(q,{class:"text-gray-500"},{default:n(()=>[w(f(l.id_eleve?"Aucun protocole de traitement actif trouvé pour cet élève.":`Sélectionnez
                    d'abord
                    un élève.`),1)]),_:1})]),_:1})]),_:1},8,["modelValue","options","rules","loading","disable","error","error-message"]),l.id_traitement_eleve?(c(),D(Me,{key:0,class:"my-4"})):P("",!0)],64)):P("",!0),_("div",Ze,[a(B,{dense:"",filled:"",required:"",modelValue:l.date_administration,"onUpdate:modelValue":e[5]||(e[5]=t=>l.date_administration=t),label:"Date d'Administration *",mask:"####-##-##",rules:[t=>!!t||"Date requise"],error:!!i.value.dateheure_administration||!!i.value.date_administration,"error-message":i.value.dateheure_administration||i.value.date_administration,onBlur:e[6]||(e[6]=t=>{U("dateheure_administration"),U("date_administration")}),standout:"bg-sky-50",class:"rounded-md"},{prepend:n(()=>[a(A,{name:"sym_o_event",class:"cursor-pointer"},{default:n(()=>[a(oe,null,{default:n(()=>[a(ge,{modelValue:l.date_administration,"onUpdate:modelValue":e[4]||(e[4]=t=>l.date_administration=t),mask:"YYYY-MM-DD",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","error","error-message"]),a(B,{dense:"",filled:"",required:"",modelValue:l.heure_administration,"onUpdate:modelValue":e[8]||(e[8]=t=>l.heure_administration=t),label:"Heure d'Administration (HH:MM) *",mask:"##:##",rules:[t=>!!t||"Heure requise",t=>/^([01]\d|2[0-3]):([0-5]\d)$/.test(t)||"Format HH:MM invalide"],error:!!i.value.dateheure_administration||!!i.value.heure_administration,"error-message":i.value.dateheure_administration||i.value.heure_administration,onBlur:e[9]||(e[9]=t=>{U("dateheure_administration"),U("heure_administration")}),standout:"bg-sky-50",class:"rounded-md"},{prepend:n(()=>[a(A,{name:"sym_o_schedule",class:"cursor-pointer"},{default:n(()=>[a(oe,null,{default:n(()=>[a(Ke,{modelValue:l.heure_administration,"onUpdate:modelValue":e[7]||(e[7]=t=>l.heure_administration=t),format24h:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules","error","error-message"])]),a(Ie,{modelValue:l.auto_administration_rapportee,"onUpdate:modelValue":e[10]||(e[10]=t=>l.auto_administration_rapportee=t),label:"Auto-administration rapportée par l'élève"},null,8,["modelValue"]),l.auto_administration_rapportee?P("",!0):(c(),D(O,{key:1,dense:"",filled:"",modelValue:l.administre_par_idpers,"onUpdate:modelValue":e[11]||(e[11]=t=>l.administre_par_idpers=t),options:Q(de),label:"Administré par (Personnel)","emit-value":"","map-options":"",clearable:"","option-value":"idpers","option-label":t=>`${t.nom} ${t.prenom}`,error:!!i.value.administre_par_idpers,"error-message":i.value.administre_par_idpers,onBlur:e[12]||(e[12]=t=>U("administre_par_idpers")),standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","options","option-label","error","error-message"])),a(B,{dense:"",filled:"",modelValue:l.dosage_administre_reel,"onUpdate:modelValue":e[13]||(e[13]=t=>l.dosage_administre_reel=t),label:"Dosage Réel Administré (ex: 1 bouffée, 5ml)",error:!!i.value.dosage_administre_reel,"error-message":i.value.dosage_administre_reel,onBlur:e[14]||(e[14]=t=>U("dosage_administre_reel")),standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","error","error-message"]),a(O,{dense:"",filled:"",modelValue:l.id_horaire_associe,"onUpdate:modelValue":e[15]||(e[15]=t=>l.id_horaire_associe=t),options:x.value,label:"Horaire Associé (Optionnel)","emit-value":"","map-options":"",clearable:"","option-value":"id_horaire","option-label":Ne,loading:C.value,disable:!l.id_traitement_eleve,error:!!i.value.id_horaire_associe,"error-message":i.value.id_horaire_associe,onBlur:e[16]||(e[16]=t=>U("id_horaire_associe")),standout:"bg-sky-50",class:"rounded-md"},{"no-option":n(()=>[a(Z,null,{default:n(()=>[a(q,{class:"text-gray-500"},{default:n(()=>[w(f(l.id_traitement_eleve?"Aucun horaire défini pour ce protocole.":`Sélectionnez d'abord un
                  protocole de
                  traitement.`),1)]),_:1})]),_:1})]),_:1},8,["modelValue","options","loading","disable","error","error-message"]),a(B,{type:"textarea",autogrow:"",dense:"",filled:"",modelValue:l.observations_notes,"onUpdate:modelValue":e[17]||(e[17]=t=>l.observations_notes=t),label:"Observations / Notes (ex: état de l'élève, effets secondaires)",error:!!i.value.observations_notes,"error-message":i.value.observations_notes,onBlur:e[18]||(e[18]=t=>U("observations_notes")),standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","error","error-message"]),ne.isViewMode&&y.value?.id_journal?(c(),H("div",et,[_("p",null,"Élève: "+f(y.value.traitement_eleve?.eleve?.nom_complet||"N/A"),1),_("p",null,"Protocole: "+f(y.value.traitement_eleve?.condition_medicale||"N/A")+" - "+f(y.value.traitement_eleve?.nom_medicament_procedure||"N/A"),1),y.value.created_by_user?(c(),H("p",tt,"Créé par: "+f(y.value.created_by_user?.nom_complet),1)):P("",!0)])):P("",!0)]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},lt=Ae(at,[["__scopeId","data-v-1911defa"]]),rt={class:"p-4"},ot={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},st={class:"row items-center justify-end"},nt={class:"row items-center justify-end"},it={class:"mt-3 flex justify-end gap-2"},dt={class:"mb-4 flex justify-between items-center"},ut={class:"text-md text-gray-600"},mt={key:0,class:"text-center p-10"},pt={key:1,class:"text-center p-10 bg-red-50 border border-red-200 rounded-md"},_t={class:"text-gray-600"},ct={key:2,class:"text-center p-10 bg-gray-50 border border-gray-200 rounded-md"},vt=["src"],ft={class:"text-sm text-gray-500"},gt={key:0},bt={class:"flex gap-1 mt-xs"},Lt={__name:"JournalMedicalPage",setup(ne){const ie=xe(),ee=k(()=>ie.getters["user/current"]?.annee?.idannee),$=he();We();const u=v([]),J=W({journalEntries:!1}),z=v(""),{studentOptions:h,staffOptions:te,fetchStudents:g,fetchStaff:F}=Ee(),d=W({id_eleve:null,date_debut_journal:null,date_fin_journal:null,administre_par_idpers:null,observations_notes:""}),p=W({current_page:1,per_page:15,total:0,last_page:1}),l=v(!1),M=v(null),y=v(null),I=v(null),i=v(!1),j=v(0),R=(m,s="DD/MM/YYYY")=>m?S.formatDate(m,s):"",E=m=>!d.date_debut_journal||S.extractDate(m,"YYYY-MM-DD")>=S.extractDate(d.date_debut_journal,"YYYY-MM-DD"),K=m=>ze(m),b=async(m=1)=>{J.journalEntries=!0,z.value="",p.current_page=m;try{const s={...d,page:p.current_page,per_page:p.per_page};Object.keys(s).forEach(V=>{(s[V]===null||s[V]===""||Array.isArray(s[V])&&s[V].length===0)&&delete s[V]});const o=await T("get","/journal-entries",{params:s});o.data&&o.data.data?(u.value=o.data.data,p.total=o.data.total,p.last_page=o.data.last_page,p.current_page=o.data.current_page,p.per_page=o.data.per_page):(u.value=[],p.total=0)}catch(s){console.error("Error fetching journal entries:",s),z.value=s.response?.data?.message||"Erreur lors du chargement des entrées du journal.",Y.create({type:"negative",message:z.value,position:"top"}),u.value=[],p.total=0}finally{J.journalEntries=!1}},x=ve((m,s,o)=>{g(m,ee.value,{hasPlan:!0}).then(V=>{s(()=>{h.value=V})}).catch(()=>o())},500),C=ve(()=>b(1),700);le(d,C,{deep:!0});const de=()=>{d.id_eleve=null,d.date_debut_journal=null,d.date_fin_journal=null,d.administre_par_idpers=null,d.observations_notes=""},ue=()=>{M.value=null,y.value=null,I.value=d.id_eleve,i.value=!1,j.value++,l.value=!0},X=m=>{M.value=m.id_journal,y.value=m.id_traitement_eleve,I.value=m.traitement_eleve?.id_eleve||null,i.value=!1,j.value++,l.value=!0},ae=m=>{M.value=m.id_journal,y.value=m.id_traitement_eleve,I.value=m.traitement_eleve?.id_eleve||null,i.value=!0,j.value++,l.value=!0},me=()=>{l.value=!1,b(p.current_page)},L=m=>{$.dialog({title:"Confirmer Suppression",message:"Êtes-vous sûr de vouloir supprimer cette entrée du journal ? Cette action est irréversible.",cancel:{label:"Annuler",color:"grey",flat:!0,class:"un-rounded-md"},ok:{label:"Supprimer",color:"negative",unelevated:!0,class:"un-rounded-md"},persistent:!0}).onOk(async()=>{$.loading.show({message:"Suppression en cours..."});try{await T("delete",`/journal-entries/${m}`),Y.create({type:"positive",message:"Entrée du journal supprimée avec succès.",position:"top"}),b(u.value.length===1&&p.current_page>1?p.current_page-1:p.current_page)}catch(s){console.error("Error deleting journal entry:",s),Y.create({type:"negative",message:s.response?.data?.message||"Erreur lors de la suppression.",position:"top"})}finally{$.loading.hide()}})};return Ue(async()=>{$.loading.show({delay:300}),await Promise.all([g("",ee.value,{hasPlan:!0}),F()]),await b(1),$.loading.hide()}),(m,s)=>(c(),D(Pe,{class:"page-content journal-medical-page bg-gray-100 rounded-none"},{default:n(()=>[_("div",rt,[a(je,{flat:"",bordered:"",class:"mb-4 shadow-sm"},{default:n(()=>[a(fe,{class:"bg-slate-50"},{default:n(()=>s[9]||(s[9]=[_("div",{class:"text-xl font-semibold text-slate-700"},"Journal des Administrations Médicales",-1),_("p",{class:"text-sm text-slate-500"},"Consulter et gérer les entrées du journal médical.",-1)])),_:1}),a(fe,null,{default:n(()=>[_("div",ot,[a(O,{dense:"",filled:"",modelValue:d.id_eleve,"onUpdate:modelValue":s[0]||(s[0]=o=>d.id_eleve=o),options:Q(h),label:"Élève","use-input":"","emit-value":"","map-options":"",clearable:"",onFilter:Q(x),"option-value":"idpers","option-label":o=>`${o.nom} ${o.prenom} (${o.code||"N/A"})`,standout:"bg-sky-50",class:"rounded-md"},{"no-option":n(()=>[a(Z,null,{default:n(()=>[a(q,{class:"text-gray-500"},{default:n(()=>s[10]||(s[10]=[w("Aucun élève trouvé.")])),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","option-label"]),a(B,{dense:"",filled:"",modelValue:d.date_debut_journal,"onUpdate:modelValue":[s[2]||(s[2]=o=>d.date_debut_journal=o),Q(C)],label:"Date Début",mask:"####-##-##",clearable:"",standout:"bg-sky-50",class:"rounded-md"},{prepend:n(()=>[a(A,{name:"sym_o_event",class:"cursor-pointer"},{default:n(()=>[a(oe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[a(ge,{modelValue:d.date_debut_journal,"onUpdate:modelValue":s[1]||(s[1]=o=>d.date_debut_journal=o),mask:"YYYY-MM-DD",minimal:""},{default:n(()=>[_("div",st,[re(a(N,{label:"OK",color:"primary",flat:""},null,512),[[se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue"]),a(B,{dense:"",filled:"",modelValue:d.date_fin_journal,"onUpdate:modelValue":[s[4]||(s[4]=o=>d.date_fin_journal=o),Q(C)],label:"Date Fin",mask:"####-##-##",clearable:"",standout:"bg-sky-50",class:"rounded-md",rules:[o=>!o||!d.date_debut_journal||Q(S).extractDate(o,"YYYY-MM-DD")>=Q(S).extractDate(d.date_debut_journal,"YYYY-MM-DD")||"Date fin >= date début"]},{prepend:n(()=>[a(A,{name:"sym_o_event",class:"cursor-pointer"},{default:n(()=>[a(oe,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:n(()=>[a(ge,{modelValue:d.date_fin_journal,"onUpdate:modelValue":s[3]||(s[3]=o=>d.date_fin_journal=o),mask:"YYYY-MM-DD",minimal:"",options:E},{default:n(()=>[_("div",nt,[re(a(N,{label:"OK",color:"primary",flat:""},null,512),[[se]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue","rules"]),a(O,{dense:"",filled:"",modelValue:d.administre_par_idpers,"onUpdate:modelValue":s[5]||(s[5]=o=>d.administre_par_idpers=o),options:Q(te),label:"Administré par","emit-value":"","map-options":"",clearable:"","option-value":"idpers","option-label":o=>`${o.nom} ${o.prenom}`,standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","options","option-label"]),a(B,{dense:"",filled:"",modelValue:d.observations_notes,"onUpdate:modelValue":[s[6]||(s[6]=o=>d.observations_notes=o),Q(C)],label:"Recherche Notes/Observations",clearable:"",standout:"bg-sky-50",class:"rounded-md md:col-span-2 lg:col-span-1"},null,8,["modelValue","onUpdate:modelValue"])]),_("div",it,[a(N,{unelevated:"",label:"Effacer Filtres",color:"grey-7",onClick:de,icon:"sym_o_clear",class:"rounded-md",size:"sm"})])]),_:1})]),_:1}),_("div",dt,[_("div",ut,f(p.total)+" entrée(s) au journal trouvée(s). ",1),a(N,{color:"primary",icon:"sym_o_note_add",label:"Nouvelle Entrée",onClick:ue,class:"rounded-md",unelevated:""})]),J.journalEntries?(c(),H("div",mt,[a(Oe,{color:"primary",size:"xl"}),s[11]||(s[11]=_("p",{class:"text-gray-500 mt-2"},"Chargement des entrées du journal...",-1))])):z.value?(c(),H("div",pt,[a(A,{name:"sym_o_error",size:"lg",color:"negative"}),s[12]||(s[12]=_("p",{class:"text-negative mt-2 font-semibold"},"Erreur de chargement",-1)),_("p",_t,f(z.value),1)])):u.value.length?(c(),D(Be,{key:3,bordered:"",separator:"",class:"rounded-lg bg-white shadow"},{default:n(()=>[a(He,{items:u.value,separator:"",style:{"max-height":"70vh"}},{default:n(({item:o})=>[(c(),D(Z,{key:o.id_journal,class:"py-3 hover:bg-slate-50"},{default:n(()=>[a(q,{avatar:"",top:""},{default:n(()=>[o.traitement_eleve?.eleve?.photo?(c(),D(De,{key:0,size:"lg"},{default:n(()=>[_("img",{src:K(o.traitement_eleve.eleve)},null,8,vt)]),_:2},1024)):(c(),D(De,{key:1,color:"accent-1","text-color":"accent-8",icon:"sym_o_person",size:"lg"}))]),_:2},1024),a(q,null,{default:n(()=>[a(G,{class:"font-semibold text-primary-dark text-md"},{default:n(()=>[w(f(o.traitement_eleve?.eleve?.nom_complet||"Élève N/A")+" ",1),_("span",ft," (Protocole: "+f(o.traitement_eleve?.condition_medicale||o.traitement_eleve?.nom_medicament_procedure||"N/A")+")",1)]),_:2},1024),a(G,{caption:"",class:"text-gray-600"},{default:n(()=>[a(A,{name:"sym_o_calendar_month",size:"xs",class:"q-mr-xs"}),w(" "+f(R(o.dateheure_administration,"DD/MM/YYYY HH:mm")),1)]),_:2},1024),a(G,{caption:"",class:"text-gray-600"},{default:n(()=>[a(A,{name:"sym_o_syringe",size:"xs",class:"q-mr-xs"}),w(" Dosage: "+f(o.dosage_administre_reel||"Non spécifié"),1)]),_:2},1024),o.observations_notes?(c(),D(G,{key:0,caption:"",class:"text-gray-600"},{default:n(()=>[a(A,{name:"sym_o_visibility",size:"xs",class:"q-mr-xs"}),w(" "+f(o.observations_notes.substring(0,150))+f(o.observations_notes.length>150?"...":""),1)]),_:2},1024)):P("",!0),a(G,{caption:"",class:"text-sm text-gray-500 mt-1"},{default:n(()=>[w(" Administré par: "+f(o.auto_administration_rapportee?"Élève (rapporté)":o.administre_par?.nom_complet||"N/A")+" ",1),o.created_by_user?(c(),H("span",gt," | Enregistré par: "+f(o.created_by_user?.nom_complet||"N/A"),1)):P("",!0)]),_:2},1024)]),_:2},1024),a(q,{side:"",top:"",class:"pt-sm space-y-1 items-end"},{default:n(()=>[o.auto_administration_rapportee?(c(),D(we,{key:0,dense:"",square:"",label:"Auto-Admin",color:"orange-6","text-color":"white",class:"text-sm font-medium"})):(c(),D(we,{key:1,dense:"",square:"",label:"Admin. Personnel",color:"blue-6","text-color":"white",class:"text-sm font-medium"})),_("div",bt,[a(N,{flat:"",dense:"",round:"",icon:"sym_o_visibility",onClick:_e(V=>ae(o),["stop"]),color:"blue-grey-6",size:"sm"},{default:n(()=>[a(ce,{class:"bg-gray-800 text-white rounded"},{default:n(()=>s[15]||(s[15]=[w("Voir Détails")])),_:1})]),_:2},1032,["onClick"]),a(N,{flat:"",dense:"",round:"",icon:"sym_o_edit",onClick:_e(V=>X(o),["stop"]),color:"secondary",size:"sm"},{default:n(()=>[a(ce,{class:"bg-gray-800 text-white rounded"},{default:n(()=>s[16]||(s[16]=[w("Modifier")])),_:1})]),_:2},1032,["onClick"]),a(N,{flat:"",dense:"",round:"",icon:"sym_o_delete",onClick:_e(V=>L(o.id_journal),["stop"]),color:"negative",size:"sm"},{default:n(()=>[a(ce,{class:"bg-gray-800 text-white rounded"},{default:n(()=>s[17]||(s[17]=[w("Supprimer")])),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))]),_:1},8,["items"])]),_:1})):(c(),H("div",ct,[a(A,{name:"sym_o_history_edu",size:"lg",color:"grey-5"}),s[13]||(s[13]=_("p",{class:"text-gray-500 mt-2 text-lg"},"Aucune entrée au journal trouvée.",-1)),s[14]||(s[14]=_("p",{class:"text-gray-400"},"Utilisez les filtres ou ajoutez une nouvelle entrée.",-1))])),p.last_page>1?(c(),D(Te,{key:4,align:"center",class:"py-4"},{default:n(()=>[a(qe,{modelValue:p.current_page,"onUpdate:modelValue":[s[7]||(s[7]=o=>p.current_page=o),b],max:p.last_page,"direction-links":"",flat:"",color:"primary","active-color":"primary",class:"rounded-md"},null,8,["modelValue","max"])]),_:1})):P("",!0)]),(c(),D(lt,{isDialogVisible:l.value,"onUpdate:isDialogVisible":s[8]||(s[8]=o=>l.value=o),"journal-entry-id":M.value,"traitement-id":y.value,"student-id-for-new":I.value,"is-view-mode":i.value,onJournalEntrySaved:me,key:j.value},null,8,["isDialogVisible","journal-entry-id","traitement-id","student-id-for-new","is-view-mode"]))]),_:1}))}};export{Lt as default};
