import{v as Ee,bC as je,W as He,bD as Ue,z as Ge,X as Ke,bm as Xe,bu as Ye,c0 as se,c1 as Je,A as y,B as r,bF as Ze,c2 as ea,Y as g,c3 as aa,aR as be,C as ta,D as la,av as F,y as K,c4 as ye,bp as oa,c5 as na,c6 as ra,aO as xe,aP as qe,aI as we,a4 as W,S as _,a5 as o,a8 as R,Q as X,R as ue,a6 as i,a3 as x,ad as ie,ab as ke,aF as Y,aE as ce,a9 as Z,aa as sa,aw as ua,ax as ia,ay as ve,a7 as ca,aG as da,aD as Be,o as pe,d as Ce,aH as fa,aW as va,af as ma}from"./index-Bl2lQPd7.js";import{T as de}from"./TouchPan-jBhMORlX.js";import{b as J}from"./format-IcNrutKL.js";import{u as Te}from"./composables-CAkrP3jA.js";import{Q as _e}from"./QToolbarTitle-C8APieXG.js";import{Q as Se}from"./QToolbar-DR-_wX4W.js";import{Q as ha}from"./QBanner-xBGiroIy.js";import{Q as ga,a as ba}from"./QItem-De3v03wU.js";import{Q as ya}from"./QList-CMzNTEGD.js";import{Q as wa}from"./QPageSticky-adQ0nSeI.js";import{C as fe}from"./ClosePopup-BY_YGFBZ.js";const Qe=150,za=Ee({name:"QDrawer",inheritAttrs:!1,props:{...Ue,...He,side:{type:String,default:"left",validator:a=>["left","right"].includes(a)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:a=>["default","desktop","mobile"].includes(a),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...je,"onLayout","miniState"],setup(a,{slots:C,emit:d,attrs:p}){const b=Ge(),{proxy:{$q:f}}=b,N=Ke(a,f),{preventBodyScroll:O}=aa(),{registerTimeout:M,removeTimeout:A}=Xe(),t=Ye(Je,se);if(t===se)return console.error("QDrawer needs to be child of QLayout"),se;let S,Q=null,V;const v=y(a.behavior==="mobile"||a.behavior!=="desktop"&&t.totalWidth.value<=a.breakpoint),q=r(()=>a.mini===!0&&v.value!==!0),m=r(()=>q.value===!0?a.miniWidth:a.width),s=y(a.showIfAbove===!0&&v.value===!1?!0:a.modelValue===!0),E=r(()=>a.persistent!==!0&&(v.value===!0||De.value===!0));function z(e,l){if(H(),e!==!1&&t.animate(),k(0),v.value===!0){const w=t.instances[U.value];w?.belowBreakpoint===!0&&w.hide(!1),D(1),t.isContainer.value!==!0&&O(!0)}else D(0),e!==!1&&oe(!1);M(()=>{e!==!1&&oe(!0),l!==!0&&d("show",e)},Qe)}function j(e,l){c(),e!==!1&&t.animate(),D(0),k(h.value*m.value),ne(),l!==!0?M(()=>{d("hide",e)},Qe):A()}const{show:I,hide:B}=Ze({showing:s,hideOnRouteChange:E,handleShow:z,handleHide:j}),{addToHistory:H,removeFromHistory:c}=ea(s,B,E),n={belowBreakpoint:v,hide:B},u=r(()=>a.side==="right"),h=r(()=>(f.lang.rtl===!0?-1:1)*(u.value===!0?1:-1)),$=y(0),T=y(!1),ee=y(!1),me=y(m.value*h.value),U=r(()=>u.value===!0?"left":"right"),ae=r(()=>s.value===!0&&v.value===!1&&a.overlay===!1?a.miniToOverlay===!0?a.miniWidth:m.value:0),te=r(()=>a.overlay===!0||a.miniToOverlay===!0||t.view.value.indexOf(u.value?"R":"L")!==-1||f.platform.is.ios===!0&&t.isContainer.value===!0),P=r(()=>a.overlay===!1&&s.value===!0&&v.value===!1),De=r(()=>a.overlay===!0&&s.value===!0&&v.value===!1),Le=r(()=>"fullscreen q-drawer__backdrop"+(s.value===!1&&T.value===!1?" hidden":"")),Oe=r(()=>({backgroundColor:`rgba(0,0,0,${$.value*.4})`})),he=r(()=>u.value===!0?t.rows.value.top[2]==="r":t.rows.value.top[0]==="l"),$e=r(()=>u.value===!0?t.rows.value.bottom[2]==="r":t.rows.value.bottom[0]==="l"),Re=r(()=>{const e={};return t.header.space===!0&&he.value===!1&&(te.value===!0?e.top=`${t.header.offset}px`:t.header.space===!0&&(e.top=`${t.header.size}px`)),t.footer.space===!0&&$e.value===!1&&(te.value===!0?e.bottom=`${t.footer.offset}px`:t.footer.space===!0&&(e.bottom=`${t.footer.size}px`)),e}),Me=r(()=>{const e={width:`${m.value}px`,transform:`translateX(${me.value}px)`};return v.value===!0?e:Object.assign(e,Re.value)}),Ae=r(()=>"q-drawer__content fit "+(t.isContainer.value!==!0?"scroll":"overflow-auto")),Ve=r(()=>`q-drawer q-drawer--${a.side}`+(ee.value===!0?" q-drawer--mini-animate":"")+(a.bordered===!0?" q-drawer--bordered":"")+(N.value===!0?" q-drawer--dark q-dark":"")+(T.value===!0?" no-transition":s.value===!0?"":" q-layout--prevent-focus")+(v.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${q.value===!0?"mini":"standard"}`+(te.value===!0||P.value!==!0?" fixed":"")+(a.overlay===!0||a.miniToOverlay===!0?" q-drawer--on-top":"")+(he.value===!0?" q-drawer--top-padding":""))),We=r(()=>{const e=f.lang.rtl===!0?a.side:U.value;return[[de,Fe,void 0,{[e]:!0,mouse:!0}]]}),ze=r(()=>{const e=f.lang.rtl===!0?U.value:a.side;return[[de,ge,void 0,{[e]:!0,mouse:!0}]]}),Ie=r(()=>{const e=f.lang.rtl===!0?U.value:a.side;return[[de,ge,void 0,{[e]:!0,mouse:!0,mouseAllDir:!0}]]});function le(){Ne(v,a.behavior==="mobile"||a.behavior!=="desktop"&&t.totalWidth.value<=a.breakpoint)}g(v,e=>{e===!0?(S=s.value,s.value===!0&&B(!1)):a.overlay===!1&&a.behavior!=="mobile"&&S!==!1&&(s.value===!0?(k(0),D(0),ne()):I(!1))}),g(()=>a.side,(e,l)=>{t.instances[l]===n&&(t.instances[l]=void 0,t[l].space=!1,t[l].offset=0),t.instances[e]=n,t[e].size=m.value,t[e].space=P.value,t[e].offset=ae.value}),g(t.totalWidth,()=>{(t.isContainer.value===!0||document.qScrollPrevented!==!0)&&le()}),g(()=>a.behavior+a.breakpoint,le),g(t.isContainer,e=>{s.value===!0&&O(e!==!0),e===!0&&le()}),g(t.scrollbarWidth,()=>{k(s.value===!0?0:void 0)}),g(ae,e=>{L("offset",e)}),g(P,e=>{d("onLayout",e),L("space",e)}),g(u,()=>{k()}),g(m,e=>{k(),re(a.miniToOverlay,e)}),g(()=>a.miniToOverlay,e=>{re(e,m.value)}),g(()=>f.lang.rtl,()=>{k()}),g(()=>a.mini,()=>{a.noMiniAnimation||a.modelValue===!0&&(Pe(),t.animate())}),g(q,e=>{d("miniState",e)});function k(e){e===void 0?be(()=>{e=s.value===!0?0:m.value,k(h.value*e)}):(t.isContainer.value===!0&&u.value===!0&&(v.value===!0||Math.abs(e)===m.value)&&(e+=h.value*t.scrollbarWidth.value),me.value=e)}function D(e){$.value=e}function oe(e){const l=e===!0?"remove":t.isContainer.value!==!0?"add":"";l!==""&&document.body.classList[l]("q-body--drawer-toggle")}function Pe(){Q!==null&&clearTimeout(Q),b.proxy&&b.proxy.$el&&b.proxy.$el.classList.add("q-drawer--mini-animate"),ee.value=!0,Q=setTimeout(()=>{Q=null,ee.value=!1,b?.proxy?.$el?.classList.remove("q-drawer--mini-animate")},150)}function Fe(e){if(s.value!==!1)return;const l=m.value,w=J(e.distance.x,0,l);if(e.isFinal===!0){w>=Math.min(75,l)===!0?I():(t.animate(),D(0),k(h.value*l)),T.value=!1;return}k((f.lang.rtl===!0?u.value!==!0:u.value)?Math.max(l-w,0):Math.min(0,w-l)),D(J(w/l,0,1)),e.isFirst===!0&&(T.value=!0)}function ge(e){if(s.value!==!0)return;const l=m.value,w=e.direction===a.side,G=(f.lang.rtl===!0?w!==!0:w)?J(e.distance.x,0,l):0;if(e.isFinal===!0){Math.abs(G)<Math.min(75,l)===!0?(t.animate(),D(1),k(0)):B(),T.value=!1;return}k(h.value*G),D(J(1-G/l,0,1)),e.isFirst===!0&&(T.value=!0)}function ne(){O(!1),oe(!0)}function L(e,l){t.update(a.side,e,l)}function Ne(e,l){e.value!==l&&(e.value=l)}function re(e,l){L("size",e===!0?a.miniWidth:l)}return t.instances[a.side]=n,re(a.miniToOverlay,m.value),L("space",P.value),L("offset",ae.value),a.showIfAbove===!0&&a.modelValue!==!0&&s.value===!0&&a["onUpdate:modelValue"]!==void 0&&d("update:modelValue",!0),ta(()=>{d("onLayout",P.value),d("miniState",q.value),S=a.showIfAbove===!0;const e=()=>{(s.value===!0?z:j)(!1,!0)};if(t.totalWidth.value!==0){be(e);return}V=g(t.totalWidth,()=>{V(),V=void 0,s.value===!1&&a.showIfAbove===!0&&v.value===!1?I(!1):e()})}),la(()=>{V?.(),Q!==null&&(clearTimeout(Q),Q=null),s.value===!0&&ne(),t.instances[a.side]===n&&(t.instances[a.side]=void 0,L("size",0),L("offset",0),L("space",!1))}),()=>{const e=[];v.value===!0&&(a.noSwipeOpen===!1&&e.push(F(K("div",{key:"open",class:`q-drawer__opener fixed-${a.side}`,"aria-hidden":"true"}),We.value)),e.push(ye("div",{ref:"backdrop",class:Le.value,style:Oe.value,"aria-hidden":"true",onClick:B},void 0,"backdrop",a.noSwipeBackdrop!==!0&&s.value===!0,()=>Ie.value)));const l=q.value===!0&&C.mini!==void 0,w=[K("div",{...p,key:""+l,class:[Ae.value,p.class]},l===!0?C.mini():oa(C.default))];return a.elevated===!0&&s.value===!0&&w.push(K("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),e.push(ye("aside",{ref:"content",class:Ve.value,style:Me.value},w,"contentclose",a.noSwipeClose!==!0&&v.value===!0,()=>ze.value)),K("div",{class:"q-drawer-container"},e)}}}),ka={key:0,class:"window-height window-width bg-white"},pa={class:"relative"},Ca={class:"col-xs-12 col-md-4 q-pa-xl bg-secondary text-white"},_a={style:{"text-align":"center"}},Sa={key:1,class:"qrscanner relative window-height window-width"},Qa={class:"relative"},xa={__name:"SchoolScan",setup(a){const C=na();ra(),Te();const d=xe(),p=qe();r(()=>p.getters["user/current"]),r(()=>p.getters["user/config"]),r(()=>p.getters["user/user"]);const b=r(()=>{let c=we();if(S.value.push(c),Object.keys(c).length>0){let u=we();if(S.value.push(u),Object.keys(u).length){let h=Object.keys(u);S.value.push(h);let $=[];for(var n=0;n<h.length;n++){S.value.push([u[h[n]],atob(u[h[n]])]);let T=atob(u[h[n]]).split("|");$.push({key:h[n],titre:T[1],code:u[h[n]]})}return S.value.push($),$}return[]}}),f=y(""),N=y(!1),O=y(!1),M=y(!1),A=y(!1),t=y(null),S=y([]);function Q(){O.value=!O.value,O.value?QRScanner.useFrontCamera():QRScanner.useBackCamera()}function V(){M.value=!M.value,M.value?QRScanner.enableLight():QRScanner.disableLight()}function v(){console.log(t.value),fa(t.value.key),t.value=null}function q(){QRScanner.destroy(function(c){}),A.value=!1,document.body.classList.remove("ecp-scanner")}function m(){return p.dispatch("ecole/getInfo")}function s(){f.value="",d.platform.is.cordova&&(d.platform.is.ios&&QRScanner.prepare((c,n)=>{c&&console.error(c),n.authorized||n.denied}),QRScanner.scan((c,n)=>{A.value=!1,c&&(f.value="Scanning failed: "+c._message,console.error(c._message)),pe(n)?(Ce(),m().then(()=>{}),q(),H()):f.value="Code incorrect! veuillez réessayer "}),A.value=!0,document.body.classList.add("ecp-scanner"),QRScanner.show())}function E(c){pe(c.code)&&(m(),Ce(),H())}function z(){console.log("LanceDataServer"),j().then(()=>{I({page:1})})}function j(){return p.dispatch("user/getConfig")}function I({page:c}){return p.dispatch("actualite/getData",{page:c})}function B(){return p.dispatch("user/verify")}function H(){va()&&(d.loading.show(),m().then(()=>{C.replace("/"),B(),z(),d.loading.hide()}).catch(c=>{console.error(c),C.replace("/"),B(),z(),d.loading.hide()}))}return(c,n)=>(_(),W(Z,null,[A.value?(_(),W("div",Sa,[R("div",Qa,[o(Se,{class:"text-white"},{default:i(()=>[o(_e),o(x,{flat:"",dense:"",icon:"close",onClick:q})]),_:1})]),n[3]||(n[3]=R("div",{class:"qrscanner-area"},null,-1)),o(wa,{position:"bottom",offset:[0,80]},{default:i(()=>[o(x,{onClick:V,fab:"",class:"q-mr-md",color:"dark"},{default:i(()=>[o(ve,{name:"flash_on"})]),_:1}),o(x,{onClick:Q,fab:"",color:"dark"},{default:i(()=>[o(ve,{name:"flip_camera_ios"})]),_:1})]),_:1})])):(_(),W("div",ka,[R("div",pa,[o(Se,{class:""},{default:i(()=>[o(_e),F(o(x,{flat:"",dense:"",icon:"close"},null,512),[[fe]])]),_:1})]),R("div",Ca,[f.value?(_(),X(ha,{key:0,"inline-actions":"",class:"text-white bg-red"},{action:i(()=>[o(x,{flat:"",color:"white",label:"Rescan",onClick:s})]),default:i(()=>[ie(" Erreur: "+ke(f.value)+" ",1)]),_:1})):ue("",!0),o(ce,{flat:"",class:"bg-transparent"},{default:i(()=>[o(Y),o(Y,null,{default:i(()=>[R("div",_a,[o(x,{unelevated:"",rounded:"",color:"primary",size:"md",label:"Flasher le QRCode",icon:"qr_code",onClick:s}),n[1]||(n[1]=R("div",{style:{"text-align":"center","text-size":"0.5rem"}},"Code communiqué par votre établissement",-1))])]),_:1})]),_:1})]),b.value.length?(_(),X(ce,{key:0,flat:"",square:"",class:""},{default:i(()=>[b.value.length?(_(),X(Y,{key:0},{default:i(()=>n[2]||(n[2]=[ie(" ou sélectionner un établissement: ")])),_:1})):ue("",!0),o(ya,{bordered:""},{default:i(()=>[(_(!0),W(Z,null,sa(b.value,(u,h)=>(_(),W(Z,{key:h},[F((_(),X(ga,{clickable:""},{default:i(()=>[o(ba,{onClick:$=>E(u)},{default:i(()=>[ie(ke(u.titre),1)]),_:2},1032,["onClick"])]),_:2},1024)),[[ua]]),o(ia)],64))),128))]),_:1})]),_:1})):ue("",!0)])),o(Be,{modelValue:N.value,"onUpdate:modelValue":n[0]||(n[0]=u=>N.value=u),persistent:""},{default:i(()=>[o(ce,null,{default:i(()=>[o(Y,{class:"row items-center"},{default:i(()=>[o(ca,{icon:"warning",color:"primary","text-color":"white"}),n[4]||(n[4]=R("span",{class:"q-ml-sm"},"Êtes-vous sûr de vouloir supprimer cet établissement ?",-1))]),_:1}),o(da,{align:"right"},{default:i(()=>[F(o(x,{flat:"",label:"Non",color:"primary"},null,512),[[fe]]),F(o(x,{flat:"",label:"Oui",color:"primary",onClick:v},null,512),[[fe]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ia={__name:"SchoolSwitcher",setup(a){Te(),xe();const C=qe();r(()=>C.getters["user/current"]),r(()=>C.getters["user/config"]),r(()=>C.getters["user/user"]);const d=y(!1);return(p,b)=>(_(),W(Z,null,[o(x,{flat:"",class:ma({"full-width":!0,"q-mt-sm":!0}),onClick:b[0]||(b[0]=f=>d.value=!d.value)},{default:i(()=>[o(ve,{name:"icon_orientation"})]),_:1}),o(Be,{modelValue:d.value,"onUpdate:modelValue":b[1]||(b[1]=f=>d.value=f),position:"right",maximized:""},{default:i(()=>[o(xa)]),_:1},8,["modelValue"])],64))}};export{za as Q,Ia as _};
