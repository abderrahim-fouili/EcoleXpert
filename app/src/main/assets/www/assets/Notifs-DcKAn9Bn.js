import{_ as N,aY as q,ar as D,b9 as M,b2 as V,ba as U,as as B,at as S,ag as I,a4 as l,S as s,a8 as y,a5 as a,Q as c,R as m,a6 as i,ad as n,ab as d,ax as v,a9 as p,aa as _,ac as O,ah as b,ay as k,a3 as j,aE as E,aB as P}from"./index-Bl2lQPd7.js";import{Q as u}from"./QItemLabel-BkJiB6aE.js";import{Q as T,a as x}from"./QItem-De3v03wU.js";import{Q as w}from"./QBadge-Bjfo5tRO.js";import{Q as z}from"./QList-CMzNTEGD.js";import{f as h}from"./index-C9ZTL5MN.js";import{f as g}from"./index-Dx01H97j.js";import{q as A}from"./format-IcNrutKL.js";import"./index-BXMW6yyY.js";import"./index-CbPSoDvq.js";const R={emits:["notif:edit","notif:remove","abs:justifier","notif:hold"],data(){return{active:null,holding:!1}},computed:{...S({user:"user/user",config:"user/config",current:"user/current",notifsList:"absence/notifs",form:"absence/form"}),notifs(){return this.notifsList&&this.notifsList.data?this.notifsList.data:[]},eleve(){if(this.current&&this.current.hasOwnProperty("eleve"))return this.current.eleve},annee(){if(this.current&&this.current.hasOwnProperty("annee"))return this.current.annee}},methods:{...B({getConfig:"user/getConfig",getNotifs:"absence/getNotifs",remove:"absence/remove"}),LetterAvatar:U,toNow:V,fileIcon:M,openURL:D,pjUrl:q,getData(){this.getNotifs({page:this.notifsList.current_page,filter:{eleve_id:this.eleve.idpers}})},showDelete(e){this.$q.dialog({title:"Suppression",message:"Supprimer cette notification?",cancel:!0,ok:{label:"Oui",outline:!0,color:"red"},persistent:!0}).onOk(()=>{this.remove(e).then(o=>{this.getData()})})},edit(e){e.id===this.active?this.active=null:e&&!e.status&&(Object.assign(this.form,e),this.form.du=h(g(this.form.du),"yyyy-MM-dd"),this.form.au=h(g(this.form.au),"yyyy-MM-dd"),this.$emit("notif:edit",{ntf:e,title:"Modifier"}))},toDate(e){return A.capitalize(h(g(e),"E dd MMM yyyy"))},personAvatar(e){return P(e)},sub(e){return this.$cleanHtml(e,{allowedTags:["b","i","em","strong","a"]})}},mounted(){this.setTitle("Notifier une absence"),this.getNotifs({page:1,filter:{eleve_id:this.eleve.idpers}})}},F={class:"q-pa-lg flex flex-center"},G={key:0},H=["onClick"];function Y(e,o,J,K,L,r){const Q=I("ep-pagination");return s(),l(p,null,[y("div",F,[e.notifsList?(s(),c(Q,{key:0,modelValue:e.notifsList.current_page,"onUpdate:modelValue":[o[0]||(o[0]=t=>e.notifsList.current_page=t),r.getData],max:e.notifsList.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:i(()=>[n(" Page "+d(e.notifsList.current_page),1)]),_:1},8,["modelValue","max","onUpdate:modelValue"])):m("",!0)]),a(E,{style:{margin:"0 -8px"},flat:""},{default:i(()=>[a(z,null,{default:i(()=>[a(v),(s(!0),l(p,null,_(r.notifs,(t,C)=>(s(),l(p,{key:C},[a(T,{clickable:"",style:O("border-left: 5px solid "+(t.status?"var(--q-positive)":"var(--q-warning)")),onClick:f=>r.edit(t),active:L.active===t.id},{default:i(()=>[a(x,null,{default:i(()=>[a(u,{style:{"font-weight":"500"}},{default:i(()=>[y("div",null,d(r.toDate(t.du)),1),t.du!=t.au?(s(),l("div",G,d(r.toDate(t.au)),1)):m("",!0)]),_:2},1024),a(u,{style:{padding:"12px 0"}},{default:i(()=>[n(d(t.motif),1)]),_:2},1024),t.fichiers.length?(s(),c(u,{key:0,lines:"1"},{default:i(()=>[(s(!0),l(p,null,_(t.fichiers,(f,W)=>(s(),l("div",{outline:"",color:"grey-9",onClick:b(X=>r.openURL(r.pjUrl(f)),["stop"]),class:"ellipsis rounded-borders q-mr-xs q-pa-xs",style:{"max-width":"40%",display:"inline-block",border:"1px solid var(--q-primary)"}},[a(k,{name:"img:"+r.fileIcon(f.fichier),size:"14px"},null,8,["name"]),n(" "+d(f.fichier),1)],8,H))),256))]),_:2},1024)):m("",!0)]),_:2},1024),a(x,{side:"",top:"",style:{position:"relative"}},{default:i(()=>[a(u,{caption:""},{default:i(()=>[n(d(r.toNow(t.created_at*1e3)),1)]),_:2},1024),a(u,{caption:""},{default:i(()=>[t.status?(s(),c(w,{key:0,color:"positive"},{default:i(()=>o[1]||(o[1]=[n("ValidÃ©")])),_:1})):(s(),c(w,{key:1,color:"warning"},{default:i(()=>o[2]||(o[2]=[n("En cours")])),_:1}))]),_:2},1024),t.status?m("",!0):(s(),c(u,{key:0,style:{"min-height":"32px","min-width":"32px","margin-top":"16px"}},{default:i(()=>[a(j,{onClick:b(f=>r.showDelete(t),["stop"]),dense:"",flat:"",color:"red",class:"absolute-bottom-right"},{default:i(()=>[a(k,{name:"delete"})]),_:2},1032,["onClick"])]),_:2},1024))]),_:2},1024)]),_:2},1032,["style","onClick","active"]),a(v)],64))),128))]),_:1})]),_:1})],64)}const ne=N(R,[["render",Y]]);export{ne as default};
