import{Q as z}from"./QBadge-Bjfo5tRO.js";import{aO as L,aP as G,A as j,B as o,C as H,Q as g,S as p,a6 as l,a5 as e,av as Y,a3 as U,ad as b,ab as q,aF as T,a8 as E,R as F,b1 as B,aZ as _e,a_ as be,a2 as X,aG as ne,aE as Z,ac as re,a7 as ye,aS as ie,aB as ke,ag as ae,a4 as K,ay as te,ax as oe,a9 as W,aa as he,ah as Ve,aC as we,aD as xe,b2 as Ce,b3 as Qe}from"./index-Bl2lQPd7.js";import{Q as S}from"./QItemLabel-BkJiB6aE.js";import{Q as A,a as D}from"./QItem-De3v03wU.js";import{Q as Se}from"./QList-CMzNTEGD.js";import{u as J}from"./composables-CAkrP3jA.js";import{Q as se}from"./QToolbarTitle-C8APieXG.js";import{Q as ue}from"./QToolbar-DR-_wX4W.js";import{Q as M}from"./QSelect-DchnWyXK.js";import{Q as de}from"./QForm-Dk45GsL9.js";import{C as ee}from"./ClosePopup-BY_YGFBZ.js";import{Q as qe}from"./QSpace-CKKoNTi_.js";import"./QChip-C9OfA2gn.js";import"./QMenu-BNr9Tzvf.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./rtl-DFPa-2ov.js";import"./format-IcNrutKL.js";const Ne={class:"q-py-md"},Re={class:"q-gutter-md"},Oe={__name:"Edit",props:{reclamation:{type:Object,default:()=>null},title:{type:String,default:()=>"Nouvelle reclamation"}},emits:["reclamation:sent","reclamation:error"],setup(P,{emit:$}){J();const i=L(),r=G(),y=P,m=j(null),w=$,k=o(()=>r.getters["user/current"]),s=o(()=>r.getters["reclamation/form"]),N=o(()=>r.getters["user/config"]);o(()=>r.getters["user/user"]);const v=o(()=>N.value.meta.admins),R=o(()=>k.value.annee.profs),d=j("admin"),Q=o(()=>R.value.map(c=>({label:c.nom+" "+c.prenom,value:c}))),x=o(()=>v.value.map(c=>({label:c.description,value:c}))),u=o({get(){return d.value==="admin"?x.value.find(c=>c.value.idrole===(s.value.idrole?s.value.idrole.idrole:0))||null:Q.value.find(c=>c.value.idpers===(s.value.idtarget?s.value.idtarget.idpers:0))||null},set(c){c===null?(s.value.idrole=0,s.value.idtarget=0):d.value==="admin"?s.value.idrole=c.value:s.value.idtarget=c.value}});function t(){m.value.validate().then(c=>{if(c){let _={...s.value};s.value.idtarget&&isNaN(s.value.idtarget)&&(_.idtarget=s.value.idtarget.idpers),s.value.idrole&&isNaN(s.value.idrole)&&(_.idrole=s.value.idrole.idrole),d.value==="admin"?_.idtarget=0:_.idrole=0,w("reclamation:sent",_)}else i.notify({color:"negative",message:"Champs obligatoires non remplis",position:"bottom",icon:"error_outline",actions:[{label:i.lang.label.close,color:"yellow"}]})})}function h(){y.reclamation?(r.commit("reclamation/setForm",{...y.reclamation}),y.reclamation.idrole===0?(s.value.idtarget=Q.value.find(c=>c.value.idpers===y.reclamation.idtarget).value||null,d.value="prof"):(s.value.idrole=x.value.find(c=>c.value.idrole===y.reclamation.idrole).value||null,d.value="admin"),console.log("reclamation",y.reclamation,s.value)):r.commit("reclamation/resetForm")}function C(c){return c.value.disciplines&&c.value.disciplines.length}function I(c){return c.value.disciplines[0].description}return H(()=>{h()}),(c,_)=>(p(),g(Z,null,{default:l(()=>[e(ue,{class:"bg-secondary text-white shadow-2"},{default:l(()=>[Y(e(U,{flat:"",dense:"",icon:"arrow_back"},null,512),[[ee]]),e(se,null,{default:l(()=>[b(q(P.title),1)]),_:1}),e(U,{class:"q-ml-lg",flat:"",icon:"send",onClick:t})]),_:1}),e(T,{style:{"overflow-y":"scroll"}},{default:l(()=>[e(de,{onSubmit:t,class:"q-gutter-md",ref_key:"reclamationForm",ref:m},{default:l(()=>[E("div",Ne,[E("div",Re,[e(B,{modelValue:d.value,"onUpdate:modelValue":_[0]||(_[0]=f=>d.value=f),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"admin",label:"Administration"},null,8,["modelValue"]),e(B,{modelValue:d.value,"onUpdate:modelValue":_[1]||(_[1]=f=>d.value=f),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"prof",label:"Professeur"},null,8,["modelValue"])])]),d.value==="admin"?(p(),g(M,{key:0,filled:"",modelValue:u.value,"onUpdate:modelValue":_[2]||(_[2]=f=>u.value=f),options:x.value,"use-chips":"",label:"Administraion","lazy-rules":"",rules:[f=>!!f||"Champ obligatoire"]},null,8,["modelValue","options","rules"])):F("",!0),d.value==="prof"?(p(),g(M,{key:1,filled:"",modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=f=>u.value=f),options:Q.value,"use-chips":"",label:"Professeur","lazy-rules":"",rules:[f=>!!f||"Champ obligatoire"]},{option:l(f=>[e(A,_e(be(f.itemProps)),{default:l(()=>[e(D,null,{default:l(()=>[e(S,{innerHTML:f.opt.label},null,8,["innerHTML"])]),_:2},1024),e(D,{side:""},{default:l(()=>[C(f.opt)?(p(),g(z,{key:0,color:"grey"},{default:l(()=>[b(q(I(f.opt)),1)]),_:2},1024)):F("",!0)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","rules"])):F("",!0),e(X,{modelValue:s.value.objet,"onUpdate:modelValue":_[4]||(_[4]=f=>s.value.objet=f),label:"Objet",rules:[f=>!!f||"Champ obligatoire"],"lazy-rules":"",filled:""},null,8,["modelValue","rules"]),e(X,{modelValue:s.value.contenu,"onUpdate:modelValue":_[5]||(_[5]=f=>s.value.contenu=f),autogrow:"",type:"textarea",label:"Message",rules:[f=>!!f||"Champ obligatoire"],"lazy-rules":"","input-style":"min-height:150px",filled:""},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),e(ne,{align:"right",class:""},{default:l(()=>[e(U,{label:"Envoyer",icon:"send",onClick:t})]),_:1})]),_:1}))}},Fe={class:"flex flex-center",style:{"max-width":"85%"}},Ue={class:"absolute-bottom"},je=["src"],De={__name:"View",props:{reclamation:{type:Object,default:()=>null}},emits:["reclamation:sent","reclamation:error"],setup(P,{emit:$}){J(),L();const i=G(),r=P,y=o(()=>i.getters["user/current"]),m=o(()=>i.getters["reclamation/form"]),w=o(()=>i.getters["user/config"]);o(()=>i.getters["user/user"]);const k=o(()=>w.value.meta.admins),s=o(()=>y.value.annee.profs),N=j("admin"),v=o(()=>s.value.map(u=>({label:u.nom+" "+u.prenom,value:u}))),R=o(()=>k.value.map(u=>({label:u.description,value:u}))),d=o(()=>{if(m.value.idrole){let u=k.value.find(t=>t.idrole===m.value.idrole);if(u)return u.description}else return m.value&&m.value.target?m.value.target.nom+" "+m.value.target.prenom:""});o({get(){return N.value==="admin"?R.value.find(u=>u.value.idrole===m.value.idrole)||null:v.value.find(u=>u.value.idpers===m.value.idtarget)||null},set(u){N.value==="admin"?m.value.idrole=u.value.idrole:m.value.idtarget=u.value.idpers}});function Q(){r.reclamation?(i.commit("reclamation/setForm",r.reclamation),r.reclamation.idrole===0?N.value="prof":N.value="admin"):i.commit("reclamation/resetForm")}function x(u){if(u.status===1)return"var(--q-warning)";if(u.status>1)return"var(--q-positive)"}return H(()=>{Q()}),(u,t)=>(p(),g(Z,{class:"window-width"},{default:l(()=>[e(T,{class:"row text-white",style:re("font-weight:600;background-color: "+x(m.value))},{default:l(()=>[E("div",Fe,q(m.value.objet),1),e(qe),Y(e(U,{icon:"close",flat:"",round:"",dense:""},null,512),[[ee]])]),_:1},8,["style"]),e(T,null,{default:l(()=>[b(q(m.value.contenu),1)]),_:1}),m.value.report?(p(),g(A,{key:0,class:"q-pa-lg shadow-1 q--avoid-card-border"},{default:l(()=>[e(D,null,{default:l(()=>[e(S,{overline:""},{default:l(()=>t[0]||(t[0]=[b("ADMINISRATION")])),_:1}),e(S,null,{default:l(()=>[b(q(m.value.report),1)]),_:1})]),_:1})]),_:1})):F("",!0),E("div",Ue,[m.value.idrole?(p(),g(A,{key:0},{default:l(()=>[e(D,null,{default:l(()=>[e(S,{overline:""},{default:l(()=>t[1]||(t[1]=[b("SERVICE CONCERNE")])),_:1}),e(S,null,{default:l(()=>[b(q(d.value),1)]),_:1})]),_:1})]),_:1})):(p(),g(A,{key:1},{default:l(()=>[e(D,{avatar:""},{default:l(()=>[e(ye,{color:"teal","text-color":"white"},{default:l(()=>[E("img",{src:ie(ke)(m.value.target)},null,8,je)]),_:1})]),_:1}),e(D,null,{default:l(()=>[e(S,{overline:""},{default:l(()=>t[2]||(t[2]=[b("PROFESSEUR CONCERNE")])),_:1}),e(S,null,{default:l(()=>[b(q(d.value),1)]),_:1})]),_:1})]),_:1}))])]),_:1}))}},Ee={class:"q-py-md"},Pe={class:"q-gutter-md"},$e={__name:"Filter",props:{form:{type:Object,default:()=>null}},emits:["reclamation:filter","reclamation:error"],setup(P,{emit:$}){J(),L();const i=G(),r=P,y=$,m=o(()=>i.getters["user/current"]),w=o(()=>i.getters["user/config"]);o(()=>i.getters["user/user"]);const k=o(()=>i.getters["reclamation/data"]),s=o(()=>w.value.meta.admins),N=o(()=>m.value.annee.profs),v=j("admin"),R=o(()=>N.value.map(t=>({label:t.nom+" "+t.prenom,value:t.idpers}))),d=o(()=>s.value.map(t=>({label:t.description,value:t.idrole}))),Q=o({get(){return v.value==="admin"?d.value.find(t=>t.value===r.form.role)||null:R.value.find(t=>t.value===r.form.target)||null},set(t){console.log(t),v.value==="admin"?r.form.role=t?t.value:null:r.form.target=t?t.value:null}});function x(){v.value==="admin"?r.form.target=null:r.form.role=null,y("reclamation:filter",{filter:r.form,page:k.current_page??1})}function u(){r.form.role?v.value="admin":v.value="prof",i.commit("reclamation/resetForm")}return H(()=>{u()}),(t,h)=>(p(),g(Z,null,{default:l(()=>[e(ue,{class:"bg-secondary text-white shadow-2"},{default:l(()=>[Y(e(U,{flat:"",dense:"",icon:"arrow_back"},null,512),[[ee]]),e(se,null,{default:l(()=>h[5]||(h[5]=[b(" Filtre ")])),_:1}),e(U,{class:"q-ml-lg",flat:"",icon:"filter_list",onClick:x})]),_:1}),e(T,{style:{"overflow-y":"scroll"}},{default:l(()=>[e(de,{onSubmit:x,class:"q-gutter-md"},{default:l(()=>[E("div",Ee,[E("div",Pe,[e(B,{modelValue:v.value,"onUpdate:modelValue":h[0]||(h[0]=C=>v.value=C),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"admin",label:"Administration"},null,8,["modelValue"]),e(B,{modelValue:v.value,"onUpdate:modelValue":h[1]||(h[1]=C=>v.value=C),"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"prof",label:"Professeur"},null,8,["modelValue"])])]),v.value==="admin"?(p(),g(M,{key:0,filled:"",modelValue:Q.value,"onUpdate:modelValue":h[2]||(h[2]=C=>Q.value=C),options:d.value,"use-chips":"",label:"Administraion","lazy-rules":""},null,8,["modelValue","options"])):F("",!0),v.value==="prof"?(p(),g(M,{key:1,filled:"",modelValue:Q.value,"onUpdate:modelValue":h[3]||(h[3]=C=>Q.value=C),options:R.value,"use-chips":"",label:"Professeur","lazy-rules":""},null,8,["modelValue","options"])):F("",!0),e(X,{clearable:"",modelValue:r.form.objet,"onUpdate:modelValue":h[4]||(h[4]=C=>r.form.objet=C),label:"Objet","lazy-rules":"",filled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(ne,{align:"right",class:""},{default:l(()=>[e(U,{label:"Appliquer",icon:"filter_list",onClick:x})]),_:1})]),_:1}))}},ze={class:"q-pa-lg flex flex-center"},ol={__name:"Index",setup(P){const $=J(),i=L(),r=G(),y=j(null),m=j("Nouvelle reclamation"),w=j(!1),k=j("edit");let s=null;const N=o(()=>r.getters["user/config"]),v=o(()=>r.getters["user/current"]),R=o(()=>r.getters["user/user"]),d=o(()=>r.getters["reclamation/data"]);o(()=>r.getters["reclamation/form"]);const Q=o(()=>N.value.meta.admins),x=j({objet:null,status:null,role:null,target:null}),u=o(()=>d.value&&d.value.data?d.value.data:[]);function t(a){w.value=!1;let n={...x.value};a?a.filter||(a.filter={...n}):a={page:1,filter:{...n}},a.filter.eleve=v.value.eleve.idpers,a.filter.annee=v.value.annee.idannee,a.filter.classe=v.value.annee.pivot.idclasse,r.dispatch("reclamation/getData",a)}function h(a){a.status=1,a.idreclamateur=R.value.idpers,a.idannee=v.value.annee.idannee,a.ideleve=v.value.eleve.idpers,a.idclasse=v.value.annee.pivot.idclasse,a.idreclamation?r.dispatch("reclamation/update",a).then(n=>{i.notify({color:"positive",message:"Reclamation mise à jour",position:"bottom",icon:"check_circle",actions:[{label:i.lang.label.close,color:"yellow"}]}),w.value=!1,t({page:1})}).catch(n=>{let O=n.message;n.response&&n.response.data&&n.response.data.message&&(O=n.response.data.message),i.notify({color:"negative",message:O,position:"bottom",icon:"error_outline",actions:[{label:i.lang.label.close,color:"yellow"}]})}):r.dispatch("reclamation/save",a).then(n=>{i.notify({color:"positive",message:"Reclamation enregistrée",position:"bottom",icon:"check_circle",actions:[{label:i.lang.label.close,color:"yellow"}]}),w.value=!1,t({page:1})}).catch(n=>{let O=n.message;n.response&&n.response.data&&n.response.data.message&&(O=n.response.data.message),i.notify({color:"negative",message:O,position:"bottom",icon:"error_outline",actions:[{label:i.lang.label.close,color:"yellow"}]})})}function C(a){i.notify({color:"negative",message:a.message,position:"bottom",icon:"error_outline",actions:[{label:i.lang.label.close,color:"yellow"}]})}function I(a){a.idreclamation?(s=a.idreclamation,y.value=a,a.created_by===R.value.idpers?(console.log("edit",y.value,a),k.value="edit",m.value="Modifier",w.value=!0):(k.value="view",w.value=!0)):(k.value="edit",m.value="Nouvelle reclamation",y.value=null,w.value=!0)}function c(){k.value="filter",w.value=!0}function _(){for(let a in x.value)if(x.value[a])return!0;return!1}function f(a){r.dispatch("setRefresh",a)}function ce(a){return Ce(Qe(a))}function me(a){return a.status===1&&R.value.idpers===a.created_by}function fe(a){i.dialog({title:"Supprimer la reclamation",message:'Êtes vous sûr de vouloir supprimer la reclamation "'+a.objet+'" ?',cancel:!0,persistent:!0,ok:{label:"Supprimer",color:"negative"}}).onOk(()=>{r.dispatch("reclamation/remove",a).then(n=>{i.notify({color:"positive",message:"Reclamation supprimée",position:"bottom",icon:"check_circle",actions:[{label:i.lang.label.close,color:"yellow"}]}),t({page:1})}).catch(n=>{let O=n.message;n.response&&n.response.data&&n.response.data.message&&(O=n.response.data.message),i.notify({color:"negative",message:O,position:"bottom",icon:"error_outline",actions:[{label:i.lang.label.close,color:"yellow"}]})})})}function le(a){return a.idrole?Q.value.find(n=>n.idrole===a.idrole).description:a.target?.nom+" "+a.target?.prenom}return H(()=>{$.setTitle("Reclamations"),t({page:1}),f(a=>{t({page:d.value?d.value.current_page:1}),a()})}),(a,n)=>{const O=ae("ep-pagination"),pe=ae("ep-footer");return p(),K(W,null,[e(we,{padding:"",class:"page-content"},{default:l(()=>[E("div",ze,[d.value?(p(),g(O,{key:0,modelValue:d.value.current_page,"onUpdate:modelValue":[n[0]||(n[0]=V=>d.value.current_page=V),t],max:d.value.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:l(()=>[e(U,{onClick:c,flat:""},{default:l(()=>[_()?(p(),g(z,{key:0,color:"warning",rounded:"",align:"top"})):F("",!0),e(te,{name:"filter_list"}),b(" Page "+q(d.value.current_page),1)]),_:1})]),_:1},8,["modelValue","max"])):F("",!0)]),e(Z,{style:{margin:"0 -8px"},flat:""},{default:l(()=>[e(Se,null,{default:l(()=>[e(oe),(p(!0),K(W,null,he(u.value,(V,ve)=>(p(),K(W,{key:"recs"+ve},[e(A,{clickable:"",style:re("border-left: 5px solid "+(V.status>1?"var(--q-positive)":"var(--q-warning)")),onClick:ge=>I(V),active:ie(s)===V.id},{default:l(()=>[e(D,null,{default:l(()=>[e(S,null,{default:l(()=>[V.idrole>0?(p(),g(z,{key:0,color:"teal"},{default:l(()=>[b(q(le(V)),1)]),_:2},1024)):(p(),g(z,{key:1,color:"blue"},{default:l(()=>[b(q(le(V)),1)]),_:2},1024))]),_:2},1024),e(S,{style:{padding:"12px 0"}},{default:l(()=>[b(q(V.objet),1)]),_:2},1024)]),_:2},1024),e(D,{side:"",top:"",style:{position:"relative"}},{default:l(()=>[e(S,{caption:""},{default:l(()=>[b(q(ce(V.updated_at)),1)]),_:2},1024),e(S,{caption:""},{default:l(()=>[V.status===1?(p(),g(z,{key:0,color:"warning"},{default:l(()=>n[2]||(n[2]=[b("En cours")])),_:1})):V.status>1?(p(),g(z,{key:1,color:"positive"},{default:l(()=>n[3]||(n[3]=[b("Clôturée")])),_:1})):F("",!0)]),_:2},1024),me(V)?(p(),g(S,{key:0,style:{"min-height":"32px","min-width":"32px","margin-top":"16px"}},{default:l(()=>[e(U,{onClick:Ve(ge=>fe(V),["stop"]),dense:"",flat:"",color:"red",class:"absolute-bottom-right"},{default:l(()=>[e(te,{name:"delete"})]),_:2},1032,["onClick"])]),_:2},1024)):F("",!0)]),_:2},1024)]),_:2},1032,["style","onClick","active"]),e(oe)],64))),128))]),_:1})]),_:1})]),_:1}),e(xe,{modelValue:w.value,"onUpdate:modelValue":n[1]||(n[1]=V=>w.value=V),position:k.value==="edit"?"bottom":k.value==="filter"?"top":"left",maximized:k.value!=="filter"},{default:l(()=>[k.value==="edit"?(p(),g(Oe,{key:0,reclamation:y.value,title:m.value,"onReclamation:sent":h,"onReclamation:error":C},null,8,["reclamation","title"])):k.value==="filter"?(p(),g($e,{key:1,form:x.value,"onReclamation:filter":t},null,8,["form"])):(p(),g(De,{key:2,reclamation:y.value},null,8,["reclamation"]))]),_:1},8,["modelValue","position","maximized"]),e(pe,{to:"#footer-portal"},{default:l(()=>[e(U,{flat:"",onClick:I,icon:"icon_nouveau_document",label:""})]),_:1})],64)}}};export{ol as default};
