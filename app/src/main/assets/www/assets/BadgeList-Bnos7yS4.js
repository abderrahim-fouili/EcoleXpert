import{_ as w,b2 as Q,as as x,at as k,ag as N,Q as l,S as o,a6 as e,a8 as u,a5 as s,R as h,ad as d,ab as r,a4 as g,ax as _,a9 as v,aa as V,a7 as L,a3 as B,ay as S,aC as T,h as m,aB as C}from"./index-Bl2lQPd7.js";import{Q as I,a as f}from"./QItem-De3v03wU.js";import{Q as c}from"./QItemLabel-BkJiB6aE.js";import{Q as A}from"./QBadge-Bjfo5tRO.js";import{Q as D}from"./QList-CMzNTEGD.js";import{i as J}from"./stomp-SbqQEsfg.js";const O={data(){return{raw:[],stomp:null,timer:null,mode:1,modes:["Tous","Validés","Non Validés"]}},computed:{...k({config:"user/config",user:"user/user"}),data(){return this.mode===2?this.raw.filter(t=>t.status):this.mode===3?this.raw.filter(t=>!t.status):this.raw}},methods:{...x({getData:"badge/getData",valid:"badge/valid"}),toNow:Q,startTimer(){this.timer=setTimeout(()=>{this.getList(),this.startTimer()},6e4)},topic(){let t="/topic/"+m+"-";return this.config.roles.prof?t+=this.user.idpers:t+="scan-admin",t},personAvatar(t){return C(t)},getList(){this.getData().then(t=>{console.log(t),t.success&&(this.raw=[...new Map(t.data.map(i=>[i.data.eleve.idpers,i])).values()])})},validate(t){this.valid(t.id).then(()=>{this.stomp?(this.stomp.publish({destination:"/topic/"+m+"-scan-"+t.id,body:JSON.stringify({message:t.id})}),this.stomp.publish({destination:"/topic/"+m+"-scan-admin",body:JSON.stringify({message:t.id})}),t.personne_id&&this.stomp.publish({destination:"/topic/"+m+"-"+t.personne_id,body:JSON.stringify({message:t.id})})):this.getList()})}},mounted(){this.getList(),this.setTitle("Sortie de l'élève"),this.startTimer(),J(t=>{console.log("stomp activated"),this.stomp=t,t.subscribe(this.topic(),()=>{this.getList()})})},unmounted(){this.stomp&&(this.stomp.deactivate(),console.log("stomp deactivated")),this.timer!==null&&(clearTimeout(this.timer),console.log("timer deactivated"))}},P={class:"q-pa-lg flex flex-center"},q=["src"],U={style:{"font-weight":"500"}},z={style:{"padding-top":"10px"}};function E(t,i,F,G,n,p){const y=N("ep-pagination");return o(),l(T,{class:"page-content"},{default:e(()=>[u("div",P,[n.raw.length?(o(),l(y,{key:0,modelValue:n.mode,"onUpdate:modelValue":i[0]||(i[0]=a=>n.mode=a),max:3,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:e(()=>[d(r(n.modes[n.mode-1]),1)]),_:1},8,["modelValue"])):h("",!0)]),s(D,{style:{margin:"0"},flat:""},{default:e(()=>[s(_),(o(!0),g(v,null,V(p.data,(a,b)=>(o(),g(v,{key:b},[s(I,null,{default:e(()=>[s(f,{avatar:""},{default:e(()=>[s(L,{square:"",size:"lg"},{default:e(()=>[u("img",{src:p.personAvatar(a.data.eleve)},null,8,q)]),_:2},1024)]),_:2},1024),s(f,null,{default:e(()=>[s(c,{lines:"1",style:{"font-weight":"600"}},{default:e(()=>[d(r(a.data.eleve.nom)+" "+r(a.data.eleve.prenom),1)]),_:2},1024),s(c,{caption:"",lines:"2"}),a.data.prof?(o(),l(c,{key:0,lines:"2"},{default:e(()=>[i[1]||(i[1]=d(" Prof: ")),u("span",U,r(a.data.prof.nom)+" "+r(a.data.prof.prenom),1)]),_:2},1024)):h("",!0)]),_:2},1024),s(f,{side:"",top:""},{default:e(()=>[s(c,{caption:""},{default:e(()=>[d(r(p.toNow(a.created_at*1e3)),1)]),_:2},1024),u("div",z,[a.status?(o(),l(A,{key:0,color:"positive"},{default:e(()=>i[2]||(i[2]=[d("Validé")])),_:1})):(o(),l(B,{key:1,onClick:M=>p.validate(a),dense:"",unelevated:"",color:"primary"},{default:e(()=>[s(S,{name:"done"})]),_:2},1032,["onClick"]))])]),_:2},1024)]),_:2},1024),s(_)],64))),128))]),_:1})]),_:1})}const Y=w(O,[["render",E]]);export{Y as default};
