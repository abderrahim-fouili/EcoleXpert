import{Q as C}from"./QImg-BMvxJu3S.js";import{Q as b}from"./QTooltip-r7WoEuzy.js";import{_ as F,bt as E,a4 as u,S as g,a8 as n,ad as c,a5 as i,a6 as p,a3 as h,aO as L,A as I,J as Q}from"./index-Bl2lQPd7.js";import{Q as $}from"./QSpinnerDots-BW9ZsFNG.js";const U=E({name:"SchoolLogoUpload",props:{modelValue:{type:String,default:null},settings:{type:Object,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const a=L(),r=I(null),m=I(!1),v=()=>{r.value&&r.value.click()},l=()=>{t("update:modelValue",null)},w=()=>{a.notify({type:"warning",message:"Impossible de charger l'image. L'URL pourrait être incorrecte."})},S=()=>e.settings&&e.settings.imgbb?e.settings.imgbb:e.settings&&e.settings.imgcdndev?e.settings.imgcdndev:(a.notify({type:"warning",message:"Paramètres d'hébergement d'images non trouvés. Utilisation du service par défaut."}),{url:"https://api.imgbb.com/1/upload",key:"your-fallback-key"});return{fileInput:r,isUploading:m,triggerFileInput:v,onFileSelected:async V=>{const d=V.target.files[0];if(d){if(!d.type.startsWith("image/")){a.notify({type:"negative",message:"Veuillez sélectionner une image valide"});return}if(d.size>2*1024*1024){a.notify({type:"negative",message:`Le fichier est trop volumineux (max 2MB): ${d.name}`});return}m.value=!0;try{const s=S(),y=new FormData;y.append("image",d);const o=await Q.create().post(`${s.url}?key=${s.key}`,y,{headers:{"Content-Type":"multipart/form-data"},transformRequest:(f,k)=>(delete k.Authorization,delete k["x-user-as"],f)});if(o.data&&o.data.success)t("update:modelValue",o.data.data.url),a.notify({type:"positive",message:"Logo téléchargé avec succès"});else{const f=o.data&&o.data.error?o.data.error.message:o.data&&o.data.message?o.data.message:"Unknown upload error";throw new Error(f)}}catch(s){console.error("Error uploading image:",s),a.notify({type:"negative",message:"Échec du téléchargement du logo: "+(s.response?.data?.error?.message||s.message||"Erreur inconnue")})}finally{m.value=!1,r.value&&(r.value.value="")}}},clearLogo:l,handleImageError:w}}}),q={key:0},z={key:0,class:"logo-upload-container"},B={key:1,class:"logo-preview-wrapper"},D={class:"logo-actions q-mt-sm"},T={key:1,class:"upload-loading"};function M(e,t,a,r,m,v){return g(),u("div",null,[n("input",{type:"file",class:"hidden-input",accept:"image/*",onChange:t[0]||(t[0]=(...l)=>e.onFileSelected&&e.onFileSelected(...l)),ref:"fileInput"},null,544),e.isUploading?(g(),u("div",T,[i($,{color:"primary",size:"40px"}),t[5]||(t[5]=n("div",{class:"q-mt-sm"},"Téléchargement en cours...",-1))])):(g(),u("div",q,[e.modelValue?(g(),u("div",B,[i(C,{src:e.modelValue,class:"logo-preview",fit:"contain",onError:e.handleImageError},null,8,["src","onError"]),n("div",D,[i(h,{flat:"",dense:"",color:"primary",icon:"edit",onClick:e.triggerFileInput},{default:p(()=>[i(b,null,{default:p(()=>t[3]||(t[3]=[c("Modifier le logo")])),_:1})]),_:1},8,["onClick"]),i(h,{flat:"",dense:"",color:"negative",icon:"delete",onClick:e.clearLogo},{default:p(()=>[i(b,null,{default:p(()=>t[4]||(t[4]=[c("Supprimer le logo")])),_:1})]),_:1},8,["onClick"])])])):(g(),u("div",z,[n("div",{class:"dropbox cursor-pointer",onClick:t[1]||(t[1]=(...l)=>e.triggerFileInput&&e.triggerFileInput(...l))},t[2]||(t[2]=[n("p",null,[c(" Déposez votre logo ici"),n("br"),c(" ou cliquez pour sélectionner une image ")],-1)]))]))]))])}const R=F(U,[["render",M],["__scopeId","data-v-d350121a"]]);export{R as S};
