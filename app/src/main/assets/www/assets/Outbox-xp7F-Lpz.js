import{Q as T}from"./QImg-BMvxJu3S.js";import{Q as z}from"./QBadge-Bjfo5tRO.js";import{_ as F,dk as K,aO as W,aP as Z,B as Q,A as $,ag as L,Q as i,S as l,a6 as a,a5 as e,R as h,av as G,a3 as X,ad as u,ab as n,aF as A,a4 as c,a9 as _,aa as y,ay as Y,ax as V,aS as b,bd as O,a7 as P,ba as M,aB as N,aE as J,ck as ee,aY as ae,b8 as te,b9 as se,b2 as le,as as re,at as oe,a8 as R,ah as j,aw as ne,aD as ie,be as ue}from"./index-Bl2lQPd7.js";import{Q as q,a as w}from"./QItem-De3v03wU.js";import{Q as k}from"./QItemLabel-BkJiB6aE.js";import{Q as I}from"./QList-CMzNTEGD.js";import{q as de}from"./date-C1Mon-Jj.js";import{Q as me}from"./QToolbarTitle-C8APieXG.js";import{Q as pe}from"./QToolbar-DR-_wX4W.js";import{Q as ce,a as ge}from"./QBreadcrumbs-D5k8AHhT.js";import{Q as fe,a as E}from"./QTabs-yl5EIOig.js";import{Q as he,a as H}from"./QTabPanels-Bqg1c7oo.js";import{C as _e}from"./ClosePopup-BY_YGFBZ.js";import{u as ve,H as be,a as ke,b as we,c as ye,i as xe,cn as Qe}from"./index.esm.min-FpMw1SSI.js";import{i as Ve}from"./installSVGRenderer-BO49usYp.js";import"./format-IcNrutKL.js";import"./rtl-DFPa-2ov.js";import"./TouchSwipe-jpsGI2FR.js";import"./touch-BjYP5sR0.js";import"./selection-DaBtDCZ0.js";import"./use-render-cache-DLxPkVnQ.js";const Le={key:0,class:"text-dark"},Ce={__name:"Stats",props:{message:{default:()=>null},height:{default:()=>"150px"}},setup(r){K(v=>({"1a378892":r.height})),ve([ke,we,ye,xe,Ve]);const d=r;ee(Qe,"light"),W();const m=Z(),C=Q(()=>m.getters["message/stats"]),g=Q(()=>m.getters["message/read"]),t=Q(()=>m.getters["message/notread"]);let p=$("read");const D=Q(()=>({tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"Message lu",type:"pie",data:[{value:C.value?.read,name:"Lu"},{value:C.value?.notread,name:"Non lu"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}));function x(){m.dispatch("message/notread",{form:{id:d.message.id},page:t.value?.current_page})}function o(){m.dispatch("message/read",{form:{id:d.message.id},page:g.value?.current_page})}function S(){m.commit("message/stats",null),m.commit("message/read",null),m.commit("message/notread",null),m.dispatch("message/stats",{id:d.message.id}),o(),x()}return S(),(v,f)=>{const U=L("ep-pagination");return l(),i(J,{style:{"min-width":"300px","max-width":"100vw"}},{default:a(()=>[e(pe,{class:"bg-secondary text-white shadow-2"},{default:a(()=>[G(e(X,{flat:"",dense:"",icon:"arrow_back"},null,512),[[_e]]),e(me,null,{default:a(()=>[u(n(d.message.objet),1)]),_:1})]),_:1}),d.message.thread?(l(),i(A,{key:0},{default:a(()=>[e(ce,{gutter:"none"},{separator:a(()=>[e(Y,{name:"arrow_right",color:"grey-9"})]),default:a(()=>[(l(!0),c(_,null,y(d.message.thread.filter,(s,B)=>(l(),i(ge,{key:"s-"+B},{default:a(()=>[s.type==="personne"?(l(),c("span",Le,n(s.label),1)):(l(),i(z,{key:1},{default:a(()=>[u(n(s.label||s.id),1)]),_:2},1024))]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),e(V),e(A,null,{default:a(()=>[e(b(be),{class:"chart",option:D.value},null,8,["option"])]),_:1}),e(V),e(fe,{modelValue:b(p),"onUpdate:modelValue":f[0]||(f[0]=s=>O(p)?p.value=s:p=s),dense:"","switch-indicator":"",align:"justify","narrow-indicator":""},{default:a(()=>[e(E,{name:"read",label:"Lu",class:"text-positive"}),e(E,{name:"notread",label:"Non lu",class:"text-negative"})]),_:1},8,["modelValue"]),e(he,{modelValue:b(p),"onUpdate:modelValue":f[3]||(f[3]=s=>O(p)?p.value=s:p=s),animated:"",swipeable:""},{default:a(()=>[e(H,{name:"read",class:"q-pa-none"},{default:a(()=>[t.value&&t.value.current_page?(l(),i(U,{key:0,modelValue:t.value.current_page,"onUpdate:modelValue":[f[1]||(f[1]=s=>t.value.current_page=s),o],max:t.value.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{height:"30px"}},{content:a(()=>[u(" Page "+n(t.value.current_page),1)]),_:1},8,["modelValue","max"])):h("",!0),g.value&&g.value.data&&g.value.data.length?(l(),i(I,{key:1},{default:a(()=>[(l(!0),c(_,null,y(g.value.data,(s,B)=>(l(),c(_,null,[e(q,null,{default:a(()=>[e(w,{avatar:""},{default:a(()=>[e(P,null,{default:a(()=>[e(T,{ratio:"1",src:b(N)(s),"placeholder-src":b(M)(s?.nom)},null,8,["src","placeholder-src"])]),_:2},1024)]),_:2},1024),e(w,null,{default:a(()=>[e(k,null,{default:a(()=>[u(n(s?.nom)+" "+n(s?.prenom),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(V)],64))),256))]),_:1})):h("",!0)]),_:1}),e(H,{name:"notread",class:"q-pa-none"},{default:a(()=>[t.value&&t.value.current_page?(l(),i(U,{key:0,modelValue:t.value.current_page,"onUpdate:modelValue":[f[2]||(f[2]=s=>t.value.current_page=s),x],max:t.value.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{height:"30px"}},{content:a(()=>[u(" Page "+n(t.value.current_page),1)]),_:1},8,["modelValue","max"])):h("",!0),t.value&&t.value.data&&t.value.data.length?(l(),i(I,{key:1},{default:a(()=>[(l(!0),c(_,null,y(t.value.data,(s,B)=>(l(),c(_,null,[e(q,null,{default:a(()=>[e(w,{avatar:""},{default:a(()=>[e(P,null,{default:a(()=>[e(T,{ratio:"1",src:b(N)(s),"placeholder-src":b(M)(s?.nom)},null,8,["src","placeholder-src"])]),_:2},1024)]),_:2},1024),e(w,null,{default:a(()=>[e(k,null,{default:a(()=>[u(n(s?.nom)+" "+n(s?.prenom),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(V)],64))),256))]),_:1})):h("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},De=F(Ce,[["__scopeId","data-v-f3755a14"]]),Se={components:{StatsViewer:De},data(){return{statsDialog:!1,message:null}},computed:{...oe({user:"user/user",config:"user/config",links:"user/nav",current:"user/current",messagesList:"message/outbox",darkMode:"darkMode"}),messages(){return this.messagesList&&this.messagesList.data?this.messagesList.data:[]},classe(){if(this.current&&this.current.hasOwnProperty("classe"))return this.current.classe},annee(){if(this.current&&this.current.hasOwnProperty("annee"))return this.current.annee},dark:{get(){return this.darkMode},set(r){this.toggleDarkMode()}}},methods:{...re({getConfig:"user/getConfig",getMessages:"message/getOutbox"}),LetterAvatar:M,toNow:le,fileIcon:se,openURL:te,pjUrl:ae,showStats(r){this.message=r,this.statsDialog=!0},personAvatar(r){return N(r)},getData(){this.messagesList?this.getMessages({page:this.messagesList.current_page,filter:this.filter()}):this.getMessages({page:1,filter:this.filter()})},filter(){return null},sub(r){return ue(this.$cleanHtml(r,{allowedTags:[]}))},date(r){return de.formatDate(r*1e3)}},mounted(){this.getData()}},Ue=["onClick"],Be={class:"q-pt-sm"};function Te(r,d,m,C,g,t){const p=L("ep-pagination"),D=L("ep-portal"),x=L("stats-viewer");return l(),c(_,null,[r.messagesList?(l(),i(D,{key:0,to:"#pagination-portal"},{default:a(()=>[r.messagesList&&r.messagesList.current_page?(l(),i(p,{key:0,modelValue:r.messagesList.current_page,"onUpdate:modelValue":[d[0]||(d[0]=o=>r.messagesList.current_page=o),t.getData],max:r.messagesList.last_page,"direction-links":"","boundary-links":!1,div:"",divClass:"full-width text-center text-white text-bold",dark:"",color:"white",class:"bg-primary full-width",style:{"border-radius":"10rem",height:"30px"}},{content:a(()=>[u(" Page "+n(r.messagesList.current_page),1)]),_:1},8,["modelValue","max","onUpdate:modelValue"])):h("",!0)]),_:1})):h("",!0),e(J,{style:{margin:"0 -8px"},flat:""},{default:a(()=>[e(I,null,{default:a(()=>[(l(!0),c(_,null,y(t.messages,(o,S)=>G((l(),i(q,{key:S,clickable:"",onClick:v=>r.go("/admin/messages/view/"+o.id)},{default:a(()=>[e(w,{avatar:""},{default:a(()=>[e(P,null,{default:a(()=>[e(T,{src:t.personAvatar(o.sender),"placeholder-src":t.LetterAvatar(o.sender.nom)},null,8,["src","placeholder-src"]),e(z,{floating:"",transparent:"",color:"secondary"},{default:a(()=>[u(n(o.type_sender),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(w,null,{default:a(()=>[e(k,{lines:"1"},{default:a(()=>[R("span",null,n(o.sender.nom)+" "+n(o.sender.prenom),1)]),_:2},1024),e(k,{lines:"1"},{default:a(()=>[u(n(o.objet),1)]),_:2},1024),e(k,{caption:"",lines:"1"},{default:a(()=>[u(n(t.sub(o.message)),1)]),_:2},1024),o.fichiers.length?(l(),i(k,{key:0,lines:"1"},{default:a(()=>[(l(!0),c(_,null,y(o.fichiers,(v,f)=>(l(),c("div",{outline:"",color:"grey-9",onClick:j(U=>t.openURL(t.pjUrl(v)),["prevent"]),class:"ellipsis rounded-borders q-mr-xs q-pa-xs",style:{"max-width":"40%",display:"inline-block",border:"1px solid var(--q-primary)"}},[e(Y,{name:"img:"+t.fileIcon(v.fichier),size:"14px"},null,8,["name"]),u(" "+n(v.fichier),1)],8,Ue))),256))]),_:2},1024)):h("",!0)]),_:2},1024),e(w,{side:"",top:""},{default:a(()=>[e(k,{caption:""},{default:a(()=>[u(n(t.toNow(o.created_at*1e3)),1)]),_:2},1024),R("div",Be,[e(X,{flat:"",dense:"",color:"blue",icon:"pie_chart",onClick:j(v=>t.showStats(o),["stop"])},null,8,["onClick"])])]),_:2},1024)]),_:2},1032,["onClick"])),[[ne]])),128))]),_:1})]),_:1}),e(ie,{modelValue:g.statsDialog,"onUpdate:modelValue":d[1]||(d[1]=o=>g.statsDialog=o),maximized:"",position:"right"},{default:a(()=>[e(x,{message:g.message},null,8,["message"])]),_:1},8,["modelValue"])],64)}const ea=F(Se,[["render",Te]]);export{ea as default};
