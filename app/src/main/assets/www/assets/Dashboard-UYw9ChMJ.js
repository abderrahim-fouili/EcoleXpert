import{aP as Re,A as B,B as S,Y as Be,d8 as Ie,i as Ge,N as Ee,_ as st,dk as dt,C as Ue,a4 as f,S as r,a8 as a,Q as k,R as x,a5 as e,a6 as t,aF as Q,a2 as Fe,aS as l,ay as M,av as ue,a3 as U,ad as c,cW as Je,d4 as He,ab as i,aE as K,a9 as F,aa as J,ac as he,aw as Ve,af as qe,aB as Pe,a7 as ae,ax as Ne,aG as lt,aD as at,aO as ot,aY as ut,aQ as ct,be as mt,ag as We,ba as Ke,b2 as pt,ah as ft,aC as gt,a as Te}from"./index-Bl2lQPd7.js";import{Q as Ye}from"./QImg-BMvxJu3S.js";import{Q as Qe}from"./QBadge-Bjfo5tRO.js";import{Q as H,a as w}from"./QItem-De3v03wU.js";import{Q as D}from"./QItemLabel-BkJiB6aE.js";import{Q as oe}from"./QTooltip-r7WoEuzy.js";import{Q as Ae}from"./QList-CMzNTEGD.js";import{Q as vt}from"./QExpansionItem-EMhshZ_3.js";import{Q as _t}from"./QBtnToggle-BRjXr5oj.js";import{Q as yt}from"./QSpinnerGears-DmolwAR1.js";import{Q as nt}from"./QBanner-xBGiroIy.js";import{A as ht}from"./Appel-CJj4wrOT.js";import{Q as ze}from"./QDate-C_jC-zMt.js";import{Q as Le}from"./QPopupProxy-CQ30ymZI.js";import{Q as be}from"./QSelect-DchnWyXK.js";import{Q as Xe}from"./QSpace-CKKoNTi_.js";import{Q as bt}from"./QBtnGroup-CdugIB7Z.js";import{Q as xt}from"./QSpinnerBars-COgM5MgD.js";import{Q as wt}from"./QToolbar-DR-_wX4W.js";import{C as $e}from"./ClosePopup-BY_YGFBZ.js";import{u as je,a as kt}from"./composables-CAkrP3jA.js";import{q as de}from"./date-C1Mon-Jj.js";import{f as Me}from"./index-C9ZTL5MN.js";import{p as Se}from"./index-DXqHobUu.js";import{a as qt}from"./index-B29DxFTF.js";import{Q as re}from"./QSkeleton-CAzJcT8b.js";import{Q as Ze}from"./QChip-C9OfA2gn.js";import{Q as Dt}from"./QPagination-UgiQF7o2.js";import{Q as $t}from"./QInnerLoading-WxvcYHvS.js";import{_ as At}from"./PlatDuJourCard-_8r8QfGN.js";import{Q as Ct}from"./QCircularProgress-C_b7NmsY.js";import"./position-engine-o8Q2RudZ.js";import"./selection-DaBtDCZ0.js";import"./QSlideTransition-CrdUnXBf.js";import"./index-CbPSoDvq.js";import"./use-render-cache-DLxPkVnQ.js";import"./use-datetime-hbLWgGn4.js";import"./format-IcNrutKL.js";import"./QMenu-BNr9Tzvf.js";import"./rtl-DFPa-2ov.js";import"./index-BXMW6yyY.js";import"./defineProperty-CfK5lsJW.js";import"./index-QVwDN08p.js";const we=p=>{if(!p||typeof p!="string")return 0;const I=p.split(":");return I.length<2?0:parseInt(I[0],10)*60+parseInt(I[1],10)},et=(p,I)=>{try{const{r:g,g:v,b:z}=Ie.textToRgb(p),$=1-I/100,L=Math.max(0,Math.round(g*$)),h=Math.max(0,Math.round(v*$)),b=Math.max(0,Math.round(z*$));return`rgb(${L}, ${h}, ${b})`}catch{return p}};function Mt(){const p=Re(),{lighten:I,getPaletteColor:g}=Ie,v=B({anneeId:null,date:de.formatDate(Date.now(),"YYYY-MM-DD"),viewType:"date",displayFocus:"classes",classIds:[],profIds:[]}),z=B(30),$=B("08:00"),L=B("19:00"),h=B({show:!1,session:null}),b=[{label:"Semaine",value:"week"},{label:"Jour",value:"date"}],X=[{label:"Par Classe/Matière",value:"classes"},{label:"Par Professeur",value:"professors"}],N=S(()=>p.getters["timetable/academicYears"]),j=S(()=>p.getters["timetable/classes"].map(u=>({...u}))),V=S(()=>p.getters["timetable/professors"].map(u=>({...u}))),P=S(()=>p.getters["timetable/timetableMetadata"]),Z=S(()=>p.getters["timetable/orderedDaysWithData"]),O=S(()=>p.getters["timetable/isLoading"]),W=S(()=>p.getters["timetable/isLoadingFilters"]),se=S(()=>p.getters["timetable/error"]),A=S(()=>p.getters["user/current"]?.annee),ee=u=>u?Me(Se(u,"yyyy-MM-dd",new Date),"dd/MM/yyyy"):"",te=u=>u?Me(Se(u,"yyyy-MM-dd",new Date),"dd MMM",{locale:Ge}):"",le=u=>u?Me(Se(u,"yyyy-MM-dd",new Date),"eeee d MMMM yyyy",{locale:Ge}):"";function ce(u){let n=[`${u.debut?.substring(0,5)||"?"} - ${u.fin?.substring(0,5)||"?"} `,`Matière: ${u.matiere?.nom||"N/A"} (${u.matiere?.bref||""})`,`Classe: ${u.classe?.nom||"N/A"} (${u.classe?.bref||""})`,`Prof(s): ${u.professeurs?.map(s=>s.nom_complet||`${s.prenom||""} ${s.nom||""}`.trim()).join(", ")||"N/A"} `,`Salle: ${u.salle?.nom||"N/A"} (${u.salle?.bref||""})`,`Date: ${ee(u.date_specific)} `];return u.is_cancelled&&(n.push("---"),n.push(`ANNULÉE par ${u.cancellation_details?.cancelled_by||"?"} `),u.cancellation_details?.reason&&n.push(`Raison: ${u.cancellation_details.reason} `),n.push(`Compensée: ${u.cancellation_details?.is_compensated?"Oui":"Non"} `)),n.join(`
`)}const ne=S(()=>Z.value?Z.value.flatMap(u=>(u.sessions||[]).map(n=>({...n,key:`${n.emploi_classe_id}_${n.date_specific}_${n.debut} `,tooltipContent:ce(n),professeurs:(n.professeurs||[]).map(s=>({...s,nom_complet:s.nom_complet||`${s.prenom||""} ${s.nom||""} `.trim()}))}))):[]),m=S(()=>{const u=we($.value),n=we(L.value);if(!ne.value.length)return{start:u,end:n};let s=1/0,d=0;ne.value.forEach(me=>{const ve=we(me.debut),E=we(me.fin);ve<s&&(s=ve),E>d&&(d=E)}),isFinite(s)||(s=u),(d<=0||!isFinite(d))&&(d=n);const T=Math.min(u,Math.floor(s/z.value)*z.value),Y=Math.max(n,Math.ceil(d/z.value)*z.value);return{start:T,end:Y>T?Y:T+z.value}}),o=S(()=>{const u=[],{start:n,end:s}=m.value;if(s<=n)return[$.value];for(let d=n;d<s;d+=z.value){const T=Math.floor(d/60).toString().padStart(2,"0"),Y=(d%60).toString().padStart(2,"0");u.push(`${T}:${Y} `)}return u}),C=S(()=>{const u=B({view:null,columns:[],rows:[],sessions:[],timeSlots:[]});if(!P.value||!Z.value)return u.value={view:null,columns:[],rows:[],sessions:[],timeSlots:[]},u;const n=ne.value,s=o.value,d=v.value.viewType;if(d==="week"){const T=Z.value.map(Y=>({id:Y.specificDate,label:Y.name,subLabel:te(Y.specificDate),specificDate:Y.specificDate}));u.value={view:"week",columns:T,rows:[],timeSlots:s,sessions:n}}else if(d==="date"){const T=s.map(E=>({id:E,label:E})),Y=new Map;v.value.displayFocus==="classes"?n.forEach(E=>{E.classe&&!Y.has(E.classe.id)&&Y.set(E.classe.id,{id:E.classe.id,label:E.classe.nom,subLabel:E.classe.bref,type:"class",classement:E.classe.classement})}):n.forEach(E=>{(E.professeurs||[]).forEach(G=>{G&&G.id&&!Y.has(G.id)&&Y.set(G.id,{id:G.id,label:G.nom_complet,subLabel:G.matricule||"Professeur",type:"professor",photo:G.photo})})});let me=Array.from(Y.values());v.value.displayFocus==="classes"?me.sort((E,G)=>{const De=E.classement,pe=G.classement,xe=typeof De=="number"&&isFinite(De),Ce=typeof pe=="number"&&isFinite(pe);return xe&&Ce?De-pe:xe?-1:Ce?1:(E.label||"").localeCompare(G.label||"")}):me.sort((E,G)=>(E.label||"").localeCompare(G.label||""));const ve=n.filter(E=>E.date_specific===v.value.date);u.value={view:"date",columns:T,rows:me,timeSlots:s,sessions:ve}}else u.value={view:null,columns:[],rows:[],sessions:[],timeSlots:[]};return u}),R=(u,n=!1)=>{const s=C.value.value;if(!u||!u.debut||!u.fin||!s?.view)return{display:"none"};const d=we(u.debut),T=we(u.fin);if(T<=d)return{display:"none"};const Y=T-d,me=m.value.start,ve=Math.max(0,Math.floor((d-me)/z.value)),E=Math.max(1,Math.ceil(Y/z.value)),G=g("grey-7"),De=u.matiere?.discipline_color||G,pe=u.is_cancelled&&!n?g("grey-5"):De,xe=88,Ce=u.is_cancelled&&!n?95:Math.max(xe,Ie.luminosity(pe)>.4?xe:xe+10),Oe=u.is_cancelled&&!n?g("grey-2"):I(pe,Ce),it=u.is_cancelled&&!n?g("grey-6"):Ie.luminosity(Oe)>.6?et(pe,15):g("grey-1"),ie={"--session-color":pe,"background-color":Oe,color:it,"z-index":u.is_cancelled&&!n?1:5};if(s.view==="week"&&!n){const _e=s.columns.findIndex(ye=>ye.specificDate===u.date_specific);if(_e===-1)return{display:"none"};ie["grid-column-start"]=_e+2,ie["grid-column-end"]="span 1",ie["grid-row-start"]=ve+2,ie["grid-row-end"]=`span ${E} `}else if(s.view==="date"&&!n){let _e=-1;if(v.value.displayFocus==="classes"?_e=s.rows.findIndex(ye=>ye.type==="class"&&u.classe?.id===ye.id):_e=s.rows.findIndex(ye=>ye.type==="professor"&&(u.professeurs||[]).some(rt=>rt?.id===ye.id)),_e===-1)return{display:"none"};ie["grid-row-start"]=_e+2,ie["grid-row-end"]="span 1",ie["grid-column-start"]=ve+2,ie["grid-column-end"]=`span ${E} `}else if(!n)return{display:"none"};return ie},_=(u=null)=>{if(!v.value.anneeId||!v.value.date){Ee.create({type:"warning",message:"Veuillez sélectionner une année scolaire et une date.",position:"top",classes:"modern-notify"});return}h.value.show=!1,h.value.session=null,console.log("Loading timetable...",v.value);let n={...v.value};u&&(u==="week"||u==="day")&&(n.viewType=u),p.dispatch("timetable/fetchTimetable",n)},y=u=>{let n;if(u===0)n=new Date;else{const s=P.value?.date_view_starts;if(!s){Ee.create({type:"info",message:"Chargez d'abord un emploi du temps.",position:"top",classes:"modern-notify"});return}try{const d=Se(s,"yyyy-MM-dd",new Date),T=v.value.viewType==="week"?7:1;n=qt(d,u*T)}catch(d){console.error("Error parsing date for navigation:",d),Ee.create({type:"negative",message:"Erreur de date pour la navigation.",position:"top"});return}}v.value.date=Me(n,"yyyy-MM-dd"),_()},fe=u=>{h.value.session=u,h.value.show=!0},ge=async()=>{p.commit("timetable/CLEAR_TIMETABLE_DATA"),await p.dispatch("timetable/fetchAcademicYears");const u=A.value?.idannee;u&&N.value.some(n=>n.idannee===u)?v.value.anneeId=u:N.value.length>0?v.value.anneeId=N.value[0].idannee:v.value.anneeId=null,v.value.anneeId&&(await p.dispatch("timetable/fetchClassesForYear",v.value.anneeId),await p.dispatch("timetable/fetchProfessorsForYear",v.value.anneeId),_("week"))},q=async()=>{p.commit("timetable/CLEAR_TIMETABLE_DATA"),await p.dispatch("timetable/fetchAcademicYears");const u=A.value?.idannee;u&&N.value.some(n=>n.idannee===u)?v.value.anneeId=u:N.value.length>0?v.value.anneeId=N.value[0].idannee:v.value.anneeId=null,v.value.anneeId&&(await p.dispatch("timetable/fetchClassesForYear",v.value.anneeId),await p.dispatch("timetable/fetchProfessorsForYear",v.value.anneeId),_())};return Be(A,(u,n)=>{const s=u?.idannee,d=n?.idannee;s!==d&&s?(v.value.anneeId=s,v.value.classIds=[],v.value.profIds=[],p.dispatch("timetable/fetchClassesForYear",s),p.dispatch("timetable/fetchProfessorsForYear",s),p.commit("timetable/CLEAR_TIMETABLE_DATA")):!s&&d&&(v.value.anneeId=null,v.value.classIds=[],v.value.profIds=[],p.commit("timetable/CLEAR_CLASSES"),p.commit("timetable/CLEAR_PROFESSORS"),p.commit("timetable/CLEAR_TIMETABLE_DATA"))}),{filters:v,isLoading:O,isLoadingFilters:W,error:se,timetableMetadata:P,gridData:C,sessionDetailsDialog:h,academicYears:N,classes:j,professors:V,viewTypeOptions:b,displayFocusOptions:X,initialize:ge,initializeForCmp:q,loadTimetable:_,navigatePeriod:y,showSessionDetails:fe,getSessionStyle:R,formatDateDMY:ee,formatDateDM:te,formatDateFull:le,lighten:I,darken:et}}const St={class:"un-flex un-flex-col"},It={class:"row q-col-gutter-lg items-center"},Vt={class:"col-12 col-md-auto"},Pt={class:"row items-center justify-end q-pt-sm"},Nt={class:"col-12 col-md-auto"},Et={class:"col-12 col-md-auto"},Tt={class:"col-12 col-md-auto"},Yt={class:"row q-col-gutter-lg items-center"},Ft={class:"col-12 col-md-6 col-lg"},Qt={class:"col-12 col-md-6 col-lg"},zt={key:1,class:""},Lt={key:0,class:"text-subtitle1 text-grey-8 q-my-sm"},Rt={class:"text-weight-medium"},Bt={class:"text-weight-medium"},Ut={key:0},jt={class:"text-weight-medium"},Ot={key:2,class:"text-center q-my-xl"},Gt={key:4,class:"text-center text-grey-6 q-my-xl"},Jt={key:5,class:"timetable-grid-wrapper grow"},Ht={key:0,class:"timetable-grid-container week-view bg-white shadow-2"},Wt={class:"timetable-inner"},Kt={class:"text-weight-medium"},Xt={class:"text-caption text-grey-7"},Zt=["onClick"],es={class:"tooltip-pre"},ts={class:"session-content"},ss={class:"session-time text-caption"},ls={class:"session-title text-weight-medium ellipsis"},as={key:0,class:"session-detail ellipsis"},os={key:1,class:"session-detail ellipsis"},ns={class:"session-detail ellipsis"},is={key:2,class:"session-detail ellipsis"},rs={key:1,class:"timetable-grid-container date-view bg-white shadow-2"},ds={class:"timetable-inner"},us={class:"grid-header resource-header"},cs=["src"],ms={class:"ellipsis"},ps={class:"text-weight-medium"},fs={key:0,class:"text-grey-7"},gs=["onClick"],vs={class:"tooltip-pre"},_s={class:"session-content"},ys={class:"session-time text-caption"},hs={class:"session-title text-weight-medium ellipsis"},bs={class:"session-detail ellipsis"},xs={key:0},ws={key:1},ks={class:"session-detail ellipsis"},qs={key:0,class:"session-detail ellipsis"},Ds={key:6,class:"text-center text-grey-6 q-my-xl"},$s=["onClick"],As={class:"tooltip-pre"},Cs={class:"session-content"},Ms={class:"session-time text-caption"},Ss={class:"session-title text-weight-medium ellipsis"},Is={class:"session-detail ellipsis"},Vs={class:"session-detail ellipsis"},Ps={key:0,class:"session-detail ellipsis"},Ns={class:"text-subtitle1 q-mb-md text-grey-8"},Es={class:"text-primary"},Ts={class:"text-primary"},Ys={key:0},Fs={__name:"Timetable",props:{date:{default:"today"},showFilters:{type:Boolean,default:!1},showLabel:{type:Boolean,default:!1},displayFocus:{type:String,default:"classes"},viewType:{type:String,default:"date"},height:{type:String,default:"200px"}},setup(p){dt(ne=>({"6630dcf8":p.height}));const I=p,{filters:g,isLoading:v,isLoadingFilters:z,error:$,timetableMetadata:L,gridData:h,sessionDetailsDialog:b,classes:X,professors:N,viewTypeOptions:j,displayFocusOptions:V,initializeForCmp:P,loadTimetable:Z,navigatePeriod:O,showSessionDetails:W,getSessionStyle:se,formatDateDMY:A,formatDateFull:ee,lighten:te}=Mt();I.date==="today"?g.value.date=de.formatDate(Date.now(),"YYYY-MM-DD"):g.value.date=I.date,g.value.viewType=I.viewType,g.value.displayFocus=I.displayFocus;const{setTitle:le,showFooter:ce}=je();return Ue(()=>{P()}),(ne,m)=>(r(),f(F,null,[a("div",St,[p.showFilters?(r(),k(K,{key:0,flat:"",class:"filter-card bg-white q-pa-sm",style:{"border-radius":"12px"}},{default:t(()=>[e(Q,null,{default:t(()=>[a("div",It,[a("div",Vt,[e(Fe,{dense:"",outlined:"",modelValue:l(g).date,"onUpdate:modelValue":m[1]||(m[1]=o=>l(g).date=o),label:"Date Réf.",mask:"####-##-##",clearable:"",filled:"",class:"modern-input",style:{"min-width":"140px"}},{prepend:t(()=>[e(M,{name:"sym_o_event",class:"cursor-pointer text-primary-6"},{default:t(()=>[e(Le,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(ze,{modelValue:l(g).date,"onUpdate:modelValue":m[0]||(m[0]=o=>l(g).date=o),mask:"YYYY-MM-DD",minimal:"",color:"primary"},{default:t(()=>[a("div",Pt,[ue(e(U,{label:"Fermer",color:"primary",flat:"",dense:""},null,512),[[$e]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a("div",Nt,[e(be,{dense:"",outlined:"",modelValue:l(g).viewType,"onUpdate:modelValue":m[2]||(m[2]=o=>l(g).viewType=o),options:l(j),label:"Vue","emit-value":"","map-options":"",filled:"",class:"modern-select",style:{"min-width":"120px"}},{prepend:t(()=>[e(M,{name:"sym_o_view_week",class:"text-primary-6"})]),_:1},8,["modelValue","options"])]),a("div",Et,[e(be,{dense:"",outlined:"",modelValue:l(g).displayFocus,"onUpdate:modelValue":m[3]||(m[3]=o=>l(g).displayFocus=o),options:l(V),label:"Focus","emit-value":"","map-options":"",filled:"",class:"modern-select",style:{"min-width":"160px"}},{prepend:t(()=>[e(M,{name:"sym_o_filter_center_focus",class:"text-primary-6"})]),_:1},8,["modelValue","options"])]),e(Xe,{class:"gt-sm"}),a("div",Tt,[e(bt,{flat:"",rounded:"",class:"nav-btn-group",padding:"xs lg"},{default:t(()=>[e(U,{onClick:m[4]||(m[4]=o=>l(O)(-1)),icon:"sym_o_chevron_left",dense:"",flat:"",disable:!l(L),padding:"xs md"},{default:t(()=>[e(oe,{class:"modern-tooltip"},{default:t(()=>m[10]||(m[10]=[c("Précédent")])),_:1})]),_:1},8,["disable"]),e(U,{onClick:m[5]||(m[5]=o=>l(O)(0)),icon:"sym_o_today",dense:"",flat:"",padding:"xs md"},{default:t(()=>[e(oe,{class:"modern-tooltip"},{default:t(()=>m[11]||(m[11]=[c("Aujourd'hui")])),_:1})]),_:1}),e(U,{onClick:m[6]||(m[6]=o=>l(O)(1)),icon:"sym_o_chevron_right",dense:"",flat:"",disable:!l(L),padding:"xs md"},{default:t(()=>[e(oe,{class:"modern-tooltip"},{default:t(()=>m[12]||(m[12]=[c("Suivant")])),_:1})]),_:1},8,["disable"])]),_:1}),e(U,{label:"Afficher",color:"primary",onClick:l(Z),icon:"sym_o_search",loading:l(v),disable:!l(g).anneeId||!l(g).date||l(v),unelevated:"",rounded:"",class:"q-ml-md",padding:"xs lg"},null,8,["onClick","loading","disable"])])])]),_:1}),e(Q,{class:"q-pt-none"},{default:t(()=>[a("div",Yt,[a("div",Ft,[e(be,{dense:"",outlined:"",multiple:"","use-chips":"",modelValue:l(g).classIds,"onUpdate:modelValue":m[7]||(m[7]=o=>l(g).classIds=o),options:l(X),label:"Filtrer Classe(s)","option-value":"idclasse","option-label":"classe_fr","emit-value":"","map-options":"",loading:l(z).classes,clearable:"",filled:"",class:"modern-select"},{prepend:t(()=>[e(M,{name:"sym_o_groups",class:"text-primary-6"})]),option:t(({itemProps:o,opt:C,selected:R,toggleOption:_})=>[e(H,Je(o,{dense:""}),{default:t(()=>[e(w,{side:""},{default:t(()=>[e(He,{"model-value":R,"onUpdate:modelValue":y=>_(C),dense:"",size:"sm"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),e(w,null,{default:t(()=>[e(D,null,{default:t(()=>[c(i(C.classe_fr),1)]),_:2},1024),e(D,{caption:""},{default:t(()=>[c(i(C.bref),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","loading"])]),a("div",Qt,[e(be,{dense:"",outlined:"",multiple:"","use-chips":"",modelValue:l(g).profIds,"onUpdate:modelValue":m[8]||(m[8]=o=>l(g).profIds=o),options:l(N),label:"Filtrer Professeur(s)","option-value":"idpers","option-label":"nom_complet","emit-value":"","map-options":"",loading:l(z).professors,clearable:"",filled:"",class:"modern-select"},{prepend:t(()=>[e(M,{name:"sym_o_person_pin",class:"text-primary-6"})]),option:t(({itemProps:o,opt:C,selected:R,toggleOption:_})=>[e(H,Je(o,{dense:""}),{default:t(()=>[e(w,{side:""},{default:t(()=>[e(He,{"model-value":R,"onUpdate:modelValue":y=>_(C),dense:"",size:"sm"},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),e(w,null,{default:t(()=>[e(D,null,{default:t(()=>[c(i(C.nom_complet),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","loading"])])])]),_:1})]),_:1})):x("",!0),p.showLabel?(r(),f("div",zt,[l(L)?(r(),f("div",Lt,[c(i(l(g).viewType==="week"?"Semaine":"Jour")+" du ",1),a("span",Rt,i(l(A)(l(L).date_view_starts)),1),m[14]||(m[14]=c(" au ")),a("span",Bt,i(l(A)(l(L).date_view_ends)),1),l(L).annee_scolaire?(r(),f("span",Ut,[m[13]||(m[13]=c(" / Année: ")),a("span",jt,i(l(L).annee_scolaire.description),1)])):x("",!0)])):x("",!0)])):x("",!0),l(v)?(r(),f("div",Ot,[e(xt,{color:"primary",size:"4em"}),m[15]||(m[15]=a("div",{class:"q-mt-lg text-primary-8 text-body1"},"Chargement en cours...",-1))])):l($)?(r(),k(nt,{key:3,dense:"","inline-actions":"",class:"text-white bg-negative q-mb-lg modern-banner"},{avatar:t(()=>[e(M,{name:"sym_o_error_outline"})]),action:t(()=>[e(U,{flat:"",dense:"",color:"white",label:"Réessayer",onClick:l(Z),size:"sm",disable:!l(g).anneeId||!l(g).date},null,8,["onClick","disable"])]),default:t(()=>[m[16]||(m[16]=a("span",{class:"text-weight-medium"},"Erreur:",-1)),c(" "+i(l($))+" ",1)]),_:1})):!l(v)&&!l($)&&!l(L)?(r(),f("div",Gt,[e(M,{name:"sym_o_manage_search",size:"5em",class:"q-mb-md opacity-50"}),m[17]||(m[17]=a("div",{class:"text-h6 text-weight-light"},"Prêt à afficher l'emploi du temps.",-1)),m[18]||(m[18]=a("div",{class:"text-body1"},'Veuillez sélectionner les filtres et cliquer sur "Afficher".',-1))])):l(L)&&l(h).value&&(l(h).value.columns?.length>0||l(h).value.rows?.length>0)?(r(),f("div",Jt,[l(g).viewType==="week"&&l(h).value.view==="week"?(r(),f("div",Ht,[a("div",Wt,[m[19]||(m[19]=a("div",{class:"grid-header time-header"},"Heure",-1)),(r(!0),f(F,null,J(l(h).value.columns,o=>(r(),f("div",{key:o.id,class:"grid-header day-header"},[a("div",Kt,i(o.label),1),a("div",Xt,i(o.subLabel),1)]))),128)),(r(!0),f(F,null,J(l(h).value.timeSlots,(o,C)=>(r(),f(F,{key:o},[a("div",{class:"grid-cell time-slot-label",style:he({gridRow:C+2,gridColumn:1})},i(o),5),(r(!0),f(F,null,J(l(h).value.columns,(R,_)=>(r(),f("div",{key:R.id+"-"+o,class:"grid-cell time-slot-cell",style:he({gridRow:C+2,gridColumn:_+2})},null,4))),128))],64))),128)),(r(!0),f(F,null,J(l(h).value.sessions,o=>ue((r(),f("div",{key:o.key,class:qe(["session-block",{"cancelled-session":o.is_cancelled,"has-details":!0}]),style:he(l(se)(o)),onClick:C=>l(W)(o)},[e(oe,{anchor:"top middle",self:"bottom middle",offset:[5,5],class:"modern-tooltip","max-width":"300px"},{default:t(()=>[a("pre",es,i(o.tooltipContent),1)]),_:2},1024),a("div",ts,[a("div",ss,[c(i(o.debut?.substring(0,5))+" - "+i(o.fin?.substring(0,5))+" ",1),o.is_cancelled?(r(),k(M,{key:0,name:"sym_o_block",color:"negative",size:"xs",class:"q-ml-xs",title:"Annulée"})):x("",!0)]),a("div",ls,i(o.matiere?.bref||o.matiere?.nom||"?"),1),l(g).displayFocus==="professors"?(r(),f("div",as,i(o.classe?.nom||"?"),1)):(r(),f("div",os,i(o.professeurs?.map(C=>C.nom).join(", ")||"?"),1)),a("div",ns,[e(M,{name:"sym_o_meeting_room",size:"xs",class:"q-mr-xs opacity-70"}),c(i(o.salle?.bref||o.salle?.nom||"?"),1)]),o.cahiers&&o.cahiers.length>0?(r(),f("div",is,[e(M,{name:"sym_o_book_ribbon",size:"xs",class:"opacity-70"})])):x("",!0)])],14,Zt)),[[Ve,void 0,void 0,{early:!0}]])),128))])])):l(g).viewType==="date"&&l(h).value.view==="date"?(r(),f("div",rs,[a("div",ds,[a("div",us,i(l(g).displayFocus==="classes"?"Classe / Matière":"Professeur"),1),(r(!0),f(F,null,J(l(h).value.columns,o=>(r(),f("div",{key:o.id,class:"grid-header time-header"},i(o.label),1))),128)),(r(!0),f(F,null,J(l(h).value.rows,(o,C)=>(r(),f(F,{key:o.id},[a("div",{class:"grid-cell resource-label",style:he({gridRow:C+2,gridColumn:1})},[o.photo?(r(),k(ae,{key:0,size:"md",class:"q-mr-sm text-primary-7"},{default:t(()=>[a("img",{src:l(Pe)(o),alt:"Resource Image"},null,8,cs)]),_:2},1024)):(r(),k(M,{key:1,name:o.type==="class"?"sym_o_groups":"sym_o_person",size:"sm",class:"q-mr-sm text-primary-7"},null,8,["name"])),a("div",ms,[a("div",ps,i(o.label),1),o.subLabel?(r(),f("div",fs,i(o.subLabel),1)):x("",!0)])],4),(r(!0),f(F,null,J(l(h).value.columns,(R,_)=>(r(),f("div",{key:o.id+"-"+R.id,class:"grid-cell time-slot-cell",style:he({gridRow:C+2,gridColumn:_+2})},null,4))),128))],64))),128)),(r(!0),f(F,null,J(l(h).value.sessions,o=>ue((r(),f("div",{key:o.key,class:qe(["session-block",{"cancelled-session":o.is_cancelled,"has-details":!0}]),style:he(l(se)(o)),onClick:C=>l(W)(o)},[e(oe,{anchor:"top middle",self:"bottom middle",offset:[5,5],class:"modern-tooltip","max-width":"300px"},{default:t(()=>[a("pre",vs,i(o.tooltipContent),1)]),_:2},1024),a("div",_s,[a("div",ys,[c(i(o.debut?.substring(0,5))+" - "+i(o.fin?.substring(0,5))+" ",1),o.is_cancelled?(r(),k(M,{key:0,name:"sym_o_block",color:"negative",size:"xs",class:"q-ml-xs",title:"Annulée"})):x("",!0)]),a("div",hs,i(o.matiere?.bref||o.matiere?.nom||"?"),1),a("div",bs,[l(g).displayFocus==="professors"?(r(),f("span",xs,i(o.classe?.nom||"?"),1)):(r(),f("span",ws,i(o.professeurs?.map(C=>C.nom).join(", ")||"?"),1))]),a("div",ks,[e(M,{name:"sym_o_meeting_room",size:"xs",class:"q-mr-xs opacity-70"}),c(i(o.salle?.bref||o.salle?.nom||"?"),1)]),o.cahiers&&o.cahiers.length>0?(r(),f("div",qs,[e(M,{name:"sym_o_book_ribbon",size:"xs",class:"opacity-70"})])):x("",!0)])],14,gs)),[[Ve,void 0,void 0,{early:!0}]])),128))])])):x("",!0)])):!l(v)&&l(L)?(r(),f("div",Ds,[e(M,{name:"sym_o_event_busy",size:"5em",class:"q-mb-md opacity-50"}),m[20]||(m[20]=a("div",{class:"text-h6 text-weight-light"},"Aucune séance trouvée.",-1)),m[21]||(m[21]=a("div",{class:"text-body1"},"Vérifiez vos filtres ou la programmation pour cette période.",-1))])):x("",!0)]),l(h).value?.sessions&&l(h).value.sessions.filter(o=>o.is_cancelled)?.length?(r(),k(K,{key:0,bordered:"",class:"q-mt-md"},{default:t(()=>[e(Q,{horizontal:""},{default:t(()=>[e(Q,{style:{"text-align":"center","font-weight":"bold"}},{default:t(()=>m[22]||(m[22]=[c("Séances Annulées")])),_:1}),e(Ne,{vertical:""}),e(Q,{class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-2 grow"},{default:t(()=>[l(h).value?.sessions?(r(!0),f(F,{key:0},J(l(h).value.sessions.filter(o=>o.is_cancelled),o=>ue((r(),f("div",{key:o.key+"-cancelled",class:qe(["cancelled session-block",{"cancelled-session":o.is_cancelled,"has-details":!0}]),style:he(l(se)(o,!0)),onClick:C=>l(W)(o)},[e(oe,{anchor:"top middle",self:"bottom middle",offset:[5,5],class:"modern-tooltip","max-width":"300px"},{default:t(()=>[a("pre",As,i(o.tooltipContent),1)]),_:2},1024),a("div",Cs,[a("div",Ms,i(o.debut?.substring(0,5))+" - "+i(o.fin?.substring(0,5)),1),a("div",Ss,i(o.matiere?.bref||o.matiere?.nom||"?"),1),a("div",Is,[a("span",null,i(o.classe?.nom||"?"),1),m[23]||(m[23]=a("br",null,null,-1)),a("span",null,i(o.professeurs?.map(C=>C.nom).join(", ")||"?"),1)]),a("div",Vs,[e(M,{name:"sym_o_meeting_room",size:"xs",class:"q-mr-xs opacity-70"}),c(i(o.salle?.bref||o.salle?.nom||"?"),1)]),o.cahiers&&o.cahiers.length>0?(r(),f("div",Ps,[e(M,{name:"sym_o_book_ribbon",size:"xs",class:"opacity-70"})])):x("",!0)])],14,$s)),[[Ve,void 0,void 0,{early:!0}]])),128)):x("",!0)]),_:1})]),_:1})]),_:1})):x("",!0),e(at,{modelValue:l(b).show,"onUpdate:modelValue":m[9]||(m[9]=o=>l(b).show=o)},{default:t(()=>[e(K,{class:"modern-dialog-card",style:{width:"100%","max-width":"500px"}},{default:t(()=>[e(wt,{class:"text-primary"},{default:t(()=>[e(M,{name:"sym_o_info",size:"sm",class:"q-mr-sm"}),m[24]||(m[24]=a("div",{class:"text-h6 text-weight-regular"},"Détails de la Séance",-1)),e(Xe),ue(e(U,{icon:"close",flat:"",round:"",dense:"",color:"grey-7"},null,512),[[$e]])]),_:1}),l(b).session?(r(),k(Q,{key:0,class:"q-pt-none q-px-md"},{default:t(()=>[a("div",Ns,[c(i(l(ee)(l(b).session.date_specific))+" ",1),m[25]||(m[25]=a("br",null,null,-1)),m[26]||(m[26]=c("de ")),a("strong",Es,i(l(b).session.debut?.substring(0,5)||"?"),1),m[27]||(m[27]=c(" à ")),a("strong",Ts,i(l(b).session.fin?.substring(0,5)||"?"),1)]),e(Ae,{separator:"",padding:"",class:"rounded-borders"},{default:t(()=>[e(H,null,{default:t(()=>[e(w,{avatar:"",top:""},{default:t(()=>[e(ae,{rounded:"",color:l(b).session.matiere?.discipline_color?l(te)(l(b).session.matiere.discipline_color,75):"grey-2","text-color":l(b).session.matiere?.discipline_color||"grey-7",icon:"sym_o_book",size:"lg"},null,8,["color","text-color"])]),_:1}),e(w,null,{default:t(()=>[e(D,{class:"text-weight-medium"},{default:t(()=>[c(i(l(b).session.matiere?.nom||"N/A"),1)]),_:1}),e(D,{caption:""},{default:t(()=>[c(i(l(b).session.matiere?.bref||""),1)]),_:1}),e(D,{caption:"",class:"q-mt-xs"},{default:t(()=>[e(Qe,{outline:"",dense:"",color:l(b).session.matiere?.discipline_color||"grey-6",label:l(b).session.matiere?.discipline_nom||"Discipline N/A"},null,8,["color","label"])]),_:1})]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(w,{avatar:"",top:""},{default:t(()=>[e(ae,{rounded:"",icon:"sym_o_groups",color:"blue-grey-1","text-color":"blue-grey-8",size:"lg"})]),_:1}),e(w,null,{default:t(()=>[e(D,{class:"text-weight-medium"},{default:t(()=>[c(i(l(b).session.classe?.nom||"N/A"),1)]),_:1}),e(D,{caption:""},{default:t(()=>[c(i(l(b).session.classe?.bref||""),1)]),_:1})]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(w,{avatar:"",top:""},{default:t(()=>[e(ae,{rounded:"",icon:"sym_o_person",color:"indigo-1","text-color":"indigo-8",size:"lg"})]),_:1}),e(w,null,{default:t(()=>[l(b).session.professeurs&&l(b).session.professeurs.length>0?(r(),k(D,{key:0,class:"text-weight-medium"},{default:t(()=>[c(i(l(b).session.professeurs.map(o=>o.nom_complet||`${o.prenom||""} ${o.nom||""}`.trim()).join(", ")),1)]),_:1})):(r(),k(D,{key:1,caption:""},{default:t(()=>m[28]||(m[28]=[c("Aucun professeur assigné")])),_:1}))]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(w,{avatar:"",top:""},{default:t(()=>[e(ae,{rounded:"",icon:"sym_o_meeting_room",color:"teal-1","text-color":"teal-8",size:"lg"})]),_:1}),e(w,null,{default:t(()=>[e(D,{class:"text-weight-medium"},{default:t(()=>[c(i(l(b).session.salle?.nom||"N/A"),1)]),_:1}),e(D,{caption:""},{default:t(()=>[c(i(l(b).session.salle?.bref||""),1)]),_:1})]),_:1})]),_:1}),l(b).session.cahiers?.length>0?(r(),k(H,{key:0},{default:t(()=>[e(w,{avatar:"",top:""},{default:t(()=>[e(ae,{rounded:"",icon:"sym_o_book_ribbon",color:"teal-1","text-color":"teal-8",size:"lg"})]),_:1}),e(w,null,{default:t(()=>[e(D,{class:"text-weight-medium"},{default:t(()=>m[29]||(m[29]=[c("Cahier de textes")])),_:1})]),_:1})]),_:1})):x("",!0),l(b).session.is_cancelled?(r(),k(H,{key:1,class:"bg-red-1 text-negative"},{default:t(()=>[e(w,{avatar:"",top:""},{default:t(()=>[e(ae,{rounded:"",icon:"sym_o_cancel",color:"red-2","text-color":"negative",size:"lg"})]),_:1}),e(w,null,{default:t(()=>[e(D,{class:"text-weight-bold"},{default:t(()=>m[30]||(m[30]=[c("Séance Annulée")])),_:1}),l(b).session.cancellation_details?.reason?(r(),k(D,{key:0,caption:"",class:"text-red-9"},{default:t(()=>[c("Raison: "+i(l(b).session.cancellation_details.reason),1)]),_:1})):x("",!0),l(b).session.cancellation_details?.cancelled_by?(r(),k(D,{key:1,caption:"",class:"text-red-9"},{default:t(()=>[c("Par: "+i(l(b).session.cancellation_details.cancelled_by),1)]),_:1})):x("",!0),e(D,{caption:"",class:"text-red-9"},{default:t(()=>[c(" Compensée: "+i(l(b).session.cancellation_details?.is_compensated?"Oui":"Non")+" ",1),l(b).session.cancellation_details?.compensation_notes?(r(),f("span",Ys," ("+i(l(b).session.cancellation_details.compensation_notes)+")",1)):x("",!0)]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1})):x("",!0),e(lt,{align:"right",class:"q-pa-md q-pt-none"},{default:t(()=>[ue(e(U,{flat:"",label:"Fermer",color:"primary",rounded:"",dense:"",padding:"xs md"},null,512),[[$e]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Qs=st(Fs,[["__scopeId","data-v-4e83de6d"]]),zs={class:"row q-col-gutter-md items-end"},Ls={class:"col-12 col-md-3"},Rs={class:"col-12 col-md-3"},Bs={class:"col-12 col-md-3"},Us={class:"col-12 col-md-3"},js={class:"col-12 text-right"},Os={class:"row q-mt-sm items-center q-col-gutter-sm"},Gs={class:"col-xs-12 col-sm-auto"},Js={class:"col-xs-12 col-sm-auto"},Hs={class:"q-gutter-xs"},Ws={key:1,class:"empty-state-container"},Ks={class:"full-width row flex-center q-pa-xl empty-state"},Xs={key:2,class:"relative-position"},Zs=["src"],el=["onClick"],tl={class:"text-grey-7 q-ml-sm text-caption"},sl={class:"col-xs-12 col-sm-auto"},ll={class:"col-xs-12 col-sm-auto"},al={class:"column items-end justify-between",style:{"min-width":"180px",height:"100%"}},ol={class:"q-gutter-xs q-mb-xs"},nl={key:0,class:"q-mt-xs text-right"},il={class:"text-caption text-grey-7"},rl={key:1,class:"q-mt-xs text-right",style:{height:"18px"}},dl={key:0,class:"row items-center justify-between q-pa-md bg-grey-1 rounded-borders-bottom"},ul={key:1,style:{"min-height":"36px"}},cl={class:"q-gutter-y-md"},ml={key:0},pl={__name:"NotifAbsence",props:{date:{default:"today"},showFilters:{type:Boolean,default:!1},showLabel:{type:Boolean,default:!1},defaultStatus:{type:String,default:0},height:{type:String,default:"200px"}},setup(p){const I=p,g=Re(),v=ot(),{setTitle:z}=je(),$={PENDING:0,APPROVED:1,REJECTED:2},L=()=>({personne_id:null,status:I.defaultStatus,date_from:null,date_to:null}),h=B(L()),b=B([]),X=S(()=>g.getters["absence/notifications/notificationsList"]),N=S(()=>g.getters["absence/notifications/isLoading"]),j=S(()=>g.getters["absence/notifications/statusMap"]),V=S(()=>g.getters["absence/notifications/currentNotification"]),P=B({...g.getters["absence/notifications/pagination"]}),Z=B([{label:"10",value:10},{label:"15",value:15},{label:"25",value:25},{label:"50",value:50}]);Be(()=>g.getters["absence/notifications/pagination"],n=>{P.value.page=n.page,P.value.rowsPerPage=n.rowsPerPage,P.value.rowsNumber=n.rowsNumber,P.value.sortBy=n.sortBy,P.value.descending=n.descending},{deep:!0});const O=B(!1),W=B(null),se=S(()=>g.getters["user/currentAnnee"]),A=S(()=>Object.entries(j.value||{}).map(([n,s])=>({label:s,value:parseInt(n)}))),ee=S(()=>!P.value.rowsPerPage||!P.value.rowsNumber?0:Math.ceil(P.value.rowsNumber/P.value.rowsPerPage)),te=n=>{const s=n.target,d=s.parentNode;if(s.style.display="none",d&&d.querySelector){const T=d.querySelector("i.q-icon");T&&(T.style.display="inline-flex")}},le=async(n={})=>{const s={...h.value,...n};s.date_from&&typeof s.date_from=="string"&&s.date_from.includes("/")?s.date_from=de.formatDate(de.extractDate(s.date_from,"DD/MM/YYYY"),"YYYY-MM-DD"):s.date_from&&typeof s.date_from=="object"&&(s.date_from=de.formatDate(s.date_from,"YYYY-MM-DD")),s.date_to&&typeof s.date_to=="string"&&s.date_to.includes("/")?s.date_to=de.formatDate(de.extractDate(s.date_to,"DD/MM/YYYY"),"YYYY-MM-DD"):s.date_to&&typeof s.date_to=="object"&&(s.date_to=de.formatDate(s.date_to,"YYYY-MM-DD")),await g.dispatch("absence/notifications/fetchNotifications",s)},ce=()=>{N.value&&X.value.length>0||(g.commit("absence/notifications/SET_PAGINATION",{...P.value,page:1}),le())},ne=()=>{h.value=L(),b.value=[],ce()},m=n=>{N.value||(g.commit("absence/notifications/SET_PAGINATION",{...P.value,page:n}),le())},o=n=>{N.value||(g.commit("absence/notifications/SET_PAGINATION",{...P.value,page:1,rowsPerPage:n}),le())},C=(n,s,d)=>{if(n.length<2){d();return}g.dispatch("absence/notifications/searchStudents",{term:n,anneeId:se.value?.idannee}).then(T=>{s(()=>{b.value=T})}).catch(()=>d())},R=(n,s=!1)=>n?de.formatDate(n,s?"DD/MM/YYYY HH:mm":"DD/MM/YYYY"):"N/A",_=n=>{switch(n){case $.PENDING:return"warning";case $.APPROVED:return"positive";case $.REJECTED:return"negative";default:return"grey-6"}},y=n=>n.status===$.PENDING,fe=(n,s)=>{W.value=n,n.status===$.PENDING&&ge(n,$.APPROVED)},ge=(n,s)=>{const d=j.value[s]||"ce statut",T=j.value[n.status];v.dialog({title:"Confirmer Changement de Statut",message:`Voulez-vous vraiment changer le statut de cette notification de "${T}" à "${d}" pour l'élève ${n.personne?.nom} ${n.personne?.prenom}?`,cancel:{label:"Annuler",flat:!0,color:"grey-8"},persistent:!0,ok:{label:"Confirmer",color:_(s),unelevated:!0,class:"q-px-md"}}).onOk(()=>{q(n,s)})},q=async(n,s)=>{try{await g.dispatch("absence/notifications/updateNotificationStatus",{id:n.id,status:s})}catch{}},u=async n=>{try{await g.dispatch("absence/notifications/fetchNotificationById",n.id),O.value=!0}catch{v.notify({type:"negative",message:"Impossible de charger les détails."})}};return Ue(async()=>{z("Notifications d'Absence"),await g.dispatch("absence/notifications/fetchStatuses"),(!N.value||X.value.length===0)&&le()}),(n,s)=>(r(),f(F,null,[p.showFilters?(r(),k(K,{key:0,flat:"",bordered:"",class:"filter-card shadow-2 rounded-borders"},{default:t(()=>[e(Q,null,{default:t(()=>[s[10]||(s[10]=a("h5",{class:"text-h5 q-mt-none q-mb-md text-primary"},"Filtrer les Notifications d'Absence",-1)),a("div",zs,[a("div",Ls,[e(be,{outlined:"",modelValue:h.value.personne_id,"onUpdate:modelValue":s[0]||(s[0]=d=>h.value.personne_id=d),"use-input":"","hide-selected":"","fill-input":"","input-debounce":"500",label:"Rechercher Élève",options:b.value,onFilter:C,"option-value":"idpers","option-label":d=>`${d.nom} ${d.prenom} (${d.code||"N/A"})`,"emit-value":"","map-options":"",clearable:""},{"no-option":t(()=>[e(H,null,{default:t(()=>[e(w,{class:"text-grey"},{default:t(()=>s[9]||(s[9]=[c("Aucun élève trouvé.")])),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label"])]),a("div",Rs,[e(be,{outlined:"",modelValue:h.value.status,"onUpdate:modelValue":s[1]||(s[1]=d=>h.value.status=d),options:A.value,label:"Statut","emit-value":"","map-options":"",clearable:""},null,8,["modelValue","options"])]),a("div",Bs,[e(Fe,{outlined:"",modelValue:h.value.date_from,"onUpdate:modelValue":s[3]||(s[3]=d=>h.value.date_from=d),label:"Du",mask:"####-##-##",clearable:""},{append:t(()=>[e(M,{name:"event",class:"cursor-pointer text-primary"},{default:t(()=>[e(Le,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(ze,{modelValue:h.value.date_from,"onUpdate:modelValue":s[2]||(s[2]=d=>h.value.date_from=d),mask:"YYYY-MM-DD",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a("div",Us,[e(Fe,{outlined:"",modelValue:h.value.date_to,"onUpdate:modelValue":s[5]||(s[5]=d=>h.value.date_to=d),label:"Au",mask:"####-##-##",clearable:""},{append:t(()=>[e(M,{name:"event",class:"cursor-pointer text-primary"},{default:t(()=>[e(Le,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(ze,{modelValue:h.value.date_to,"onUpdate:modelValue":s[4]||(s[4]=d=>h.value.date_to=d),mask:"YYYY-MM-DD",color:"primary"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),a("div",js,[e(U,{label:"Filtrer",color:"primary",icon:"search",onClick:ce,loading:N.value&&X.value.length===0,class:"q-mr-sm",rounded:""},null,8,["loading"]),e(U,{label:"Réinitialiser",color:"grey-7",flat:"",icon:"refresh",onClick:ne,rounded:""})])])]),_:1})]),_:1})):x("",!0),e(K,{flat:"",bordered:"",class:"q-mt-lg shadow-2 rounded-borders mt-0"},{default:t(()=>[N.value&&X.value.length===0?(r(),k(Q,{key:0,class:"q-pa-lg"},{default:t(()=>[(r(!0),f(F,null,J(P.value.rowsPerPage>5?5:P.value.rowsPerPage,d=>(r(),f("div",{key:`skel-${d}`,class:"q-mb-md"},[e(K,{flat:"",bordered:""},{default:t(()=>[e(H,{class:"q-py-md"},{default:t(()=>[e(w,{avatar:"",top:"",class:"q-pr-md"},{default:t(()=>[e(re,{type:"QAvatar",size:"56px"})]),_:1}),e(w,null,{default:t(()=>[e(re,{type:"text",width:"40%",class:"q-mb-sm",style:{height:"20px"}}),e(re,{type:"text",width:"60%",style:{height:"16px"}}),e(re,{type:"text",class:"q-mt-sm",width:"80%"}),a("div",Os,[a("div",Gs,[e(re,{type:"text",width:"100px"})]),a("div",Js,[e(re,{type:"text",width:"100px"})])])]),_:1}),e(w,{side:"",top:""},{default:t(()=>[e(re,{type:"QChip",width:"90px",height:"28px",class:"q-mb-sm"}),a("div",Hs,[e(re,{type:"QBtn",width:"36px",height:"36px"}),e(re,{type:"QBtn",width:"36px",height:"36px"})])]),_:1})]),_:1})]),_:1})]))),128))]),_:1})):!N.value&&X.value.length===0?(r(),f("div",Ws,[a("div",Ks,[e(M,{name:"notifications_paused",size:"5rem",color:"grey-5"}),s[11]||(s[11]=a("div",{class:"text-h6 text-grey-7 q-mt-md"},"Aucune notification d'absence trouvée",-1)),s[12]||(s[12]=a("div",{class:"text-body2 text-grey q-mt-xs"},"Ajustez vos filtres ou attendez de nouvelles notifications.",-1))])])):(r(),f("div",Xs,[e(Ae,{separator:""},{default:t(()=>[(r(!0),f(F,null,J(X.value,(d,T)=>(r(),f(F,{key:d.id},[e(H,{class:"notification-list-item q-py-md"},{default:t(()=>[e(w,{avatar:"",top:"",class:qe({"q-pr-md":l(v).screen.gt.xs})},{default:t(()=>[e(ae,{size:l(v).screen.gt.xs?"56px":"40px"},{default:t(()=>[a("img",{src:l(Pe)(d.personne),onError:te},null,40,Zs)]),_:2},1032,["size"])]),_:2},1032,["class"]),e(w,null,{default:t(()=>[e(D,{lines:"1"},{default:t(()=>[a("span",{class:"text-weight-bold text-primary cursor-pointer",onClick:Y=>u(d)},i(d.personne?.nom)+" "+i(d.personne?.prenom),9,el),a("span",tl," ("+i(d.personne?.classes&&d.personne?.classes[0]?d.personne.classes[0].classe_fr:"Classe N/A")+") ",1)]),_:2},1024),e(D,{caption:"",lines:"1"},{default:t(()=>[c("Soumis le: "+i(R(d.created_at,!0)),1)]),_:2},1024),e(D,{class:"q-mt-xs truncate",style:{"max-height":"4.5em"}},{default:t(()=>[s[13]||(s[13]=a("strong",{class:"text-body2"},"Motif:",-1)),c(" "+i(d.motif),1)]),_:2},1024),a("div",{class:qe(["row q-mt-sm items-center",{"q-col-gutter-sm":l(v).screen.gt.xs}])},[a("div",sl,[s[14]||(s[14]=a("span",{class:"text-caption text-weight-medium"},"Du:",-1)),c(" "+i(R(d.du)),1)]),a("div",ll,[s[15]||(s[15]=a("span",{class:"text-caption text-weight-medium"},"Au:",-1)),c(" "+i(R(d.au)),1)])],2)]),_:2},1024),e(w,{side:"",top:""},{default:t(()=>[a("div",al,[e(Ze,{color:_(d.status),"text-color":"white",size:"sm",class:"q-mb-sm text-capitalize",clickable:"",onClick:Y=>y(d)?fe(d,Y):null,ripple:y(d)},{default:t(()=>[c(i(d.status_text||j.value[d.status]||"Inconnu"),1)]),_:2},1032,["color","onClick","ripple"]),a("div",ol,[e(U,{flat:"",round:"",icon:"visibility",color:"info",size:"sm",onClick:Y=>u(d)},{default:t(()=>[e(oe,null,{default:t(()=>s[16]||(s[16]=[c("Voir Détails")])),_:1})]),_:2},1032,["onClick"]),d.status===$.PENDING?(r(),k(U,{key:0,flat:"",round:"",icon:"check_circle_outline",color:"positive",size:"sm",onClick:Y=>ge(d,$.APPROVED)},{default:t(()=>[e(oe,null,{default:t(()=>s[17]||(s[17]=[c("Approuver")])),_:1})]),_:2},1032,["onClick"])):x("",!0),d.status===$.PENDING?(r(),k(U,{key:1,flat:"",round:"",icon:"highlight_off",color:"negative",size:"sm",onClick:Y=>ge(d,$.REJECTED)},{default:t(()=>[e(oe,null,{default:t(()=>s[18]||(s[18]=[c("Rejeter")])),_:1})]),_:2},1032,["onClick"])):x("",!0)]),d.fichiers&&d.fichiers.length>0?(r(),f("div",nl,[e(M,{name:"attach_file",color:"grey-7",size:"xs",class:"q-mr-xs"}),a("span",il,i(d.fichiers.length)+" PJ"+i(d.fichiers.length>1?"s":""),1)])):(r(),f("div",rl))])]),_:2},1024)]),_:2},1024),T<X.value.length-1?(r(),k(Ne,{key:0,spaced:"none",inset:"item-thumbnail"})):x("",!0)],64))),128))]),_:1}),ee.value>1||N.value?(r(),f("div",dl,[e(be,{modelValue:P.value.rowsPerPage,"onUpdate:modelValue":[s[6]||(s[6]=d=>P.value.rowsPerPage=d),o],options:Z.value,label:"Par page",dense:"",borderless:"","emit-value":"","map-options":"","options-dense":"",style:{"min-width":"100px"},class:"q-mr-md",disable:N.value},null,8,["modelValue","options","disable"]),ee.value>1?(r(),k(Dt,{key:0,modelValue:P.value.page,"onUpdate:modelValue":[s[7]||(s[7]=d=>P.value.page=d),m],max:ee.value,"max-pages":l(v).screen.lt.sm?3:6,"direction-links":"","boundary-links":"",color:"primary",size:l(v).screen.lt.sm?"sm":"md","active-design":"unelevated",disable:N.value},null,8,["modelValue","max","max-pages","size","disable"])):(r(),f("div",ul))])):x("",!0),e($t,{showing:N.value,color:"primary",label:"Chargement...","label-style":"font-size: 1.1em;"},null,8,["showing"])]))]),_:1}),e(at,{modelValue:O.value,"onUpdate:modelValue":s[8]||(s[8]=d=>O.value=d),position:"standard"},{default:t(()=>[V.value?(r(),k(K,{key:0,style:{width:"600px","max-width":"90vw"}},{default:t(()=>[e(Q,{class:"bg-primary text-white"},{default:t(()=>[s[19]||(s[19]=a("div",{class:"text-h6"},"Détails de la Notification",-1)),ue(e(U,{icon:"close",flat:"",round:"",dense:"",class:"absolute-top-right q-ma-xs"},null,512),[[$e]])]),_:1}),e(Q,{class:"q-pt-lg"},{default:t(()=>[a("div",cl,[a("div",null,[s[20]||(s[20]=a("strong",null,"Élève:",-1)),c(" "+i(V.value.personne?.nom)+" "+i(V.value.personne?.prenom),1)]),a("div",null,[s[21]||(s[21]=a("strong",null,"Classe:",-1)),c(" "+i(V.value.personne?.classes&&V.value.personne?.classes[0]?V.value.personne.classes[0].classe_fr:"N/A"),1)]),a("div",null,[s[22]||(s[22]=a("strong",null,"Motif:",-1)),c(" "+i(V.value.motif),1)]),a("div",null,[s[23]||(s[23]=a("strong",null,"Du:",-1)),c(" "+i(R(V.value.du,!0)),1)]),a("div",null,[s[24]||(s[24]=a("strong",null,"Au:",-1)),c(" "+i(R(V.value.au,!0)),1)]),a("div",null,[s[25]||(s[25]=a("strong",null,"Soumis le:",-1)),c(" "+i(R(V.value.created_at,!0)),1)]),a("div",null,[s[26]||(s[26]=a("strong",null,"Statut:",-1)),e(Ze,{color:_(V.value.status),"text-color":"white",size:"sm",class:"q-ml-sm text-capitalize"},{default:t(()=>[c(i(V.value.status_text||j.value[V.value.status]||"Inconnu"),1)]),_:1},8,["color"])]),V.value.fichiers&&V.value.fichiers.length>0?(r(),f("div",ml,[a("strong",null,"Pièces jointes ("+i(V.value.fichiers.length)+"):",1),e(Ae,{bordered:"",separator:"",dense:"",class:"q-mt-xs rounded-borders"},{default:t(()=>[(r(!0),f(F,null,J(V.value.fichiers,d=>(r(),k(H,{key:d.id||d.name,clickable:"",tag:"a",href:l(ut)(d),target:"_blank",rel:"noopener noreferrer"},{default:t(()=>[e(w,{avatar:""},{default:t(()=>[e(M,{name:"attachment",color:"primary"})]),_:1}),e(w,null,{default:t(()=>[e(D,{class:"text-primary text-ellipsis"},{default:t(()=>[c(i(d.fichier||"Fichier joint"),1)]),_:2},1024),d.size?(r(),k(D,{key:0,caption:""},{default:t(()=>[c(i((d.size/1024).toFixed(1))+" KB",1)]),_:2},1024)):x("",!0)]),_:2},1024),e(w,{side:""},{default:t(()=>[e(M,{name:"open_in_new"})]),_:1})]),_:2},1032,["href"]))),128))]),_:1})])):x("",!0)])]),_:1}),e(lt,{align:"right",class:"q-pa-md"},{default:t(()=>[ue(e(U,{flat:"",label:"Fermer",color:"primary"},null,512),[[$e]])]),_:1})]),_:1})):x("",!0)]),_:1},8,["modelValue"])],64))}},fl=st(pl,[["__scopeId","data-v-df15c06a"]]),ke={__name:"StatItem",props:{icon:String,label:String,value:[String,Number],color:String,bigValue:Boolean},setup(p){return(I,g)=>(r(),k(H,{dense:"",class:"q-pa-none"},{default:t(()=>[e(w,{avatar:"",top:"",class:"q-pr-sm q-pt-xs"},{default:t(()=>[e(ae,{icon:p.icon,"text-color":p.color?p.color:"grey-8","font-size":"26px"},null,8,["icon","text-color"])]),_:1}),e(w,null,{default:t(()=>[e(D,{caption:"",class:"text-weight-medium text-grey-7"},{default:t(()=>[c(i(p.label),1)]),_:1}),e(D,{class:qe([p.bigValue?"text-h5":"text-h6","text-weight-bold",p.color?"text-"+p.color:"text-grey-9"])},{default:t(()=>[c(i(p.value),1)]),_:1},8,["class"])]),_:1})]),_:1}))}},gl={class:"text-subtitle1 text-weight-medium q-mb-xs text-grey-9"},vl={class:"text-body2 text-grey-7"},_l={key:0},yl={key:1},tt={__name:"PercentageStatCard",props:{icon:String,label:String,value:Number,total:Number,done:Number,unit:String,color:String},setup(p){return(I,g)=>(r(),k(K,{flat:"",bordered:"",class:"full-height rounded-lg text-center"},{default:t(()=>[e(Q,{class:"q-pa-md"},{default:t(()=>[e(Ct,{"show-value":"",value:p.value,size:"90px",thickness:.22,color:p.color||"primary","track-color":"grey-3",class:"q-mb-md"},{default:t(()=>[c(i(p.value)+"% ",1)]),_:1},8,["value","color"]),a("div",gl,i(p.label),1),a("div",vl,[e(M,{name:p.icon,size:"sm",class:"q-mr-xs vertical-middle",color:p.color||"primary"},null,8,["name","color"]),p.total>0?(r(),f("span",_l,i(p.done)+" "+i(p.unit)+" "+i(p.unit==="appels"?p.done>1?"non faits":"non fait":p.done>1?"non saisis":"non saisi")+" sur "+i(p.total),1)):(r(),f("span",yl,"Aucun "+i(p.unit)+" prévu",1))])]),_:1})]),_:1}))}},hl={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},bl={key:0,class:"lg:col-span-3 md:col-span-2"},xl=["onClick"],wl={class:"absolute-bottom full-width text-center text-white q-pa-xs bg-black-60"},kl={class:"md:col-span-2 lg:col-span-1"},ql={key:1,class:"lg:col-span-2 md:col-span-2"},Dl={key:0,class:"bg-grey-1"},$l={class:"q-mt-xl min-h-[416px]"},Al={class:"q-my-lg row items-center justify-start"},Cl={key:0,class:"text-center q-pa-xl"},Ml={class:"text-subtitle1"},Sl={key:2},Il={class:"text-subtitle1 text-grey-8 q-mb-md"},Vl={class:"text-primary"},Pl={class:"text-primary"},Nl={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},El={class:"text-h6 text-weight-medium text-blue-grey-9 flex items-center justify-center"},Tl={class:"grid grid-cols-2 gap-y-5 gap-x-3"},Yl={class:"text-h6 text-weight-medium text-teal-9 flex items-center justify-center"},Fl={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ql={class:"sm:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4 q-mt-sm"},Ma={__name:"Dashboard",setup(p){const I=Re(),{setTitle:g,showFooter:v,go:z}=je();B(new Date);const $=B(null),{platDuJour:L,loading:h,error:b,fetchPlatDuJour:X}=kt();S(()=>I.getters["user/user"]),S(()=>I.getters["user/config"]);const N=S(()=>I.getters["user/current"]),j=S(()=>I.getters["actualite/data"]),V=S(()=>I.getters["adminAbsences/appel"]),P=(_,y)=>_||"",Z=S(()=>{let _=[];return j.value&&j.value.data?(_=j.value.data.slice(0,7),_.map(y=>({title:y.objet,img:ct(y.contenu),contenu:m(y.contenu),id:y.id}))):[]}),O=S(()=>N.value&&N.value.hasOwnProperty("annee")?N.value.annee:null),W=ot(),se=B("today"),A=B(null),ee=B(!0),te=B(null),le=async()=>{ee.value=!0,te.value=null,A.value=null;try{const{data:_}=await Te("get","/admin-stats",{params:{period:se.value}});if(_&&typeof _=="object")A.value=_;else throw console.warn("Received unexpected response structure for stats:",_),new Error("Format de réponse invalide de l'API des statistiques.")}catch(_){console.error("Error fetching dashboard stats:",_),te.value=_.message||"Impossible de charger les statistiques.",W.notify({type:"negative",message:te.value,icon:"report_problem"})}finally{ee.value=!1}};Be(O,_=>{_&&R()},{immediate:!0});function ce(_,y){return _&&_.length?_.filter(fe=>fe.personne_id!=y.idpers):[]}function ne(_){W.dialog({title:"Confirmer",message:'Êtes-vous sûr de vouloir retirer ce message de la liste des "non répondus"?',cancel:!0,persistent:!0,ok:{label:"Retirer",color:"negative"}}).onOk(()=>{Te("post","/messages/noreponse-retirer",{message:_}).then(()=>{o(),W.notify({type:"positive",message:"Message retiré."})}).catch(y=>{W.notify({type:"negative",message:"Erreur lors du retrait du message."}),console.error(y)})})}function m(_){const y=mt(_?P(_):"");return y.length>120?y.substring(0,117)+"...":y}function o(){Te("post","/messages/noreponse").then(({data:_})=>{$.value=_}).catch(_=>console.error("Error loading 'noReponse':",_))}function C(_){return Pe(_)}function R(){O.value&&O.value.courant===1?I.dispatch("adminAbsences/getAppel",{annee:O.value.idannee,nonfait:!0}):I.commit("adminAbsences/setAppel",[])}return Ue(()=>{v(!1),g("Tableau de Bord"),(!j.value||!j.value.data||j.value.data.length===0)&&I.dispatch("actualite/getData",{page:1}),o(),X(),le()}),(_,y)=>{const fe=We("slide"),ge=We("carousel-3d");return r(),k(gt,{padding:"",class:"page-content bg-grey-2"},{default:t(()=>[a("div",hl,[Z.value.length?(r(),f("div",bl,[e(K,{flat:"",bordered:"",class:"rounded-lg overflow-hidden"},{default:t(()=>[e(Q,{class:"text-h6 text-weight-bold text-primary q-py-sm q-px-md text-center"},{default:t(()=>y[3]||(y[3]=[c(" INFORMATIONS & ÉVÉNEMENTS ")])),_:1}),e(ge,{width:300,height:255,border:0,autoplay:!0,autoplayTimeout:1e4,style:{"margin-top":"0px"}},{default:t(()=>[(r(!0),f(F,null,J(Z.value,(q,u)=>(r(),k(fe,{index:u,key:u,style:{width:"100%","border-radius":"8px"},count:Z.value.length},{default:t(()=>[a("div",{class:"cursor-pointer full-height rounded-lg shadow-1",onClick:n=>l(z)("/admin/actualites/"+q.id)},[q.img?(r(),k(Ye,{key:0,src:q.img,style:{height:"220px"},class:"bg-secondary rounded-t-lg"},{default:t(()=>[a("div",wl,i(q.title),1)]),_:2},1032,["src"])):(r(),f(F,{key:1},[e(Q,{class:"text-white text-bold text-center bg-secondary q-py-md rounded-t-lg"},{default:t(()=>[c(i(q.title),1)]),_:2},1024),e(Q,{class:"text-grey-8 ellipsis-3-lines q-pa-md bg-grey-1 rounded-b-lg flex-grow",style:{"min-height":"60px"}},{default:t(()=>[c(i(q.contenu),1)]),_:2},1024)],64))],8,xl)]),_:2},1032,["index","count"]))),128))]),_:1})]),_:1})])):x("",!0),a("div",kl,[!l(h)&&!l(b)?(r(),k(At,{key:0,programme:l(L),class:"w-full rounded-lg shadow-1 lg:col-span-1 md:col-span-1"},null,8,["programme"])):x("",!0)]),e(K,{class:"rounded-lg shadow-1 lg:col-span-4 md:col-span-2"},{default:t(()=>[e(Q,{onClick:y[0]||(y[0]=q=>l(z)("/admin/timetable")),class:"text-h6 text-weight-medium text-grey-8 q-py-sm q-px-md text-center cursor-pointer hover:text-primary transition-colors"},{default:t(()=>y[4]||(y[4]=[c(" Emploi du temps ")])),_:1}),e(Qs,{"display-focus":"professors","view-type":"date",date:"today",height:l(W).screen.lt.sm?"280px":"380px"},null,8,["height"])]),_:1}),e(K,{class:"rounded-lg shadow-1 lg:col-span-3 md:col-span-1"},{default:t(()=>[e(Q,{onClick:y[1]||(y[1]=q=>l(z)("/admin/absences-notifications")),class:"text-h6 text-weight-medium text-grey-8 q-py-sm q-px-md text-center cursor-pointer hover:text-primary transition-colors"},{default:t(()=>y[5]||(y[5]=[c(" Notifications d'absence ")])),_:1}),e(fl,{height:l(W).screen.lt.sm?"280px":"380px"},null,8,["height"])]),_:1}),$.value&&$.value.data&&$.value.data.length?(r(),f("div",ql,[e(K,{flat:"",bordered:"",class:"rounded-lg"},{default:t(()=>[e(Q,{class:"text-h6 text-weight-medium text-grey-8 q-py-sm q-px-md text-center bg-grey-1 rounded-t-lg"},{default:t(()=>[c(i($.value.titre),1)]),_:1}),e(Ae,{separator:""},{default:t(()=>[(r(!0),f(F,null,J($.value.data,(q,u)=>(r(),f(F,{key:q.messages[0].id},[ue((r(),k(H,{clickable:"",onClick:n=>l(z)("/admin/messages/validation/view/"+q.messages[0].id+"/review")},{default:t(()=>[e(w,{avatar:"",top:"",class:"q-pt-sm"},{default:t(()=>[e(ae,{size:"48px"},{default:t(()=>[e(Ye,{src:C(q.messages[0].sender),"placeholder-src":l(Ke)(q.messages[0].sender.nom)},null,8,["src","placeholder-src"]),e(Qe,{floating:"",transparent:"",color:"secondary",class:"text-caption q-px-xs q-py-none",style:{"border-radius":"4px",border:"1px solid white"}},{default:t(()=>[c(i(q.messages[0].type_sender.substring(0,4)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(w,null,{default:t(()=>[e(D,{lines:"1",class:"text-subtitle1 text-weight-medium"},{default:t(()=>[c(i(q.messages[0].sender.nom)+" "+i(q.messages[0].sender.prenom),1)]),_:2},1024),e(D,{lines:"1",class:"text-grey-7 text-weight-regular"},{default:t(()=>[c(i(q.messages[0].objet),1)]),_:2},1024),e(D,{caption:"",lines:"1",class:"text-grey-6"},{default:t(()=>[c(i(m(q.messages[0].message)),1)]),_:2},1024)]),_:2},1024),e(w,{side:"",top:""},{default:t(()=>[e(D,{caption:"",class:"q-mb-xs text-grey-7"},{default:t(()=>[c(i(l(pt)(q.messages[0].created_at*1e3)),1)]),_:2},1024),e(U,{flat:"",dense:"",round:"",icon:"delete_outline",color:"negative",onClick:ft(n=>ne(q.messages[0].id),["stop"])},{default:t(()=>[e(oe,null,{default:t(()=>y[6]||(y[6]=[c("Retirer")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"])),[[Ve]]),q.personnes.length?(r(),f("div",Dl,[e(vt,{group:"message-recipients",dense:"",label:`Destinataires non répondus (${ce(q.personnes,q.messages[0].sender).length})`,"header-class":"text-caption text-grey-8 q-py-none q-px-md","expand-icon-class":"text-grey-7"},{default:t(()=>[e(Ae,{dense:"",class:"bg-white"},{default:t(()=>[(r(!0),f(F,null,J(ce(q.personnes,q.messages[0].sender),(n,s)=>(r(),k(H,{key:s,class:"q-py-xs q-px-md"},{default:t(()=>[e(w,{avatar:"",class:"q-pr-sm",style:{"min-width":"36px"}},{default:t(()=>[e(ae,{size:"sm"},{default:t(()=>[e(Ye,{ratio:"1",src:l(Pe)(n.personne),"placeholder-src":l(Ke)(n.personne?.nom)},null,8,["src","placeholder-src"])]),_:2},1024)]),_:2},1024),e(w,null,{default:t(()=>[e(D,{class:"text-body2 text-grey-9"},{default:t(()=>[c(i(n.personne?.nom)+" "+i(n.personne?.prenom)+" ",1),e(Qe,{color:n.personne?.type==="USER"?"blue-grey-5":"teal-5",class:"q-ml-sm text-caption q-py-xs",outline:"",dense:""},{default:t(()=>[c(i(n.personne?.type==="USER"?"Admin":(n.personne?.type||"Prof").toLowerCase()),1)]),_:2},1032,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["label"])])):x("",!0)],64))),128))]),_:1})]),_:1})])):x("",!0),V.value&&V.value.length?(r(),k(ht,{key:2,appels:V.value,annee:O.value,class:"rounded-lg shadow-1 bg-white"},{default:t(()=>[e(Q,{class:"text-h6 text-weight-medium text-grey-8 q-py-sm q-px-md text-center"},{default:t(()=>[c(" Appels non faits ("+i(V.value.length)+") ",1)]),_:1})]),_:1},8,["appels","annee"])):x("",!0)]),a("div",$l,[a("div",Al,[e(_t,{modelValue:se.value,"onUpdate:modelValue":[y[2]||(y[2]=q=>se.value=q),le],"toggle-color":"primary",push:"",rounded:"",options:[{label:"Aujourd'hui",value:"today"},{label:"Cette Semaine",value:"this_week"}]},null,8,["modelValue"])]),ee.value?(r(),f("div",Cl,[e(yt,{color:"primary",size:"3.5em"}),y[7]||(y[7]=a("div",{class:"q-mt-md text-grey-7 text-subtitle1"},"Chargement des statistiques...",-1))])):x("",!0),te.value?(r(),k(nt,{key:1,"inline-actions":"",class:"text-white bg-red-6 q-mb-lg rounded-borders shadow-2"},{avatar:t(()=>[e(M,{name:"error_outline",size:"md"})]),action:t(()=>[e(U,{flat:"",color:"white",label:"Réessayer",onClick:le})]),default:t(()=>[a("span",Ml,i(te.value),1)]),_:1})):x("",!0),A.value&&!ee.value?(r(),f("div",Sl,[a("div",Il,[y[8]||(y[8]=c(" Période: ")),a("strong",Vl,i(A.value.period_start_date),1),y[9]||(y[9]=c(" au ")),a("strong",Pl,i(A.value.period_end_date),1)]),a("div",Nl,[e(K,{flat:"",bordered:"",class:"rounded-lg"},{default:t(()=>[e(Q,{class:"rounded-t-lg q-py-sm"},{default:t(()=>[a("div",El,[e(M,{name:"school",class:"q-mr-sm text-2xl"}),y[10]||(y[10]=c("Vie Scolaire "))])]),_:1}),e(Ne),e(Q,{class:"q-pa-md"},{default:t(()=>[a("div",Tl,[e(ke,{icon:"person_off",label:"Absents",value:A.value.school_life_stats.absents,color:"negative"},null,8,["value"]),e(ke,{icon:"schedule",label:"Retardataires",value:A.value.school_life_stats.retardataires,color:"warning"},null,8,["value"]),e(ke,{icon:"medical_services",label:"Passages Infirmerie",value:A.value.school_life_stats.passages_infirmerie,color:"info"},null,8,["value"]),e(ke,{icon:"gavel",label:"Infractions",value:A.value.school_life_stats.punitions_notifiees,color:"deep-orange-8"},null,8,["value"])])]),_:1})]),_:1}),e(K,{flat:"",bordered:"",class:"rounded-lg"},{default:t(()=>[e(Q,{class:"rounded-t-lg q-py-sm"},{default:t(()=>[a("div",Yl,[e(M,{name:"history_edu",class:"q-mr-sm text-2xl"}),y[11]||(y[11]=c("Activité des Professeurs "))])]),_:1}),e(Ne),e(Q,{class:"q-pa-md"},{default:t(()=>[a("div",Fl,[e(tt,{icon:"checklist_rtl",label:"Appels Non Faits",value:A.value.teacher_stats.appels_non_faits_percentage,total:A.value.debug_info.actual_total_scheduled_sessions,done:A.value.debug_info.actual_total_scheduled_sessions-A.value.debug_info.calls_made_in_period,unit:"appels",color:"orange-8"},null,8,["value","total","done"]),e(tt,{icon:"edit_calendar",label:"Cahiers de Textes Non Saisis",value:A.value.teacher_stats.cahiers_textes_non_saisis_percentage,total:A.value.debug_info.actual_total_scheduled_sessions,done:A.value.debug_info.actual_total_scheduled_sessions-A.value.debug_info.lesson_plans_entered_in_period,unit:"cahiers",color:"deep-orange-8"},null,8,["value","total","done"]),a("div",Ql,[e(ke,{icon:"assignment",label:"Devoirs Donnés",value:A.value.teacher_stats.nombre_devoirs,"big-value":"",color:"primary"},null,8,["value"]),e(ke,{icon:"event_busy",label:"Cours Non Assurés",value:A.value.teacher_stats.cours_non_assures,color:"red-8","big-value":""},null,8,["value"])])])]),_:1})]),_:1})])])):x("",!0)])]),_:1})}}};export{Ma as default};
