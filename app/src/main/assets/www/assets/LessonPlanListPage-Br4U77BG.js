const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LessonPlanDailyReport-CeUQ-mxd.js","./date-C1Mon-Jj.js","./index-Bl2lQPd7.js","./index-B-uS9A6y.css","./format-IcNrutKL.js","./QSelect-DchnWyXK.js","./QChip-C9OfA2gn.js","./QItem-De3v03wU.js","./QItemLabel-BkJiB6aE.js","./QMenu-BNr9Tzvf.js","./position-engine-o8Q2RudZ.js","./selection-DaBtDCZ0.js","./rtl-DFPa-2ov.js","./QDate-C_jC-zMt.js","./use-render-cache-DLxPkVnQ.js","./use-datetime-hbLWgGn4.js","./QPopupProxy-CQ30ymZI.js","./QSpinnerDots-BW9ZsFNG.js","./QTooltip-r7WoEuzy.js","./QVirtualScroll-CENgsPEr.js","./QList-CMzNTEGD.js","./QPagination-UgiQF7o2.js","./QToolbarTitle-C8APieXG.js","./QSpace-CKKoNTi_.js","./QToolbar-DR-_wX4W.js","./QTabs-yl5EIOig.js","./QTabPanels-Bqg1c7oo.js","./TouchSwipe-jpsGI2FR.js","./touch-BjYP5sR0.js","./QExpansionItem-EMhshZ_3.js","./QSlideTransition-CrdUnXBf.js","./QForm-Dk45GsL9.js","./ExportControls-UOL0zNKZ.js","./_commonjsHelpers-D6-XlEtG.js","./ExportControls-DNN08Nas.css","./LessonPlanDailyReport-DvLuOzLR.css"])))=>i.map(i=>d[i]);
import{A as y,a as Q,N as w,aO as Pe,aP as Oe,B as b,aU as oe,Y as ge,Q as v,S as r,a6 as o,a5 as l,aE as $e,R as D,a3 as T,ad as C,ab as p,aF as ke,a8 as m,a4 as k,a2 as N,ay as J,aS as A,b7 as Qe,a9 as fe,aa as xe,d4 as qe,aD as Fe,aX as Le,C as je,a$ as Ne,a7 as Te,ah as he,aG as Ie,aC as Re,b0 as ze}from"./index-Bl2lQPd7.js";import{Q as B}from"./QSelect-DchnWyXK.js";import{Q as we}from"./QDate-C_jC-zMt.js";import{Q as Ye}from"./QPopupProxy-CQ30ymZI.js";import{Q as He}from"./QSpinnerDots-BW9ZsFNG.js";import{Q as Ce,a as re}from"./QItem-De3v03wU.js";import{Q as ee}from"./QItemLabel-BkJiB6aE.js";import{Q as Je}from"./QChip-C9OfA2gn.js";import{Q as De}from"./QTooltip-r7WoEuzy.js";import{Q as Be}from"./QVirtualScroll-CENgsPEr.js";import{Q as Se}from"./QList-CMzNTEGD.js";import{Q as We}from"./QPagination-UgiQF7o2.js";import{q as O}from"./date-C1Mon-Jj.js";import{Q as Ge}from"./QToolbarTitle-C8APieXG.js";import{Q as Ke}from"./QSpace-CKKoNTi_.js";import{Q as Xe}from"./QToolbar-DR-_wX4W.js";import{Q as Ee,a as Z}from"./QTabs-yl5EIOig.js";import{Q as Ze,a as Me}from"./QTabPanels-Bqg1c7oo.js";import{Q as ea}from"./QExpansionItem-EMhshZ_3.js";import{Q as aa}from"./QForm-Dk45GsL9.js";import{E as sa}from"./ExportControls-UOL0zNKZ.js";function Ue(){const V=y([]),I=y([]),f=y([]),E=y([]),Y=y([]),_=y([]),R=y([]),c=y({academicYears:!1,classes:!1,matieres:!1,professors:!1,statuses:!1,materialTypes:!1,emploiClasses:!1}),P=async(d=null)=>{c.value.academicYears=!0;try{const i=await Q("get",`/eleve-traitements/form-data/academic-years/${d||""}`);V.value=i.data.map(g=>({label:g.description,value:g.idannee,courant:g.courant}))}catch(i){console.error("Error fetching academic years:",i),w.create({type:"negative",message:"Erreur chargement années scolaires."})}finally{c.value.academicYears=!1}},L=async(d,i)=>{if(!d){I.value=[];return}c.value.classes=!0;try{const{data:g}=await Q("get",`/filters/classes/${d}`);I.value=g.data.map(M=>({label:M.classe_fr,value:M.idclasse}))}catch(g){console.error("Error fetching classes:",g),w.create({type:"negative",message:"Erreur chargement classes."})}finally{c.value.classes=!1}},$=async d=>{if(!d){f.value=[];return}c.value.matieres=!0;try{const{data:i}=await Q("get",`/filters/matieres/${d}`);f.value=i.data.map(g=>({label:g.matiere_fr,value:g.idmatiere}))}catch(i){console.error("Error fetching matieres:",i),w.create({type:"negative",message:"Erreur chargement matières."})}finally{c.value.matieres=!1}},S=async d=>{if(!d){E.value=[];return}c.value.professors=!0;try{const{data:i}=await Q("get",`/filters/professors/${d}`);E.value=i.data.map(g=>({label:`${g.nom_complet}`,value:g.idpers}))}catch(i){console.error("Error fetching professors:",i),w.create({type:"negative",message:"Erreur chargement professeurs."})}finally{c.value.professors=!1}},U=async()=>{c.value.statuses=!0;try{const d=await Q("get","/lesson-plans/status-options");Y.value=Object.entries(d.data).map(([i,g])=>({label:g,value:i}))}catch(d){console.error("Error fetching status options:",d),w.create({type:"negative",message:"Erreur chargement statuts."})}finally{c.value.statuses=!1}},j=async()=>{c.value.materialTypes=!0;try{const d=await Q("get","/lesson-plans/material-options");_.value=d.data}catch(d){console.error("Error fetching material types:",d),w.create({type:"negative",message:"Erreur chargement types de matériel."})}finally{c.value.materialTypes=!1}},W=async(d={})=>{c.value.emploiClasses=!0;try{let i={...d};if(!i.idannee)return;i.annee_id=i.idannee,i.idprof&&(i.professor_id=i.idprof);const{data:g}=await Q("get","/schedulable",{params:i});console.log(g),R.value=g.data.map(M=>({label:`${ae(M.jour)} ${G(M.debut)}-${G(M.fin)} (${M.matiere?.bref||"N/A"}) - ${M.classe?.bref||"N/A"}`,value:M.id,jour_iso:M.jour}))}catch(i){console.error("Error fetching emploi de temps slots:",i),w.create({type:"negative",message:"Erreur chargement des créneaux horaires."}),R.value=[]}finally{c.value.emploiClasses=!1}},G=d=>{const i=d.toString().padStart(4,"0");return`${i.substring(0,2)}:${i.substring(2,4)}`},ae=d=>["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][d];return{academicYearOptions:V,classOptions:I,matiereOptions:f,professorOptions:E,statusOptions:Y,materialTypesWithMaterials:_,emploiClasseOptions:R,loadingStates:c,fetchAcademicYears:P,fetchClasses:L,fetchMatieres:$,fetchProfessors:S,fetchStatusOptions:U,fetchMaterialTypesWithMaterials:j,fetchEmploiClasseOptions:W,isProf:d=>d.type==="PROF"}}const ta={class:"flex-grow un-flex flex-col md:flex-row"},la={class:"gt-sm md:basis-1/5"},oa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ra={key:0,class:"mt-4 p-3 bg-slate-100 rounded-md text-sm text-slate-600 space-y-1"},na={key:0,class:"text-center"},ia={class:"p-2 grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1"},da={key:0,class:"py-1"},ua={key:0,class:"ml-7 mt-1 space-y-1 p-2 border-l-2 border-sky-200"},ma={key:0,class:"text-sm text-grey-6 p-2"},ca={key:0,class:"text-center"},pa={class:"font-medium"},fa={key:2,class:"text-center text-grey-6 p-4"},ga={__name:"LessonPlanFormDialog",props:{isDialogVisible:Boolean,lessonPlanId:[Number,String,null],isViewMode:Boolean},emits:["update:isDialogVisible","lessonPlanSaved"],setup(V,{emit:I}){const f=V,E=I;Pe();const Y=Oe(),_=b(()=>Y.getters["user/user"]),R=b(()=>Y.getters["user/current"]),c=b(()=>R.value?.annee?.idannee),P=b(()=>_.value?.type==="USER"||_.value?.isAdmin),L=y(null),$=y("general"),S=y(!1),U=y([]),{statusOptions:j,materialTypesWithMaterials:W,emploiClasseOptions:G,professorOptions:ae,fetchStatusOptions:se,fetchMaterialTypesWithMaterials:d,fetchEmploiClasseOptions:i,fetchProfessors:g,loadingStates:M}=Ue(),q=oe({details:!1,history:!1,materialTypes:b(()=>M.value.materialTypes),emploiClasses:b(()=>M.value.emploiClasses),professors:b(()=>M.value.professors)}),ne=()=>({id:null,emploi_classe_id:null,session_date:O.formatDate(Date.now(),"YYYY-MM-DD"),idprof:P.value?null:_.value?.idpers,prof_name_display:"",pedagogical_objective:"",targeted_competencies:"",observations:"",status:"PLANNED",materials:[],created_at:null,created_by:null,updated_at:null,updated_by:null}),a=oe(ne()),u=y({}),x=y({}),z=b({get:()=>f.isDialogVisible,set:n=>E("update:isDialogVisible",n)}),F=b(()=>!f.lessonPlanId),K=b(()=>f.isViewMode?"Détails du Cahier Journal":F.value?"Nouveau Cahier Journal":"Modifier Cahier Journal"),te=(n,s="DD/MM/YYYY")=>n?O.formatDate(n,s):"",X=b(()=>{if(!a.session_date)return[];const n=O.getDayOfWeek(O.extractDate(a.session_date,"YYYY-MM-DD"));return G.value.filter(s=>s.jour_iso===n)}),ie=n=>{if(a.emploi_classe_id=null,n){const s={session_date:n,idannee:c.value};_.value?.type==="PROF"&&!P.value&&(s.idprof=_.value.idpers),i(s)}},de=n=>{!P.value&&n&&_.value?.type==="PROF"&&(a.idprof=_.value.idpers)},ve=async n=>{q.details=!0;try{const e=(await Q("get",`/lesson-plans/${n}`)).data;if(Object.assign(a,e),a.session_date=O.formatDate(e.session_date,"YYYY-MM-DD"),a.prof_name_display=`${e.prof?.nom||""} ${e.prof?.prenom||""}`.trim()||"N/A",u.value={},x.value={},e.materials_used?(a.materials=e.materials_used.map(t=>({material_id:t.material_id,quantity:t.quantity,notes:t.notes})),e.materials_used.forEach(t=>{u.value[t.material_id]=!0,x.value[t.material_id]={quantity:t.quantity,notes:t.notes}})):a.materials=[],a.session_date){const t={session_date:a.session_date,idannee:c.value};_.value?.type==="PROF"&&!P.value&&(t.idprof=_.value.idpers),await i(t)}}catch{w.create({type:"negative",message:"Erreur chargement détails."}),le()}finally{q.details=!1}},H=async n=>{q.history=!0;try{const s=await Q("get",`/lesson-plans/${n}/history`);U.value=s.data}catch{w.create({type:"negative",message:"Erreur chargement historique."})}finally{q.history=!1}},ye=(n,s)=>{s&&(x.value[n]||(x.value[n]={quantity:null,notes:""})),a.materials=Object.entries(u.value).filter(([,e])=>e).map(([e])=>({material_id:parseInt(e),...x.value[e]}))},ue=async()=>{me(),$.value="general",U.value=[];const n=[se(),d()];P.value&&n.push(g(c.value)),await Promise.all(n),f.lessonPlanId?(await ve(f.lessonPlanId),U.value=a.history,f.isViewMode||H(f.lessonPlanId)):(a.session_date=O.formatDate(Date.now(),"YYYY-MM-DD"),_.value?.type==="PROF"&&!P.value&&(a.idprof=_.value.idpers,a.prof_name_display=`${_.value.nom||""} ${_.value.prenom||""}`.trim()||"N/A"),ie(a.session_date))},me=()=>{Object.assign(a,ne()),u.value={},x.value={},L.value&&L.value.resetValidation()},_e=()=>{me()},ce=()=>{le()},le=()=>{E("update:isDialogVisible",!1)},be=async()=>{if(!await L.value.validate()){w.create({type:"warning",message:"Veuillez corriger les erreurs."});return}S.value=!0;const s={...a};s.materials=Object.entries(u.value).filter(([,e])=>e).map(([e,t])=>({material_id:parseInt(e),quantity:x.value[e]?.quantity||null,notes:x.value[e]?.notes||null})),delete s.prof_name_display;try{let e;F.value?e=await Q("post","/lesson-plans",s):e=await Q("put",`/lesson-plans/${f.lessonPlanId}`,s),w.create({type:"positive",message:"Cahier Journal sauvegardé."}),E("lessonPlanSaved",e.data),le()}catch(e){console.error("Error saving lesson plan:",e.response),e.response&&e.response.status===422?w.create({type:"negative",message:"Validation échouée: "+(e.response.data.message||"Vérifiez les champs.")}):w.create({type:"negative",message:e.response?.data?.message||"Erreur sauvegarde."})}finally{S.value=!1}},pe=(n,s)=>{if(n==="item"){if(f.isViewMode&&!Ve(s))return!1}else if(f.isViewMode&&n==="check")return s;return!0},Ve=n=>!!a.materials.find(e=>n.materials.find(t=>t.id===e.material_id));return ge(()=>[f.lessonPlanId,f.isDialogVisible],([n,s])=>{s&&(n!==a.id||n===null&&a.id!==null)&&ue()}),(n,s)=>(r(),v(Fe,{modelValue:z.value,"onUpdate:modelValue":s[11]||(s[11]=e=>z.value=e),persistent:"",maximized:"",onBeforeShow:ue,onHide:_e},{default:o(()=>[l($e,{class:"un-flex flex-col h-full"},{default:o(()=>[l(Xe,{class:"bg-primary text-white shadow-2"},{default:o(()=>[l(T,{flat:"",dense:"",icon:"sym_o_arrow_back",onClick:ce}),l(Ge,null,{default:o(()=>[C(p(K.value),1)]),_:1}),l(Ke),V.isViewMode?D("",!0):(r(),v(T,{key:0,label:"Sauvegarder",icon:"sym_o_save",onClick:be,loading:S.value,class:"mr-sm rounded-md",unelevated:""},null,8,["loading"])),l(T,{flat:"",dense:"",icon:"sym_o_close",onClick:ce})]),_:1}),l(ke,{class:"flex-grow overflow-auto p-0 un-flex flex-col"},{default:o(()=>[l(aa,{ref_key:"mainFormRef",ref:L,class:"h-full un-flex flex-col"},{default:o(()=>[l(Ee,{modelValue:$.value,"onUpdate:modelValue":s[0]||(s[0]=e=>$.value=e),dense:"",class:"lt-md text-primary-dark bg-slate-50","active-bg-color":"primary-light","active-color":"primary","indicator-color":"primary",align:"justify"},{default:o(()=>[l(Z,{name:"general",icon:"sym_o_article",label:"Général"}),l(Z,{name:"materials",icon:"sym_o_note_alt",label:"Matériels"}),F.value?D("",!0):(r(),v(Z,{key:0,name:"history",icon:"sym_o_history",label:"Historique"}))]),_:1},8,["modelValue"]),m("div",ta,[m("div",la,[l(Ee,{modelValue:$.value,"onUpdate:modelValue":s[1]||(s[1]=e=>$.value=e),vertical:"",class:"text-primary-dark bg-slate-50","active-bg-color":"primary-light","active-color":"primary","indicator-color":"primary"},{default:o(()=>[l(Z,{name:"general",icon:"sym_o_article",label:"Informations Générales"}),l(Z,{name:"materials",icon:"sym_o_note_alt",label:"Matériels Utilisés"}),F.value?D("",!0):(r(),v(Z,{key:0,name:"history",icon:"sym_o_history",label:"Historique des Modifications"}))]),_:1},8,["modelValue"])]),l(Ze,{modelValue:$.value,"onUpdate:modelValue":s[10]||(s[10]=e=>$.value=e),animated:"",swipeable:"","transition-prev":"jump-up","transition-next":"jump-up",class:"flex-grow h-full p-4 overflow-y-auto md:basis-4/5"},{default:o(()=>[l(Me,{name:"general",class:"space-y-4"},{default:o(()=>[s[13]||(s[13]=m("div",{class:"text-lg font-semibold text-slate-700"},"Détails de la Séance",-1)),m("div",oa,[l(N,{dense:"",filled:"",required:"",modelValue:a.session_date,"onUpdate:modelValue":[s[3]||(s[3]=e=>a.session_date=e),ie],label:"Date de la Séance *",mask:"####-##-##",rules:[e=>!!e||"Date requise"],readonly:V.isViewMode,standout:"bg-sky-50",class:"rounded-md"},{prepend:o(()=>[l(J,{name:"sym_o_event",class:"cursor-pointer"},{default:o(()=>[V.isViewMode?D("",!0):(r(),v(Ye,{key:0},{default:o(()=>[l(we,{modelValue:a.session_date,"onUpdate:modelValue":s[2]||(s[2]=e=>a.session_date=e),mask:"YYYY-MM-DD",minimal:""},null,8,["modelValue"])]),_:1}))]),_:1})]),_:1},8,["modelValue","rules","readonly"]),l(B,{dense:"",filled:"",required:"",modelValue:a.emploi_classe_id,"onUpdate:modelValue":[s[4]||(s[4]=e=>a.emploi_classe_id=e),de],options:X.value,label:"Créneau Horaire *","emit-value":"","map-options":"",rules:[e=>!!e||"Créneau requis"],readonly:V.isViewMode||!a.session_date,loading:q.emploiClasses,disable:!a.session_date,standout:"bg-sky-50",class:"rounded-md"},{"no-option":o(()=>[l(Ce,null,{default:o(()=>[l(re,{class:"text-grey-7"},{default:o(()=>s[12]||(s[12]=[C("Sélectionnez d'abord une date ou aucun créneau disponible.")])),_:1})]),_:1})]),_:1},8,["modelValue","options","rules","readonly","loading","disable"]),P.value&&!V.isViewMode?(r(),v(B,{key:0,dense:"",filled:"",modelValue:a.idprof,"onUpdate:modelValue":s[5]||(s[5]=e=>a.idprof=e),options:A(ae),label:"Professeur Responsable","emit-value":"","map-options":"","option-value":"value","option-label":"label",clearable:"",readonly:V.isViewMode,loading:q.professors,standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","options","readonly","loading"])):(r(),v(N,{key:1,dense:"",filled:"","model-value":a.prof_name_display,label:"Professeur Responsable",readonly:"",standout:"bg-slate-100",class:"rounded-md"},null,8,["model-value"])),l(B,{dense:"",filled:"",required:"",modelValue:a.status,"onUpdate:modelValue":s[6]||(s[6]=e=>a.status=e),options:A(j),label:"Statut de la Séance *","emit-value":"","map-options":"",rules:[e=>!!e||"Statut requis"],readonly:V.isViewMode,standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","options","rules","readonly"])]),l(N,{modelValue:a.pedagogical_objective,"onUpdate:modelValue":s[7]||(s[7]=e=>a.pedagogical_objective=e),type:"textarea",label:"Objectif Pédagogique",autogrow:"",dense:"",filled:"",readonly:V.isViewMode,standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","readonly"]),l(N,{modelValue:a.targeted_competencies,"onUpdate:modelValue":s[8]||(s[8]=e=>a.targeted_competencies=e),type:"textarea",label:"Compétence(s) Ciblée(s)",autogrow:"",dense:"",filled:"",readonly:V.isViewMode,standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","readonly"]),l(N,{modelValue:a.observations,"onUpdate:modelValue":s[9]||(s[9]=e=>a.observations=e),type:"textarea",label:"Observations / Remarques",autogrow:"",dense:"",filled:"",readonly:V.isViewMode,standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","readonly"]),V.isViewMode&&a.created_at?(r(),k("div",ra,[m("p",null,"Créé le: "+p(te(a.created_at,"DD/MM/YYYY HH:mm"))+" par "+p(a.created_by?.nom||"N/A"),1),m("p",null,"Mis à jour le: "+p(te(a.updated_at,"DD/MM/YYYY HH:mm"))+" par "+p(a.updated_by?.nom||"N/A"),1)])):D("",!0)]),_:1}),l(Me,{name:"materials",class:"space-y-2"},{default:o(()=>[s[16]||(s[16]=m("div",{class:"text-lg font-semibold text-slate-700 mb-2"},"Matériels et Supports Pédagogiques",-1)),q.materialTypes?(r(),k("div",na,[l(Qe,{color:"primary",size:"md"}),s[14]||(s[14]=C(" Chargement... "))])):A(W).length===0?(r(),v(Se,{key:1,class:"text-grey-6"},{default:o(()=>s[15]||(s[15]=[C("Aucun matériel disponible.")])),_:1})):(r(!0),k(fe,{key:2},xe(A(W),e=>(r(),k("div",{key:e.id,class:"mb-3"},[pe("item",e)?(r(),v(ea,{key:0,"expand-separator":"",label:e.name,"header-class":"bg-slate-100 text-slate-700 font-medium rounded-t-md",class:"rounded-md shadow-sm","default-opened":""},{default:o(()=>[m("div",ia,[(r(!0),k(fe,null,xe(e.materials,t=>(r(),k(fe,{key:t.id},[pe("check",u.value[t.id])?(r(),k("div",da,[l(qe,{modelValue:u.value[t.id],"onUpdate:modelValue":[h=>u.value[t.id]=h,h=>ye(t.id,h)],label:t.name,disable:V.isViewMode,dense:""},null,8,["modelValue","onUpdate:modelValue","label","disable"]),u.value[t.id]?(r(),k("div",ua,[l(N,{modelValue:x.value[t.id].quantity,"onUpdate:modelValue":h=>x.value[t.id].quantity=h,type:"number",label:"Quantité",dense:"",filled:"",min:0,readonly:V.isViewMode,standout:"bg-sky-50 text-sm",class:"rounded-md text-xs"},null,8,["modelValue","onUpdate:modelValue","readonly"]),l(N,{modelValue:x.value[t.id].notes,"onUpdate:modelValue":h=>x.value[t.id].notes=h,label:"Notes (version, prépa.)",dense:"",filled:"",readonly:V.isViewMode,standout:"bg-sky-50 text-sm",class:"rounded-md text-xs"},null,8,["modelValue","onUpdate:modelValue","readonly"])])):D("",!0)])):D("",!0)],64))),128)),e.materials.length===0?(r(),k("div",ma,"Aucun matériel dans cette catégorie. ")):D("",!0)])]),_:2},1032,["label"])):D("",!0)]))),128))]),_:1}),F.value?D("",!0):(r(),v(Me,{key:0,name:"history"},{default:o(()=>[s[18]||(s[18]=m("div",{class:"text-lg font-semibold text-slate-700 mb-2"},"Historique des Modifications",-1)),q.history?(r(),k("div",ca,[l(Qe,{color:"primary",size:"md"}),s[17]||(s[17]=C(" Chargement..."))])):U.value.length>0?(r(),v(Se,{key:1,bordered:"",separator:"",class:"rounded-md"},{default:o(()=>[(r(!0),k(fe,null,xe(U.value,e=>(r(),v(Ce,{key:e.id},{default:o(()=>[l(re,null,{default:o(()=>[l(ee,{class:"text-sm"},{default:o(()=>[m("span",pa,p(e.change_description||e.field_changed),1),C(" par "+p(e.changed_by?.nom||"Système")+" "+p(e.changed_by?.prenom||""),1)]),_:2},1024),l(ee,{caption:""},{default:o(()=>[C("Le "+p(te(e.changed_at,"DD/MM/YYYY HH:mm:ss")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),k("div",fa,"Aucun historique de modification."))]),_:1}))]),_:1},8,["modelValue"])])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},va={class:"p-4"},ya={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3"},_a={class:"mt-3 flex justify-end gap-2"},ba={class:"mb-4 flex justify-between items-center"},Va={class:"text-md text-gray-600"},xa={key:0,class:"text-sm text-primary ml-2"},ha={class:"flex gap-2 items-center"},Da={key:0,class:"text-center p-10"},Ma={key:1,class:"text-center p-10 bg-red-50 border border-red-200 rounded-md"},ka={class:"text-gray-600"},wa={key:2,class:"text-center p-10 bg-gray-50 border border-gray-200 rounded-md"},Ya={class:"text-sm text-gray-500"},Ca={class:"text-sm text-gray-500"},Sa={class:"flex gap-1"},Qa={__name:"LessonPlanListPage",setup(V){const I=Ne(()=>ze(()=>import("./LessonPlanDailyReport-CeUQ-mxd.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]),import.meta.url)),f=Pe(),E=Oe(),Y=b(()=>E.getters["user/user"]),_=b(()=>E.getters["user/current"]),R=b(()=>E.getters["ecole/info"]),c=b(()=>_.value?.annee?.idannee),P=b(()=>_.value?.classe?.idclasse),L=b(()=>Y.value?.type==="USER"||Y.value?.isAdmin),$=b(()=>ne(Y.value)),S=y([]),U=oe({lessonPlans:!1}),j=y(""),{classOptions:W,matiereOptions:G,professorOptions:ae,statusOptions:se,fetchAcademicYears:d,fetchClasses:i,fetchMatieres:g,fetchProfessors:M,fetchStatusOptions:q,isProf:ne}=Ue(),a=oe({annee_id:null,classe_id:null,matiere_id:null,prof_id:null,date_from:null,date_to:null,status:null}),u=oe({current_page:1,per_page:15,total:0,last_page:1}),x=y(!1),z=y(null),F=y(!1),K=y(0),te=y(null),X=b(()=>!0),ie=b(()=>X.value?{reportDate:a.date_from,lessonPlans:S.value,schoolInfo:R.value,currentUser:Y.value}:{}),de=(s,e="DD/MM/YYYY")=>s?O.formatDate(s,e):"",ve=s=>!a.date_from||O.extractDate(s,"YYYY/MM/DD")>=O.extractDate(a.date_from,"YYYY-MM-DD"),H=async(s=1)=>{U.lessonPlans=!0,j.value="",u.current_page=s;try{const e={...a,page:u.current_page,per_page:u.per_page};Object.keys(e).forEach(h=>{(e[h]===null||e[h]==="")&&delete e[h]}),X.value&&e.date_from&&e.date_to;const t=await Q("get","/lesson-plans",{params:e});t.data&&t.data.data?(S.value=t.data.data.map(h=>({...h,status_display:se.value.find(Ae=>Ae.value===h.status)?.label||h.status})),u.total=t.data.total,u.last_page=t.data.last_page,u.current_page=t.data.current_page,u.per_page=t.data.per_page):(S.value=[],u.total=0)}catch(e){console.error("Error fetching lesson plans:",e),j.value=e.response?.data?.message||"Erreur chargement.",w.create({type:"negative",message:j.value}),S.value=[],u.total=0}finally{U.lessonPlans=!1}},ye=Le(()=>H(1),700);ge(a,ye,{deep:!0}),ge(()=>_.value?.annee?.idannee,s=>{a.annee_id=c.value}),ge(()=>P.value,s=>{a.classe_id=P.value});const ue=()=>{a.classe_id=null,a.matiere_id=null,a.prof_id=null,a.date_from=null,a.date_to=null,a.status=null,a.annee_id=c.value},me=()=>{z.value=null,F.value=!1,K.value++,x.value=!0},_e=s=>{z.value=s.id,F.value=!1,K.value++,x.value=!0},ce=s=>{z.value=s.id,F.value=!0,K.value++,x.value=!0},le=()=>{H(u.current_page)},be=s=>Y.value?.type==="PROF"&&s.idprof===Y.value?.idpers?O.isSameDate(new Date(s.created_at),new Date,"day"):!1,pe=s=>Y.value?.type==="PROF"&&s.idprof===Y.value?.idpers,Ve=s=>{f.dialog({title:"Confirmer Suppression",message:"Êtes-vous sûr de vouloir supprimer ce Cahier Journal ?",cancel:{label:"Annuler",color:"grey",flat:!0},ok:{label:"Supprimer",color:"negative",unelevated:!0}}).onOk(async()=>{f.loading.show({message:"Suppression..."});try{await Q("delete",`/lesson-plans/${s}`),w.create({type:"positive",message:"Cahier Journal supprimé."}),H(S.value.length===1&&u.current_page>1?u.current_page-1:u.current_page)}catch(e){w.create({type:"negative",message:e.response?.data?.message||"Erreur suppression."})}finally{f.loading.hide()}})},n=s=>({PLANNED:{name:"blue-6",bg:"blue-1",text:"blue-8"},COMPLETED:{name:"positive",bg:"green-1",text:"green-8"},PARTIALLY_COMPLETED:{name:"warning",bg:"orange-1",text:"orange-8"},CANCELLED_SESSION:{name:"grey-7",bg:"grey-3",text:"grey-9"}})[s]||{name:"grey",bg:"grey-2",text:"grey-8"};return je(async()=>{f.loading.show({delay:300}),await E.dispatch("ecole/getInfo"),await q(),await d(),a.annee_id=c.value,a.annee_id&&await Promise.all([i(a.annee_id,Y.value),g(a.annee_id),L.value?M(a.annee_id):Promise.resolve()]),await H(1),f.loading.hide()}),(s,e)=>(r(),v(Re,{class:"page-content lesson-plan-list-page bg-gray-100 rounded-none"},{default:o(()=>[m("div",va,[l($e,{flat:"",bordered:"",class:"mb-4 shadow-sm"},{default:o(()=>[l(ke,{class:"bg-slate-50"},{default:o(()=>e[10]||(e[10]=[m("div",{class:"text-xl font-semibold text-slate-700"},"Cahier Journals",-1),m("p",{class:"text-sm text-slate-500"},"Gérer les fiches de préparation des cours.",-1)])),_:1}),l(ke,null,{default:o(()=>[m("div",ya,[l(B,{dense:"",filled:"",modelValue:a.classe_id,"onUpdate:modelValue":e[0]||(e[0]=t=>a.classe_id=t),options:A(W),label:"Classe","emit-value":"","map-options":"","option-value":"value","option-label":"label",clearable:"",standout:"bg-sky-50",class:"rounded-md",disable:!a.annee_id},null,8,["modelValue","options","disable"]),l(B,{dense:"",filled:"",modelValue:a.matiere_id,"onUpdate:modelValue":e[1]||(e[1]=t=>a.matiere_id=t),options:A(G),label:"Matière","emit-value":"","map-options":"","option-value":"value","option-label":"label",clearable:"",standout:"bg-sky-50",class:"rounded-md",disable:!a.annee_id},null,8,["modelValue","options","disable"]),L.value?(r(),v(B,{key:0,dense:"",filled:"",modelValue:a.prof_id,"onUpdate:modelValue":e[2]||(e[2]=t=>a.prof_id=t),options:A(ae),label:"Professeur","emit-value":"","map-options":"","option-value":"value","option-label":"label",clearable:"",standout:"bg-sky-50",class:"rounded-md",disable:!a.annee_id},null,8,["modelValue","options","disable"])):D("",!0),l(N,{dense:"",filled:"",modelValue:a.date_from,"onUpdate:modelValue":e[4]||(e[4]=t=>a.date_from=t),label:"Date Début (ou Date Journal)",mask:"####-##-##",clearable:"",standout:"bg-sky-50",class:"rounded-md"},{prepend:o(()=>[l(J,{name:"sym_o_event",class:"cursor-pointer"},{default:o(()=>[l(Ye,null,{default:o(()=>[l(we,{modelValue:a.date_from,"onUpdate:modelValue":e[3]||(e[3]=t=>a.date_from=t),mask:"YYYY-MM-DD",minimal:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(N,{dense:"",filled:"",modelValue:a.date_to,"onUpdate:modelValue":e[6]||(e[6]=t=>a.date_to=t),label:"Date Fin (laisser vide pour Journal)",mask:"####-##-##",clearable:"",standout:"bg-sky-50",class:"rounded-md",rules:[t=>!t||!a.date_from||A(O).extractDate(t,"YYYY-MM-DD")>=A(O).extractDate(a.date_from,"YYYY-MM-DD")||"Date fin >= date début"]},{prepend:o(()=>[l(J,{name:"sym_o_event",class:"cursor-pointer"},{default:o(()=>[l(Ye,null,{default:o(()=>[l(we,{modelValue:a.date_to,"onUpdate:modelValue":e[5]||(e[5]=t=>a.date_to=t),mask:"YYYY-MM-DD",minimal:"",options:ve},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","rules"]),l(B,{dense:"",filled:"",modelValue:a.status,"onUpdate:modelValue":e[7]||(e[7]=t=>a.status=t),options:A(se),label:"Statut","emit-value":"","map-options":"","option-value":"value","option-label":"label",clearable:"",standout:"bg-sky-50",class:"rounded-md"},null,8,["modelValue","options"])]),m("div",_a,[l(T,{unelevated:"",label:"Effacer Filtres",color:"grey-7",onClick:ue,icon:"sym_o_clear",class:"rounded-md",size:"sm"})])]),_:1})]),_:1}),m("div",ba,[m("div",Va,[C(p(u.total)+" fiche(s) trouvée(s). ",1),X.value?(r(),k("span",xa,"(Journal du "+p(a.date_from)+")",1)):D("",!0)]),m("div",ha,[X.value&&S.value.length>0?(r(),v(sa,{key:0,ref_key:"exportControlsRef",ref:te,"report-component":A(I),"report-data":ie.value,"pdf-filename-prefix":"Cahier_Journal","pdf-title":"Cahier Journal","pdf-orientation":"landscape","pdf-format":"a4","pdf-margin":[10,10,10,10],"report-component-styles":[{url:"/reports/lesson_plan_report.css"}]},null,8,["report-component","report-data"])):D("",!0),$.value?(r(),v(T,{key:1,color:"primary",icon:"sym_o_add_circle",label:"Nouveau Cahier Journal",onClick:me,class:"rounded-md",unelevated:""})):D("",!0)])]),U.lessonPlans?(r(),k("div",Da,[l(He,{color:"primary",size:"xl"}),e[11]||(e[11]=m("p",{class:"text-gray-500 mt-2"},"Chargement des cahiers de textes...",-1))])):j.value?(r(),k("div",Ma,[l(J,{name:"sym_o_error",size:"lg",color:"negative"}),e[12]||(e[12]=m("p",{class:"text-negative mt-2 font-semibold"},"Erreur de chargement",-1)),m("p",ka,p(j.value),1)])):S.value.length?(r(),v(Se,{key:3,bordered:"",separator:"",class:"rounded-lg bg-white shadow"},{default:o(()=>[l(Be,{items:S.value,separator:"",style:{"max-height":"70vh"}},{default:o(({item:t})=>[(r(),v(Ce,{key:t.id,class:"py-3 hover:bg-slate-50"},{default:o(()=>[l(re,{avatar:"",top:""},{default:o(()=>[l(Te,{color:n(t.status).bg,"text-color":n(t.status).text,icon:"sym_o_event_note",class:"font-bold",size:"lg"},null,8,["color","text-color"])]),_:2},1024),l(re,null,{default:o(()=>[l(ee,{class:"font-semibold text-primary-dark text-md"},{default:o(()=>[C(p(t.emploi_classe?.classe?.classe_fr||"N/A")+" - "+p(t.emploi_classe?.matiere?.matiere_fr||"N/A")+" ",1),m("span",Ya," ("+p(de(t.session_date,"dddd DD MMMM YYYY"))+")",1)]),_:2},1024),l(ee,{caption:"",class:"text-gray-600"},{default:o(()=>[l(J,{name:"sym_o_person",size:"xs",class:"q-mr-xs"}),C(" Prof: "+p(t.prof?.nom||"N/A")+" "+p(t.prof?.prenom||""),1)]),_:2},1024),l(ee,{caption:"",class:"text-gray-600"},{default:o(()=>[l(J,{name:"sym_o_flag",size:"xs",class:"q-mr-xs"}),C(" Objectif: "+p(t.pedagogical_objective?.substring(0,100)||"Non défini")+p(t.pedagogical_objective?.length>100?"...":""),1)]),_:2},1024),l(ee,{caption:"",class:"text-gray-500 text-sm"},{default:o(()=>[C(" Créneau: "+p(t.emploi_classe?.heure_debut?.substring(0,5))+" - "+p(t.emploi_classe?.heure_fin?.substring(0,5))+" | Salle: "+p(t.emploi_classe?.salle?.salle||"N/A"),1)]),_:2},1024)]),_:2},1024),l(re,{side:"",top:"",class:"pt-sm space-y-1 items-end"},{default:o(()=>[l(Je,{square:"",label:t.status_display,color:n(t.status).name,"text-color":"white",class:"text-sm font-medium"},null,8,["label","color"]),m("div",Ca,"MàJ: "+p(de(t.updated_at,"DD/MM/YY HH:mm")),1),m("div",Sa,[l(T,{flat:"",dense:"",round:"",icon:"sym_o_visibility",onClick:he(h=>ce(t),["stop"]),color:"blue-grey-6",size:"sm"},{default:o(()=>[l(De,{class:"bg-gray-800 text-white rounded"},{default:o(()=>e[15]||(e[15]=[C("Voir")])),_:1})]),_:2},1032,["onClick"]),pe(t)?(r(),v(T,{key:0,flat:"",dense:"",round:"",icon:"sym_o_edit",onClick:he(h=>_e(t),["stop"]),color:"secondary",size:"sm"},{default:o(()=>[l(De,{class:"bg-gray-800 text-white rounded"},{default:o(()=>e[16]||(e[16]=[C("Modifier")])),_:1})]),_:2},1032,["onClick"])):D("",!0),be(t)?(r(),v(T,{key:1,flat:"",dense:"",round:"",icon:"sym_o_delete",onClick:he(h=>Ve(t.id),["stop"]),color:"negative",size:"sm"},{default:o(()=>[l(De,{class:"bg-gray-800 text-white rounded"},{default:o(()=>e[17]||(e[17]=[C("Supprimer")])),_:1})]),_:2},1032,["onClick"])):D("",!0)])]),_:2},1024)]),_:2},1024))]),_:1},8,["items"])]),_:1})):(r(),k("div",wa,[l(J,{name:"sym_o_menu_book",size:"lg",color:"grey-5"}),e[13]||(e[13]=m("p",{class:"text-gray-500 mt-2 text-lg"},"Aucun Cahier Journal trouvé.",-1)),e[14]||(e[14]=m("p",{class:"text-gray-400"},"Utilisez les filtres ou ajoutez une nouvelle fiche.",-1))])),u.last_page>1?(r(),v(Ie,{key:4,align:"center",class:"py-4"},{default:o(()=>[l(We,{modelValue:u.current_page,"onUpdate:modelValue":[e[8]||(e[8]=t=>u.current_page=t),H],max:u.last_page,"direction-links":"",flat:"",color:"primary","active-color":"primary",class:"rounded-md"},null,8,["modelValue","max"])]),_:1})):D("",!0)]),(r(),v(ga,{isDialogVisible:x.value,"onUpdate:isDialogVisible":e[9]||(e[9]=t=>x.value=t),"lesson-plan-id":z.value,"is-view-mode":F.value,onLessonPlanSaved:le,key:K.value},null,8,["isDialogVisible","lesson-plan-id","is-view-mode"]))]),_:1}))}},Xa=Object.freeze(Object.defineProperty({__proto__:null,default:Qa},Symbol.toStringTag,{value:"Module"}));export{Xa as L,Ue as u};
